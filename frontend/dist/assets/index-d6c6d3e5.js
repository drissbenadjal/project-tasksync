function p9(e,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(i,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>i[n]})}}}return Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();var Hl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var EB={exports:{}},Tw={},AB={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Av=Symbol.for("react.element"),m9=Symbol.for("react.portal"),g9=Symbol.for("react.fragment"),v9=Symbol.for("react.strict_mode"),y9=Symbol.for("react.profiler"),x9=Symbol.for("react.provider"),w9=Symbol.for("react.context"),b9=Symbol.for("react.forward_ref"),_9=Symbol.for("react.suspense"),S9=Symbol.for("react.memo"),M9=Symbol.for("react.lazy"),xO=Symbol.iterator;function E9(e){return e===null||typeof e!="object"?null:(e=xO&&e[xO]||e["@@iterator"],typeof e=="function"?e:null)}var TB={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},CB=Object.assign,DB={};function ap(e,t,r){this.props=e,this.context=t,this.refs=DB,this.updater=r||TB}ap.prototype.isReactComponent={};ap.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ap.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function PB(){}PB.prototype=ap.prototype;function nC(e,t,r){this.props=e,this.context=t,this.refs=DB,this.updater=r||TB}var sC=nC.prototype=new PB;sC.constructor=nC;CB(sC,ap.prototype);sC.isPureReactComponent=!0;var wO=Array.isArray,OB=Object.prototype.hasOwnProperty,aC={current:null},LB={key:!0,ref:!0,__self:!0,__source:!0};function IB(e,t,r){var i,n={},s=null,a=null;if(t!=null)for(i in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)OB.call(t,i)&&!LB.hasOwnProperty(i)&&(n[i]=t[i]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];n.children=l}if(e&&e.defaultProps)for(i in o=e.defaultProps,o)n[i]===void 0&&(n[i]=o[i]);return{$$typeof:Av,type:e,key:s,ref:a,props:n,_owner:aC.current}}function A9(e,t){return{$$typeof:Av,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function oC(e){return typeof e=="object"&&e!==null&&e.$$typeof===Av}function T9(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var bO=/\/+/g;function p_(e,t){return typeof e=="object"&&e!==null&&e.key!=null?T9(""+e.key):t.toString(36)}function a1(e,t,r,i,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Av:case m9:a=!0}}if(a)return a=e,n=n(a),e=i===""?"."+p_(a,0):i,wO(n)?(r="",e!=null&&(r=e.replace(bO,"$&/")+"/"),a1(n,t,r,"",function(u){return u})):n!=null&&(oC(n)&&(n=A9(n,r+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(bO,"$&/")+"/")+e)),t.push(n)),1;if(a=0,i=i===""?".":i+":",wO(e))for(var o=0;o<e.length;o++){s=e[o];var l=i+p_(s,o);a+=a1(s,t,r,l,n)}else if(l=E9(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=i+p_(s,o++),a+=a1(s,t,r,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function w0(e,t,r){if(e==null)return e;var i=[],n=0;return a1(e,i,"","",function(s){return t.call(r,s,n++)}),i}function C9(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Dn={current:null},o1={transition:null},D9={ReactCurrentDispatcher:Dn,ReactCurrentBatchConfig:o1,ReactCurrentOwner:aC};Yt.Children={map:w0,forEach:function(e,t,r){w0(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return w0(e,function(){t++}),t},toArray:function(e){return w0(e,function(t){return t})||[]},only:function(e){if(!oC(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Yt.Component=ap;Yt.Fragment=g9;Yt.Profiler=y9;Yt.PureComponent=nC;Yt.StrictMode=v9;Yt.Suspense=_9;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D9;Yt.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=CB({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=aC.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)OB.call(t,l)&&!LB.hasOwnProperty(l)&&(i[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];i.children=o}return{$$typeof:Av,type:e.type,key:n,ref:s,props:i,_owner:a}};Yt.createContext=function(e){return e={$$typeof:w9,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:x9,_context:e},e.Consumer=e};Yt.createElement=IB;Yt.createFactory=function(e){var t=IB.bind(null,e);return t.type=e,t};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(e){return{$$typeof:b9,render:e}};Yt.isValidElement=oC;Yt.lazy=function(e){return{$$typeof:M9,_payload:{_status:-1,_result:e},_init:C9}};Yt.memo=function(e,t){return{$$typeof:S9,type:e,compare:t===void 0?null:t}};Yt.startTransition=function(e){var t=o1.transition;o1.transition={};try{e()}finally{o1.transition=t}};Yt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Yt.useCallback=function(e,t){return Dn.current.useCallback(e,t)};Yt.useContext=function(e){return Dn.current.useContext(e)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(e){return Dn.current.useDeferredValue(e)};Yt.useEffect=function(e,t){return Dn.current.useEffect(e,t)};Yt.useId=function(){return Dn.current.useId()};Yt.useImperativeHandle=function(e,t,r){return Dn.current.useImperativeHandle(e,t,r)};Yt.useInsertionEffect=function(e,t){return Dn.current.useInsertionEffect(e,t)};Yt.useLayoutEffect=function(e,t){return Dn.current.useLayoutEffect(e,t)};Yt.useMemo=function(e,t){return Dn.current.useMemo(e,t)};Yt.useReducer=function(e,t,r){return Dn.current.useReducer(e,t,r)};Yt.useRef=function(e){return Dn.current.useRef(e)};Yt.useState=function(e){return Dn.current.useState(e)};Yt.useSyncExternalStore=function(e,t,r){return Dn.current.useSyncExternalStore(e,t,r)};Yt.useTransition=function(){return Dn.current.useTransition()};Yt.version="18.2.0";AB.exports=Yt;var pe=AB.exports;const fe=sp(pe),P9=p9({__proto__:null,default:fe},[pe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O9=pe,L9=Symbol.for("react.element"),I9=Symbol.for("react.fragment"),R9=Object.prototype.hasOwnProperty,k9=O9.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,z9={key:!0,ref:!0,__self:!0,__source:!0};function RB(e,t,r){var i,n={},s=null,a=null;r!==void 0&&(s=""+r),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(i in t)R9.call(t,i)&&!z9.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:L9,type:e,key:s,ref:a,props:n,_owner:k9.current}}Tw.Fragment=I9;Tw.jsx=RB;Tw.jsxs=RB;EB.exports=Tw;var lC=EB.exports;const kB=lC.Fragment,ge=lC.jsx,St=lC.jsxs;var KM={},zB={exports:{}},_s={},NB={exports:{}},BB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(O,W){var N=O.length;O.push(W);e:for(;0<N;){var B=N-1>>>1,j=O[B];if(0<n(j,W))O[B]=W,O[N]=j,N=B;else break e}}function r(O){return O.length===0?null:O[0]}function i(O){if(O.length===0)return null;var W=O[0],N=O.pop();if(N!==W){O[0]=N;e:for(var B=0,j=O.length,Q=j>>>1;B<Q;){var H=2*(B+1)-1,G=O[H],$=H+1,se=O[$];if(0>n(G,N))$<j&&0>n(se,G)?(O[B]=se,O[$]=N,B=$):(O[B]=G,O[H]=N,B=H);else if($<j&&0>n(se,N))O[B]=se,O[$]=N,B=$;else break e}}return W}function n(O,W){var N=O.sortIndex-W.sortIndex;return N!==0?N:O.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,c=null,d=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(O){for(var W=r(u);W!==null;){if(W.callback===null)i(u);else if(W.startTime<=O)i(u),W.sortIndex=W.expirationTime,t(l,W);else break;W=r(u)}}function w(O){if(m=!1,x(O),!p)if(r(l)!==null)p=!0,K(S);else{var W=r(u);W!==null&&q(w,W.startTime-O)}}function S(O,W){p=!1,m&&(m=!1,v(M),M=-1),f=!0;var N=d;try{for(x(W),c=r(l);c!==null&&(!(c.expirationTime>W)||O&&!L());){var B=c.callback;if(typeof B=="function"){c.callback=null,d=c.priorityLevel;var j=B(c.expirationTime<=W);W=e.unstable_now(),typeof j=="function"?c.callback=j:c===r(l)&&i(l),x(W)}else i(l);c=r(l)}if(c!==null)var Q=!0;else{var H=r(u);H!==null&&q(w,H.startTime-W),Q=!1}return Q}finally{c=null,d=N,f=!1}}var _=!1,A=null,M=-1,T=5,C=-1;function L(){return!(e.unstable_now()-C<T)}function I(){if(A!==null){var O=e.unstable_now();C=O;var W=!0;try{W=A(!0,O)}finally{W?k():(_=!1,A=null)}}else _=!1}var k;if(typeof y=="function")k=function(){y(I)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,V=z.port2;z.port1.onmessage=I,k=function(){V.postMessage(null)}}else k=function(){g(I,0)};function K(O){A=O,_||(_=!0,k())}function q(O,W){M=g(function(){O(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,K(S))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var W=3;break;default:W=d}var N=d;d=W;try{return O()}finally{d=N}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,W){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var N=d;d=O;try{return W()}finally{d=N}},e.unstable_scheduleCallback=function(O,W,N){var B=e.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?B+N:B):N=B,O){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=N+j,O={id:h++,callback:W,priorityLevel:O,startTime:N,expirationTime:j,sortIndex:-1},N>B?(O.sortIndex=N,t(u,O),r(l)===null&&O===r(u)&&(m?(v(M),M=-1):m=!0,q(w,N-B))):(O.sortIndex=j,t(l,O),p||f||(p=!0,K(S))),O},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(O){var W=d;return function(){var N=d;d=W;try{return O.apply(this,arguments)}finally{d=N}}}})(BB);NB.exports=BB;var N9=NB.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FB=pe,vs=N9;function Ne(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var UB=new Set,Cg={};function Dh(e,t){Of(e,t),Of(e+"Capture",t)}function Of(e,t){for(Cg[e]=t,e=0;e<t.length;e++)UB.add(t[e])}var Ol=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ZM=Object.prototype.hasOwnProperty,B9=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_O={},SO={};function F9(e){return ZM.call(SO,e)?!0:ZM.call(_O,e)?!1:B9.test(e)?SO[e]=!0:(_O[e]=!0,!1)}function U9(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function j9(e,t,r,i){if(t===null||typeof t>"u"||U9(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Pn(e,t,r,i,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){qi[e]=new Pn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];qi[t]=new Pn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){qi[e]=new Pn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){qi[e]=new Pn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){qi[e]=new Pn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){qi[e]=new Pn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){qi[e]=new Pn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){qi[e]=new Pn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){qi[e]=new Pn(e,5,!1,e.toLowerCase(),null,!1,!1)});var uC=/[\-:]([a-z])/g;function cC(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(uC,cC);qi[t]=new Pn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(uC,cC);qi[t]=new Pn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(uC,cC);qi[t]=new Pn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){qi[e]=new Pn(e,1,!1,e.toLowerCase(),null,!1,!1)});qi.xlinkHref=new Pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){qi[e]=new Pn(e,1,!1,e.toLowerCase(),null,!0,!0)});function hC(e,t,r,i){var n=qi.hasOwnProperty(t)?qi[t]:null;(n!==null?n.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(j9(t,r,n,i)&&(r=null),i||n===null?F9(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=r===null?n.type===3?!1:"":r:(t=n.attributeName,i=n.attributeNamespace,r===null?e.removeAttribute(t):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var Vl=FB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b0=Symbol.for("react.element"),zd=Symbol.for("react.portal"),Nd=Symbol.for("react.fragment"),dC=Symbol.for("react.strict_mode"),JM=Symbol.for("react.profiler"),jB=Symbol.for("react.provider"),HB=Symbol.for("react.context"),fC=Symbol.for("react.forward_ref"),eE=Symbol.for("react.suspense"),tE=Symbol.for("react.suspense_list"),pC=Symbol.for("react.memo"),vu=Symbol.for("react.lazy"),VB=Symbol.for("react.offscreen"),MO=Symbol.iterator;function Vp(e){return e===null||typeof e!="object"?null:(e=MO&&e[MO]||e["@@iterator"],typeof e=="function"?e:null)}var Hr=Object.assign,m_;function zm(e){if(m_===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);m_=t&&t[1]||""}return`
`+m_+e}var g_=!1;function v_(e,t){if(!e||g_)return"";g_=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var i=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){i=u}e.call(t.prototype)}else{try{throw Error()}catch(u){i=u}e()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var n=u.stack.split(`
`),s=i.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{g_=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?zm(e):""}function H9(e){switch(e.tag){case 5:return zm(e.type);case 16:return zm("Lazy");case 13:return zm("Suspense");case 19:return zm("SuspenseList");case 0:case 2:case 15:return e=v_(e.type,!1),e;case 11:return e=v_(e.type.render,!1),e;case 1:return e=v_(e.type,!0),e;default:return""}}function rE(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Nd:return"Fragment";case zd:return"Portal";case JM:return"Profiler";case dC:return"StrictMode";case eE:return"Suspense";case tE:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case HB:return(e.displayName||"Context")+".Consumer";case jB:return(e._context.displayName||"Context")+".Provider";case fC:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case pC:return t=e.displayName||null,t!==null?t:rE(e.type)||"Memo";case vu:t=e._payload,e=e._init;try{return rE(e(t))}catch{}}return null}function V9(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rE(t);case 8:return t===dC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ju(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function WB(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function W9(e){var t=WB(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function _0(e){e._valueTracker||(e._valueTracker=W9(e))}function GB(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=WB(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function B1(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function iE(e,t){var r=t.checked;return Hr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function EO(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=Ju(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function YB(e,t){t=t.checked,t!=null&&hC(e,"checked",t,!1)}function nE(e,t){YB(e,t);var r=Ju(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?sE(e,t.type,r):t.hasOwnProperty("defaultValue")&&sE(e,t.type,Ju(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function AO(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function sE(e,t,r){(t!=="number"||B1(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Nm=Array.isArray;function af(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+Ju(r),t=null,n=0;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,i&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function aE(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ne(91));return Hr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function TO(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Ne(92));if(Nm(r)){if(1<r.length)throw Error(Ne(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Ju(r)}}function qB(e,t){var r=Ju(t.value),i=Ju(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function CO(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function XB(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oE(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?XB(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var S0,$B=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,n){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(S0=S0||document.createElement("div"),S0.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=S0.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Dg(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Qm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},G9=["Webkit","ms","Moz","O"];Object.keys(Qm).forEach(function(e){G9.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Qm[t]=Qm[e]})});function QB(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Qm.hasOwnProperty(e)&&Qm[e]?(""+t).trim():t+"px"}function KB(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=QB(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}var Y9=Hr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lE(e,t){if(t){if(Y9[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ne(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ne(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ne(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ne(62))}}function uE(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cE=null;function mC(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var hE=null,of=null,lf=null;function DO(e){if(e=Dv(e)){if(typeof hE!="function")throw Error(Ne(280));var t=e.stateNode;t&&(t=Lw(t),hE(e.stateNode,e.type,t))}}function ZB(e){of?lf?lf.push(e):lf=[e]:of=e}function JB(){if(of){var e=of,t=lf;if(lf=of=null,DO(e),t)for(e=0;e<t.length;e++)DO(t[e])}}function eF(e,t){return e(t)}function tF(){}var y_=!1;function rF(e,t,r){if(y_)return e(t,r);y_=!0;try{return eF(e,t,r)}finally{y_=!1,(of!==null||lf!==null)&&(tF(),JB())}}function Pg(e,t){var r=e.stateNode;if(r===null)return null;var i=Lw(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Ne(231,t,typeof r));return r}var dE=!1;if(Ol)try{var Wp={};Object.defineProperty(Wp,"passive",{get:function(){dE=!0}}),window.addEventListener("test",Wp,Wp),window.removeEventListener("test",Wp,Wp)}catch{dE=!1}function q9(e,t,r,i,n,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(h){this.onError(h)}}var Km=!1,F1=null,U1=!1,fE=null,X9={onError:function(e){Km=!0,F1=e}};function $9(e,t,r,i,n,s,a,o,l){Km=!1,F1=null,q9.apply(X9,arguments)}function Q9(e,t,r,i,n,s,a,o,l){if($9.apply(this,arguments),Km){if(Km){var u=F1;Km=!1,F1=null}else throw Error(Ne(198));U1||(U1=!0,fE=u)}}function Ph(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function iF(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function PO(e){if(Ph(e)!==e)throw Error(Ne(188))}function K9(e){var t=e.alternate;if(!t){if(t=Ph(e),t===null)throw Error(Ne(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return PO(n),e;if(s===i)return PO(n),t;s=s.sibling}throw Error(Ne(188))}if(r.return!==i.return)r=n,i=s;else{for(var a=!1,o=n.child;o;){if(o===r){a=!0,r=n,i=s;break}if(o===i){a=!0,i=n,r=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===r){a=!0,r=s,i=n;break}if(o===i){a=!0,i=s,r=n;break}o=o.sibling}if(!a)throw Error(Ne(189))}}if(r.alternate!==i)throw Error(Ne(190))}if(r.tag!==3)throw Error(Ne(188));return r.stateNode.current===r?e:t}function nF(e){return e=K9(e),e!==null?sF(e):null}function sF(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=sF(e);if(t!==null)return t;e=e.sibling}return null}var aF=vs.unstable_scheduleCallback,OO=vs.unstable_cancelCallback,Z9=vs.unstable_shouldYield,J9=vs.unstable_requestPaint,ri=vs.unstable_now,e7=vs.unstable_getCurrentPriorityLevel,gC=vs.unstable_ImmediatePriority,oF=vs.unstable_UserBlockingPriority,j1=vs.unstable_NormalPriority,t7=vs.unstable_LowPriority,lF=vs.unstable_IdlePriority,Cw=null,co=null;function r7(e){if(co&&typeof co.onCommitFiberRoot=="function")try{co.onCommitFiberRoot(Cw,e,void 0,(e.current.flags&128)===128)}catch{}}var Ma=Math.clz32?Math.clz32:s7,i7=Math.log,n7=Math.LN2;function s7(e){return e>>>=0,e===0?32:31-(i7(e)/n7|0)|0}var M0=64,E0=4194304;function Bm(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function H1(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,n=e.suspendedLanes,s=e.pingedLanes,a=r&268435455;if(a!==0){var o=a&~n;o!==0?i=Bm(o):(s&=a,s!==0&&(i=Bm(s)))}else a=r&~n,a!==0?i=Bm(a):s!==0&&(i=Bm(s));if(i===0)return 0;if(t!==0&&t!==i&&!(t&n)&&(n=i&-i,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(i&4&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-Ma(t),n=1<<r,i|=e[r],t&=~n;return i}function a7(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function o7(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-Ma(s),o=1<<a,l=n[a];l===-1?(!(o&r)||o&i)&&(n[a]=a7(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function pE(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function uF(){var e=M0;return M0<<=1,!(M0&4194240)&&(M0=64),e}function x_(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Tv(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ma(t),e[t]=r}function l7(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-Ma(r),s=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~s}}function vC(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-Ma(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var hr=0;function cF(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var hF,yC,dF,fF,pF,mE=!1,A0=[],Bu=null,Fu=null,Uu=null,Og=new Map,Lg=new Map,wu=[],u7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function LO(e,t){switch(e){case"focusin":case"focusout":Bu=null;break;case"dragenter":case"dragleave":Fu=null;break;case"mouseover":case"mouseout":Uu=null;break;case"pointerover":case"pointerout":Og.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lg.delete(t.pointerId)}}function Gp(e,t,r,i,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},t!==null&&(t=Dv(t),t!==null&&yC(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function c7(e,t,r,i,n){switch(t){case"focusin":return Bu=Gp(Bu,e,t,r,i,n),!0;case"dragenter":return Fu=Gp(Fu,e,t,r,i,n),!0;case"mouseover":return Uu=Gp(Uu,e,t,r,i,n),!0;case"pointerover":var s=n.pointerId;return Og.set(s,Gp(Og.get(s)||null,e,t,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,Lg.set(s,Gp(Lg.get(s)||null,e,t,r,i,n)),!0}return!1}function mF(e){var t=Wc(e.target);if(t!==null){var r=Ph(t);if(r!==null){if(t=r.tag,t===13){if(t=iF(r),t!==null){e.blockedOn=t,pF(e.priority,function(){dF(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function l1(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=gE(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);cE=i,r.target.dispatchEvent(i),cE=null}else return t=Dv(r),t!==null&&yC(t),e.blockedOn=r,!1;t.shift()}return!0}function IO(e,t,r){l1(e)&&r.delete(t)}function h7(){mE=!1,Bu!==null&&l1(Bu)&&(Bu=null),Fu!==null&&l1(Fu)&&(Fu=null),Uu!==null&&l1(Uu)&&(Uu=null),Og.forEach(IO),Lg.forEach(IO)}function Yp(e,t){e.blockedOn===t&&(e.blockedOn=null,mE||(mE=!0,vs.unstable_scheduleCallback(vs.unstable_NormalPriority,h7)))}function Ig(e){function t(n){return Yp(n,e)}if(0<A0.length){Yp(A0[0],e);for(var r=1;r<A0.length;r++){var i=A0[r];i.blockedOn===e&&(i.blockedOn=null)}}for(Bu!==null&&Yp(Bu,e),Fu!==null&&Yp(Fu,e),Uu!==null&&Yp(Uu,e),Og.forEach(t),Lg.forEach(t),r=0;r<wu.length;r++)i=wu[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<wu.length&&(r=wu[0],r.blockedOn===null);)mF(r),r.blockedOn===null&&wu.shift()}var uf=Vl.ReactCurrentBatchConfig,V1=!0;function d7(e,t,r,i){var n=hr,s=uf.transition;uf.transition=null;try{hr=1,xC(e,t,r,i)}finally{hr=n,uf.transition=s}}function f7(e,t,r,i){var n=hr,s=uf.transition;uf.transition=null;try{hr=4,xC(e,t,r,i)}finally{hr=n,uf.transition=s}}function xC(e,t,r,i){if(V1){var n=gE(e,t,r,i);if(n===null)D_(e,t,i,W1,r),LO(e,i);else if(c7(n,e,t,r,i))i.stopPropagation();else if(LO(e,i),t&4&&-1<u7.indexOf(e)){for(;n!==null;){var s=Dv(n);if(s!==null&&hF(s),s=gE(e,t,r,i),s===null&&D_(e,t,i,W1,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else D_(e,t,i,null,r)}}var W1=null;function gE(e,t,r,i){if(W1=null,e=mC(i),e=Wc(e),e!==null)if(t=Ph(e),t===null)e=null;else if(r=t.tag,r===13){if(e=iF(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return W1=e,null}function gF(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(e7()){case gC:return 1;case oF:return 4;case j1:case t7:return 16;case lF:return 536870912;default:return 16}default:return 16}}var Au=null,wC=null,u1=null;function vF(){if(u1)return u1;var e,t=wC,r=t.length,i,n="value"in Au?Au.value:Au.textContent,s=n.length;for(e=0;e<r&&t[e]===n[e];e++);var a=r-e;for(i=1;i<=a&&t[r-i]===n[s-i];i++);return u1=n.slice(e,1<i?1-i:void 0)}function c1(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function T0(){return!0}function RO(){return!1}function Ss(e){function t(r,i,n,s,a){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?T0:RO,this.isPropagationStopped=RO,this}return Hr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=T0)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=T0)},persist:function(){},isPersistent:T0}),t}var op={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bC=Ss(op),Cv=Hr({},op,{view:0,detail:0}),p7=Ss(Cv),w_,b_,qp,Dw=Hr({},Cv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_C,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qp&&(qp&&e.type==="mousemove"?(w_=e.screenX-qp.screenX,b_=e.screenY-qp.screenY):b_=w_=0,qp=e),w_)},movementY:function(e){return"movementY"in e?e.movementY:b_}}),kO=Ss(Dw),m7=Hr({},Dw,{dataTransfer:0}),g7=Ss(m7),v7=Hr({},Cv,{relatedTarget:0}),__=Ss(v7),y7=Hr({},op,{animationName:0,elapsedTime:0,pseudoElement:0}),x7=Ss(y7),w7=Hr({},op,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),b7=Ss(w7),_7=Hr({},op,{data:0}),zO=Ss(_7),S7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},M7={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},E7={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function A7(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=E7[e])?!!t[e]:!1}function _C(){return A7}var T7=Hr({},Cv,{key:function(e){if(e.key){var t=S7[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=c1(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?M7[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_C,charCode:function(e){return e.type==="keypress"?c1(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?c1(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),C7=Ss(T7),D7=Hr({},Dw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),NO=Ss(D7),P7=Hr({},Cv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_C}),O7=Ss(P7),L7=Hr({},op,{propertyName:0,elapsedTime:0,pseudoElement:0}),I7=Ss(L7),R7=Hr({},Dw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),k7=Ss(R7),z7=[9,13,27,32],SC=Ol&&"CompositionEvent"in window,Zm=null;Ol&&"documentMode"in document&&(Zm=document.documentMode);var N7=Ol&&"TextEvent"in window&&!Zm,yF=Ol&&(!SC||Zm&&8<Zm&&11>=Zm),BO=String.fromCharCode(32),FO=!1;function xF(e,t){switch(e){case"keyup":return z7.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wF(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Bd=!1;function B7(e,t){switch(e){case"compositionend":return wF(t);case"keypress":return t.which!==32?null:(FO=!0,BO);case"textInput":return e=t.data,e===BO&&FO?null:e;default:return null}}function F7(e,t){if(Bd)return e==="compositionend"||!SC&&xF(e,t)?(e=vF(),u1=wC=Au=null,Bd=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return yF&&t.locale!=="ko"?null:t.data;default:return null}}var U7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function UO(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!U7[e.type]:t==="textarea"}function bF(e,t,r,i){ZB(i),t=G1(t,"onChange"),0<t.length&&(r=new bC("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Jm=null,Rg=null;function j7(e){LF(e,0)}function Pw(e){var t=jd(e);if(GB(t))return e}function H7(e,t){if(e==="change")return t}var _F=!1;if(Ol){var S_;if(Ol){var M_="oninput"in document;if(!M_){var jO=document.createElement("div");jO.setAttribute("oninput","return;"),M_=typeof jO.oninput=="function"}S_=M_}else S_=!1;_F=S_&&(!document.documentMode||9<document.documentMode)}function HO(){Jm&&(Jm.detachEvent("onpropertychange",SF),Rg=Jm=null)}function SF(e){if(e.propertyName==="value"&&Pw(Rg)){var t=[];bF(t,Rg,e,mC(e)),rF(j7,t)}}function V7(e,t,r){e==="focusin"?(HO(),Jm=t,Rg=r,Jm.attachEvent("onpropertychange",SF)):e==="focusout"&&HO()}function W7(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Pw(Rg)}function G7(e,t){if(e==="click")return Pw(t)}function Y7(e,t){if(e==="input"||e==="change")return Pw(t)}function q7(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ta=typeof Object.is=="function"?Object.is:q7;function kg(e,t){if(Ta(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!ZM.call(t,n)||!Ta(e[n],t[n]))return!1}return!0}function VO(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function WO(e,t){var r=VO(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=VO(r)}}function MF(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?MF(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function EF(){for(var e=window,t=B1();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=B1(e.document)}return t}function MC(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function X7(e){var t=EF(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&MF(r.ownerDocument.documentElement,r)){if(i!==null&&MC(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!e.extend&&s>i&&(n=i,i=s,s=n),n=WO(r,s);var a=WO(r,i);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var $7=Ol&&"documentMode"in document&&11>=document.documentMode,Fd=null,vE=null,eg=null,yE=!1;function GO(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;yE||Fd==null||Fd!==B1(i)||(i=Fd,"selectionStart"in i&&MC(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),eg&&kg(eg,i)||(eg=i,i=G1(vE,"onSelect"),0<i.length&&(t=new bC("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=Fd)))}function C0(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Ud={animationend:C0("Animation","AnimationEnd"),animationiteration:C0("Animation","AnimationIteration"),animationstart:C0("Animation","AnimationStart"),transitionend:C0("Transition","TransitionEnd")},E_={},AF={};Ol&&(AF=document.createElement("div").style,"AnimationEvent"in window||(delete Ud.animationend.animation,delete Ud.animationiteration.animation,delete Ud.animationstart.animation),"TransitionEvent"in window||delete Ud.transitionend.transition);function Ow(e){if(E_[e])return E_[e];if(!Ud[e])return e;var t=Ud[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in AF)return E_[e]=t[r];return e}var TF=Ow("animationend"),CF=Ow("animationiteration"),DF=Ow("animationstart"),PF=Ow("transitionend"),OF=new Map,YO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function lc(e,t){OF.set(e,t),Dh(t,[e])}for(var A_=0;A_<YO.length;A_++){var T_=YO[A_],Q7=T_.toLowerCase(),K7=T_[0].toUpperCase()+T_.slice(1);lc(Q7,"on"+K7)}lc(TF,"onAnimationEnd");lc(CF,"onAnimationIteration");lc(DF,"onAnimationStart");lc("dblclick","onDoubleClick");lc("focusin","onFocus");lc("focusout","onBlur");lc(PF,"onTransitionEnd");Of("onMouseEnter",["mouseout","mouseover"]);Of("onMouseLeave",["mouseout","mouseover"]);Of("onPointerEnter",["pointerout","pointerover"]);Of("onPointerLeave",["pointerout","pointerover"]);Dh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Dh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Dh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Dh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Dh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Dh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Z7=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fm));function qO(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,Q9(i,t,void 0,e),e.currentTarget=null}function LF(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;qO(n,o,u),s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;qO(n,o,u),s=l}}}if(U1)throw e=fE,U1=!1,fE=null,e}function Tr(e,t){var r=t[SE];r===void 0&&(r=t[SE]=new Set);var i=e+"__bubble";r.has(i)||(IF(t,e,2,!1),r.add(i))}function C_(e,t,r){var i=0;t&&(i|=4),IF(r,e,i,t)}var D0="_reactListening"+Math.random().toString(36).slice(2);function zg(e){if(!e[D0]){e[D0]=!0,UB.forEach(function(r){r!=="selectionchange"&&(Z7.has(r)||C_(r,!1,e),C_(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[D0]||(t[D0]=!0,C_("selectionchange",!1,t))}}function IF(e,t,r,i){switch(gF(t)){case 1:var n=d7;break;case 4:n=f7;break;default:n=xC}r=n.bind(null,t,r,e),n=void 0,!dE||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),i?n!==void 0?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):n!==void 0?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function D_(e,t,r,i,n){var s=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=Wc(o),a===null)return;if(l=a.tag,l===5||l===6){i=s=a;continue e}o=o.parentNode}}i=i.return}rF(function(){var u=s,h=mC(r),c=[];e:{var d=OF.get(e);if(d!==void 0){var f=bC,p=e;switch(e){case"keypress":if(c1(r)===0)break e;case"keydown":case"keyup":f=C7;break;case"focusin":p="focus",f=__;break;case"focusout":p="blur",f=__;break;case"beforeblur":case"afterblur":f=__;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=kO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=g7;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=O7;break;case TF:case CF:case DF:f=x7;break;case PF:f=I7;break;case"scroll":f=p7;break;case"wheel":f=k7;break;case"copy":case"cut":case"paste":f=b7;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=NO}var m=(t&4)!==0,g=!m&&e==="scroll",v=m?d!==null?d+"Capture":null:d;m=[];for(var y=u,x;y!==null;){x=y;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,v!==null&&(w=Pg(y,v),w!=null&&m.push(Ng(y,w,x)))),g)break;y=y.return}0<m.length&&(d=new f(d,p,null,r,h),c.push({event:d,listeners:m}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",d&&r!==cE&&(p=r.relatedTarget||r.fromElement)&&(Wc(p)||p[Ll]))break e;if((f||d)&&(d=h.window===h?h:(d=h.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=r.relatedTarget||r.toElement,f=u,p=p?Wc(p):null,p!==null&&(g=Ph(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(m=kO,w="onMouseLeave",v="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(m=NO,w="onPointerLeave",v="onPointerEnter",y="pointer"),g=f==null?d:jd(f),x=p==null?d:jd(p),d=new m(w,y+"leave",f,r,h),d.target=g,d.relatedTarget=x,w=null,Wc(h)===u&&(m=new m(v,y+"enter",p,r,h),m.target=x,m.relatedTarget=g,w=m),g=w,f&&p)t:{for(m=f,v=p,y=0,x=m;x;x=Xh(x))y++;for(x=0,w=v;w;w=Xh(w))x++;for(;0<y-x;)m=Xh(m),y--;for(;0<x-y;)v=Xh(v),x--;for(;y--;){if(m===v||v!==null&&m===v.alternate)break t;m=Xh(m),v=Xh(v)}m=null}else m=null;f!==null&&XO(c,d,f,m,!1),p!==null&&g!==null&&XO(c,g,p,m,!0)}}e:{if(d=u?jd(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var S=H7;else if(UO(d))if(_F)S=Y7;else{S=W7;var _=V7}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(S=G7);if(S&&(S=S(e,u))){bF(c,S,r,h);break e}_&&_(e,d,u),e==="focusout"&&(_=d._wrapperState)&&_.controlled&&d.type==="number"&&sE(d,"number",d.value)}switch(_=u?jd(u):window,e){case"focusin":(UO(_)||_.contentEditable==="true")&&(Fd=_,vE=u,eg=null);break;case"focusout":eg=vE=Fd=null;break;case"mousedown":yE=!0;break;case"contextmenu":case"mouseup":case"dragend":yE=!1,GO(c,r,h);break;case"selectionchange":if($7)break;case"keydown":case"keyup":GO(c,r,h)}var A;if(SC)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Bd?xF(e,r)&&(M="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(M="onCompositionStart");M&&(yF&&r.locale!=="ko"&&(Bd||M!=="onCompositionStart"?M==="onCompositionEnd"&&Bd&&(A=vF()):(Au=h,wC="value"in Au?Au.value:Au.textContent,Bd=!0)),_=G1(u,M),0<_.length&&(M=new zO(M,e,null,r,h),c.push({event:M,listeners:_}),A?M.data=A:(A=wF(r),A!==null&&(M.data=A)))),(A=N7?B7(e,r):F7(e,r))&&(u=G1(u,"onBeforeInput"),0<u.length&&(h=new zO("onBeforeInput","beforeinput",null,r,h),c.push({event:h,listeners:u}),h.data=A))}LF(c,t)})}function Ng(e,t,r){return{instance:e,listener:t,currentTarget:r}}function G1(e,t){for(var r=t+"Capture",i=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=Pg(e,r),s!=null&&i.unshift(Ng(e,s,n)),s=Pg(e,t),s!=null&&i.push(Ng(e,s,n))),e=e.return}return i}function Xh(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function XO(e,t,r,i,n){for(var s=t._reactName,a=[];r!==null&&r!==i;){var o=r,l=o.alternate,u=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&u!==null&&(o=u,n?(l=Pg(r,s),l!=null&&a.unshift(Ng(r,l,o))):n||(l=Pg(r,s),l!=null&&a.push(Ng(r,l,o)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var J7=/\r\n?/g,eq=/\u0000|\uFFFD/g;function $O(e){return(typeof e=="string"?e:""+e).replace(J7,`
`).replace(eq,"")}function P0(e,t,r){if(t=$O(t),$O(e)!==t&&r)throw Error(Ne(425))}function Y1(){}var xE=null,wE=null;function bE(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var _E=typeof setTimeout=="function"?setTimeout:void 0,tq=typeof clearTimeout=="function"?clearTimeout:void 0,QO=typeof Promise=="function"?Promise:void 0,rq=typeof queueMicrotask=="function"?queueMicrotask:typeof QO<"u"?function(e){return QO.resolve(null).then(e).catch(iq)}:_E;function iq(e){setTimeout(function(){throw e})}function P_(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){e.removeChild(n),Ig(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);Ig(t)}function ju(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function KO(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var lp=Math.random().toString(36).slice(2),to="__reactFiber$"+lp,Bg="__reactProps$"+lp,Ll="__reactContainer$"+lp,SE="__reactEvents$"+lp,nq="__reactListeners$"+lp,sq="__reactHandles$"+lp;function Wc(e){var t=e[to];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ll]||r[to]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=KO(e);e!==null;){if(r=e[to])return r;e=KO(e)}return t}e=r,r=e.parentNode}return null}function Dv(e){return e=e[to]||e[Ll],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function jd(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ne(33))}function Lw(e){return e[Bg]||null}var ME=[],Hd=-1;function uc(e){return{current:e}}function Pr(e){0>Hd||(e.current=ME[Hd],ME[Hd]=null,Hd--)}function Er(e,t){Hd++,ME[Hd]=e.current,e.current=t}var ec={},un=uc(ec),Gn=uc(!1),dh=ec;function Lf(e,t){var r=e.type.contextTypes;if(!r)return ec;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=t[s];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Yn(e){return e=e.childContextTypes,e!=null}function q1(){Pr(Gn),Pr(un)}function ZO(e,t,r){if(un.current!==ec)throw Error(Ne(168));Er(un,t),Er(Gn,r)}function RF(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in t))throw Error(Ne(108,V9(e)||"Unknown",n));return Hr({},r,i)}function X1(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ec,dh=un.current,Er(un,e),Er(Gn,Gn.current),!0}function JO(e,t,r){var i=e.stateNode;if(!i)throw Error(Ne(169));r?(e=RF(e,t,dh),i.__reactInternalMemoizedMergedChildContext=e,Pr(Gn),Pr(un),Er(un,e)):Pr(Gn),Er(Gn,r)}var dl=null,Iw=!1,O_=!1;function kF(e){dl===null?dl=[e]:dl.push(e)}function aq(e){Iw=!0,kF(e)}function cc(){if(!O_&&dl!==null){O_=!0;var e=0,t=hr;try{var r=dl;for(hr=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}dl=null,Iw=!1}catch(n){throw dl!==null&&(dl=dl.slice(e+1)),aF(gC,cc),n}finally{hr=t,O_=!1}}return null}var Vd=[],Wd=0,$1=null,Q1=0,zs=[],Ns=0,fh=null,vl=1,yl="";function Oc(e,t){Vd[Wd++]=Q1,Vd[Wd++]=$1,$1=e,Q1=t}function zF(e,t,r){zs[Ns++]=vl,zs[Ns++]=yl,zs[Ns++]=fh,fh=e;var i=vl;e=yl;var n=32-Ma(i)-1;i&=~(1<<n),r+=1;var s=32-Ma(t)+n;if(30<s){var a=n-n%5;s=(i&(1<<a)-1).toString(32),i>>=a,n-=a,vl=1<<32-Ma(t)+n|r<<n|i,yl=s+e}else vl=1<<s|r<<n|i,yl=e}function EC(e){e.return!==null&&(Oc(e,1),zF(e,1,0))}function AC(e){for(;e===$1;)$1=Vd[--Wd],Vd[Wd]=null,Q1=Vd[--Wd],Vd[Wd]=null;for(;e===fh;)fh=zs[--Ns],zs[Ns]=null,yl=zs[--Ns],zs[Ns]=null,vl=zs[--Ns],zs[Ns]=null}var gs=null,hs=null,Br=!1,ga=null;function NF(e,t){var r=Hs(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function e3(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,gs=e,hs=ju(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,gs=e,hs=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=fh!==null?{id:vl,overflow:yl}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Hs(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,gs=e,hs=null,!0):!1;default:return!1}}function EE(e){return(e.mode&1)!==0&&(e.flags&128)===0}function AE(e){if(Br){var t=hs;if(t){var r=t;if(!e3(e,t)){if(EE(e))throw Error(Ne(418));t=ju(r.nextSibling);var i=gs;t&&e3(e,t)?NF(i,r):(e.flags=e.flags&-4097|2,Br=!1,gs=e)}}else{if(EE(e))throw Error(Ne(418));e.flags=e.flags&-4097|2,Br=!1,gs=e}}}function t3(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;gs=e}function O0(e){if(e!==gs)return!1;if(!Br)return t3(e),Br=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!bE(e.type,e.memoizedProps)),t&&(t=hs)){if(EE(e))throw BF(),Error(Ne(418));for(;t;)NF(e,t),t=ju(t.nextSibling)}if(t3(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ne(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){hs=ju(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}hs=null}}else hs=gs?ju(e.stateNode.nextSibling):null;return!0}function BF(){for(var e=hs;e;)e=ju(e.nextSibling)}function If(){hs=gs=null,Br=!1}function TC(e){ga===null?ga=[e]:ga.push(e)}var oq=Vl.ReactCurrentBatchConfig;function fa(e,t){if(e&&e.defaultProps){t=Hr({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var K1=uc(null),Z1=null,Gd=null,CC=null;function DC(){CC=Gd=Z1=null}function PC(e){var t=K1.current;Pr(K1),e._currentValue=t}function TE(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function cf(e,t){Z1=e,CC=Gd=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(jn=!0),e.firstContext=null)}function qs(e){var t=e._currentValue;if(CC!==e)if(e={context:e,memoizedValue:t,next:null},Gd===null){if(Z1===null)throw Error(Ne(308));Gd=e,Z1.dependencies={lanes:0,firstContext:e}}else Gd=Gd.next=e;return t}var Gc=null;function OC(e){Gc===null?Gc=[e]:Gc.push(e)}function FF(e,t,r,i){var n=t.interleaved;return n===null?(r.next=r,OC(t)):(r.next=n.next,n.next=r),t.interleaved=r,Il(e,i)}function Il(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var yu=!1;function LC(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function UF(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ml(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Hu(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,Jt&2){var n=i.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),i.pending=t,Il(e,r)}return n=i.interleaved,n===null?(t.next=t,OC(i)):(t.next=n.next,n.next=t),i.interleaved=t,Il(e,r)}function h1(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,vC(e,r)}}function r3(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=a:s=s.next=a,r=r.next}while(r!==null);s===null?n=s=t:s=s.next=t}else n=s=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function J1(e,t,r,i){var n=e.updateQueue;yu=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var h=e.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l))}if(s!==null){var c=n.baseState;a=0,h=u=l=null,o=s;do{var d=o.lane,f=o.eventTime;if((i&d)===d){h!==null&&(h=h.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,m=o;switch(d=t,f=r,m.tag){case 1:if(p=m.payload,typeof p=="function"){c=p.call(f,c,d);break e}c=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,d=typeof p=="function"?p.call(f,c,d):p,d==null)break e;c=Hr({},c,d);break e;case 2:yu=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,d=n.effects,d===null?n.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=f,l=c):h=h.next=f,a|=d;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;d=o,o=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(1);if(h===null&&(l=c),n.baseState=l,n.firstBaseUpdate=u,n.lastBaseUpdate=h,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);mh|=a,e.lanes=a,e.memoizedState=c}}function i3(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(Ne(191,n));n.call(i)}}}var jF=new FB.Component().refs;function CE(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:Hr({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Rw={isMounted:function(e){return(e=e._reactInternals)?Ph(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=An(),n=Wu(e),s=Ml(i,n);s.payload=t,r!=null&&(s.callback=r),t=Hu(e,s,n),t!==null&&(Ea(t,e,n,i),h1(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=An(),n=Wu(e),s=Ml(i,n);s.tag=1,s.payload=t,r!=null&&(s.callback=r),t=Hu(e,s,n),t!==null&&(Ea(t,e,n,i),h1(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=An(),i=Wu(e),n=Ml(r,i);n.tag=2,t!=null&&(n.callback=t),t=Hu(e,n,i),t!==null&&(Ea(t,e,i,r),h1(t,e,i))}};function n3(e,t,r,i,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,s,a):t.prototype&&t.prototype.isPureReactComponent?!kg(r,i)||!kg(n,s):!0}function HF(e,t,r){var i=!1,n=ec,s=t.contextType;return typeof s=="object"&&s!==null?s=qs(s):(n=Yn(t)?dh:un.current,i=t.contextTypes,s=(i=i!=null)?Lf(e,n):ec),t=new t(r,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Rw,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function s3(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&Rw.enqueueReplaceState(t,t.state,null)}function DE(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs=jF,LC(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=qs(s):(s=Yn(t)?dh:un.current,n.context=Lf(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(CE(e,t,s,r),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&Rw.enqueueReplaceState(n,n.state,null),J1(e,r,n,i),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function Xp(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ne(309));var i=r.stateNode}if(!i)throw Error(Ne(147,e));var n=i,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;o===jF&&(o=n.refs={}),a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(Ne(284));if(!r._owner)throw Error(Ne(290,e))}return e}function L0(e,t){throw e=Object.prototype.toString.call(t),Error(Ne(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function a3(e){var t=e._init;return t(e._payload)}function VF(e){function t(v,y){if(e){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function r(v,y){if(!e)return null;for(;y!==null;)t(v,y),y=y.sibling;return null}function i(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function n(v,y){return v=Gu(v,y),v.index=0,v.sibling=null,v}function s(v,y,x){return v.index=x,e?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function a(v){return e&&v.alternate===null&&(v.flags|=2),v}function o(v,y,x,w){return y===null||y.tag!==6?(y=B_(x,v.mode,w),y.return=v,y):(y=n(y,x),y.return=v,y)}function l(v,y,x,w){var S=x.type;return S===Nd?h(v,y,x.props.children,w,x.key):y!==null&&(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===vu&&a3(S)===y.type)?(w=n(y,x.props),w.ref=Xp(v,y,x),w.return=v,w):(w=v1(x.type,x.key,x.props,null,v.mode,w),w.ref=Xp(v,y,x),w.return=v,w)}function u(v,y,x,w){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=F_(x,v.mode,w),y.return=v,y):(y=n(y,x.children||[]),y.return=v,y)}function h(v,y,x,w,S){return y===null||y.tag!==7?(y=th(x,v.mode,w,S),y.return=v,y):(y=n(y,x),y.return=v,y)}function c(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=B_(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case b0:return x=v1(y.type,y.key,y.props,null,v.mode,x),x.ref=Xp(v,null,y),x.return=v,x;case zd:return y=F_(y,v.mode,x),y.return=v,y;case vu:var w=y._init;return c(v,w(y._payload),x)}if(Nm(y)||Vp(y))return y=th(y,v.mode,x,null),y.return=v,y;L0(v,y)}return null}function d(v,y,x,w){var S=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return S!==null?null:o(v,y,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case b0:return x.key===S?l(v,y,x,w):null;case zd:return x.key===S?u(v,y,x,w):null;case vu:return S=x._init,d(v,y,S(x._payload),w)}if(Nm(x)||Vp(x))return S!==null?null:h(v,y,x,w,null);L0(v,x)}return null}function f(v,y,x,w,S){if(typeof w=="string"&&w!==""||typeof w=="number")return v=v.get(x)||null,o(y,v,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case b0:return v=v.get(w.key===null?x:w.key)||null,l(y,v,w,S);case zd:return v=v.get(w.key===null?x:w.key)||null,u(y,v,w,S);case vu:var _=w._init;return f(v,y,x,_(w._payload),S)}if(Nm(w)||Vp(w))return v=v.get(x)||null,h(y,v,w,S,null);L0(y,w)}return null}function p(v,y,x,w){for(var S=null,_=null,A=y,M=y=0,T=null;A!==null&&M<x.length;M++){A.index>M?(T=A,A=null):T=A.sibling;var C=d(v,A,x[M],w);if(C===null){A===null&&(A=T);break}e&&A&&C.alternate===null&&t(v,A),y=s(C,y,M),_===null?S=C:_.sibling=C,_=C,A=T}if(M===x.length)return r(v,A),Br&&Oc(v,M),S;if(A===null){for(;M<x.length;M++)A=c(v,x[M],w),A!==null&&(y=s(A,y,M),_===null?S=A:_.sibling=A,_=A);return Br&&Oc(v,M),S}for(A=i(v,A);M<x.length;M++)T=f(A,v,M,x[M],w),T!==null&&(e&&T.alternate!==null&&A.delete(T.key===null?M:T.key),y=s(T,y,M),_===null?S=T:_.sibling=T,_=T);return e&&A.forEach(function(L){return t(v,L)}),Br&&Oc(v,M),S}function m(v,y,x,w){var S=Vp(x);if(typeof S!="function")throw Error(Ne(150));if(x=S.call(x),x==null)throw Error(Ne(151));for(var _=S=null,A=y,M=y=0,T=null,C=x.next();A!==null&&!C.done;M++,C=x.next()){A.index>M?(T=A,A=null):T=A.sibling;var L=d(v,A,C.value,w);if(L===null){A===null&&(A=T);break}e&&A&&L.alternate===null&&t(v,A),y=s(L,y,M),_===null?S=L:_.sibling=L,_=L,A=T}if(C.done)return r(v,A),Br&&Oc(v,M),S;if(A===null){for(;!C.done;M++,C=x.next())C=c(v,C.value,w),C!==null&&(y=s(C,y,M),_===null?S=C:_.sibling=C,_=C);return Br&&Oc(v,M),S}for(A=i(v,A);!C.done;M++,C=x.next())C=f(A,v,M,C.value,w),C!==null&&(e&&C.alternate!==null&&A.delete(C.key===null?M:C.key),y=s(C,y,M),_===null?S=C:_.sibling=C,_=C);return e&&A.forEach(function(I){return t(v,I)}),Br&&Oc(v,M),S}function g(v,y,x,w){if(typeof x=="object"&&x!==null&&x.type===Nd&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case b0:e:{for(var S=x.key,_=y;_!==null;){if(_.key===S){if(S=x.type,S===Nd){if(_.tag===7){r(v,_.sibling),y=n(_,x.props.children),y.return=v,v=y;break e}}else if(_.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===vu&&a3(S)===_.type){r(v,_.sibling),y=n(_,x.props),y.ref=Xp(v,_,x),y.return=v,v=y;break e}r(v,_);break}else t(v,_);_=_.sibling}x.type===Nd?(y=th(x.props.children,v.mode,w,x.key),y.return=v,v=y):(w=v1(x.type,x.key,x.props,null,v.mode,w),w.ref=Xp(v,y,x),w.return=v,v=w)}return a(v);case zd:e:{for(_=x.key;y!==null;){if(y.key===_)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){r(v,y.sibling),y=n(y,x.children||[]),y.return=v,v=y;break e}else{r(v,y);break}else t(v,y);y=y.sibling}y=F_(x,v.mode,w),y.return=v,v=y}return a(v);case vu:return _=x._init,g(v,y,_(x._payload),w)}if(Nm(x))return p(v,y,x,w);if(Vp(x))return m(v,y,x,w);L0(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(r(v,y.sibling),y=n(y,x),y.return=v,v=y):(r(v,y),y=B_(x,v.mode,w),y.return=v,v=y),a(v)):r(v,y)}return g}var Rf=VF(!0),WF=VF(!1),Pv={},ho=uc(Pv),Fg=uc(Pv),Ug=uc(Pv);function Yc(e){if(e===Pv)throw Error(Ne(174));return e}function IC(e,t){switch(Er(Ug,t),Er(Fg,e),Er(ho,Pv),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:oE(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=oE(t,e)}Pr(ho),Er(ho,t)}function kf(){Pr(ho),Pr(Fg),Pr(Ug)}function GF(e){Yc(Ug.current);var t=Yc(ho.current),r=oE(t,e.type);t!==r&&(Er(Fg,e),Er(ho,r))}function RC(e){Fg.current===e&&(Pr(ho),Pr(Fg))}var Fr=uc(0);function ex(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var L_=[];function kC(){for(var e=0;e<L_.length;e++)L_[e]._workInProgressVersionPrimary=null;L_.length=0}var d1=Vl.ReactCurrentDispatcher,I_=Vl.ReactCurrentBatchConfig,ph=0,jr=null,wi=null,Ii=null,tx=!1,tg=!1,jg=0,lq=0;function Ki(){throw Error(Ne(321))}function zC(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Ta(e[r],t[r]))return!1;return!0}function NC(e,t,r,i,n,s){if(ph=s,jr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,d1.current=e===null||e.memoizedState===null?dq:fq,e=r(i,n),tg){s=0;do{if(tg=!1,jg=0,25<=s)throw Error(Ne(301));s+=1,Ii=wi=null,t.updateQueue=null,d1.current=pq,e=r(i,n)}while(tg)}if(d1.current=rx,t=wi!==null&&wi.next!==null,ph=0,Ii=wi=jr=null,tx=!1,t)throw Error(Ne(300));return e}function BC(){var e=jg!==0;return jg=0,e}function Qa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?jr.memoizedState=Ii=e:Ii=Ii.next=e,Ii}function Xs(){if(wi===null){var e=jr.alternate;e=e!==null?e.memoizedState:null}else e=wi.next;var t=Ii===null?jr.memoizedState:Ii.next;if(t!==null)Ii=t,wi=e;else{if(e===null)throw Error(Ne(310));wi=e,e={memoizedState:wi.memoizedState,baseState:wi.baseState,baseQueue:wi.baseQueue,queue:wi.queue,next:null},Ii===null?jr.memoizedState=Ii=e:Ii=Ii.next=e}return Ii}function Hg(e,t){return typeof t=="function"?t(e):t}function R_(e){var t=Xs(),r=t.queue;if(r===null)throw Error(Ne(311));r.lastRenderedReducer=e;var i=wi,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var o=a=null,l=null,u=s;do{var h=u.lane;if((ph&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var c={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=c,a=i):l=l.next=c,jr.lanes|=h,mh|=h}u=u.next}while(u!==null&&u!==s);l===null?a=i:l.next=o,Ta(i,t.memoizedState)||(jn=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=l,r.lastRenderedState=i}if(e=r.interleaved,e!==null){n=e;do s=n.lane,jr.lanes|=s,mh|=s,n=n.next;while(n!==e)}else n===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function k_(e){var t=Xs(),r=t.queue;if(r===null)throw Error(Ne(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,s=t.memoizedState;if(n!==null){r.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);Ta(s,t.memoizedState)||(jn=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),r.lastRenderedState=s}return[s,i]}function YF(){}function qF(e,t){var r=jr,i=Xs(),n=t(),s=!Ta(i.memoizedState,n);if(s&&(i.memoizedState=n,jn=!0),i=i.queue,FC(QF.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||Ii!==null&&Ii.memoizedState.tag&1){if(r.flags|=2048,Vg(9,$F.bind(null,r,i,n,t),void 0,null),Ni===null)throw Error(Ne(349));ph&30||XF(r,t,n)}return n}function XF(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=jr.updateQueue,t===null?(t={lastEffect:null,stores:null},jr.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function $F(e,t,r,i){t.value=r,t.getSnapshot=i,KF(t)&&ZF(e)}function QF(e,t,r){return r(function(){KF(t)&&ZF(e)})}function KF(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Ta(e,r)}catch{return!0}}function ZF(e){var t=Il(e,1);t!==null&&Ea(t,e,1,-1)}function o3(e){var t=Qa();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hg,lastRenderedState:e},t.queue=e,e=e.dispatch=hq.bind(null,jr,e),[t.memoizedState,e]}function Vg(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=jr.updateQueue,t===null?(t={lastEffect:null,stores:null},jr.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function JF(){return Xs().memoizedState}function f1(e,t,r,i){var n=Qa();jr.flags|=e,n.memoizedState=Vg(1|t,r,void 0,i===void 0?null:i)}function kw(e,t,r,i){var n=Xs();i=i===void 0?null:i;var s=void 0;if(wi!==null){var a=wi.memoizedState;if(s=a.destroy,i!==null&&zC(i,a.deps)){n.memoizedState=Vg(t,r,s,i);return}}jr.flags|=e,n.memoizedState=Vg(1|t,r,s,i)}function l3(e,t){return f1(8390656,8,e,t)}function FC(e,t){return kw(2048,8,e,t)}function eU(e,t){return kw(4,2,e,t)}function tU(e,t){return kw(4,4,e,t)}function rU(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function iU(e,t,r){return r=r!=null?r.concat([e]):null,kw(4,4,rU.bind(null,t,e),r)}function UC(){}function nU(e,t){var r=Xs();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&zC(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function sU(e,t){var r=Xs();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&zC(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function aU(e,t,r){return ph&21?(Ta(r,t)||(r=uF(),jr.lanes|=r,mh|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,jn=!0),e.memoizedState=r)}function uq(e,t){var r=hr;hr=r!==0&&4>r?r:4,e(!0);var i=I_.transition;I_.transition={};try{e(!1),t()}finally{hr=r,I_.transition=i}}function oU(){return Xs().memoizedState}function cq(e,t,r){var i=Wu(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},lU(e))uU(t,r);else if(r=FF(e,t,r,i),r!==null){var n=An();Ea(r,e,i,n),cU(r,t,i)}}function hq(e,t,r){var i=Wu(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(lU(e))uU(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,r);if(n.hasEagerState=!0,n.eagerState=o,Ta(o,a)){var l=t.interleaved;l===null?(n.next=n,OC(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}r=FF(e,t,n,i),r!==null&&(n=An(),Ea(r,e,i,n),cU(r,t,i))}}function lU(e){var t=e.alternate;return e===jr||t!==null&&t===jr}function uU(e,t){tg=tx=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function cU(e,t,r){if(r&4194240){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,vC(e,r)}}var rx={readContext:qs,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useInsertionEffect:Ki,useLayoutEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useMutableSource:Ki,useSyncExternalStore:Ki,useId:Ki,unstable_isNewReconciler:!1},dq={readContext:qs,useCallback:function(e,t){return Qa().memoizedState=[e,t===void 0?null:t],e},useContext:qs,useEffect:l3,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,f1(4194308,4,rU.bind(null,t,e),r)},useLayoutEffect:function(e,t){return f1(4194308,4,e,t)},useInsertionEffect:function(e,t){return f1(4,2,e,t)},useMemo:function(e,t){var r=Qa();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=Qa();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=cq.bind(null,jr,e),[i.memoizedState,e]},useRef:function(e){var t=Qa();return e={current:e},t.memoizedState=e},useState:o3,useDebugValue:UC,useDeferredValue:function(e){return Qa().memoizedState=e},useTransition:function(){var e=o3(!1),t=e[0];return e=uq.bind(null,e[1]),Qa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=jr,n=Qa();if(Br){if(r===void 0)throw Error(Ne(407));r=r()}else{if(r=t(),Ni===null)throw Error(Ne(349));ph&30||XF(i,t,r)}n.memoizedState=r;var s={value:r,getSnapshot:t};return n.queue=s,l3(QF.bind(null,i,s,e),[e]),i.flags|=2048,Vg(9,$F.bind(null,i,s,r,t),void 0,null),r},useId:function(){var e=Qa(),t=Ni.identifierPrefix;if(Br){var r=yl,i=vl;r=(i&~(1<<32-Ma(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=jg++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=lq++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},fq={readContext:qs,useCallback:nU,useContext:qs,useEffect:FC,useImperativeHandle:iU,useInsertionEffect:eU,useLayoutEffect:tU,useMemo:sU,useReducer:R_,useRef:JF,useState:function(){return R_(Hg)},useDebugValue:UC,useDeferredValue:function(e){var t=Xs();return aU(t,wi.memoizedState,e)},useTransition:function(){var e=R_(Hg)[0],t=Xs().memoizedState;return[e,t]},useMutableSource:YF,useSyncExternalStore:qF,useId:oU,unstable_isNewReconciler:!1},pq={readContext:qs,useCallback:nU,useContext:qs,useEffect:FC,useImperativeHandle:iU,useInsertionEffect:eU,useLayoutEffect:tU,useMemo:sU,useReducer:k_,useRef:JF,useState:function(){return k_(Hg)},useDebugValue:UC,useDeferredValue:function(e){var t=Xs();return wi===null?t.memoizedState=e:aU(t,wi.memoizedState,e)},useTransition:function(){var e=k_(Hg)[0],t=Xs().memoizedState;return[e,t]},useMutableSource:YF,useSyncExternalStore:qF,useId:oU,unstable_isNewReconciler:!1};function zf(e,t){try{var r="",i=t;do r+=H9(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function z_(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function PE(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var mq=typeof WeakMap=="function"?WeakMap:Map;function hU(e,t,r){r=Ml(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){nx||(nx=!0,UE=i),PE(e,t)},r}function dU(e,t,r){r=Ml(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){PE(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){PE(e,t),typeof i!="function"&&(Vu===null?Vu=new Set([this]):Vu.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function u3(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new mq;var n=new Set;i.set(t,n)}else n=i.get(t),n===void 0&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=Dq.bind(null,e,t,r),t.then(e,e))}function c3(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function h3(e,t,r,i,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ml(-1,1),t.tag=2,Hu(r,t,1))),r.lanes|=1),e)}var gq=Vl.ReactCurrentOwner,jn=!1;function wn(e,t,r,i){t.child=e===null?WF(t,null,r,i):Rf(t,e.child,r,i)}function d3(e,t,r,i,n){r=r.render;var s=t.ref;return cf(t,n),i=NC(e,t,r,i,s,n),r=BC(),e!==null&&!jn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Rl(e,t,n)):(Br&&r&&EC(t),t.flags|=1,wn(e,t,i,n),t.child)}function f3(e,t,r,i,n){if(e===null){var s=r.type;return typeof s=="function"&&!XC(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=s,fU(e,t,s,i,n)):(e=v1(r.type,null,i,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var a=s.memoizedProps;if(r=r.compare,r=r!==null?r:kg,r(a,i)&&e.ref===t.ref)return Rl(e,t,n)}return t.flags|=1,e=Gu(s,i),e.ref=t.ref,e.return=t,t.child=e}function fU(e,t,r,i,n){if(e!==null){var s=e.memoizedProps;if(kg(s,i)&&e.ref===t.ref)if(jn=!1,t.pendingProps=i=s,(e.lanes&n)!==0)e.flags&131072&&(jn=!0);else return t.lanes=e.lanes,Rl(e,t,n)}return OE(e,t,r,i,n)}function pU(e,t,r){var i=t.pendingProps,n=i.children,s=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Er(qd,os),os|=r;else{if(!(r&1073741824))return e=s!==null?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Er(qd,os),os|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,Er(qd,os),os|=i}else s!==null?(i=s.baseLanes|r,t.memoizedState=null):i=r,Er(qd,os),os|=i;return wn(e,t,n,r),t.child}function mU(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function OE(e,t,r,i,n){var s=Yn(r)?dh:un.current;return s=Lf(t,s),cf(t,n),r=NC(e,t,r,i,s,n),i=BC(),e!==null&&!jn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Rl(e,t,n)):(Br&&i&&EC(t),t.flags|=1,wn(e,t,r,n),t.child)}function p3(e,t,r,i,n){if(Yn(r)){var s=!0;X1(t)}else s=!1;if(cf(t,n),t.stateNode===null)p1(e,t),HF(t,r,i),DE(t,r,i,n),i=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,u=r.contextType;typeof u=="object"&&u!==null?u=qs(u):(u=Yn(r)?dh:un.current,u=Lf(t,u));var h=r.getDerivedStateFromProps,c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==u)&&s3(t,a,i,u),yu=!1;var d=t.memoizedState;a.state=d,J1(t,i,a,n),l=t.memoizedState,o!==i||d!==l||Gn.current||yu?(typeof h=="function"&&(CE(t,r,h,i),l=t.memoizedState),(o=yu||n3(t,r,o,i,d,l,u))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=u,i=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,UF(e,t),o=t.memoizedProps,u=t.type===t.elementType?o:fa(t.type,o),a.props=u,c=t.pendingProps,d=a.context,l=r.contextType,typeof l=="object"&&l!==null?l=qs(l):(l=Yn(r)?dh:un.current,l=Lf(t,l));var f=r.getDerivedStateFromProps;(h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==c||d!==l)&&s3(t,a,i,l),yu=!1,d=t.memoizedState,a.state=d,J1(t,i,a,n);var p=t.memoizedState;o!==c||d!==p||Gn.current||yu?(typeof f=="function"&&(CE(t,r,f,i),p=t.memoizedState),(u=yu||n3(t,r,u,i,d,p,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,p,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),a.props=i,a.state=p,a.context=l,i=u):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return LE(e,t,r,i,s,n)}function LE(e,t,r,i,n,s){mU(e,t);var a=(t.flags&128)!==0;if(!i&&!a)return n&&JO(t,r,!1),Rl(e,t,s);i=t.stateNode,gq.current=t;var o=a&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&a?(t.child=Rf(t,e.child,null,s),t.child=Rf(t,null,o,s)):wn(e,t,o,s),t.memoizedState=i.state,n&&JO(t,r,!0),t.child}function gU(e){var t=e.stateNode;t.pendingContext?ZO(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ZO(e,t.context,!1),IC(e,t.containerInfo)}function m3(e,t,r,i,n){return If(),TC(n),t.flags|=256,wn(e,t,r,i),t.child}var IE={dehydrated:null,treeContext:null,retryLane:0};function RE(e){return{baseLanes:e,cachePool:null,transitions:null}}function vU(e,t,r){var i=t.pendingProps,n=Fr.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),Er(Fr,n&1),e===null)return AE(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=i.children,e=i.fallback,s?(i=t.mode,s=t.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=Bw(a,i,0,null),e=th(e,i,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=RE(r),t.memoizedState=IE,e):jC(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return vq(e,t,a,i,o,n,r);if(s){s=i.fallback,a=t.mode,n=e.child,o=n.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&t.child!==n?(i=t.child,i.childLanes=0,i.pendingProps=l,t.deletions=null):(i=Gu(n,l),i.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=Gu(o,s):(s=th(s,a,r,null),s.flags|=2),s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,a=e.child.memoizedState,a=a===null?RE(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~r,t.memoizedState=IE,i}return s=e.child,e=s.sibling,i=Gu(s,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function jC(e,t){return t=Bw({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function I0(e,t,r,i){return i!==null&&TC(i),Rf(t,e.child,null,r),e=jC(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function vq(e,t,r,i,n,s,a){if(r)return t.flags&256?(t.flags&=-257,i=z_(Error(Ne(422))),I0(e,t,a,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=i.fallback,n=t.mode,i=Bw({mode:"visible",children:i.children},n,0,null),s=th(s,n,a,null),s.flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,t.mode&1&&Rf(t,e.child,null,a),t.child.memoizedState=RE(a),t.memoizedState=IE,s);if(!(t.mode&1))return I0(e,t,a,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(Ne(419)),i=z_(s,i,void 0),I0(e,t,a,i)}if(o=(a&e.childLanes)!==0,jn||o){if(i=Ni,i!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,Il(e,n),Ea(i,e,n,-1))}return qC(),i=z_(Error(Ne(421))),I0(e,t,a,i)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=Pq.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,hs=ju(n.nextSibling),gs=t,Br=!0,ga=null,e!==null&&(zs[Ns++]=vl,zs[Ns++]=yl,zs[Ns++]=fh,vl=e.id,yl=e.overflow,fh=t),t=jC(t,i.children),t.flags|=4096,t)}function g3(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),TE(e.return,t,r)}function N_(e,t,r,i,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function yU(e,t,r){var i=t.pendingProps,n=i.revealOrder,s=i.tail;if(wn(e,t,i.children,r),i=Fr.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&g3(e,r,t);else if(e.tag===19)g3(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Er(Fr,i),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;r!==null;)e=r.alternate,e!==null&&ex(e)===null&&(n=r),r=r.sibling;r=n,r===null?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),N_(t,!1,n,r,s);break;case"backwards":for(r=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&ex(e)===null){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}N_(t,!0,r,null,s);break;case"together":N_(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function p1(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Rl(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),mh|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Ne(153));if(t.child!==null){for(e=t.child,r=Gu(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Gu(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function yq(e,t,r){switch(t.tag){case 3:gU(t),If();break;case 5:GF(t);break;case 1:Yn(t.type)&&X1(t);break;case 4:IC(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,n=t.memoizedProps.value;Er(K1,i._currentValue),i._currentValue=n;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(Er(Fr,Fr.current&1),t.flags|=128,null):r&t.child.childLanes?vU(e,t,r):(Er(Fr,Fr.current&1),e=Rl(e,t,r),e!==null?e.sibling:null);Er(Fr,Fr.current&1);break;case 19:if(i=(r&t.childLanes)!==0,e.flags&128){if(i)return yU(e,t,r);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),Er(Fr,Fr.current),i)break;return null;case 22:case 23:return t.lanes=0,pU(e,t,r)}return Rl(e,t,r)}var xU,kE,wU,bU;xU=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};kE=function(){};wU=function(e,t,r,i){var n=e.memoizedProps;if(n!==i){e=t.stateNode,Yc(ho.current);var s=null;switch(r){case"input":n=iE(e,n),i=iE(e,i),s=[];break;case"select":n=Hr({},n,{value:void 0}),i=Hr({},i,{value:void 0}),s=[];break;case"textarea":n=aE(e,n),i=aE(e,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=Y1)}lE(r,i);var a;r=null;for(u in n)if(!i.hasOwnProperty(u)&&n.hasOwnProperty(u)&&n[u]!=null)if(u==="style"){var o=n[u];for(a in o)o.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Cg.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(o=n!=null?n[u]:void 0,i.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(r||(r={}),r[a]=l[a])}else r||(s||(s=[]),s.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Cg.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Tr("scroll",e),s||o===l||(s=[])):(s=s||[]).push(u,l))}r&&(s=s||[]).push("style",r);var u=s;(t.updateQueue=u)&&(t.flags|=4)}};bU=function(e,t,r,i){r!==i&&(t.flags|=4)};function $p(e,t){if(!Br)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Zi(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function xq(e,t,r){var i=t.pendingProps;switch(AC(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zi(t),null;case 1:return Yn(t.type)&&q1(),Zi(t),null;case 3:return i=t.stateNode,kf(),Pr(Gn),Pr(un),kC(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(O0(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ga!==null&&(VE(ga),ga=null))),kE(e,t),Zi(t),null;case 5:RC(t);var n=Yc(Ug.current);if(r=t.type,e!==null&&t.stateNode!=null)wU(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(Ne(166));return Zi(t),null}if(e=Yc(ho.current),O0(t)){i=t.stateNode,r=t.type;var s=t.memoizedProps;switch(i[to]=t,i[Bg]=s,e=(t.mode&1)!==0,r){case"dialog":Tr("cancel",i),Tr("close",i);break;case"iframe":case"object":case"embed":Tr("load",i);break;case"video":case"audio":for(n=0;n<Fm.length;n++)Tr(Fm[n],i);break;case"source":Tr("error",i);break;case"img":case"image":case"link":Tr("error",i),Tr("load",i);break;case"details":Tr("toggle",i);break;case"input":EO(i,s),Tr("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Tr("invalid",i);break;case"textarea":TO(i,s),Tr("invalid",i)}lE(r,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&P0(i.textContent,o,e),n=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&P0(i.textContent,o,e),n=["children",""+o]):Cg.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Tr("scroll",i)}switch(r){case"input":_0(i),AO(i,s,!0);break;case"textarea":_0(i),CO(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Y1)}i=n,t.updateQueue=i,i!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=XB(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=a.createElement(r,{is:i.is}):(e=a.createElement(r),r==="select"&&(a=e,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):e=a.createElementNS(e,r),e[to]=t,e[Bg]=i,xU(e,t,!1,!1),t.stateNode=e;e:{switch(a=uE(r,i),r){case"dialog":Tr("cancel",e),Tr("close",e),n=i;break;case"iframe":case"object":case"embed":Tr("load",e),n=i;break;case"video":case"audio":for(n=0;n<Fm.length;n++)Tr(Fm[n],e);n=i;break;case"source":Tr("error",e),n=i;break;case"img":case"image":case"link":Tr("error",e),Tr("load",e),n=i;break;case"details":Tr("toggle",e),n=i;break;case"input":EO(e,i),n=iE(e,i),Tr("invalid",e);break;case"option":n=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},n=Hr({},i,{value:void 0}),Tr("invalid",e);break;case"textarea":TO(e,i),n=aE(e,i),Tr("invalid",e);break;default:n=i}lE(r,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?KB(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&$B(e,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&Dg(e,l):typeof l=="number"&&Dg(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Cg.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Tr("scroll",e):l!=null&&hC(e,s,l,a))}switch(r){case"input":_0(e),AO(e,i,!1);break;case"textarea":_0(e),CO(e);break;case"option":i.value!=null&&e.setAttribute("value",""+Ju(i.value));break;case"select":e.multiple=!!i.multiple,s=i.value,s!=null?af(e,!!i.multiple,s,!1):i.defaultValue!=null&&af(e,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=Y1)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Zi(t),null;case 6:if(e&&t.stateNode!=null)bU(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(Ne(166));if(r=Yc(Ug.current),Yc(ho.current),O0(t)){if(i=t.stateNode,r=t.memoizedProps,i[to]=t,(s=i.nodeValue!==r)&&(e=gs,e!==null))switch(e.tag){case 3:P0(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&P0(i.nodeValue,r,(e.mode&1)!==0)}s&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[to]=t,t.stateNode=i}return Zi(t),null;case 13:if(Pr(Fr),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Br&&hs!==null&&t.mode&1&&!(t.flags&128))BF(),If(),t.flags|=98560,s=!1;else if(s=O0(t),i!==null&&i.dehydrated!==null){if(e===null){if(!s)throw Error(Ne(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ne(317));s[to]=t}else If(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Zi(t),s=!1}else ga!==null&&(VE(ga),ga=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Fr.current&1?_i===0&&(_i=3):qC())),t.updateQueue!==null&&(t.flags|=4),Zi(t),null);case 4:return kf(),kE(e,t),e===null&&zg(t.stateNode.containerInfo),Zi(t),null;case 10:return PC(t.type._context),Zi(t),null;case 17:return Yn(t.type)&&q1(),Zi(t),null;case 19:if(Pr(Fr),s=t.memoizedState,s===null)return Zi(t),null;if(i=(t.flags&128)!==0,a=s.rendering,a===null)if(i)$p(s,!1);else{if(_i!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=ex(e),a!==null){for(t.flags|=128,$p(s,!1),i=a.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)s=r,e=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Er(Fr,Fr.current&1|2),t.child}e=e.sibling}s.tail!==null&&ri()>Nf&&(t.flags|=128,i=!0,$p(s,!1),t.lanes=4194304)}else{if(!i)if(e=ex(a),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),$p(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Br)return Zi(t),null}else 2*ri()-s.renderingStartTime>Nf&&r!==1073741824&&(t.flags|=128,i=!0,$p(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(r=s.last,r!==null?r.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=ri(),t.sibling=null,r=Fr.current,Er(Fr,i?r&1|2:r&1),t):(Zi(t),null);case 22:case 23:return YC(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?os&1073741824&&(Zi(t),t.subtreeFlags&6&&(t.flags|=8192)):Zi(t),null;case 24:return null;case 25:return null}throw Error(Ne(156,t.tag))}function wq(e,t){switch(AC(t),t.tag){case 1:return Yn(t.type)&&q1(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return kf(),Pr(Gn),Pr(un),kC(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return RC(t),null;case 13:if(Pr(Fr),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ne(340));If()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Pr(Fr),null;case 4:return kf(),null;case 10:return PC(t.type._context),null;case 22:case 23:return YC(),null;case 24:return null;default:return null}}var R0=!1,tn=!1,bq=typeof WeakSet=="function"?WeakSet:Set,at=null;function Yd(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){Yr(e,t,i)}else r.current=null}function zE(e,t,r){try{r()}catch(i){Yr(e,t,i)}}var v3=!1;function _q(e,t){if(xE=V1,e=EF(),MC(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var a=0,o=-1,l=-1,u=0,h=0,c=e,d=null;t:for(;;){for(var f;c!==r||n!==0&&c.nodeType!==3||(o=a+n),c!==s||i!==0&&c.nodeType!==3||(l=a+i),c.nodeType===3&&(a+=c.nodeValue.length),(f=c.firstChild)!==null;)d=c,c=f;for(;;){if(c===e)break t;if(d===r&&++u===n&&(o=a),d===s&&++h===i&&(l=a),(f=c.nextSibling)!==null)break;c=d,d=c.parentNode}c=f}r=o===-1||l===-1?null:{start:o,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(wE={focusedElem:e,selectionRange:r},V1=!1,at=t;at!==null;)if(t=at,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,at=e;else for(;at!==null;){t=at;try{var p=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:fa(t.type,m),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ne(163))}}catch(w){Yr(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,at=e;break}at=t.return}return p=v3,v3=!1,p}function rg(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&zE(t,r,s)}n=n.next}while(n!==i)}}function zw(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function NE(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function _U(e){var t=e.alternate;t!==null&&(e.alternate=null,_U(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[to],delete t[Bg],delete t[SE],delete t[nq],delete t[sq])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function SU(e){return e.tag===5||e.tag===3||e.tag===4}function y3(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||SU(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function BE(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Y1));else if(i!==4&&(e=e.child,e!==null))for(BE(e,t,r),e=e.sibling;e!==null;)BE(e,t,r),e=e.sibling}function FE(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(FE(e,t,r),e=e.sibling;e!==null;)FE(e,t,r),e=e.sibling}var Wi=null,pa=!1;function eu(e,t,r){for(r=r.child;r!==null;)MU(e,t,r),r=r.sibling}function MU(e,t,r){if(co&&typeof co.onCommitFiberUnmount=="function")try{co.onCommitFiberUnmount(Cw,r)}catch{}switch(r.tag){case 5:tn||Yd(r,t);case 6:var i=Wi,n=pa;Wi=null,eu(e,t,r),Wi=i,pa=n,Wi!==null&&(pa?(e=Wi,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Wi.removeChild(r.stateNode));break;case 18:Wi!==null&&(pa?(e=Wi,r=r.stateNode,e.nodeType===8?P_(e.parentNode,r):e.nodeType===1&&P_(e,r),Ig(e)):P_(Wi,r.stateNode));break;case 4:i=Wi,n=pa,Wi=r.stateNode.containerInfo,pa=!0,eu(e,t,r),Wi=i,pa=n;break;case 0:case 11:case 14:case 15:if(!tn&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&zE(r,t,a),n=n.next}while(n!==i)}eu(e,t,r);break;case 1:if(!tn&&(Yd(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(o){Yr(r,t,o)}eu(e,t,r);break;case 21:eu(e,t,r);break;case 22:r.mode&1?(tn=(i=tn)||r.memoizedState!==null,eu(e,t,r),tn=i):eu(e,t,r);break;default:eu(e,t,r)}}function x3(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new bq),t.forEach(function(i){var n=Oq.bind(null,e,i);r.has(i)||(r.add(i),i.then(n,n))})}}function na(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:Wi=o.stateNode,pa=!1;break e;case 3:Wi=o.stateNode.containerInfo,pa=!0;break e;case 4:Wi=o.stateNode.containerInfo,pa=!0;break e}o=o.return}if(Wi===null)throw Error(Ne(160));MU(s,a,n),Wi=null,pa=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(u){Yr(n,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)EU(t,e),t=t.sibling}function EU(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(na(t,e),za(e),i&4){try{rg(3,e,e.return),zw(3,e)}catch(m){Yr(e,e.return,m)}try{rg(5,e,e.return)}catch(m){Yr(e,e.return,m)}}break;case 1:na(t,e),za(e),i&512&&r!==null&&Yd(r,r.return);break;case 5:if(na(t,e),za(e),i&512&&r!==null&&Yd(r,r.return),e.flags&32){var n=e.stateNode;try{Dg(n,"")}catch(m){Yr(e,e.return,m)}}if(i&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=r!==null?r.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&YB(n,s),uE(o,a);var u=uE(o,s);for(a=0;a<l.length;a+=2){var h=l[a],c=l[a+1];h==="style"?KB(n,c):h==="dangerouslySetInnerHTML"?$B(n,c):h==="children"?Dg(n,c):hC(n,h,c,u)}switch(o){case"input":nE(n,s);break;case"textarea":qB(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?af(n,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?af(n,!!s.multiple,s.defaultValue,!0):af(n,!!s.multiple,s.multiple?[]:"",!1))}n[Bg]=s}catch(m){Yr(e,e.return,m)}}break;case 6:if(na(t,e),za(e),i&4){if(e.stateNode===null)throw Error(Ne(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(m){Yr(e,e.return,m)}}break;case 3:if(na(t,e),za(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{Ig(t.containerInfo)}catch(m){Yr(e,e.return,m)}break;case 4:na(t,e),za(e);break;case 13:na(t,e),za(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(WC=ri())),i&4&&x3(e);break;case 22:if(h=r!==null&&r.memoizedState!==null,e.mode&1?(tn=(u=tn)||h,na(t,e),tn=u):na(t,e),za(e),i&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!h&&e.mode&1)for(at=e,h=e.child;h!==null;){for(c=at=h;at!==null;){switch(d=at,f=d.child,d.tag){case 0:case 11:case 14:case 15:rg(4,d,d.return);break;case 1:Yd(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){i=d,r=d.return;try{t=i,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){Yr(i,r,m)}}break;case 5:Yd(d,d.return);break;case 22:if(d.memoizedState!==null){b3(c);continue}}f!==null?(f.return=d,at=f):b3(c)}h=h.sibling}e:for(h=null,c=e;;){if(c.tag===5){if(h===null){h=c;try{n=c.stateNode,u?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=c.stateNode,l=c.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=QB("display",a))}catch(m){Yr(e,e.return,m)}}}else if(c.tag===6){if(h===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(m){Yr(e,e.return,m)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===e)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===e)break e;for(;c.sibling===null;){if(c.return===null||c.return===e)break e;h===c&&(h=null),c=c.return}h===c&&(h=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:na(t,e),za(e),i&4&&x3(e);break;case 21:break;default:na(t,e),za(e)}}function za(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(SU(r)){var i=r;break e}r=r.return}throw Error(Ne(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(Dg(n,""),i.flags&=-33);var s=y3(e);FE(e,s,n);break;case 3:case 4:var a=i.stateNode.containerInfo,o=y3(e);BE(e,o,a);break;default:throw Error(Ne(161))}}catch(l){Yr(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Sq(e,t,r){at=e,AU(e)}function AU(e,t,r){for(var i=(e.mode&1)!==0;at!==null;){var n=at,s=n.child;if(n.tag===22&&i){var a=n.memoizedState!==null||R0;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||tn;o=R0;var u=tn;if(R0=a,(tn=l)&&!u)for(at=n;at!==null;)a=at,l=a.child,a.tag===22&&a.memoizedState!==null?_3(n):l!==null?(l.return=a,at=l):_3(n);for(;s!==null;)at=s,AU(s),s=s.sibling;at=n,R0=o,tn=u}w3(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,at=s):w3(e)}}function w3(e){for(;at!==null;){var t=at;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:tn||zw(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!tn)if(r===null)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:fa(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&i3(t,s,i);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}i3(t,a,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var c=h.dehydrated;c!==null&&Ig(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ne(163))}tn||t.flags&512&&NE(t)}catch(d){Yr(t,t.return,d)}}if(t===e){at=null;break}if(r=t.sibling,r!==null){r.return=t.return,at=r;break}at=t.return}}function b3(e){for(;at!==null;){var t=at;if(t===e){at=null;break}var r=t.sibling;if(r!==null){r.return=t.return,at=r;break}at=t.return}}function _3(e){for(;at!==null;){var t=at;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{zw(4,t)}catch(l){Yr(t,r,l)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var n=t.return;try{i.componentDidMount()}catch(l){Yr(t,n,l)}}var s=t.return;try{NE(t)}catch(l){Yr(t,s,l)}break;case 5:var a=t.return;try{NE(t)}catch(l){Yr(t,a,l)}}}catch(l){Yr(t,t.return,l)}if(t===e){at=null;break}var o=t.sibling;if(o!==null){o.return=t.return,at=o;break}at=t.return}}var Mq=Math.ceil,ix=Vl.ReactCurrentDispatcher,HC=Vl.ReactCurrentOwner,Vs=Vl.ReactCurrentBatchConfig,Jt=0,Ni=null,di=null,Yi=0,os=0,qd=uc(0),_i=0,Wg=null,mh=0,Nw=0,VC=0,ig=null,zn=null,WC=0,Nf=1/0,al=null,nx=!1,UE=null,Vu=null,k0=!1,Tu=null,sx=0,ng=0,jE=null,m1=-1,g1=0;function An(){return Jt&6?ri():m1!==-1?m1:m1=ri()}function Wu(e){return e.mode&1?Jt&2&&Yi!==0?Yi&-Yi:oq.transition!==null?(g1===0&&(g1=uF()),g1):(e=hr,e!==0||(e=window.event,e=e===void 0?16:gF(e.type)),e):1}function Ea(e,t,r,i){if(50<ng)throw ng=0,jE=null,Error(Ne(185));Tv(e,r,i),(!(Jt&2)||e!==Ni)&&(e===Ni&&(!(Jt&2)&&(Nw|=r),_i===4&&bu(e,Yi)),qn(e,i),r===1&&Jt===0&&!(t.mode&1)&&(Nf=ri()+500,Iw&&cc()))}function qn(e,t){var r=e.callbackNode;o7(e,t);var i=H1(e,e===Ni?Yi:0);if(i===0)r!==null&&OO(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&OO(r),t===1)e.tag===0?aq(S3.bind(null,e)):kF(S3.bind(null,e)),rq(function(){!(Jt&6)&&cc()}),r=null;else{switch(cF(i)){case 1:r=gC;break;case 4:r=oF;break;case 16:r=j1;break;case 536870912:r=lF;break;default:r=j1}r=RU(r,TU.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function TU(e,t){if(m1=-1,g1=0,Jt&6)throw Error(Ne(327));var r=e.callbackNode;if(hf()&&e.callbackNode!==r)return null;var i=H1(e,e===Ni?Yi:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=ax(e,i);else{t=i;var n=Jt;Jt|=2;var s=DU();(Ni!==e||Yi!==t)&&(al=null,Nf=ri()+500,eh(e,t));do try{Tq();break}catch(o){CU(e,o)}while(1);DC(),ix.current=s,Jt=n,di!==null?t=0:(Ni=null,Yi=0,t=_i)}if(t!==0){if(t===2&&(n=pE(e),n!==0&&(i=n,t=HE(e,n))),t===1)throw r=Wg,eh(e,0),bu(e,i),qn(e,ri()),r;if(t===6)bu(e,i);else{if(n=e.current.alternate,!(i&30)&&!Eq(n)&&(t=ax(e,i),t===2&&(s=pE(e),s!==0&&(i=s,t=HE(e,s))),t===1))throw r=Wg,eh(e,0),bu(e,i),qn(e,ri()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(Ne(345));case 2:Lc(e,zn,al);break;case 3:if(bu(e,i),(i&130023424)===i&&(t=WC+500-ri(),10<t)){if(H1(e,0)!==0)break;if(n=e.suspendedLanes,(n&i)!==i){An(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=_E(Lc.bind(null,e,zn,al),t);break}Lc(e,zn,al);break;case 4:if(bu(e,i),(i&4194240)===i)break;for(t=e.eventTimes,n=-1;0<i;){var a=31-Ma(i);s=1<<a,a=t[a],a>n&&(n=a),i&=~s}if(i=n,i=ri()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Mq(i/1960))-i,10<i){e.timeoutHandle=_E(Lc.bind(null,e,zn,al),i);break}Lc(e,zn,al);break;case 5:Lc(e,zn,al);break;default:throw Error(Ne(329))}}}return qn(e,ri()),e.callbackNode===r?TU.bind(null,e):null}function HE(e,t){var r=ig;return e.current.memoizedState.isDehydrated&&(eh(e,t).flags|=256),e=ax(e,t),e!==2&&(t=zn,zn=r,t!==null&&VE(t)),e}function VE(e){zn===null?zn=e:zn.push.apply(zn,e)}function Eq(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!Ta(s(),n))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function bu(e,t){for(t&=~VC,t&=~Nw,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ma(t),i=1<<r;e[r]=-1,t&=~i}}function S3(e){if(Jt&6)throw Error(Ne(327));hf();var t=H1(e,0);if(!(t&1))return qn(e,ri()),null;var r=ax(e,t);if(e.tag!==0&&r===2){var i=pE(e);i!==0&&(t=i,r=HE(e,i))}if(r===1)throw r=Wg,eh(e,0),bu(e,t),qn(e,ri()),r;if(r===6)throw Error(Ne(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Lc(e,zn,al),qn(e,ri()),null}function GC(e,t){var r=Jt;Jt|=1;try{return e(t)}finally{Jt=r,Jt===0&&(Nf=ri()+500,Iw&&cc())}}function gh(e){Tu!==null&&Tu.tag===0&&!(Jt&6)&&hf();var t=Jt;Jt|=1;var r=Vs.transition,i=hr;try{if(Vs.transition=null,hr=1,e)return e()}finally{hr=i,Vs.transition=r,Jt=t,!(Jt&6)&&cc()}}function YC(){os=qd.current,Pr(qd)}function eh(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,tq(r)),di!==null)for(r=di.return;r!==null;){var i=r;switch(AC(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&q1();break;case 3:kf(),Pr(Gn),Pr(un),kC();break;case 5:RC(i);break;case 4:kf();break;case 13:Pr(Fr);break;case 19:Pr(Fr);break;case 10:PC(i.type._context);break;case 22:case 23:YC()}r=r.return}if(Ni=e,di=e=Gu(e.current,null),Yi=os=t,_i=0,Wg=null,VC=Nw=mh=0,zn=ig=null,Gc!==null){for(t=0;t<Gc.length;t++)if(r=Gc[t],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var a=s.next;s.next=n,i.next=a}r.pending=i}Gc=null}return e}function CU(e,t){do{var r=di;try{if(DC(),d1.current=rx,tx){for(var i=jr.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}tx=!1}if(ph=0,Ii=wi=jr=null,tg=!1,jg=0,HC.current=null,r===null||r.return===null){_i=1,Wg=t,di=null;break}e:{var s=e,a=r.return,o=r,l=t;if(t=Yi,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=o,c=h.tag;if(!(h.mode&1)&&(c===0||c===11||c===15)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=c3(a);if(f!==null){f.flags&=-257,h3(f,a,o,s,t),f.mode&1&&u3(s,u,t),t=f,l=u;var p=t.updateQueue;if(p===null){var m=new Set;m.add(l),t.updateQueue=m}else p.add(l);break e}else{if(!(t&1)){u3(s,u,t),qC();break e}l=Error(Ne(426))}}else if(Br&&o.mode&1){var g=c3(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),h3(g,a,o,s,t),TC(zf(l,o));break e}}s=l=zf(l,o),_i!==4&&(_i=2),ig===null?ig=[s]:ig.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var v=hU(s,l,t);r3(s,v);break e;case 1:o=l;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Vu===null||!Vu.has(x)))){s.flags|=65536,t&=-t,s.lanes|=t;var w=dU(s,o,t);r3(s,w);break e}}s=s.return}while(s!==null)}OU(r)}catch(S){t=S,di===r&&r!==null&&(di=r=r.return);continue}break}while(1)}function DU(){var e=ix.current;return ix.current=rx,e===null?rx:e}function qC(){(_i===0||_i===3||_i===2)&&(_i=4),Ni===null||!(mh&268435455)&&!(Nw&268435455)||bu(Ni,Yi)}function ax(e,t){var r=Jt;Jt|=2;var i=DU();(Ni!==e||Yi!==t)&&(al=null,eh(e,t));do try{Aq();break}catch(n){CU(e,n)}while(1);if(DC(),Jt=r,ix.current=i,di!==null)throw Error(Ne(261));return Ni=null,Yi=0,_i}function Aq(){for(;di!==null;)PU(di)}function Tq(){for(;di!==null&&!Z9();)PU(di)}function PU(e){var t=IU(e.alternate,e,os);e.memoizedProps=e.pendingProps,t===null?OU(e):di=t,HC.current=null}function OU(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=wq(r,t),r!==null){r.flags&=32767,di=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{_i=6,di=null;return}}else if(r=xq(r,t,os),r!==null){di=r;return}if(t=t.sibling,t!==null){di=t;return}di=t=e}while(t!==null);_i===0&&(_i=5)}function Lc(e,t,r){var i=hr,n=Vs.transition;try{Vs.transition=null,hr=1,Cq(e,t,r,i)}finally{Vs.transition=n,hr=i}return null}function Cq(e,t,r,i){do hf();while(Tu!==null);if(Jt&6)throw Error(Ne(327));r=e.finishedWork;var n=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Ne(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(l7(e,s),e===Ni&&(di=Ni=null,Yi=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||k0||(k0=!0,RU(j1,function(){return hf(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Vs.transition,Vs.transition=null;var a=hr;hr=1;var o=Jt;Jt|=4,HC.current=null,_q(e,r),EU(r,e),X7(wE),V1=!!xE,wE=xE=null,e.current=r,Sq(r),J9(),Jt=o,hr=a,Vs.transition=s}else e.current=r;if(k0&&(k0=!1,Tu=e,sx=n),s=e.pendingLanes,s===0&&(Vu=null),r7(r.stateNode),qn(e,ri()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(nx)throw nx=!1,e=UE,UE=null,e;return sx&1&&e.tag!==0&&hf(),s=e.pendingLanes,s&1?e===jE?ng++:(ng=0,jE=e):ng=0,cc(),null}function hf(){if(Tu!==null){var e=cF(sx),t=Vs.transition,r=hr;try{if(Vs.transition=null,hr=16>e?16:e,Tu===null)var i=!1;else{if(e=Tu,Tu=null,sx=0,Jt&6)throw Error(Ne(331));var n=Jt;for(Jt|=4,at=e.current;at!==null;){var s=at,a=s.child;if(at.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(at=u;at!==null;){var h=at;switch(h.tag){case 0:case 11:case 15:rg(8,h,s)}var c=h.child;if(c!==null)c.return=h,at=c;else for(;at!==null;){h=at;var d=h.sibling,f=h.return;if(_U(h),h===u){at=null;break}if(d!==null){d.return=f,at=d;break}at=f}}}var p=s.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}at=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,at=a;else e:for(;at!==null;){if(s=at,s.flags&2048)switch(s.tag){case 0:case 11:case 15:rg(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,at=v;break e}at=s.return}}var y=e.current;for(at=y;at!==null;){a=at;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,at=x;else e:for(a=y;at!==null;){if(o=at,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:zw(9,o)}}catch(S){Yr(o,o.return,S)}if(o===a){at=null;break e}var w=o.sibling;if(w!==null){w.return=o.return,at=w;break e}at=o.return}}if(Jt=n,cc(),co&&typeof co.onPostCommitFiberRoot=="function")try{co.onPostCommitFiberRoot(Cw,e)}catch{}i=!0}return i}finally{hr=r,Vs.transition=t}}return!1}function M3(e,t,r){t=zf(r,t),t=hU(e,t,1),e=Hu(e,t,1),t=An(),e!==null&&(Tv(e,1,t),qn(e,t))}function Yr(e,t,r){if(e.tag===3)M3(e,e,r);else for(;t!==null;){if(t.tag===3){M3(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Vu===null||!Vu.has(i))){e=zf(r,e),e=dU(t,e,1),t=Hu(t,e,1),e=An(),t!==null&&(Tv(t,1,e),qn(t,e));break}}t=t.return}}function Dq(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=An(),e.pingedLanes|=e.suspendedLanes&r,Ni===e&&(Yi&r)===r&&(_i===4||_i===3&&(Yi&130023424)===Yi&&500>ri()-WC?eh(e,0):VC|=r),qn(e,t)}function LU(e,t){t===0&&(e.mode&1?(t=E0,E0<<=1,!(E0&130023424)&&(E0=4194304)):t=1);var r=An();e=Il(e,t),e!==null&&(Tv(e,t,r),qn(e,r))}function Pq(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),LU(e,r)}function Oq(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(Ne(314))}i!==null&&i.delete(t),LU(e,r)}var IU;IU=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Gn.current)jn=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return jn=!1,yq(e,t,r);jn=!!(e.flags&131072)}else jn=!1,Br&&t.flags&1048576&&zF(t,Q1,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;p1(e,t),e=t.pendingProps;var n=Lf(t,un.current);cf(t,r),n=NC(null,t,i,e,n,r);var s=BC();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Yn(i)?(s=!0,X1(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,LC(t),n.updater=Rw,t.stateNode=n,n._reactInternals=t,DE(t,i,e,r),t=LE(null,t,i,!0,s,r)):(t.tag=0,Br&&s&&EC(t),wn(null,t,n,r),t=t.child),t;case 16:i=t.elementType;e:{switch(p1(e,t),e=t.pendingProps,n=i._init,i=n(i._payload),t.type=i,n=t.tag=Iq(i),e=fa(i,e),n){case 0:t=OE(null,t,i,e,r);break e;case 1:t=p3(null,t,i,e,r);break e;case 11:t=d3(null,t,i,e,r);break e;case 14:t=f3(null,t,i,fa(i.type,e),r);break e}throw Error(Ne(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:fa(i,n),OE(e,t,i,n,r);case 1:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:fa(i,n),p3(e,t,i,n,r);case 3:e:{if(gU(t),e===null)throw Error(Ne(387));i=t.pendingProps,s=t.memoizedState,n=s.element,UF(e,t),J1(t,i,null,r);var a=t.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=zf(Error(Ne(423)),t),t=m3(e,t,i,r,n);break e}else if(i!==n){n=zf(Error(Ne(424)),t),t=m3(e,t,i,r,n);break e}else for(hs=ju(t.stateNode.containerInfo.firstChild),gs=t,Br=!0,ga=null,r=WF(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(If(),i===n){t=Rl(e,t,r);break e}wn(e,t,i,r)}t=t.child}return t;case 5:return GF(t),e===null&&AE(t),i=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,bE(i,n)?a=null:s!==null&&bE(i,s)&&(t.flags|=32),mU(e,t),wn(e,t,a,r),t.child;case 6:return e===null&&AE(t),null;case 13:return vU(e,t,r);case 4:return IC(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=Rf(t,null,i,r):wn(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:fa(i,n),d3(e,t,i,n,r);case 7:return wn(e,t,t.pendingProps,r),t.child;case 8:return wn(e,t,t.pendingProps.children,r),t.child;case 12:return wn(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,Er(K1,i._currentValue),i._currentValue=a,s!==null)if(Ta(s.value,a)){if(s.children===n.children&&!Gn.current){t=Rl(e,t,r);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Ml(-1,r&-r),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),TE(s.return,r,t),o.lanes|=r;break}l=l.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(Ne(341));a.lanes|=r,o=a.alternate,o!==null&&(o.lanes|=r),TE(a,r,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}wn(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,cf(t,r),n=qs(n),i=i(n),t.flags|=1,wn(e,t,i,r),t.child;case 14:return i=t.type,n=fa(i,t.pendingProps),n=fa(i.type,n),f3(e,t,i,n,r);case 15:return fU(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:fa(i,n),p1(e,t),t.tag=1,Yn(i)?(e=!0,X1(t)):e=!1,cf(t,r),HF(t,i,n),DE(t,i,n,r),LE(null,t,i,!0,e,r);case 19:return yU(e,t,r);case 22:return pU(e,t,r)}throw Error(Ne(156,t.tag))};function RU(e,t){return aF(e,t)}function Lq(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Hs(e,t,r,i){return new Lq(e,t,r,i)}function XC(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Iq(e){if(typeof e=="function")return XC(e)?1:0;if(e!=null){if(e=e.$$typeof,e===fC)return 11;if(e===pC)return 14}return 2}function Gu(e,t){var r=e.alternate;return r===null?(r=Hs(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function v1(e,t,r,i,n,s){var a=2;if(i=e,typeof e=="function")XC(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Nd:return th(r.children,n,s,t);case dC:a=8,n|=8;break;case JM:return e=Hs(12,r,t,n|2),e.elementType=JM,e.lanes=s,e;case eE:return e=Hs(13,r,t,n),e.elementType=eE,e.lanes=s,e;case tE:return e=Hs(19,r,t,n),e.elementType=tE,e.lanes=s,e;case VB:return Bw(r,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case jB:a=10;break e;case HB:a=9;break e;case fC:a=11;break e;case pC:a=14;break e;case vu:a=16,i=null;break e}throw Error(Ne(130,e==null?e:typeof e,""))}return t=Hs(a,r,t,n),t.elementType=e,t.type=i,t.lanes=s,t}function th(e,t,r,i){return e=Hs(7,e,i,t),e.lanes=r,e}function Bw(e,t,r,i){return e=Hs(22,e,i,t),e.elementType=VB,e.lanes=r,e.stateNode={isHidden:!1},e}function B_(e,t,r){return e=Hs(6,e,null,t),e.lanes=r,e}function F_(e,t,r){return t=Hs(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Rq(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=x_(0),this.expirationTimes=x_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=x_(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function $C(e,t,r,i,n,s,a,o,l){return e=new Rq(e,t,r,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Hs(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},LC(s),e}function kq(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zd,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function kU(e){if(!e)return ec;e=e._reactInternals;e:{if(Ph(e)!==e||e.tag!==1)throw Error(Ne(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Yn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ne(171))}if(e.tag===1){var r=e.type;if(Yn(r))return RF(e,r,t)}return t}function zU(e,t,r,i,n,s,a,o,l){return e=$C(r,i,!0,e,n,s,a,o,l),e.context=kU(null),r=e.current,i=An(),n=Wu(r),s=Ml(i,n),s.callback=t??null,Hu(r,s,n),e.current.lanes=n,Tv(e,n,i),qn(e,i),e}function Fw(e,t,r,i){var n=t.current,s=An(),a=Wu(n);return r=kU(r),t.context===null?t.context=r:t.pendingContext=r,t=Ml(s,a),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=Hu(n,t,a),e!==null&&(Ea(e,n,a,s),h1(e,n,a)),a}function ox(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function E3(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function QC(e,t){E3(e,t),(e=e.alternate)&&E3(e,t)}function zq(){return null}var NU=typeof reportError=="function"?reportError:function(e){console.error(e)};function KC(e){this._internalRoot=e}Uw.prototype.render=KC.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ne(409));Fw(e,t,null,null)};Uw.prototype.unmount=KC.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;gh(function(){Fw(null,e,null,null)}),t[Ll]=null}};function Uw(e){this._internalRoot=e}Uw.prototype.unstable_scheduleHydration=function(e){if(e){var t=fF();e={blockedOn:null,target:e,priority:t};for(var r=0;r<wu.length&&t!==0&&t<wu[r].priority;r++);wu.splice(r,0,e),r===0&&mF(e)}};function ZC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function jw(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function A3(){}function Nq(e,t,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var u=ox(a);s.call(u)}}var a=zU(t,i,e,0,null,!1,!1,"",A3);return e._reactRootContainer=a,e[Ll]=a.current,zg(e.nodeType===8?e.parentNode:e),gh(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof i=="function"){var o=i;i=function(){var u=ox(l);o.call(u)}}var l=$C(e,0,!1,null,null,!1,!1,"",A3);return e._reactRootContainer=l,e[Ll]=l.current,zg(e.nodeType===8?e.parentNode:e),gh(function(){Fw(t,l,r,i)}),l}function Hw(e,t,r,i,n){var s=r._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=ox(a);o.call(l)}}Fw(t,a,e,n)}else a=Nq(r,t,e,n,i);return ox(a)}hF=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Bm(t.pendingLanes);r!==0&&(vC(t,r|1),qn(t,ri()),!(Jt&6)&&(Nf=ri()+500,cc()))}break;case 13:gh(function(){var i=Il(e,1);if(i!==null){var n=An();Ea(i,e,1,n)}}),QC(e,1)}};yC=function(e){if(e.tag===13){var t=Il(e,134217728);if(t!==null){var r=An();Ea(t,e,134217728,r)}QC(e,134217728)}};dF=function(e){if(e.tag===13){var t=Wu(e),r=Il(e,t);if(r!==null){var i=An();Ea(r,e,t,i)}QC(e,t)}};fF=function(){return hr};pF=function(e,t){var r=hr;try{return hr=e,t()}finally{hr=r}};hE=function(e,t,r){switch(t){case"input":if(nE(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=Lw(i);if(!n)throw Error(Ne(90));GB(i),nE(i,n)}}}break;case"textarea":qB(e,r);break;case"select":t=r.value,t!=null&&af(e,!!r.multiple,t,!1)}};eF=GC;tF=gh;var Bq={usingClientEntryPoint:!1,Events:[Dv,jd,Lw,ZB,JB,GC]},Qp={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Fq={bundleType:Qp.bundleType,version:Qp.version,rendererPackageName:Qp.rendererPackageName,rendererConfig:Qp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vl.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=nF(e),e===null?null:e.stateNode},findFiberByHostInstance:Qp.findFiberByHostInstance||zq,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var z0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!z0.isDisabled&&z0.supportsFiber)try{Cw=z0.inject(Fq),co=z0}catch{}}_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bq;_s.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ZC(t))throw Error(Ne(200));return kq(e,t,null,r)};_s.createRoot=function(e,t){if(!ZC(e))throw Error(Ne(299));var r=!1,i="",n=NU;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=$C(e,1,!1,null,null,r,!1,i,n),e[Ll]=t.current,zg(e.nodeType===8?e.parentNode:e),new KC(t)};_s.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ne(188)):(e=Object.keys(e).join(","),Error(Ne(268,e)));return e=nF(t),e=e===null?null:e.stateNode,e};_s.flushSync=function(e){return gh(e)};_s.hydrate=function(e,t,r){if(!jw(t))throw Error(Ne(200));return Hw(null,e,t,!0,r)};_s.hydrateRoot=function(e,t,r){if(!ZC(e))throw Error(Ne(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",a=NU;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=zU(t,null,e,1,r??null,n,!1,s,a),e[Ll]=t.current,zg(e),i)for(e=0;e<i.length;e++)r=i[e],n=r._getVersion,n=n(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new Uw(t)};_s.render=function(e,t,r){if(!jw(t))throw Error(Ne(200));return Hw(null,e,t,!1,r)};_s.unmountComponentAtNode=function(e){if(!jw(e))throw Error(Ne(40));return e._reactRootContainer?(gh(function(){Hw(null,null,e,!1,function(){e._reactRootContainer=null,e[Ll]=null})}),!0):!1};_s.unstable_batchedUpdates=GC;_s.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!jw(r))throw Error(Ne(200));if(e==null||e._reactInternals===void 0)throw Error(Ne(38));return Hw(e,t,r,!1,i)};_s.version="18.2.0-next-9e3b772b8-20220608";function BU(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(BU)}catch(e){console.error(e)}}BU(),zB.exports=_s;var FU=zB.exports;const UU=sp(FU);var T3=FU;KM.createRoot=T3.createRoot,KM.hydrateRoot=T3.hydrateRoot;/**
 * @remix-run/router v1.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zr(){return zr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},zr.apply(this,arguments)}var ci;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ci||(ci={}));const C3="popstate";function Uq(e){e===void 0&&(e={});function t(n,s){let{pathname:a="/",search:o="",hash:l=""}=Ao(n.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Gg("",{pathname:a,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){let a=n.document.querySelector("base"),o="";if(a&&a.getAttribute("href")){let l=n.location.href,u=l.indexOf("#");o=u===-1?l:l.slice(0,u)}return o+"#"+(typeof s=="string"?s:yh(s))}function i(n,s){vh(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(s)+")")}return Hq(t,r,i,e)}function jt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function vh(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function jq(){return Math.random().toString(36).substr(2,8)}function D3(e,t){return{usr:e.state,key:e.key,idx:t}}function Gg(e,t,r,i){return r===void 0&&(r=null),zr({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Ao(t):t,{state:r,key:t&&t.key||i||jq()})}function yh(e){let{pathname:t="/",search:r="",hash:i=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),i&&i!=="#"&&(t+=i.charAt(0)==="#"?i:"#"+i),t}function Ao(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function Hq(e,t,r,i){i===void 0&&(i={});let{window:n=document.defaultView,v5Compat:s=!1}=i,a=n.history,o=ci.Pop,l=null,u=h();u==null&&(u=0,a.replaceState(zr({},a.state,{idx:u}),""));function h(){return(a.state||{idx:null}).idx}function c(){o=ci.Pop;let g=h(),v=g==null?null:g-u;u=g,l&&l({action:o,location:m.location,delta:v})}function d(g,v){o=ci.Push;let y=Gg(m.location,g,v);r&&r(y,g),u=h()+1;let x=D3(y,u),w=m.createHref(y);try{a.pushState(x,"",w)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;n.location.assign(w)}s&&l&&l({action:o,location:m.location,delta:1})}function f(g,v){o=ci.Replace;let y=Gg(m.location,g,v);r&&r(y,g),u=h();let x=D3(y,u),w=m.createHref(y);a.replaceState(x,"",w),s&&l&&l({action:o,location:m.location,delta:0})}function p(g){let v=n.location.origin!=="null"?n.location.origin:n.location.href,y=typeof g=="string"?g:yh(g);return jt(v,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,v)}let m={get action(){return o},get location(){return e(n,a)},listen(g){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(C3,c),l=g,()=>{n.removeEventListener(C3,c),l=null}},createHref(g){return t(n,g)},createURL:p,encodeLocation(g){let v=p(g);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:d,replace:f,go(g){return a.go(g)}};return m}var ti;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ti||(ti={}));const Vq=new Set(["lazy","caseSensitive","path","id","index","children"]);function Wq(e){return e.index===!0}function WE(e,t,r,i){return r===void 0&&(r=[]),i===void 0&&(i={}),e.map((n,s)=>{let a=[...r,s],o=typeof n.id=="string"?n.id:a.join("-");if(jt(n.index!==!0||!n.children,"Cannot specify children on an index route"),jt(!i[o],'Found a route id collision on id "'+o+`".  Route id's must be globally unique within Data Router usages`),Wq(n)){let l=zr({},n,t(n),{id:o});return i[o]=l,l}else{let l=zr({},n,t(n),{id:o,children:void 0});return i[o]=l,n.children&&(l.children=WE(n.children,t,a,i)),l}})}function Xd(e,t,r){r===void 0&&(r="/");let i=typeof t=="string"?Ao(t):t,n=up(i.pathname||"/",r);if(n==null)return null;let s=jU(e);Gq(s);let a=null;for(let o=0;a==null&&o<s.length;++o)a=eX(s[o],iX(n));return a}function jU(e,t,r,i){t===void 0&&(t=[]),r===void 0&&(r=[]),i===void 0&&(i="");let n=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(jt(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let u=El([i,l.relativePath]),h=r.concat(l);s.children&&s.children.length>0&&(jt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),jU(s.children,t,h,u)),!(s.path==null&&!s.index)&&t.push({path:u,score:Zq(u,s.index),routesMeta:h})};return e.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))n(s,a);else for(let l of HU(s.path))n(s,a,l)}),t}function HU(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,n=r.endsWith("?"),s=r.replace(/\?$/,"");if(i.length===0)return n?[s,""]:[s];let a=HU(i.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),n&&o.push(...a),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function Gq(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Jq(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}const Yq=/^:\w+$/,qq=3,Xq=2,$q=1,Qq=10,Kq=-2,P3=e=>e==="*";function Zq(e,t){let r=e.split("/"),i=r.length;return r.some(P3)&&(i+=Kq),t&&(i+=Xq),r.filter(n=>!P3(n)).reduce((n,s)=>n+(Yq.test(s)?qq:s===""?$q:Qq),i)}function Jq(e,t){return e.length===t.length&&e.slice(0,-1).every((i,n)=>i===t[n])?e[e.length-1]-t[t.length-1]:0}function eX(e,t){let{routesMeta:r}=e,i={},n="/",s=[];for(let a=0;a<r.length;++a){let o=r[a],l=a===r.length-1,u=n==="/"?t:t.slice(n.length)||"/",h=tX({path:o.relativePath,caseSensitive:o.caseSensitive,end:l},u);if(!h)return null;Object.assign(i,h.params);let c=o.route;s.push({params:i,pathname:El([n,h.pathname]),pathnameBase:oX(El([n,h.pathnameBase])),route:c}),h.pathnameBase!=="/"&&(n=El([n,h.pathnameBase]))}return s}function tX(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=rX(e.path,e.caseSensitive,e.end),n=t.match(r);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:i.reduce((u,h,c)=>{if(h==="*"){let d=o[c]||"";a=s.slice(0,s.length-d.length).replace(/(.)\/+$/,"$1")}return u[h]=nX(o[c]||"",h),u},{}),pathname:s,pathnameBase:a,pattern:e}}function rX(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),vh(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let i=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(a,o)=>(i.push(o),"/([^\\/]+)"));return e.endsWith("*")?(i.push("*"),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),i]}function iX(e){try{return decodeURI(e)}catch(t){return vh(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function nX(e,t){try{return decodeURIComponent(e)}catch(r){return vh(!1,'The value for the URL param "'+t+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),e}}function up(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function sX(e,t){t===void 0&&(t="/");let{pathname:r,search:i="",hash:n=""}=typeof e=="string"?Ao(e):e;return{pathname:r?r.startsWith("/")?r:aX(r,t):t,search:lX(i),hash:uX(n)}}function aX(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function U_(e,t,r,i){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Vw(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function JC(e,t,r,i){i===void 0&&(i=!1);let n;typeof e=="string"?n=Ao(e):(n=zr({},e),jt(!n.pathname||!n.pathname.includes("?"),U_("?","pathname","search",n)),jt(!n.pathname||!n.pathname.includes("#"),U_("#","pathname","hash",n)),jt(!n.search||!n.search.includes("#"),U_("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(i||a==null)o=r;else{let c=t.length-1;if(a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),c-=1;n.pathname=d.join("/")}o=c>=0?t[c]:"/"}let l=sX(n,o),u=a&&a!=="/"&&a.endsWith("/"),h=(s||a===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||h)&&(l.pathname+="/"),l}const El=e=>e.join("/").replace(/\/\/+/g,"/"),oX=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),lX=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,uX=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;class eD{constructor(t,r,i,n){n===void 0&&(n=!1),this.status=t,this.statusText=r||"",this.internal=n,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}}function VU(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const WU=["post","put","patch","delete"],cX=new Set(WU),hX=["get",...WU],dX=new Set(hX),fX=new Set([301,302,303,307,308]),pX=new Set([307,308]),j_={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},mX={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Kp={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},GU=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gX=e=>({hasErrorBoundary:!!e.hasErrorBoundary});function vX(e){const t=e.window?e.window:typeof window<"u"?window:void 0,r=typeof t<"u"&&typeof t.document<"u"&&typeof t.document.createElement<"u",i=!r;jt(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let n;if(e.mapRouteProperties)n=e.mapRouteProperties;else if(e.detectErrorBoundary){let ne=e.detectErrorBoundary;n=oe=>({hasErrorBoundary:ne(oe)})}else n=gX;let s={},a=WE(e.routes,n,void 0,s),o,l=e.basename||"/",u=zr({v7_normalizeFormMethod:!1,v7_prependBasename:!1},e.future),h=null,c=new Set,d=null,f=null,p=null,m=e.hydrationData!=null,g=Xd(a,e.history.location,l),v=null;if(g==null){let ne=Is(404,{pathname:e.history.location.pathname}),{matches:oe,route:ve}=B3(a);g=oe,v={[ve.id]:ne}}let y=!g.some(ne=>ne.route.lazy)&&(!g.some(ne=>ne.route.loader)||e.hydrationData!=null),x,w={historyAction:e.history.action,location:e.history.location,matches:g,initialized:y,navigation:j_,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||v,fetchers:new Map,blockers:new Map},S=ci.Pop,_=!1,A,M=!1,T=!1,C=[],L=[],I=new Map,k=0,z=-1,V=new Map,K=new Set,q=new Map,O=new Map,W=new Map,N=!1;function B(){return h=e.history.listen(ne=>{let{action:oe,location:ve,delta:ze}=ne;if(N){N=!1;return}vh(W.size===0||ze!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let rt=ke({currentLocation:w.location,nextLocation:ve,historyAction:oe});if(rt&&ze!=null){N=!0,e.history.go(ze*-1),Ce(rt,{state:"blocked",location:ve,proceed(){Ce(rt,{state:"proceeding",proceed:void 0,reset:void 0,location:ve}),e.history.go(ze)},reset(){let Z=new Map(w.blockers);Z.set(rt,Kp),H({blockers:Z})}});return}return re(oe,ve)}),w.initialized||re(ci.Pop,w.location),x}function j(){h&&h(),c.clear(),A&&A.abort(),w.fetchers.forEach((ne,oe)=>Ie(oe)),w.blockers.forEach((ne,oe)=>Ee(oe))}function Q(ne){return c.add(ne),()=>c.delete(ne)}function H(ne){w=zr({},w,ne),c.forEach(oe=>oe(w))}function G(ne,oe){var ve,ze;let rt=w.actionData!=null&&w.navigation.formMethod!=null&&ma(w.navigation.formMethod)&&w.navigation.state==="loading"&&((ve=ne.state)==null?void 0:ve._isRedirect)!==!0,Z;oe.actionData?Object.keys(oe.actionData).length>0?Z=oe.actionData:Z=null:rt?Z=w.actionData:Z=null;let ie=oe.loaderData?N3(w.loaderData,oe.loaderData,oe.matches||[],oe.errors):w.loaderData,de=w.blockers;de.size>0&&(de=new Map(de),de.forEach((Ve,ct)=>de.set(ct,Kp)));let _e=_===!0||w.navigation.formMethod!=null&&ma(w.navigation.formMethod)&&((ze=ne.state)==null?void 0:ze._isRedirect)!==!0;o&&(a=o,o=void 0),M||S===ci.Pop||(S===ci.Push?e.history.push(ne,ne.state):S===ci.Replace&&e.history.replace(ne,ne.state)),H(zr({},oe,{actionData:Z,loaderData:ie,historyAction:S,location:ne,initialized:!0,navigation:j_,revalidation:"idle",restoreScrollPosition:ot(ne,oe.matches||w.matches),preventScrollReset:_e,blockers:de})),S=ci.Pop,_=!1,M=!1,T=!1,C=[],L=[]}async function $(ne,oe){if(typeof ne=="number"){e.history.go(ne);return}let ve=GE(w.location,w.matches,l,u.v7_prependBasename,ne,oe==null?void 0:oe.fromRouteId,oe==null?void 0:oe.relative),{path:ze,submission:rt,error:Z}=O3(u.v7_normalizeFormMethod,!1,ve,oe),ie=w.location,de=Gg(w.location,ze,oe&&oe.state);de=zr({},de,e.history.encodeLocation(de));let _e=oe&&oe.replace!=null?oe.replace:void 0,Ve=ci.Push;_e===!0?Ve=ci.Replace:_e===!1||rt!=null&&ma(rt.formMethod)&&rt.formAction===w.location.pathname+w.location.search&&(Ve=ci.Replace);let ct=oe&&"preventScrollReset"in oe?oe.preventScrollReset===!0:void 0,yt=ke({currentLocation:ie,nextLocation:de,historyAction:Ve});if(yt){Ce(yt,{state:"blocked",location:de,proceed(){Ce(yt,{state:"proceeding",proceed:void 0,reset:void 0,location:de}),$(ne,oe)},reset(){let Dt=new Map(w.blockers);Dt.set(yt,Kp),H({blockers:Dt})}});return}return await re(Ve,de,{submission:rt,pendingError:Z,preventScrollReset:ct,replace:oe&&oe.replace})}function se(){if(Xe(),H({revalidation:"loading"}),w.navigation.state!=="submitting"){if(w.navigation.state==="idle"){re(w.historyAction,w.location,{startUninterruptedRevalidation:!0});return}re(S||w.historyAction,w.navigation.location,{overrideNavigation:w.navigation})}}async function re(ne,oe,ve){A&&A.abort(),A=null,S=ne,M=(ve&&ve.startUninterruptedRevalidation)===!0,et(w.location,w.matches),_=(ve&&ve.preventScrollReset)===!0;let ze=o||a,rt=ve&&ve.overrideNavigation,Z=Xd(ze,oe,l);if(!Z){let Dt=Is(404,{pathname:oe.pathname}),{matches:nr,route:Qt}=B3(ze);Ye(),G(oe,{matches:nr,loaderData:{},errors:{[Qt.id]:Dt}});return}if(w.initialized&&!T&&_X(w.location,oe)&&!(ve&&ve.submission&&ma(ve.submission.formMethod))){G(oe,{matches:Z});return}A=new AbortController;let ie=Jp(e.history,oe,A.signal,ve&&ve.submission),de,_e;if(ve&&ve.pendingError)_e={[$d(Z).route.id]:ve.pendingError};else if(ve&&ve.submission&&ma(ve.submission.formMethod)){let Dt=await ae(ie,oe,ve.submission,Z,{replace:ve.replace});if(Dt.shortCircuited)return;de=Dt.pendingActionData,_e=Dt.pendingActionError,rt=N0(oe,ve.submission),ie=new Request(ie.url,{signal:ie.signal})}let{shortCircuited:Ve,loaderData:ct,errors:yt}=await ce(ie,oe,Z,rt,ve&&ve.submission,ve&&ve.fetcherSubmission,ve&&ve.replace,de,_e);Ve||(A=null,G(oe,zr({matches:Z},de?{actionData:de}:{},{loaderData:ct,errors:yt})))}async function ae(ne,oe,ve,ze,rt){rt===void 0&&(rt={}),Xe();let Z=TX(oe,ve);H({navigation:Z});let ie,de=qE(ze,oe);if(!de.route.action&&!de.route.lazy)ie={type:ti.error,error:Is(405,{method:ne.method,pathname:oe.pathname,routeId:de.route.id})};else if(ie=await Zp("action",ne,de,ze,s,n,l),ne.signal.aborted)return{shortCircuited:!0};if(df(ie)){let _e;return rt&&rt.replace!=null?_e=rt.replace:_e=ie.location===w.location.pathname+w.location.search,await Le(w,ie,{submission:ve,replace:_e}),{shortCircuited:!0}}if(sg(ie)){let _e=$d(ze,de.route.id);return(rt&&rt.replace)!==!0&&(S=ci.Push),{pendingActionData:{},pendingActionError:{[_e.route.id]:ie.error}}}if(qc(ie))throw Is(400,{type:"defer-action"});return{pendingActionData:{[de.route.id]:ie.data}}}async function ce(ne,oe,ve,ze,rt,Z,ie,de,_e){let Ve=ze||N0(oe,rt),ct=rt||Z||j3(Ve),yt=o||a,[Dt,nr]=L3(e.history,w,ve,ct,oe,T,C,L,q,K,yt,l,de,_e);if(Ye(ee=>!(ve&&ve.some(we=>we.route.id===ee))||Dt&&Dt.some(we=>we.route.id===ee)),z=++k,Dt.length===0&&nr.length===0){let ee=Y();return G(oe,zr({matches:ve,loaderData:{},errors:_e||null},de?{actionData:de}:{},ee?{fetchers:new Map(w.fetchers)}:{})),{shortCircuited:!0}}if(!M){nr.forEach(we=>{let tt=w.fetchers.get(we.key),lt=em(void 0,tt?tt.data:void 0);w.fetchers.set(we.key,lt)});let ee=de||w.actionData;H(zr({navigation:Ve},ee?Object.keys(ee).length===0?{actionData:null}:{actionData:ee}:{},nr.length>0?{fetchers:new Map(w.fetchers)}:{}))}nr.forEach(ee=>{I.has(ee.key)&&Ge(ee.key),ee.controller&&I.set(ee.key,ee.controller)});let Qt=()=>nr.forEach(ee=>Ge(ee.key));A&&A.signal.addEventListener("abort",Qt);let{results:Vr,loaderResults:oi,fetcherResults:Es}=await Qe(w.matches,ve,Dt,nr,ne);if(ne.signal.aborted)return{shortCircuited:!0};A&&A.signal.removeEventListener("abort",Qt),nr.forEach(ee=>I.delete(ee.key));let $i=F3(Vr);if($i){if($i.idx>=Dt.length){let ee=nr[$i.idx-Dt.length].key;K.add(ee)}return await Le(w,$i.result,{replace:ie}),{shortCircuited:!0}}let{loaderData:qe,errors:Ql}=z3(w,ve,Dt,oi,_e,nr,Es,O);O.forEach((ee,we)=>{ee.subscribe(tt=>{(tt||ee.done)&&O.delete(we)})});let X=Y(),le=U(z),Me=X||le||nr.length>0;return zr({loaderData:qe,errors:Ql},Me?{fetchers:new Map(w.fetchers)}:{})}function me(ne){return w.fetchers.get(ne)||mX}function be(ne,oe,ve,ze){if(i)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");I.has(ne)&&Ge(ne);let rt=o||a,Z=GE(w.location,w.matches,l,u.v7_prependBasename,ve,oe,ze==null?void 0:ze.relative),ie=Xd(rt,Z,l);if(!ie){Re(ne,oe,Is(404,{pathname:Z}));return}let{path:de,submission:_e,error:Ve}=O3(u.v7_normalizeFormMethod,!0,Z,ze);if(Ve){Re(ne,oe,Ve);return}let ct=qE(ie,de);if(_=(ze&&ze.preventScrollReset)===!0,_e&&ma(_e.formMethod)){Ae(ne,oe,de,ct,ie,_e);return}q.set(ne,{routeId:oe,path:de}),$e(ne,oe,de,ct,ie,_e)}async function Ae(ne,oe,ve,ze,rt,Z){if(Xe(),q.delete(ne),!ze.route.action&&!ze.route.lazy){let it=Is(405,{method:Z.formMethod,pathname:ve,routeId:oe});Re(ne,oe,it);return}let ie=w.fetchers.get(ne),de=CX(Z,ie);w.fetchers.set(ne,de),H({fetchers:new Map(w.fetchers)});let _e=new AbortController,Ve=Jp(e.history,ve,_e.signal,Z);I.set(ne,_e);let ct=k,yt=await Zp("action",Ve,ze,rt,s,n,l);if(Ve.signal.aborted){I.get(ne)===_e&&I.delete(ne);return}if(df(yt))if(I.delete(ne),z>ct){let it=Cd(void 0);w.fetchers.set(ne,it),H({fetchers:new Map(w.fetchers)});return}else{K.add(ne);let it=em(Z);return w.fetchers.set(ne,it),H({fetchers:new Map(w.fetchers)}),Le(w,yt,{submission:Z,isFetchActionRedirect:!0})}if(sg(yt)){Re(ne,oe,yt.error);return}if(qc(yt))throw Is(400,{type:"defer-action"});let Dt=w.navigation.location||w.location,nr=Jp(e.history,Dt,_e.signal),Qt=o||a,Vr=w.navigation.state!=="idle"?Xd(Qt,w.navigation.location,l):w.matches;jt(Vr,"Didn't find any matches after fetcher action");let oi=++k;V.set(ne,oi);let Es=em(Z,yt.data);w.fetchers.set(ne,Es);let[$i,qe]=L3(e.history,w,Vr,Z,Dt,T,C,L,q,K,Qt,l,{[ze.route.id]:yt.data},void 0);qe.filter(it=>it.key!==ne).forEach(it=>{let vt=it.key,Et=w.fetchers.get(vt),Tt=em(void 0,Et?Et.data:void 0);w.fetchers.set(vt,Tt),I.has(vt)&&Ge(vt),it.controller&&I.set(vt,it.controller)}),H({fetchers:new Map(w.fetchers)});let Ql=()=>qe.forEach(it=>Ge(it.key));_e.signal.addEventListener("abort",Ql);let{results:X,loaderResults:le,fetcherResults:Me}=await Qe(w.matches,Vr,$i,qe,nr);if(_e.signal.aborted)return;_e.signal.removeEventListener("abort",Ql),V.delete(ne),I.delete(ne),qe.forEach(it=>I.delete(it.key));let ee=F3(X);if(ee){if(ee.idx>=$i.length){let it=qe[ee.idx-$i.length].key;K.add(it)}return Le(w,ee.result)}let{loaderData:we,errors:tt}=z3(w,w.matches,$i,le,void 0,qe,Me,O);if(w.fetchers.has(ne)){let it=Cd(yt.data);w.fetchers.set(ne,it)}let lt=U(oi);w.navigation.state==="loading"&&oi>z?(jt(S,"Expected pending action"),A&&A.abort(),G(w.navigation.location,{matches:Vr,loaderData:we,errors:tt,fetchers:new Map(w.fetchers)})):(H(zr({errors:tt,loaderData:N3(w.loaderData,we,Vr,tt)},lt||qe.length>0?{fetchers:new Map(w.fetchers)}:{})),T=!1)}async function $e(ne,oe,ve,ze,rt,Z){let ie=w.fetchers.get(ne),de=em(Z,ie?ie.data:void 0);w.fetchers.set(ne,de),H({fetchers:new Map(w.fetchers)});let _e=new AbortController,Ve=Jp(e.history,ve,_e.signal);I.set(ne,_e);let ct=k,yt=await Zp("loader",Ve,ze,rt,s,n,l);if(qc(yt)&&(yt=await XU(yt,Ve.signal,!0)||yt),I.get(ne)===_e&&I.delete(ne),Ve.signal.aborted)return;if(df(yt))if(z>ct){let nr=Cd(void 0);w.fetchers.set(ne,nr),H({fetchers:new Map(w.fetchers)});return}else{K.add(ne),await Le(w,yt);return}if(sg(yt)){let nr=$d(w.matches,oe);w.fetchers.delete(ne),H({fetchers:new Map(w.fetchers),errors:{[nr.route.id]:yt.error}});return}jt(!qc(yt),"Unhandled fetcher deferred data");let Dt=Cd(yt.data);w.fetchers.set(ne,Dt),H({fetchers:new Map(w.fetchers)})}async function Le(ne,oe,ve){let{submission:ze,replace:rt,isFetchActionRedirect:Z}=ve===void 0?{}:ve;oe.revalidate&&(T=!0);let ie=Gg(ne.location,oe.location,zr({_isRedirect:!0},Z?{_isFetchActionRedirect:!0}:{}));if(jt(ie,"Expected a location on the redirect navigation"),r){let Ve=!1;if(oe.reloadDocument)Ve=!0;else if(GU.test(oe.location)){const ct=e.history.createURL(oe.location);Ve=ct.origin!==t.location.origin||up(ct.pathname,l)==null}if(Ve){rt?t.location.replace(oe.location):t.location.assign(oe.location);return}}A=null;let de=rt===!0?ci.Replace:ci.Push,_e=ze||j3(ne.navigation);if(pX.has(oe.status)&&_e&&ma(_e.formMethod))await re(de,ie,{submission:zr({},_e,{formAction:oe.location}),preventScrollReset:_});else if(Z)await re(de,ie,{overrideNavigation:N0(ie),fetcherSubmission:_e,preventScrollReset:_});else{let Ve=N0(ie,_e);await re(de,ie,{overrideNavigation:Ve,preventScrollReset:_})}}async function Qe(ne,oe,ve,ze,rt){let Z=await Promise.all([...ve.map(_e=>Zp("loader",rt,_e,oe,s,n,l)),...ze.map(_e=>_e.matches&&_e.match&&_e.controller?Zp("loader",Jp(e.history,_e.path,_e.controller.signal),_e.match,_e.matches,s,n,l):{type:ti.error,error:Is(404,{pathname:_e.path})})]),ie=Z.slice(0,ve.length),de=Z.slice(ve.length);return await Promise.all([U3(ne,ve,ie,ie.map(()=>rt.signal),!1,w.loaderData),U3(ne,ze.map(_e=>_e.match),de,ze.map(_e=>_e.controller?_e.controller.signal:null),!0)]),{results:Z,loaderResults:ie,fetcherResults:de}}function Xe(){T=!0,C.push(...Ye()),q.forEach((ne,oe)=>{I.has(oe)&&(L.push(oe),Ge(oe))})}function Re(ne,oe,ve){let ze=$d(w.matches,oe);Ie(ne),H({errors:{[ze.route.id]:ve},fetchers:new Map(w.fetchers)})}function Ie(ne){let oe=w.fetchers.get(ne);I.has(ne)&&!(oe&&oe.state==="loading"&&V.has(ne))&&Ge(ne),q.delete(ne),V.delete(ne),K.delete(ne),w.fetchers.delete(ne)}function Ge(ne){let oe=I.get(ne);jt(oe,"Expected fetch controller: "+ne),oe.abort(),I.delete(ne)}function He(ne){for(let oe of ne){let ve=me(oe),ze=Cd(ve.data);w.fetchers.set(oe,ze)}}function Y(){let ne=[],oe=!1;for(let ve of K){let ze=w.fetchers.get(ve);jt(ze,"Expected fetcher: "+ve),ze.state==="loading"&&(K.delete(ve),ne.push(ve),oe=!0)}return He(ne),oe}function U(ne){let oe=[];for(let[ve,ze]of V)if(ze<ne){let rt=w.fetchers.get(ve);jt(rt,"Expected fetcher: "+ve),rt.state==="loading"&&(Ge(ve),V.delete(ve),oe.push(ve))}return He(oe),oe.length>0}function he(ne,oe){let ve=w.blockers.get(ne)||Kp;return W.get(ne)!==oe&&W.set(ne,oe),ve}function Ee(ne){w.blockers.delete(ne),W.delete(ne)}function Ce(ne,oe){let ve=w.blockers.get(ne)||Kp;jt(ve.state==="unblocked"&&oe.state==="blocked"||ve.state==="blocked"&&oe.state==="blocked"||ve.state==="blocked"&&oe.state==="proceeding"||ve.state==="blocked"&&oe.state==="unblocked"||ve.state==="proceeding"&&oe.state==="unblocked","Invalid blocker state transition: "+ve.state+" -> "+oe.state);let ze=new Map(w.blockers);ze.set(ne,oe),H({blockers:ze})}function ke(ne){let{currentLocation:oe,nextLocation:ve,historyAction:ze}=ne;if(W.size===0)return;W.size>1&&vh(!1,"A router only supports one blocker at a time");let rt=Array.from(W.entries()),[Z,ie]=rt[rt.length-1],de=w.blockers.get(Z);if(!(de&&de.state==="proceeding")&&ie({currentLocation:oe,nextLocation:ve,historyAction:ze}))return Z}function Ye(ne){let oe=[];return O.forEach((ve,ze)=>{(!ne||ne(ze))&&(ve.cancel(),oe.push(ze),O.delete(ze))}),oe}function De(ne,oe,ve){if(d=ne,p=oe,f=ve||null,!m&&w.navigation===j_){m=!0;let ze=ot(w.location,w.matches);ze!=null&&H({restoreScrollPosition:ze})}return()=>{d=null,p=null,f=null}}function xe(ne,oe){return f&&f(ne,oe.map(ze=>AX(ze,w.loaderData)))||ne.key}function et(ne,oe){if(d&&p){let ve=xe(ne,oe);d[ve]=p()}}function ot(ne,oe){if(d){let ve=xe(ne,oe),ze=d[ve];if(typeof ze=="number")return ze}return null}function ut(ne){s={},o=WE(ne,n,void 0,s)}return x={get basename(){return l},get state(){return w},get routes(){return a},initialize:B,subscribe:Q,enableScrollRestoration:De,navigate:$,fetch:be,revalidate:se,createHref:ne=>e.history.createHref(ne),encodeLocation:ne=>e.history.encodeLocation(ne),getFetcher:me,deleteFetcher:Ie,dispose:j,getBlocker:he,deleteBlocker:Ee,_internalFetchControllers:I,_internalActiveDeferreds:O,_internalSetRoutes:ut},x}function yX(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function GE(e,t,r,i,n,s,a){let o,l;if(s!=null&&a!=="path"){o=[];for(let h of t)if(o.push(h),h.route.id===s){l=h;break}}else o=t,l=t[t.length-1];let u=JC(n||".",Vw(o).map(h=>h.pathnameBase),up(e.pathname,r)||e.pathname,a==="path");return n==null&&(u.search=e.search,u.hash=e.hash),(n==null||n===""||n===".")&&l&&l.route.index&&!tD(u.search)&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),i&&r!=="/"&&(u.pathname=u.pathname==="/"?r:El([r,u.pathname])),yh(u)}function O3(e,t,r,i){if(!i||!yX(i))return{path:r};if(i.formMethod&&!EX(i.formMethod))return{path:r,error:Is(405,{method:i.formMethod})};let n=()=>({path:r,error:Is(400,{type:"invalid-body"})}),s=i.formMethod||"get",a=e?s.toUpperCase():s.toLowerCase(),o=qU(r);if(i.body!==void 0){if(i.formEncType==="text/plain"){if(!ma(a))return n();let d=typeof i.body=="string"?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce((f,p)=>{let[m,g]=p;return""+f+m+"="+g+`
`},""):String(i.body);return{path:r,submission:{formMethod:a,formAction:o,formEncType:i.formEncType,formData:void 0,json:void 0,text:d}}}else if(i.formEncType==="application/json"){if(!ma(a))return n();try{let d=typeof i.body=="string"?JSON.parse(i.body):i.body;return{path:r,submission:{formMethod:a,formAction:o,formEncType:i.formEncType,formData:void 0,json:d,text:void 0}}}catch{return n()}}}jt(typeof FormData=="function","FormData is not available in this environment");let l,u;if(i.formData)l=YE(i.formData),u=i.formData;else if(i.body instanceof FormData)l=YE(i.body),u=i.body;else if(i.body instanceof URLSearchParams)l=i.body,u=k3(l);else if(i.body==null)l=new URLSearchParams,u=new FormData;else try{l=new URLSearchParams(i.body),u=k3(l)}catch{return n()}let h={formMethod:a,formAction:o,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:u,json:void 0,text:void 0};if(ma(h.formMethod))return{path:r,submission:h};let c=Ao(r);return t&&c.search&&tD(c.search)&&l.append("index",""),c.search="?"+l,{path:yh(c),submission:h}}function xX(e,t){let r=e;if(t){let i=e.findIndex(n=>n.route.id===t);i>=0&&(r=e.slice(0,i))}return r}function L3(e,t,r,i,n,s,a,o,l,u,h,c,d,f){let p=f?Object.values(f)[0]:d?Object.values(d)[0]:void 0,m=e.createURL(t.location),g=e.createURL(n),v=f?Object.keys(f)[0]:void 0,x=xX(r,v).filter((S,_)=>{if(S.route.lazy)return!0;if(S.route.loader==null)return!1;if(wX(t.loaderData,t.matches[_],S)||a.some(T=>T===S.route.id))return!0;let A=t.matches[_],M=S;return I3(S,zr({currentUrl:m,currentParams:A.params,nextUrl:g,nextParams:M.params},i,{actionResult:p,defaultShouldRevalidate:s||m.pathname+m.search===g.pathname+g.search||m.search!==g.search||YU(A,M)}))}),w=[];return l.forEach((S,_)=>{if(!r.some(L=>L.route.id===S.routeId))return;let A=Xd(h,S.path,c);if(!A){w.push({key:_,routeId:S.routeId,path:S.path,matches:null,match:null,controller:null});return}let M=t.fetchers.get(_),T=qE(A,S.path),C=!1;u.has(_)?C=!1:o.includes(_)?C=!0:M&&M.state!=="idle"&&M.data===void 0?C=s:C=I3(T,zr({currentUrl:m,currentParams:t.matches[t.matches.length-1].params,nextUrl:g,nextParams:r[r.length-1].params},i,{actionResult:p,defaultShouldRevalidate:s})),C&&w.push({key:_,routeId:S.routeId,path:S.path,matches:A,match:T,controller:new AbortController})}),[x,w]}function wX(e,t,r){let i=!t||r.route.id!==t.route.id,n=e[r.route.id]===void 0;return i||n}function YU(e,t){let r=e.route.path;return e.pathname!==t.pathname||r!=null&&r.endsWith("*")&&e.params["*"]!==t.params["*"]}function I3(e,t){if(e.route.shouldRevalidate){let r=e.route.shouldRevalidate(t);if(typeof r=="boolean")return r}return t.defaultShouldRevalidate}async function R3(e,t,r){if(!e.lazy)return;let i=await e.lazy();if(!e.lazy)return;let n=r[e.id];jt(n,"No route found in manifest");let s={};for(let a in i){let l=n[a]!==void 0&&a!=="hasErrorBoundary";vh(!l,'Route "'+n.id+'" has a static property "'+a+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+a+'" will be ignored.')),!l&&!Vq.has(a)&&(s[a]=i[a])}Object.assign(n,s),Object.assign(n,zr({},t(n),{lazy:void 0}))}async function Zp(e,t,r,i,n,s,a,o){o===void 0&&(o={});let l,u,h,c=p=>{let m,g=new Promise((v,y)=>m=y);return h=()=>m(),t.signal.addEventListener("abort",h),Promise.race([p({request:t,params:r.params,context:o.requestContext}),g])};try{let p=r.route[e];if(r.route.lazy)if(p)u=(await Promise.all([c(p),R3(r.route,s,n)]))[0];else if(await R3(r.route,s,n),p=r.route[e],p)u=await c(p);else if(e==="action"){let m=new URL(t.url),g=m.pathname+m.search;throw Is(405,{method:t.method,pathname:g,routeId:r.route.id})}else return{type:ti.data,data:void 0};else if(p)u=await c(p);else{let m=new URL(t.url),g=m.pathname+m.search;throw Is(404,{pathname:g})}jt(u!==void 0,"You defined "+(e==="action"?"an action":"a loader")+" for route "+('"'+r.route.id+"\" but didn't return anything from your `"+e+"` ")+"function. Please return a value or `null`.")}catch(p){l=ti.error,u=p}finally{h&&t.signal.removeEventListener("abort",h)}if(MX(u)){let p=u.status;if(fX.has(p)){let v=u.headers.get("Location");if(jt(v,"Redirects returned/thrown from loaders/actions must have a Location header"),!GU.test(v))v=GE(new URL(t.url),i.slice(0,i.indexOf(r)+1),a,!0,v);else if(!o.isStaticRequest){let y=new URL(t.url),x=v.startsWith("//")?new URL(y.protocol+v):new URL(v),w=up(x.pathname,a)!=null;x.origin===y.origin&&w&&(v=x.pathname+x.search+x.hash)}if(o.isStaticRequest)throw u.headers.set("Location",v),u;return{type:ti.redirect,status:p,location:v,revalidate:u.headers.get("X-Remix-Revalidate")!==null,reloadDocument:u.headers.get("X-Remix-Reload-Document")!==null}}if(o.isRouteRequest)throw{type:l===ti.error?ti.error:ti.data,response:u};let m,g=u.headers.get("Content-Type");return g&&/\bapplication\/json\b/.test(g)?m=await u.json():m=await u.text(),l===ti.error?{type:l,error:new eD(p,u.statusText,m),headers:u.headers}:{type:ti.data,data:m,statusCode:u.status,headers:u.headers}}if(l===ti.error)return{type:l,error:u};if(SX(u)){var d,f;return{type:ti.deferred,deferredData:u,statusCode:(d=u.init)==null?void 0:d.status,headers:((f=u.init)==null?void 0:f.headers)&&new Headers(u.init.headers)}}return{type:ti.data,data:u}}function Jp(e,t,r,i){let n=e.createURL(qU(t)).toString(),s={signal:r};if(i&&ma(i.formMethod)){let{formMethod:a,formEncType:o}=i;s.method=a.toUpperCase(),o==="application/json"?(s.headers=new Headers({"Content-Type":o}),s.body=JSON.stringify(i.json)):o==="text/plain"?s.body=i.text:o==="application/x-www-form-urlencoded"&&i.formData?s.body=YE(i.formData):s.body=i.formData}return new Request(n,s)}function YE(e){let t=new URLSearchParams;for(let[r,i]of e.entries())t.append(r,typeof i=="string"?i:i.name);return t}function k3(e){let t=new FormData;for(let[r,i]of e.entries())t.append(r,i);return t}function bX(e,t,r,i,n){let s={},a=null,o,l=!1,u={};return r.forEach((h,c)=>{let d=t[c].route.id;if(jt(!df(h),"Cannot handle redirect results in processLoaderData"),sg(h)){let f=$d(e,d),p=h.error;i&&(p=Object.values(i)[0],i=void 0),a=a||{},a[f.route.id]==null&&(a[f.route.id]=p),s[d]=void 0,l||(l=!0,o=VU(h.error)?h.error.status:500),h.headers&&(u[d]=h.headers)}else qc(h)?(n.set(d,h.deferredData),s[d]=h.deferredData.data):s[d]=h.data,h.statusCode!=null&&h.statusCode!==200&&!l&&(o=h.statusCode),h.headers&&(u[d]=h.headers)}),i&&(a=i,s[Object.keys(i)[0]]=void 0),{loaderData:s,errors:a,statusCode:o||200,loaderHeaders:u}}function z3(e,t,r,i,n,s,a,o){let{loaderData:l,errors:u}=bX(t,r,i,n,o);for(let h=0;h<s.length;h++){let{key:c,match:d,controller:f}=s[h];jt(a!==void 0&&a[h]!==void 0,"Did not find corresponding fetcher result");let p=a[h];if(!(f&&f.signal.aborted))if(sg(p)){let m=$d(e.matches,d==null?void 0:d.route.id);u&&u[m.route.id]||(u=zr({},u,{[m.route.id]:p.error})),e.fetchers.delete(c)}else if(df(p))jt(!1,"Unhandled fetcher revalidation redirect");else if(qc(p))jt(!1,"Unhandled fetcher deferred data");else{let m=Cd(p.data);e.fetchers.set(c,m)}}return{loaderData:l,errors:u}}function N3(e,t,r,i){let n=zr({},t);for(let s of r){let a=s.route.id;if(t.hasOwnProperty(a)?t[a]!==void 0&&(n[a]=t[a]):e[a]!==void 0&&s.route.loader&&(n[a]=e[a]),i&&i.hasOwnProperty(a))break}return n}function $d(e,t){return(t?e.slice(0,e.findIndex(i=>i.route.id===t)+1):[...e]).reverse().find(i=>i.route.hasErrorBoundary===!0)||e[0]}function B3(e){let t=e.find(r=>r.index||!r.path||r.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t}}function Is(e,t){let{pathname:r,routeId:i,method:n,type:s}=t===void 0?{}:t,a="Unknown Server Error",o="Unknown @remix-run/router error";return e===400?(a="Bad Request",n&&r&&i?o="You made a "+n+' request to "'+r+'" but '+('did not provide a `loader` for route "'+i+'", ')+"so there is no way to handle the request.":s==="defer-action"?o="defer() is not supported in actions":s==="invalid-body"&&(o="Unable to encode submission body")):e===403?(a="Forbidden",o='Route "'+i+'" does not match URL "'+r+'"'):e===404?(a="Not Found",o='No route matches URL "'+r+'"'):e===405&&(a="Method Not Allowed",n&&r&&i?o="You made a "+n.toUpperCase()+' request to "'+r+'" but '+('did not provide an `action` for route "'+i+'", ')+"so there is no way to handle the request.":n&&(o='Invalid request method "'+n.toUpperCase()+'"')),new eD(e||500,a,new Error(o),!0)}function F3(e){for(let t=e.length-1;t>=0;t--){let r=e[t];if(df(r))return{result:r,idx:t}}}function qU(e){let t=typeof e=="string"?Ao(e):e;return yh(zr({},t,{hash:""}))}function _X(e,t){return e.pathname!==t.pathname||e.search!==t.search?!1:e.hash===""?t.hash!=="":e.hash===t.hash?!0:t.hash!==""}function qc(e){return e.type===ti.deferred}function sg(e){return e.type===ti.error}function df(e){return(e&&e.type)===ti.redirect}function SX(e){let t=e;return t&&typeof t=="object"&&typeof t.data=="object"&&typeof t.subscribe=="function"&&typeof t.cancel=="function"&&typeof t.resolveData=="function"}function MX(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function EX(e){return dX.has(e.toLowerCase())}function ma(e){return cX.has(e.toLowerCase())}async function U3(e,t,r,i,n,s){for(let a=0;a<r.length;a++){let o=r[a],l=t[a];if(!l)continue;let u=e.find(c=>c.route.id===l.route.id),h=u!=null&&!YU(u,l)&&(s&&s[l.route.id])!==void 0;if(qc(o)&&(n||h)){let c=i[a];jt(c,"Expected an AbortSignal for revalidating fetcher deferred result"),await XU(o,c,n).then(d=>{d&&(r[a]=d||r[a])})}}}async function XU(e,t,r){if(r===void 0&&(r=!1),!await e.deferredData.resolveData(t)){if(r)try{return{type:ti.data,data:e.deferredData.unwrappedData}}catch(n){return{type:ti.error,error:n}}return{type:ti.data,data:e.deferredData.data}}}function tD(e){return new URLSearchParams(e).getAll("index").some(t=>t==="")}function AX(e,t){let{route:r,pathname:i,params:n}=e;return{id:r.id,pathname:i,params:n,data:t[r.id],handle:r.handle}}function qE(e,t){let r=typeof t=="string"?Ao(t).search:t.search;if(e[e.length-1].route.index&&tD(r||""))return e[e.length-1];let i=Vw(e);return i[i.length-1]}function j3(e){let{formMethod:t,formAction:r,formEncType:i,text:n,formData:s,json:a}=e;if(!(!t||!r||!i)){if(n!=null)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:void 0,text:n};if(s!=null)return{formMethod:t,formAction:r,formEncType:i,formData:s,json:void 0,text:void 0};if(a!==void 0)return{formMethod:t,formAction:r,formEncType:i,formData:void 0,json:a,text:void 0}}}function N0(e,t){return t?{state:"loading",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function TX(e,t){return{state:"submitting",location:e,formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text}}function em(e,t){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t," _hasFetcherDoneAnything ":!0}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t," _hasFetcherDoneAnything ":!0}}function CX(e,t){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:t?t.data:void 0," _hasFetcherDoneAnything ":!0}}function Cd(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e," _hasFetcherDoneAnything ":!0}}/**
 * React Router v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lx(){return lx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},lx.apply(this,arguments)}const Ww=pe.createContext(null),$U=pe.createContext(null),cp=pe.createContext(null),Gw=pe.createContext(null),Oh=pe.createContext({outlet:null,matches:[],isDataRoute:!1}),QU=pe.createContext(null);function DX(e,t){let{relative:r}=t===void 0?{}:t;Ov()||jt(!1);let{basename:i,navigator:n}=pe.useContext(cp),{hash:s,pathname:a,search:o}=ZU(e,{relative:r}),l=a;return i!=="/"&&(l=a==="/"?i:El([i,a])),n.createHref({pathname:l,search:o,hash:s})}function Ov(){return pe.useContext(Gw)!=null}function Lv(){return Ov()||jt(!1),pe.useContext(Gw).location}function KU(e){pe.useContext(cp).static||pe.useLayoutEffect(e)}function Yw(){let{isDataRoute:e}=pe.useContext(Oh);return e?jX():PX()}function PX(){Ov()||jt(!1);let e=pe.useContext(Ww),{basename:t,navigator:r}=pe.useContext(cp),{matches:i}=pe.useContext(Oh),{pathname:n}=Lv(),s=JSON.stringify(Vw(i).map(l=>l.pathnameBase)),a=pe.useRef(!1);return KU(()=>{a.current=!0}),pe.useCallback(function(l,u){if(u===void 0&&(u={}),!a.current)return;if(typeof l=="number"){r.go(l);return}let h=JC(l,JSON.parse(s),n,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:El([t,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[t,r,s,n,e])}function ZU(e,t){let{relative:r}=t===void 0?{}:t,{matches:i}=pe.useContext(Oh),{pathname:n}=Lv(),s=JSON.stringify(Vw(i).map(a=>a.pathnameBase));return pe.useMemo(()=>JC(e,JSON.parse(s),n,r==="path"),[e,s,n,r])}function OX(e,t,r){Ov()||jt(!1);let{navigator:i}=pe.useContext(cp),{matches:n}=pe.useContext(Oh),s=n[n.length-1],a=s?s.params:{};s&&s.pathname;let o=s?s.pathnameBase:"/";s&&s.route;let l=Lv(),u;if(t){var h;let m=typeof t=="string"?Ao(t):t;o==="/"||(h=m.pathname)!=null&&h.startsWith(o)||jt(!1),u=m}else u=l;let c=u.pathname||"/",d=o==="/"?c:c.slice(o.length)||"/",f=Xd(e,{pathname:d}),p=zX(f&&f.map(m=>Object.assign({},m,{params:Object.assign({},a,m.params),pathname:El([o,i.encodeLocation?i.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?o:El([o,i.encodeLocation?i.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),n,r);return t&&p?pe.createElement(Gw.Provider,{value:{location:lx({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ci.Pop}},p):p}function LX(){let e=UX(),t=VU(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return pe.createElement(pe.Fragment,null,pe.createElement("h2",null,"Unexpected Application Error!"),pe.createElement("h3",{style:{fontStyle:"italic"}},t),r?pe.createElement("pre",{style:n},r):null,s)}const IX=pe.createElement(LX,null);class RX extends pe.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error||r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error?pe.createElement(Oh.Provider,{value:this.props.routeContext},pe.createElement(QU.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function kX(e){let{routeContext:t,match:r,children:i}=e,n=pe.useContext(Ww);return n&&n.static&&n.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),pe.createElement(Oh.Provider,{value:t},i)}function zX(e,t,r){var i;if(t===void 0&&(t=[]),r===void 0&&(r=null),e==null){var n;if((n=r)!=null&&n.errors)e=r.matches;else return null}let s=e,a=(i=r)==null?void 0:i.errors;if(a!=null){let o=s.findIndex(l=>l.route.id&&(a==null?void 0:a[l.route.id]));o>=0||jt(!1),s=s.slice(0,Math.min(s.length,o+1))}return s.reduceRight((o,l,u)=>{let h=l.route.id?a==null?void 0:a[l.route.id]:null,c=null;r&&(c=l.route.errorElement||IX);let d=t.concat(s.slice(0,u+1)),f=()=>{let p;return h?p=c:l.route.Component?p=pe.createElement(l.route.Component,null):l.route.element?p=l.route.element:p=o,pe.createElement(kX,{match:l,routeContext:{outlet:o,matches:d,isDataRoute:r!=null},children:p})};return r&&(l.route.ErrorBoundary||l.route.errorElement||u===0)?pe.createElement(RX,{location:r.location,revalidation:r.revalidation,component:c,error:h,children:f(),routeContext:{outlet:null,matches:d,isDataRoute:!0}}):f()},null)}var JU=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(JU||{}),ux=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ux||{});function NX(e){let t=pe.useContext(Ww);return t||jt(!1),t}function BX(e){let t=pe.useContext($U);return t||jt(!1),t}function FX(e){let t=pe.useContext(Oh);return t||jt(!1),t}function e4(e){let t=FX(),r=t.matches[t.matches.length-1];return r.route.id||jt(!1),r.route.id}function UX(){var e;let t=pe.useContext(QU),r=BX(ux.UseRouteError),i=e4(ux.UseRouteError);return t||((e=r.errors)==null?void 0:e[i])}function jX(){let{router:e}=NX(JU.UseNavigateStable),t=e4(ux.UseNavigateStable),r=pe.useRef(!1);return KU(()=>{r.current=!0}),pe.useCallback(function(n,s){s===void 0&&(s={}),r.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,lx({fromRouteId:t},s)))},[e,t])}const HX="startTransition",H3=P9[HX];function VX(e){let{fallbackElement:t,router:r,future:i}=e,[n,s]=pe.useState(r.state),{v7_startTransition:a}=i||{},o=pe.useCallback(c=>{a&&H3?H3(()=>s(c)):s(c)},[s,a]);pe.useLayoutEffect(()=>r.subscribe(o),[r,o]);let l=pe.useMemo(()=>({createHref:r.createHref,encodeLocation:r.encodeLocation,go:c=>r.navigate(c),push:(c,d,f)=>r.navigate(c,{state:d,preventScrollReset:f==null?void 0:f.preventScrollReset}),replace:(c,d,f)=>r.navigate(c,{replace:!0,state:d,preventScrollReset:f==null?void 0:f.preventScrollReset})}),[r]),u=r.basename||"/",h=pe.useMemo(()=>({router:r,navigator:l,static:!1,basename:u}),[r,l,u]);return pe.createElement(pe.Fragment,null,pe.createElement(Ww.Provider,{value:h},pe.createElement($U.Provider,{value:n},pe.createElement(GX,{basename:u,location:n.location,navigationType:n.historyAction,navigator:l},n.initialized?pe.createElement(WX,{routes:r.routes,state:n}):t))),null)}function WX(e){let{routes:t,state:r}=e;return OX(t,void 0,r)}function rl(e){jt(!1)}function GX(e){let{basename:t="/",children:r=null,location:i,navigationType:n=ci.Pop,navigator:s,static:a=!1}=e;Ov()&&jt(!1);let o=t.replace(/^\/*/,"/"),l=pe.useMemo(()=>({basename:o,navigator:s,static:a}),[o,s,a]);typeof i=="string"&&(i=Ao(i));let{pathname:u="/",search:h="",hash:c="",state:d=null,key:f="default"}=i,p=pe.useMemo(()=>{let m=up(u,o);return m==null?null:{location:{pathname:m,search:h,hash:c,state:d,key:f},navigationType:n}},[o,u,h,c,d,f,n]);return p==null?null:pe.createElement(cp.Provider,{value:l},pe.createElement(Gw.Provider,{children:r,value:p}))}new Promise(()=>{});function XE(e,t){t===void 0&&(t=[]);let r=[];return pe.Children.forEach(e,(i,n)=>{if(!pe.isValidElement(i))return;let s=[...t,n];if(i.type===pe.Fragment){r.push.apply(r,XE(i.props.children,s));return}i.type!==rl&&jt(!1),!i.props.index||!i.props.children||jt(!1);let a={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=XE(i.props.children,s)),r.push(a)}),r}function YX(e){let t={hasErrorBoundary:e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&Object.assign(t,{element:pe.createElement(e.Component),Component:void 0}),e.ErrorBoundary&&Object.assign(t,{errorElement:pe.createElement(e.ErrorBoundary),ErrorBoundary:void 0}),t}/**
 * React Router DOM v6.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Yg(){return Yg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Yg.apply(this,arguments)}function qX(e,t){if(e==null)return{};var r={},i=Object.keys(e),n,s;for(s=0;s<i.length;s++)n=i[s],!(t.indexOf(n)>=0)&&(r[n]=e[n]);return r}function XX(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function $X(e,t){return e.button===0&&(!t||t==="_self")&&!XX(e)}const QX=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];function KX(e,t){return vX({basename:t==null?void 0:t.basename,future:Yg({},t==null?void 0:t.future,{v7_prependBasename:!0}),history:Uq({window:t==null?void 0:t.window}),hydrationData:(t==null?void 0:t.hydrationData)||ZX(),routes:e,mapRouteProperties:YX}).initialize()}function ZX(){var e;let t=(e=window)==null?void 0:e.__staticRouterHydrationData;return t&&t.errors&&(t=Yg({},t,{errors:JX(t.errors)})),t}function JX(e){if(!e)return null;let t=Object.entries(e),r={};for(let[i,n]of t)if(n&&n.__type==="RouteErrorResponse")r[i]=new eD(n.status,n.statusText,n.data,n.internal===!0);else if(n&&n.__type==="Error"){if(n.__subType){let s=window[n.__subType];if(typeof s=="function")try{let a=new s(n.message);a.stack="",r[i]=a}catch{}}if(r[i]==null){let s=new Error(n.message);s.stack="",r[i]=s}}else r[i]=n;return r}const e$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",t$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oo=pe.forwardRef(function(t,r){let{onClick:i,relative:n,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:h}=t,c=qX(t,QX),{basename:d}=pe.useContext(cp),f,p=!1;if(typeof u=="string"&&t$.test(u)&&(f=u,e$))try{let y=new URL(window.location.href),x=u.startsWith("//")?new URL(y.protocol+u):new URL(u),w=up(x.pathname,d);x.origin===y.origin&&w!=null?u=w+x.search+x.hash:p=!0}catch{}let m=DX(u,{relative:n}),g=r$(u,{replace:a,state:o,target:l,preventScrollReset:h,relative:n});function v(y){i&&i(y),y.defaultPrevented||g(y)}return pe.createElement("a",Yg({},c,{href:f||m,onClick:p||s?i:v,ref:r,target:l}))});var V3;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher"})(V3||(V3={}));var W3;(function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(W3||(W3={}));function r$(e,t){let{target:r,replace:i,state:n,preventScrollReset:s,relative:a}=t===void 0?{}:t,o=Yw(),l=Lv(),u=ZU(e,{relative:a});return pe.useCallback(h=>{if($X(h,r)){h.preventDefault();let c=i!==void 0?i:yh(l)===yh(u);o(e,{replace:c,state:n,preventScrollReset:s,relative:a})}},[l,o,u,i,n,r,e,s,a])}const hc=typeof require<"u"?function(){return require("electron")}():function(){return console.error('If you need to use "electron" in the Renderer process, make sure that "nodeIntegration" is enabled in the Main process.'),{}}();let y1;if(typeof document>"u"){y1={};const e=["invoke","postMessage","send","sendSync","sendTo","sendToHost","addListener","emit","eventNames","getMaxListeners","listenerCount","listeners","off","on","once","prependListener","prependOnceListener","rawListeners","removeAllListeners","removeListener","setMaxListeners"];for(const t of e)y1[t]=()=>{throw new Error(`ipcRenderer doesn't work in a Web Worker.
You can see https://github.com/electron-vite/vite-plugin-electron/issues/69`)}}else y1=hc.ipcRenderer;hc.clipboard;hc.contextBridge;hc.crashReporter;const H_=y1;hc.nativeImage;hc.shell;hc.webFrame;hc.deprecate;const V_={window:{minimize:()=>H_.send("minimize"),maximize:()=>H_.send("maximize"),close:()=>H_.send("close")}};const i$=(e,t)=>{localStorage.setItem(e,t)},Bc=e=>localStorage.getItem(e),n$=e=>{localStorage.removeItem(e)},t4=pe.createContext({loading:!0,setLoading:e=>{},user:null,login:(e,t,r)=>{},register:(e,t,r,i)=>{},logout:()=>{}}),s$=({children:e})=>{const[t,r]=pe.useState(!0),[i,n]=pe.useState(null),s=()=>{n(null),n$("token")};pe.useEffect(()=>{const l=Bc("token");l?fetch("http://localhost:3001/tasksync/api/v1/user/verifytoken",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}).then(u=>{if(!u.ok)throw new Error("Erreur lors de la connexion");return u.json()}).then(u=>{n(u.user)}).catch(u=>{s(),console.error(u)}).finally(()=>{setTimeout(()=>{r(!1)},1e3)}):setTimeout(()=>{r(!1)},1e3)},[]);const a=(l,u,h)=>{fetch("http://localhost:3001/tasksync/api/v1/user/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({user_email:l,user_password:u,expirationToken:h})}).then(c=>{if(!c.ok)throw new Error("Erreur lors de la connexion");return c.json()}).then(c=>{n(c.user),i$("token",c.token)})},o=(l,u,h,c)=>{fetch("http://localhost:3001/tasksync/api/v1/user/register",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({user_firstname:l,user_lastname:u,user_email:h,user_password:c})}).then(d=>{if(!d.ok)throw new Error("Erreur lors de la connexion");return d.json()}).then(d=>{}).catch(d=>{console.error(d)})};return ge(t4.Provider,{value:{loading:t,setLoading:r,user:i,login:a,logout:s,register:o},children:e})},To=()=>pe.useContext(t4),a$=""+new URL("minimize-svg-235b8daf.svg",import.meta.url).href,o$=""+new URL("maximize-svg-0a0bdd65.svg",import.meta.url).href,l$=""+new URL("close-svg-2d0d1318.svg",import.meta.url).href,u$=()=>{const{user:e}=To();return St("nav",{className:`top-nav ${process.platform==="darwin"&&"mac"}`,children:[ge("div",{className:"logo",children:St("h1",{children:["TaskSync"," ",e&&e.user_pro===1&&ge("span",{className:"pro-badge",children:"PRO"}),e&&e.user_pro===0&&ge(kB,{children:St("span",{className:"pro-badge",children:["FREE "," ","(",e.user_firstname," ",e.user_lastname,")"]})})]})}),process.platform!=="darwin"&&St("ul",{children:[ge("li",{className:"minimize-window",onClick:()=>V_.window.minimize(),children:ge("img",{draggable:"false",src:a$,alt:"logo"})}),ge("li",{className:"maximize-window",onClick:()=>V_.window.maximize(),children:ge("img",{draggable:"false",src:o$,alt:"logo"})}),ge("li",{className:"close-window",onClick:()=>V_.window.close(),children:ge("img",{draggable:"false",src:l$,alt:"logo"})})]})]})};const r4=()=>{const{loading:e}=To();return e?ge("div",{className:"loader",children:ge("div",{className:"spinner-loader"})}):null},c$=()=>{const e=Yw(),{user:t}=To();pe.useEffect(()=>{e(t&&t!==null&&t!==void 0?"/home":"/login")},[t])};function G3(){return c$(),ge(r4,{})}const i4=()=>{const e=Yw(),{user:t}=To();pe.useEffect(()=>{t&&e("/home")},[t])},h$="modulepreload",d$=function(e,t){return new URL(e,t).href},Y3={},Iv=function(t,r,i){if(!r||r.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=d$(s,i),s in Y3)return;Y3[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!i)for(let h=n.length-1;h>=0;h--){const c=n[h];if(c.href===s&&(!a||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":h$,a||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),a)return new Promise((h,c)=>{u.addEventListener("load",h),u.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};var f$=Object.create,rD=Object.defineProperty,p$=Object.getOwnPropertyDescriptor,m$=Object.getOwnPropertyNames,g$=Object.getPrototypeOf,v$=Object.prototype.hasOwnProperty,hp=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),y$=(e,t)=>{for(var r in t)rD(e,r,{get:t[r],enumerable:!0})},x$=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of m$(t))!v$.call(e,n)&&n!==r&&rD(e,n,{get:()=>t[n],enumerable:!(i=p$(t,n))||i.enumerable});return e},dp=(e,t,r)=>(r=e!=null?f$(g$(e)):{},x$(t||!e||!e.__esModule?rD(r,"default",{value:e,enumerable:!0}):r,e)),w$=hp((e,t)=>{(function(r,i){typeof e=="object"?t.exports=i():typeof define=="function"&&define.amd?define(i):r.Alea=i()})(e,function(){return r.importState=function(n){var s=new r;return s.importState(n),s},r;function r(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var u=i();s=u(" "),a=u(" "),o=u(" ");for(var h=0;h<n.length;h++)s-=u(n[h]),s<0&&(s+=1),a-=u(n[h]),a<0&&(a+=1),o-=u(n[h]),o<0&&(o+=1);u=null;var c=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=n,c.exportState=function(){return[s,a,o,l]},c.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},c}(Array.prototype.slice.call(arguments))}function i(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),n4=hp((e,t)=>{(function(r,i){typeof e=="object"&&typeof t<"u"?i(e):typeof define=="function"&&define.amd?define(["exports"],i):i((r=typeof globalThis<"u"?globalThis:r||self).SVDJS={})})(e,function(r){r.SVD=function(i,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!i)throw new TypeError("Matrix a is not defined");var l,u,h,c,d,f,p,m,g,v,y,x,w=i[0].length,S=i.length;if(S<w)throw new TypeError("Invalid matrix: m < n");for(var _=[],A=[],M=[],T=n==="f"?S:w,C=v=p=0;C<S;C++)A[C]=new Array(T).fill(0);for(C=0;C<w;C++)M[C]=new Array(w).fill(0);var L,I=new Array(w).fill(0);for(C=0;C<S;C++)for(l=0;l<w;l++)A[C][l]=i[C][l];for(C=0;C<w;C++){for(_[C]=p,g=0,h=C+1,l=C;l<S;l++)g+=Math.pow(A[l][C],2);if(g<o)p=0;else for(m=(f=A[C][C])*(p=f<0?Math.sqrt(g):-Math.sqrt(g))-g,A[C][C]=f-p,l=h;l<w;l++){for(g=0,u=C;u<S;u++)g+=A[u][C]*A[u][l];for(f=g/m,u=C;u<S;u++)A[u][l]=A[u][l]+f*A[u][C]}for(I[C]=p,g=0,l=h;l<w;l++)g+=Math.pow(A[C][l],2);if(g<o)p=0;else{for(m=(f=A[C][C+1])*(p=f<0?Math.sqrt(g):-Math.sqrt(g))-g,A[C][C+1]=f-p,l=h;l<w;l++)_[l]=A[C][l]/m;for(l=h;l<S;l++){for(g=0,u=h;u<w;u++)g+=A[l][u]*A[C][u];for(u=h;u<w;u++)A[l][u]=A[l][u]+g*_[u]}}v<(y=Math.abs(I[C])+Math.abs(_[C]))&&(v=y)}if(s)for(C=w-1;0<=C;C--){if(p!==0){for(m=A[C][C+1]*p,l=h;l<w;l++)M[l][C]=A[C][l]/m;for(l=h;l<w;l++){for(g=0,u=h;u<w;u++)g+=A[C][u]*M[u][l];for(u=h;u<w;u++)M[u][l]=M[u][l]+g*M[u][C]}}for(l=h;l<w;l++)M[C][l]=0,M[l][C]=0;M[C][C]=1,p=_[C],h=C}if(n){if(n==="f")for(C=w;C<S;C++){for(l=w;l<S;l++)A[C][l]=0;A[C][C]=1}for(C=w-1;0<=C;C--){for(h=C+1,p=I[C],l=h;l<T;l++)A[C][l]=0;if(p!==0){for(m=A[C][C]*p,l=h;l<T;l++){for(g=0,u=h;u<S;u++)g+=A[u][C]*A[u][l];for(f=g/m,u=C;u<S;u++)A[u][l]=A[u][l]+f*A[u][C]}for(l=C;l<S;l++)A[l][C]=A[l][C]/p}else for(l=C;l<S;l++)A[l][C]=0;A[C][C]=A[C][C]+1}}for(a*=v,u=w-1;0<=u;u--)for(var k=0;k<50;k++){for(L=!1,h=u;0<=h;h--){if(Math.abs(_[h])<=a){L=!0;break}if(Math.abs(I[h-1])<=a)break}if(!L){for(d=0,c=h-(g=1),C=h;C<u+1&&(f=g*_[C],_[C]=d*_[C],!(Math.abs(f)<=a));C++)if(p=I[C],I[C]=Math.sqrt(f*f+p*p),d=p/(m=I[C]),g=-f/m,n)for(l=0;l<S;l++)y=A[l][c],x=A[l][C],A[l][c]=y*d+x*g,A[l][C]=-y*g+x*d}if(x=I[u],h===u){if(x<0&&(I[u]=-x,s))for(l=0;l<w;l++)M[l][u]=-M[l][u];break}for(v=I[h],f=(((y=I[u-1])-x)*(y+x)+((p=_[u-1])-(m=_[u]))*(p+m))/(2*m*y),p=Math.sqrt(f*f+1),f=((v-x)*(v+x)+m*(y/(f<0?f-p:f+p)-m))/v,C=h+(g=d=1);C<u+1;C++){if(p=_[C],y=I[C],m=g*p,p*=d,x=Math.sqrt(f*f+m*m),f=v*(d=f/(_[C-1]=x))+p*(g=m/x),p=-v*g+p*d,m=y*g,y*=d,s)for(l=0;l<w;l++)v=M[l][C-1],x=M[l][C],M[l][C-1]=v*d+x*g,M[l][C]=-v*g+x*d;if(x=Math.sqrt(f*f+m*m),f=(d=f/(I[C-1]=x))*p+(g=m/x)*y,v=-g*p+d*y,n)for(l=0;l<S;l++)y=A[l][C-1],x=A[l][C],A[l][C-1]=y*d+x*g,A[l][C]=-y*g+x*d}_[h]=0,_[u]=f,I[u]=v}for(C=0;C<w;C++)I[C]<a&&(I[C]=0);return{u:A,q:I,v:M}},r.VERSION="1.1.1",Object.defineProperty(r,"__esModule",{value:!0})})}),b$=hp((e,t)=>{(function(r,i){typeof e=="object"&&typeof t<"u"?t.exports=i():typeof define=="function"&&define.amd?define(i):(r=r||self,r.TinyQueue=i())})(e,function(){var r=function(n,s){if(n===void 0&&(n=[]),s===void 0&&(s=i),this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};r.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(n){for(var s=this,a=s.data,o=s.compare,l=a[n];n>0;){var u=n-1>>1,h=a[u];if(o(l,h)>=0)break;a[n]=h,n=u}a[n]=l},r.prototype._down=function(n){for(var s=this,a=s.data,o=s.compare,l=this.length>>1,u=a[n];n<l;){var h=(n<<1)+1,c=a[h],d=h+1;if(d<this.length&&o(a[d],c)<0&&(h=d,c=a[d]),o(c,u)>=0)break;a[n]=c,n=h}a[n]=u};function i(n,s){return n<s?-1:n>s?1:0}return r})}),_$=hp((e,t)=>{var r=b$();r.default&&(r=r.default),t.exports=i,t.exports.default=i;function i(u,h,c){h=h||1;for(var d,f,p,m,g=0;g<u[0].length;g++){var v=u[0][g];(!g||v[0]<d)&&(d=v[0]),(!g||v[1]<f)&&(f=v[1]),(!g||v[0]>p)&&(p=v[0]),(!g||v[1]>m)&&(m=v[1])}var y=p-d,x=m-f,w=Math.min(y,x),S=w/2;if(w===0){var _=[d,f];return _.distance=0,_}for(var A=new r(void 0,n),M=d;M<p;M+=w)for(var T=f;T<m;T+=w)A.push(new s(M+S,T+S,S,u));var C=o(u),L=new s(d+y/2,f+x/2,0,u);L.d>C.d&&(C=L);for(var I=A.length;A.length;){var k=A.pop();k.d>C.d&&(C=k,c&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,I)),!(k.max-C.d<=h)&&(S=k.h/2,A.push(new s(k.x-S,k.y-S,S,u)),A.push(new s(k.x+S,k.y-S,S,u)),A.push(new s(k.x-S,k.y+S,S,u)),A.push(new s(k.x+S,k.y+S,S,u)),I+=4)}c&&(console.log("num probes: "+I),console.log("best distance: "+C.d));var z=[C.x,C.y];return z.distance=C.d,z}function n(u,h){return h.max-u.max}function s(u,h,c,d){this.x=u,this.y=h,this.h=c,this.d=a(u,h,d),this.max=this.d+this.h*Math.SQRT2}function a(u,h,c){for(var d=!1,f=1/0,p=0;p<c.length;p++)for(var m=c[p],g=0,v=m.length,y=v-1;g<v;y=g++){var x=m[g],w=m[y];x[1]>h!=w[1]>h&&u<(w[0]-x[0])*(h-x[1])/(w[1]-x[1])+x[0]&&(d=!d),f=Math.min(f,l(u,h,x,w))}return f===0?0:(d?1:-1)*Math.sqrt(f)}function o(u){for(var h=0,c=0,d=0,f=u[0],p=0,m=f.length,g=m-1;p<m;g=p++){var v=f[p],y=f[g],x=v[0]*y[1]-y[0]*v[1];c+=(v[0]+y[0])*x,d+=(v[1]+y[1])*x,h+=x*3}return h===0?new s(f[0][0],f[0][1],0,u):new s(c/h,d/h,0,u)}function l(u,h,c,d){var f=c[0],p=c[1],m=d[0]-f,g=d[1]-p;if(m!==0||g!==0){var v=((u-f)*m+(h-p)*g)/(m*m+g*g);v>1?(f=d[0],p=d[1]):v>0&&(f+=m*v,p+=g*v)}return m=u-f,g=h-p,m*m+g*g}}),S$=hp(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var c=this||r;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var d=this||r;if(c=parseFloat(c),d.ctx||h(),typeof c<"u"&&c>=0&&c<=1){if(d._volume=c,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(c,r.ctx.currentTime);for(var f=0;f<d._howls.length;f++)if(!d._howls[f]._webAudio)for(var p=d._howls[f]._getSoundIds(),m=0;m<p.length;m++){var g=d._howls[f]._soundById(p[m]);g&&g._node&&(g._node.volume=g._volume*c)}return d}return d._volume},mute:function(c){var d=this||r;d.ctx||h(),d._muted=c,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(c?0:d._volume,r.ctx.currentTime);for(var f=0;f<d._howls.length;f++)if(!d._howls[f]._webAudio)for(var p=d._howls[f]._getSoundIds(),m=0;m<p.length;m++){var g=d._howls[f]._soundById(p[m]);g&&g._node&&(g._node.muted=c?!0:g._muted)}return d},stop:function(){for(var c=this||r,d=0;d<c._howls.length;d++)c._howls[d].stop();return c},unload:function(){for(var c=this||r,d=c._howls.length-1;d>=0;d--)c._howls[d].unload();return c.usingWebAudio&&c.ctx&&typeof c.ctx.close<"u"&&(c.ctx.close(),c.ctx=null,h()),c},codecs:function(c){return(this||r)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||r;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var d=new Audio;d.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||r,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return c}if(!d||typeof d.canPlayType!="function")return c;var f=d.canPlayType("audio/mpeg;").replace(/^no$/,""),p=c._navigator?c._navigator.userAgent:"",m=p.match(/OPR\/([0-6].)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,v=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,y=p.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return c._codecs={mp3:!!(!g&&(f||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!f,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||r;if(!(c._audioUnlocked||!c.ctx)){c._audioUnlocked=!1,c.autoUnlock=!1,!c._mobileUnloaded&&c.ctx.sampleRate!==44100&&(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var d=function(f){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,c._releaseHtml5Audio(p)}catch{c.noAudio=!0;break}for(var m=0;m<c._howls.length;m++)if(!c._howls[m]._webAudio)for(var g=c._howls[m]._getSoundIds(),v=0;v<g.length;v++){var y=c._howls[m]._soundById(g[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}c._autoResume();var x=c.ctx.createBufferSource();x.buffer=c._scratchBuffer,x.connect(c.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),x.onended=function(){x.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var w=0;w<c._howls.length;w++)c._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),c}},_obtainHtml5Audio:function(){var c=this||r;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var d=this||r;return c._unlocked&&d._html5AudioPool.push(c),d},_autoSuspend:function(){var c=this;if(!(!c.autoSuspend||!c.ctx||typeof c.ctx.suspend>"u"||!r.usingWebAudio)){for(var d=0;d<c._howls.length;d++)if(c._howls[d]._webAudio){for(var f=0;f<c._howls[d]._sounds.length;f++)if(!c._howls[d]._sounds[f]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var p=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(p,p)}},3e4),c}},_autoResume:function(){var c=this;if(!(!c.ctx||typeof c.ctx.resume>"u"||!r.usingWebAudio))return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var d=0;d<c._howls.length;d++)c._howls[d]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var r=new t,i=function(c){var d=this;if(!c.src||c.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}d.init(c)};i.prototype={init:function(c){var d=this;return r.ctx||h(),d._autoplay=c.autoplay||!1,d._format=typeof c.format!="string"?c.format:[c.format],d._html5=c.html5||!1,d._muted=c.mute||!1,d._loop=c.loop||!1,d._pool=c.pool||5,d._preload=typeof c.preload=="boolean"||c.preload==="metadata"?c.preload:!0,d._rate=c.rate||1,d._sprite=c.sprite||{},d._src=typeof c.src!="string"?c.src:[c.src],d._volume=c.volume!==void 0?c.volume:1,d._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:c.xhr&&c.xhr.withCredentials?c.xhr.withCredentials:!1},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=c.onend?[{fn:c.onend}]:[],d._onfade=c.onfade?[{fn:c.onfade}]:[],d._onload=c.onload?[{fn:c.onload}]:[],d._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],d._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],d._onpause=c.onpause?[{fn:c.onpause}]:[],d._onplay=c.onplay?[{fn:c.onplay}]:[],d._onstop=c.onstop?[{fn:c.onstop}]:[],d._onmute=c.onmute?[{fn:c.onmute}]:[],d._onvolume=c.onvolume?[{fn:c.onvolume}]:[],d._onrate=c.onrate?[{fn:c.onrate}]:[],d._onseek=c.onseek?[{fn:c.onseek}]:[],d._onunlock=c.onunlock?[{fn:c.onunlock}]:[],d._onresume=[],d._webAudio=r.usingWebAudio&&!d._html5,typeof r.ctx<"u"&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var c=this,d=null;if(r.noAudio){c._emit("loaderror",null,"No audio support.");return}typeof c._src=="string"&&(c._src=[c._src]);for(var f=0;f<c._src.length;f++){var p,m;if(c._format&&c._format[f])p=c._format[f];else{if(m=c._src[f],typeof m!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(m),p||(p=/\.([^.]+)$/.exec(m.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&r.codecs(p)){d=c._src[f];break}}if(!d){c._emit("loaderror",null,"No codec support for selected audio sources.");return}return c._src=d,c._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new n(c),c._webAudio&&a(c),c},play:function(c,d){var f=this,p=null;if(typeof c=="number")p=c,c=null;else{if(typeof c=="string"&&f._state==="loaded"&&!f._sprite[c])return null;if(typeof c>"u"&&(c="__default",!f._playLock)){for(var m=0,g=0;g<f._sounds.length;g++)f._sounds[g]._paused&&!f._sounds[g]._ended&&(m++,p=f._sounds[g]._id);m===1?c=null:p=null}}var v=p?f._soundById(p):f._inactiveSound();if(!v)return null;if(p&&!c&&(c=v._sprite||"__default"),f._state!=="loaded"){v._sprite=c,v._ended=!1;var y=v._id;return f._queue.push({event:"play",action:function(){f.play(y)}}),y}if(p&&!v._paused)return d||f._loadQueue("play"),v._id;f._webAudio&&r._autoResume();var x=Math.max(0,v._seek>0?v._seek:f._sprite[c][0]/1e3),w=Math.max(0,(f._sprite[c][0]+f._sprite[c][1])/1e3-x),S=w*1e3/Math.abs(v._rate),_=f._sprite[c][0]/1e3,A=(f._sprite[c][0]+f._sprite[c][1])/1e3;v._sprite=c,v._ended=!1;var M=function(){v._paused=!1,v._seek=x,v._start=_,v._stop=A,v._loop=!!(v._loop||f._sprite[c][2])};if(x>=A){f._ended(v);return}var T=v._node;if(f._webAudio){var C=function(){f._playLock=!1,M(),f._refreshBuffer(v);var z=v._muted||f._muted?0:v._volume;T.gain.setValueAtTime(z,r.ctx.currentTime),v._playStart=r.ctx.currentTime,typeof T.bufferSource.start>"u"?v._loop?T.bufferSource.noteGrainOn(0,x,86400):T.bufferSource.noteGrainOn(0,x,w):v._loop?T.bufferSource.start(0,x,86400):T.bufferSource.start(0,x,w),S!==1/0&&(f._endTimers[v._id]=setTimeout(f._ended.bind(f,v),S)),d||setTimeout(function(){f._emit("play",v._id),f._loadQueue()},0)};r.state==="running"&&r.ctx.state!=="interrupted"?C():(f._playLock=!0,f.once("resume",C),f._clearTimer(v._id))}else{var L=function(){T.currentTime=x,T.muted=v._muted||f._muted||r._muted||T.muted,T.volume=v._volume*r.volume(),T.playbackRate=v._rate;try{var z=T.play();if(z&&typeof Promise<"u"&&(z instanceof Promise||typeof z.then=="function")?(f._playLock=!0,M(),z.then(function(){f._playLock=!1,T._unlocked=!0,d?f._loadQueue():f._emit("play",v._id)}).catch(function(){f._playLock=!1,f._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):d||(f._playLock=!1,M(),f._emit("play",v._id)),T.playbackRate=v._rate,T.paused){f._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}c!=="__default"||v._loop?f._endTimers[v._id]=setTimeout(f._ended.bind(f,v),S):(f._endTimers[v._id]=function(){f._ended(v),T.removeEventListener("ended",f._endTimers[v._id],!1)},T.addEventListener("ended",f._endTimers[v._id],!1))}catch(V){f._emit("playerror",v._id,V)}};T.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(T.src=f._src,T.load());var I=window&&window.ejecta||!T.readyState&&r._navigator.isCocoonJS;if(T.readyState>=3||I)L();else{f._playLock=!0,f._state="loading";var k=function(){f._state="loaded",L(),T.removeEventListener(r._canPlayEvent,k,!1)};T.addEventListener(r._canPlayEvent,k,!1),f._clearTimer(v._id)}}return v._id},pause:function(c){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(c)}}),d;for(var f=d._getSoundIds(c),p=0;p<f.length;p++){d._clearTimer(f[p]);var m=d._soundById(f[p]);if(m&&!m._paused&&(m._seek=d.seek(f[p]),m._rateSeek=0,m._paused=!0,d._stopFade(f[p]),m._node))if(d._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||d._emit("pause",m?m._id:null)}return d},stop:function(c,d){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"stop",action:function(){f.stop(c)}}),f;for(var p=f._getSoundIds(c),m=0;m<p.length;m++){f._clearTimer(p[m]);var g=f._soundById(p[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,f._stopFade(p[m]),g._node&&(f._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),f._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&f._clearSound(g._node))),d||f._emit("stop",g._id))}return f},mute:function(c,d){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"mute",action:function(){f.mute(c,d)}}),f;if(typeof d>"u")if(typeof c=="boolean")f._muted=c;else return f._muted;for(var p=f._getSoundIds(d),m=0;m<p.length;m++){var g=f._soundById(p[m]);g&&(g._muted=c,g._interval&&f._stopFade(g._id),f._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,r.ctx.currentTime):g._node&&(g._node.muted=r._muted?!0:c),f._emit("mute",g._id))}return f},volume:function(){var c=this,d=arguments,f,p;if(d.length===0)return c._volume;if(d.length===1||d.length===2&&typeof d[1]>"u"){var m=c._getSoundIds(),g=m.indexOf(d[0]);g>=0?p=parseInt(d[0],10):f=parseFloat(d[0])}else d.length>=2&&(f=parseFloat(d[0]),p=parseInt(d[1],10));var v;if(typeof f<"u"&&f>=0&&f<=1){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"volume",action:function(){c.volume.apply(c,d)}}),c;typeof p>"u"&&(c._volume=f),p=c._getSoundIds(p);for(var y=0;y<p.length;y++)v=c._soundById(p[y]),v&&(v._volume=f,d[2]||c._stopFade(p[y]),c._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(f,r.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=f*r.volume()),c._emit("volume",v._id))}else return v=p?c._soundById(p):c._sounds[0],v?v._volume:0;return c},fade:function(c,d,f,p){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(c,d,f,p)}}),m;c=Math.min(Math.max(0,parseFloat(c)),1),d=Math.min(Math.max(0,parseFloat(d)),1),f=parseFloat(f),m.volume(c,p);for(var g=m._getSoundIds(p),v=0;v<g.length;v++){var y=m._soundById(g[v]);if(y){if(p||m._stopFade(g[v]),m._webAudio&&!y._muted){var x=r.ctx.currentTime,w=x+f/1e3;y._volume=c,y._node.gain.setValueAtTime(c,x),y._node.gain.linearRampToValueAtTime(d,w)}m._startFadeInterval(y,c,d,f,g[v],typeof p>"u")}}return m},_startFadeInterval:function(c,d,f,p,m,g){var v=this,y=d,x=f-d,w=Math.abs(x/.01),S=Math.max(4,w>0?p/w:p),_=Date.now();c._fadeTo=f,c._interval=setInterval(function(){var A=(Date.now()-_)/p;_=Date.now(),y+=x*A,y=Math.round(y*100)/100,x<0?y=Math.max(f,y):y=Math.min(f,y),v._webAudio?c._volume=y:v.volume(y,c._id,!0),g&&(v._volume=y),(f<d&&y<=f||f>d&&y>=f)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,v.volume(f,c._id),v._emit("fade",c._id))},S)},_stopFade:function(c){var d=this,f=d._soundById(c);return f&&f._interval&&(d._webAudio&&f._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(f._interval),f._interval=null,d.volume(f._fadeTo,c),f._fadeTo=null,d._emit("fade",c)),d},loop:function(){var c=this,d=arguments,f,p,m;if(d.length===0)return c._loop;if(d.length===1)if(typeof d[0]=="boolean")f=d[0],c._loop=f;else return m=c._soundById(parseInt(d[0],10)),m?m._loop:!1;else d.length===2&&(f=d[0],p=parseInt(d[1],10));for(var g=c._getSoundIds(p),v=0;v<g.length;v++)m=c._soundById(g[v]),m&&(m._loop=f,c._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=f,f&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,c.playing(g[v])&&(c.pause(g[v],!0),c.play(g[v],!0)))));return c},rate:function(){var c=this,d=arguments,f,p;if(d.length===0)p=c._sounds[0]._id;else if(d.length===1){var m=c._getSoundIds(),g=m.indexOf(d[0]);g>=0?p=parseInt(d[0],10):f=parseFloat(d[0])}else d.length===2&&(f=parseFloat(d[0]),p=parseInt(d[1],10));var v;if(typeof f=="number"){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"rate",action:function(){c.rate.apply(c,d)}}),c;typeof p>"u"&&(c._rate=f),p=c._getSoundIds(p);for(var y=0;y<p.length;y++)if(v=c._soundById(p[y]),v){c.playing(p[y])&&(v._rateSeek=c.seek(p[y]),v._playStart=c._webAudio?r.ctx.currentTime:v._playStart),v._rate=f,c._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(f,r.ctx.currentTime):v._node&&(v._node.playbackRate=f);var x=c.seek(p[y]),w=(c._sprite[v._sprite][0]+c._sprite[v._sprite][1])/1e3-x,S=w*1e3/Math.abs(v._rate);(c._endTimers[p[y]]||!v._paused)&&(c._clearTimer(p[y]),c._endTimers[p[y]]=setTimeout(c._ended.bind(c,v),S)),c._emit("rate",v._id)}}else return v=c._soundById(p),v?v._rate:c._rate;return c},seek:function(){var c=this,d=arguments,f,p;if(d.length===0)c._sounds.length&&(p=c._sounds[0]._id);else if(d.length===1){var m=c._getSoundIds(),g=m.indexOf(d[0]);g>=0?p=parseInt(d[0],10):c._sounds.length&&(p=c._sounds[0]._id,f=parseFloat(d[0]))}else d.length===2&&(f=parseFloat(d[0]),p=parseInt(d[1],10));if(typeof p>"u")return 0;if(typeof f=="number"&&(c._state!=="loaded"||c._playLock))return c._queue.push({event:"seek",action:function(){c.seek.apply(c,d)}}),c;var v=c._soundById(p);if(v)if(typeof f=="number"&&f>=0){var y=c.playing(p);y&&c.pause(p,!0),v._seek=f,v._ended=!1,c._clearTimer(p),!c._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=f);var x=function(){y&&c.play(p,!0),c._emit("seek",p)};if(y&&!c._webAudio){var w=function(){c._playLock?setTimeout(w,0):x()};setTimeout(w,0)}else x()}else if(c._webAudio){var S=c.playing(p)?r.ctx.currentTime-v._playStart:0,_=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(_+S*Math.abs(v._rate))}else return v._node.currentTime;return c},playing:function(c){var d=this;if(typeof c=="number"){var f=d._soundById(c);return f?!f._paused:!1}for(var p=0;p<d._sounds.length;p++)if(!d._sounds[p]._paused)return!0;return!1},duration:function(c){var d=this,f=d._duration,p=d._soundById(c);return p&&(f=d._sprite[p._sprite][1]/1e3),f},state:function(){return this._state},unload:function(){for(var c=this,d=c._sounds,f=0;f<d.length;f++)d[f]._paused||c.stop(d[f]._id),c._webAudio||(c._clearSound(d[f]._node),d[f]._node.removeEventListener("error",d[f]._errorFn,!1),d[f]._node.removeEventListener(r._canPlayEvent,d[f]._loadFn,!1),d[f]._node.removeEventListener("ended",d[f]._endFn,!1),r._releaseHtml5Audio(d[f]._node)),delete d[f]._node,c._clearTimer(d[f]._id);var p=r._howls.indexOf(c);p>=0&&r._howls.splice(p,1);var m=!0;for(f=0;f<r._howls.length;f++)if(r._howls[f]._src===c._src||c._src.indexOf(r._howls[f]._src)>=0){m=!1;break}return s&&m&&delete s[c._src],r.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,d,f,p){var m=this,g=m["_on"+c];return typeof d=="function"&&g.push(p?{id:f,fn:d,once:p}:{id:f,fn:d}),m},off:function(c,d,f){var p=this,m=p["_on"+c],g=0;if(typeof d=="number"&&(f=d,d=null),d||f)for(g=0;g<m.length;g++){var v=f===m[g].id;if(d===m[g].fn&&v||!d&&v){m.splice(g,1);break}}else if(c)p["_on"+c]=[];else{var y=Object.keys(p);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(p[y[g]])&&(p[y[g]]=[])}return p},once:function(c,d,f){var p=this;return p.on(c,d,f,1),p},_emit:function(c,d,f){for(var p=this,m=p["_on"+c],g=m.length-1;g>=0;g--)(!m[g].id||m[g].id===d||c==="load")&&(setTimeout((function(v){v.call(this,d,f)}).bind(p,m[g].fn),0),m[g].once&&p.off(c,m[g].fn,m[g].id));return p._loadQueue(c),p},_loadQueue:function(c){var d=this;if(d._queue.length>0){var f=d._queue[0];f.event===c&&(d._queue.shift(),d._loadQueue()),c||f.action()}return d},_ended:function(c){var d=this,f=c._sprite;if(!d._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(d._ended.bind(d,c),100),d;var p=!!(c._loop||d._sprite[f][2]);if(d._emit("end",c._id),!d._webAudio&&p&&d.stop(c._id,!0).play(c._id),d._webAudio&&p){d._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=r.ctx.currentTime;var m=(c._stop-c._start)*1e3/Math.abs(c._rate);d._endTimers[c._id]=setTimeout(d._ended.bind(d,c),m)}return d._webAudio&&!p&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,d._clearTimer(c._id),d._cleanBuffer(c._node),r._autoSuspend()),!d._webAudio&&!p&&d.stop(c._id,!0),d},_clearTimer:function(c){var d=this;if(d._endTimers[c]){if(typeof d._endTimers[c]!="function")clearTimeout(d._endTimers[c]);else{var f=d._soundById(c);f&&f._node&&f._node.removeEventListener("ended",d._endTimers[c],!1)}delete d._endTimers[c]}return d},_soundById:function(c){for(var d=this,f=0;f<d._sounds.length;f++)if(c===d._sounds[f]._id)return d._sounds[f];return null},_inactiveSound:function(){var c=this;c._drain();for(var d=0;d<c._sounds.length;d++)if(c._sounds[d]._ended)return c._sounds[d].reset();return new n(c)},_drain:function(){var c=this,d=c._pool,f=0,p=0;if(!(c._sounds.length<d)){for(p=0;p<c._sounds.length;p++)c._sounds[p]._ended&&f++;for(p=c._sounds.length-1;p>=0;p--){if(f<=d)return;c._sounds[p]._ended&&(c._webAudio&&c._sounds[p]._node&&c._sounds[p]._node.disconnect(0),c._sounds.splice(p,1),f--)}}},_getSoundIds:function(c){var d=this;if(typeof c>"u"){for(var f=[],p=0;p<d._sounds.length;p++)f.push(d._sounds[p]._id);return f}else return[c]},_refreshBuffer:function(c){var d=this;return c._node.bufferSource=r.ctx.createBufferSource(),c._node.bufferSource.buffer=s[d._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,r.ctx.currentTime),d},_cleanBuffer:function(c){var d=this,f=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),f))try{c.bufferSource.buffer=r._scratchBuffer}catch{}return c.bufferSource=null,d},_clearSound:function(c){var d=/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent);d||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(c){this._parent=c,this.init()};n.prototype={init:function(){var c=this,d=c._parent;return c._muted=d._muted,c._loop=d._loop,c._volume=d._volume,c._rate=d._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++r._counter,d._sounds.push(c),c.create(),c},create:function(){var c=this,d=c._parent,f=r._muted||c._muted||c._parent._muted?0:c._volume;return d._webAudio?(c._node=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),c._node.gain.setValueAtTime(f,r.ctx.currentTime),c._node.paused=!0,c._node.connect(r.masterGain)):r.noAudio||(c._node=r._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(r._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=d._src,c._node.preload=d._preload===!0?"auto":d._preload,c._node.volume=f*r.volume(),c._node.load()),c},reset:function(){var c=this,d=c._parent;return c._muted=d._muted,c._loop=d._loop,c._volume=d._volume,c._rate=d._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++r._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,d=c._parent;d._duration=Math.ceil(c._node.duration*10)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,d._duration*1e3]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),c._node.removeEventListener(r._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,d=c._parent;d._duration===1/0&&(d._duration=Math.ceil(c._node.duration*10)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=d._duration*1e3),d._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var s={},a=function(c){var d=c._src;if(s[d]){c._duration=s[d].duration,u(c);return}if(/^data:[^;]+;base64,/.test(d)){for(var f=atob(d.split(",")[1]),p=new Uint8Array(f.length),m=0;m<f.length;++m)p[m]=f.charCodeAt(m);l(p.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,d,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(v){g.setRequestHeader(v,c._xhr.headers[v])}),g.onload=function(){var v=(g.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}l(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete s[d],c.load())},o(g)}},o=function(c){try{c.send()}catch{c.onerror()}},l=function(c,d){var f=function(){d._emit("loaderror",null,"Decoding audio data failed.")},p=function(m){m&&d._sounds.length>0?(s[d._src]=m,u(d,m)):f()};typeof Promise<"u"&&r.ctx.decodeAudioData.length===1?r.ctx.decodeAudioData(c).then(p).catch(f):r.ctx.decodeAudioData(c,p,f)},u=function(c,d){d&&!c._duration&&(c._duration=d.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,c._duration*1e3]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},h=function(){if(r.usingWebAudio){try{typeof AudioContext<"u"?r.ctx=new AudioContext:typeof webkitAudioContext<"u"?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch{r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),d=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),f=d?parseInt(d[1],10):null;if(c&&f&&f<9){var p=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!p&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:r,Howl:i}}),typeof e<"u"&&(e.Howler=r,e.Howl=i),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=r,global.Howl=i,global.Sound=n):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=r,window.Howl=i,window.Sound=n)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(r){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var n=i._howls.length-1;n>=0;n--)i._howls[n].stereo(r);return i},HowlerGlobal.prototype.pos=function(r,i,n){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(i=typeof i!="number"?s._pos[1]:i,n=typeof n!="number"?s._pos[2]:n,typeof r=="number")s._pos=[r,i,n],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(r,i,n,s,a,o){var l=this;if(!l.ctx||!l.ctx.listener)return l;var u=l._orientation;if(i=typeof i!="number"?u[1]:i,n=typeof n!="number"?u[2]:n,s=typeof s!="number"?u[3]:s,a=typeof a!="number"?u[4]:a,o=typeof o!="number"?u[5]:o,typeof r=="number")l._orientation=[r,i,n,s,a,o],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(r,i,n,s,a,o);else return u;return l},Howl.prototype.init=function(r){return function(i){var n=this;return n._orientation=i.orientation||[1,0,0],n._stereo=i.stereo||null,n._pos=i.pos||null,n._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},n._onstereo=i.onstereo?[{fn:i.onstereo}]:[],n._onpos=i.onpos?[{fn:i.onpos}]:[],n._onorientation=i.onorientation?[{fn:i.onorientation}]:[],r.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(r,i){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"stereo",action:function(){n.stereo(r,i)}}),n;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof r=="number")n._stereo=r,n._pos=[r,0,0];else return n._stereo;for(var a=n._getSoundIds(i),o=0;o<a.length;o++){var l=n._soundById(a[o]);if(l)if(typeof r=="number")l._stereo=r,l._pos=[r,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,s),s==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(r,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(r,0,0):l._panner.pan.setValueAtTime(r,Howler.ctx.currentTime)),n._emit("stereo",l._id);else return l._stereo}return n},Howl.prototype.pos=function(r,i,n,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(r,i,n,s)}}),a;if(i=typeof i!="number"?0:i,n=typeof n!="number"?-.5:n,typeof s>"u")if(typeof r=="number")a._pos=[r,i,n];else return a._pos;for(var o=a._getSoundIds(s),l=0;l<o.length;l++){var u=a._soundById(o[l]);if(u)if(typeof r=="number")u._pos=[r,i,n],u._node&&((!u._panner||u._panner.pan)&&t(u,"spatial"),typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(r,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):u._panner.setPosition(r,i,n)),a._emit("pos",u._id);else return u._pos}return a},Howl.prototype.orientation=function(r,i,n,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(r,i,n,s)}}),a;if(i=typeof i!="number"?a._orientation[1]:i,n=typeof n!="number"?a._orientation[2]:n,typeof s>"u")if(typeof r=="number")a._orientation=[r,i,n];else return a._orientation;for(var o=a._getSoundIds(s),l=0;l<o.length;l++){var u=a._soundById(o[l]);if(u)if(typeof r=="number")u._orientation=[r,i,n],u._node&&(u._panner||(u._pos||(u._pos=a._pos||[0,0,-.5]),t(u,"spatial")),typeof u._panner.orientationX<"u"?(u._panner.orientationX.setValueAtTime(r,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):u._panner.setOrientation(r,i,n)),a._emit("orientation",u._id);else return u._orientation}return a},Howl.prototype.pannerAttr=function(){var r=this,i=arguments,n,s,a;if(!r._webAudio)return r;if(i.length===0)return r._pannerAttr;if(i.length===1)if(typeof i[0]=="object")n=i[0],typeof s>"u"&&(n.pannerAttr||(n.pannerAttr={coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,distanceModel:n.distanceModel,maxDistance:n.maxDistance,refDistance:n.refDistance,rolloffFactor:n.rolloffFactor,panningModel:n.panningModel}),r._pannerAttr={coneInnerAngle:typeof n.pannerAttr.coneInnerAngle<"u"?n.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:typeof n.pannerAttr.coneOuterAngle<"u"?n.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:typeof n.pannerAttr.coneOuterGain<"u"?n.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:typeof n.pannerAttr.distanceModel<"u"?n.pannerAttr.distanceModel:r._distanceModel,maxDistance:typeof n.pannerAttr.maxDistance<"u"?n.pannerAttr.maxDistance:r._maxDistance,refDistance:typeof n.pannerAttr.refDistance<"u"?n.pannerAttr.refDistance:r._refDistance,rolloffFactor:typeof n.pannerAttr.rolloffFactor<"u"?n.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:typeof n.pannerAttr.panningModel<"u"?n.pannerAttr.panningModel:r._panningModel});else return a=r._soundById(parseInt(i[0],10)),a?a._pannerAttr:r._pannerAttr;else i.length===2&&(n=i[0],s=parseInt(i[1],10));for(var o=r._getSoundIds(s),l=0;l<o.length;l++)if(a=r._soundById(o[l]),a){var u=a._pannerAttr;u={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:u.coneOuterAngle,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:u.coneOuterGain,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:u.distanceModel,maxDistance:typeof n.maxDistance<"u"?n.maxDistance:u.maxDistance,refDistance:typeof n.refDistance<"u"?n.refDistance:u.refDistance,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:u.rolloffFactor,panningModel:typeof n.panningModel<"u"?n.panningModel:u.panningModel};var h=a._panner;h?(h.coneInnerAngle=u.coneInnerAngle,h.coneOuterAngle=u.coneOuterAngle,h.coneOuterGain=u.coneOuterGain,h.distanceModel=u.distanceModel,h.maxDistance=u.maxDistance,h.refDistance=u.refDistance,h.rolloffFactor=u.rolloffFactor,h.panningModel=u.panningModel):(a._pos||(a._pos=r._pos||[0,0,-.5]),t(a,"spatial"))}return r},Sound.prototype.init=function(r){return function(){var i=this,n=i._parent;i._orientation=n._orientation,i._stereo=n._stereo,i._pos=n._pos,i._pannerAttr=n._pannerAttr,r.call(this),i._stereo?n.stereo(i._stereo):i._pos&&n.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(r){return function(){var i=this,n=i._parent;return i._orientation=n._orientation,i._stereo=n._stereo,i._pos=n._pos,i._pannerAttr=n._pannerAttr,i._stereo?n.stereo(i._stereo):i._pos?n.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,n._refreshBuffer(i)),r.call(this)}}(Sound.prototype.reset);var t=function(r,i){i=i||"spatial",i==="spatial"?(r._panner=Howler.ctx.createPanner(),r._panner.coneInnerAngle=r._pannerAttr.coneInnerAngle,r._panner.coneOuterAngle=r._pannerAttr.coneOuterAngle,r._panner.coneOuterGain=r._pannerAttr.coneOuterGain,r._panner.distanceModel=r._pannerAttr.distanceModel,r._panner.maxDistance=r._pannerAttr.maxDistance,r._panner.refDistance=r._pannerAttr.refDistance,r._panner.rolloffFactor=r._pannerAttr.rolloffFactor,r._panner.panningModel=r._pannerAttr.panningModel,typeof r._panner.positionX<"u"?(r._panner.positionX.setValueAtTime(r._pos[0],Howler.ctx.currentTime),r._panner.positionY.setValueAtTime(r._pos[1],Howler.ctx.currentTime),r._panner.positionZ.setValueAtTime(r._pos[2],Howler.ctx.currentTime)):r._panner.setPosition(r._pos[0],r._pos[1],r._pos[2]),typeof r._panner.orientationX<"u"?(r._panner.orientationX.setValueAtTime(r._orientation[0],Howler.ctx.currentTime),r._panner.orientationY.setValueAtTime(r._orientation[1],Howler.ctx.currentTime),r._panner.orientationZ.setValueAtTime(r._orientation[2],Howler.ctx.currentTime)):r._panner.setOrientation(r._orientation[0],r._orientation[1],r._orientation[2])):(r._panner=Howler.ctx.createStereoPanner(),r._panner.pan.setValueAtTime(r._stereo,Howler.ctx.currentTime)),r._panner.connect(r._node),r._paused||r._parent.pause(r._id,!0).play(r._id,!0)}}()}),M$=hp((e,t)=>{t.exports=function(r,i){for(var n=r.split("."),s=i.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),fp="149",As={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},E$=0,q3=1,A$=2,iD=1,T$=2,Um=3,Ca=0,ki=1,ds=2,pi=0,ff=1,X3=2,$3=3,Q3=4,C$=5,Dd=100,D$=101,P$=102,K3=103,Z3=104,O$=200,L$=201,I$=202,R$=203,s4=204,a4=205,k$=206,z$=207,N$=208,B$=209,F$=210,U$=0,j$=1,H$=2,$E=3,V$=4,W$=5,G$=6,Y$=7,o4=0,q$=1,X$=2,Al=0,$$=1,Q$=2,K$=3,Z$=4,J$=5,l4=300,xh=301,wh=302,QE=303,KE=304,Rv=306,xl=1e3,ii=1001,ZE=1002,wr=1003,J3=1004,W_=1005,Bt=1006,eQ=1007,Bf=1008,cn=1009,tQ=1010,rQ=1011,u4=1012,iQ=1013,Cu=1014,fs=1015,Ff=1016,nQ=1017,sQ=1018,rh=1020,aQ=1021,Us=1023,oQ=1024,lQ=1025,ih=1026,bh=1027,uQ=1028,cQ=1029,c4=1030,hQ=1031,dQ=1033,G_=33776,Y_=33777,q_=33778,X_=33779,eL=35840,tL=35841,rL=35842,iL=35843,fQ=36196,nL=37492,sL=37496,aL=37808,oL=37809,lL=37810,uL=37811,cL=37812,hL=37813,dL=37814,fL=37815,pL=37816,mL=37817,gL=37818,vL=37819,yL=37820,xL=37821,$_=36492,pQ=36283,wL=36284,bL=36285,_L=36286,h4=2200,d4=2201,nD=2202,cx=2300,hx=2301,Q_=2302,Qd=2400,Kd=2401,dx=2402,sD=2500,mQ=2501,yo=3e3,Ot=3001,Wl=3200,f4=3201,gQ=0,vQ=1,Ka="srgb",fx="srgb-linear",K_=7680,yQ=519,JE=35044,SL="300 es",eA=1035,Xi=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let r=this._listeners[e];if(r!==void 0){let i=r.indexOf(t);i!==-1&&r.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let r=t.slice(0);for(let i=0,n=r.length;i<n;i++)r[i].call(this,e);e.target=null}}},Ji=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],ML=1234567,ag=Math.PI/180,qg=180/Math.PI;function Ws(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Ji[e&255]+Ji[e>>8&255]+Ji[e>>16&255]+Ji[e>>24&255]+"-"+Ji[t&255]+Ji[t>>8&255]+"-"+Ji[t>>16&15|64]+Ji[t>>24&255]+"-"+Ji[r&63|128]+Ji[r>>8&255]+"-"+Ji[r>>16&255]+Ji[r>>24&255]+Ji[i&255]+Ji[i>>8&255]+Ji[i>>16&255]+Ji[i>>24&255]).toLowerCase()}function bi(e,t,r){return Math.max(t,Math.min(r,e))}function aD(e,t){return(e%t+t)%t}function xQ(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)}function wQ(e,t,r){return e!==t?(r-e)/(t-e):0}function og(e,t,r){return(1-r)*e+r*t}function bQ(e,t,r,i){return og(e,t,1-Math.exp(-r*i))}function _Q(e,t=1){return t-Math.abs(aD(e,t*2)-t)}function SQ(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))}function MQ(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(e*6-15)+10))}function EQ(e,t){return e+Math.floor(Math.random()*(t-e+1))}function AQ(e,t){return e+Math.random()*(t-e)}function TQ(e){return e*(.5-Math.random())}function CQ(e){e!==void 0&&(ML=e);let t=ML+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function DQ(e){return e*ag}function PQ(e){return e*qg}function tA(e){return(e&e-1)===0&&e!==0}function p4(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function px(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function OQ(e,t,r,i,n){let s=Math.cos,a=Math.sin,o=s(r/2),l=a(r/2),u=s((t+i)/2),h=a((t+i)/2),c=s((t-i)/2),d=a((t-i)/2),f=s((i-t)/2),p=a((i-t)/2);switch(n){case"XYX":e.set(o*h,l*c,l*d,o*u);break;case"YZY":e.set(l*d,o*h,l*c,o*u);break;case"ZXZ":e.set(l*c,l*d,o*h,o*u);break;case"XZX":e.set(o*h,l*p,l*f,o*u);break;case"YXY":e.set(l*f,o*h,l*p,o*u);break;case"ZYZ":e.set(l*p,l*f,o*h,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function wl(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function xr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var zt=Object.freeze({__proto__:null,DEG2RAD:ag,RAD2DEG:qg,ceilPowerOfTwo:p4,clamp:bi,damp:bQ,degToRad:DQ,denormalize:wl,euclideanModulo:aD,floorPowerOfTwo:px,generateUUID:Ws,inverseLerp:wQ,isPowerOfTwo:tA,lerp:og,mapLinear:xQ,normalize:xr,pingpong:_Q,radToDeg:PQ,randFloat:AQ,randFloatSpread:TQ,randInt:EQ,seededRandom:CQ,setQuaternionFromProperEuler:OQ,smootherstep:MQ,smoothstep:SQ}),J=class{constructor(e=0,t=0){J.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*r-s*i+e.x,this.y=n*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},zi=class{constructor(){zi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,r,i,n,s,a,o,l){let u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=n,u[5]=o,u[6]=r,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,i=t.elements,n=this.elements,s=r[0],a=r[3],o=r[6],l=r[1],u=r[4],h=r[7],c=r[2],d=r[5],f=r[8],p=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],w=i[2],S=i[5],_=i[8];return n[0]=s*p+a*v+o*w,n[3]=s*m+a*y+o*S,n[6]=s*g+a*x+o*_,n[1]=l*p+u*v+h*w,n[4]=l*m+u*y+h*S,n[7]=l*g+u*x+h*_,n[2]=c*p+d*v+f*w,n[5]=c*m+d*y+f*S,n[8]=c*g+d*x+f*_,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8];return t*s*u-t*a*l-r*n*u+r*a*o+i*n*l-i*s*o}invert(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],h=u*s-a*l,c=a*o-u*n,d=l*n-s*o,f=t*h+r*c+i*d;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);let p=1/f;return e[0]=h*p,e[1]=(i*l-u*r)*p,e[2]=(a*r-i*s)*p,e[3]=c*p,e[4]=(u*t-i*o)*p,e[5]=(i*n-a*t)*p,e[6]=d*p,e[7]=(r*o-l*t)*p,e[8]=(s*t-r*n)*p,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(r*o,r*l,-r*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Z_.makeScale(e,t)),this}rotate(e){return this.premultiply(Z_.makeRotation(-e)),this}translate(e,t){return this.premultiply(Z_.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}},Z_=new zi;function m4(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var LQ={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function B0(e,t){return new LQ[e](t)}function mx(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function nh(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function x1(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var J_={[Ka]:{[fx]:nh},[fx]:{[Ka]:x1}},mn={legacyMode:!0,get workingColorSpace(){return fx},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,r){if(this.legacyMode||t===r||!t||!r)return e;if(J_[t]&&J_[t][r]!==void 0){let i=J_[t][r];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},g4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gi={r:0,g:0,b:0},sa={h:0,s:0,l:0},F0={h:0,s:0,l:0};function eS(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*6*(2/3-r):e}function U0(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var gt=class{constructor(t,r,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,r===void 0&&i===void 0?this.set(t):this.setRGB(t,r,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,r=Ka){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,mn.toWorkingColorSpace(this,r),this}setRGB(t,r,i,n=mn.workingColorSpace){return this.r=t,this.g=r,this.b=i,mn.toWorkingColorSpace(this,n),this}setHSL(t,r,i,n=mn.workingColorSpace){if(t=aD(t,1),r=bi(r,0,1),i=bi(i,0,1),r===0)this.r=this.g=this.b=i;else{let s=i<=.5?i*(1+r):i+r-i*r,a=2*i-s;this.r=eS(a,s,t+1/3),this.g=eS(a,s,t),this.b=eS(a,s,t-1/3)}return mn.toWorkingColorSpace(this,n),this}setStyle(t,r=Ka){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s,a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,mn.toWorkingColorSpace(this,r),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,mn.toWorkingColorSpace(this,r),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let l=parseFloat(s[1])/360,u=parseFloat(s[2])/100,h=parseFloat(s[3])/100;return i(s[4]),this.setHSL(l,u,h,r)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){let s=n[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,mn.toWorkingColorSpace(this,r),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,mn.toWorkingColorSpace(this,r),this}return t&&t.length>0?this.setColorName(t,r):this}setColorName(t,r=Ka){let i=g4[t.toLowerCase()];return i!==void 0?this.setHex(i,r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=nh(t.r),this.g=nh(t.g),this.b=nh(t.b),this}copyLinearToSRGB(t){return this.r=x1(t.r),this.g=x1(t.g),this.b=x1(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ka){return mn.fromWorkingColorSpace(U0(this,gi),t),bi(gi.r*255,0,255)<<16^bi(gi.g*255,0,255)<<8^bi(gi.b*255,0,255)<<0}getHexString(t=Ka){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,r=mn.workingColorSpace){mn.fromWorkingColorSpace(U0(this,gi),r);let i=gi.r,n=gi.g,s=gi.b,a=Math.max(i,n,s),o=Math.min(i,n,s),l,u,h=(o+a)/2;if(o===a)l=0,u=0;else{let c=a-o;switch(u=h<=.5?c/(a+o):c/(2-a-o),a){case i:l=(n-s)/c+(n<s?6:0);break;case n:l=(s-i)/c+2;break;case s:l=(i-n)/c+4;break}l/=6}return t.h=l,t.s=u,t.l=h,t}getRGB(t,r=mn.workingColorSpace){return mn.fromWorkingColorSpace(U0(this,gi),r),t.r=gi.r,t.g=gi.g,t.b=gi.b,t}getStyle(t=Ka){return mn.fromWorkingColorSpace(U0(this,gi),t),t!==Ka?`color(${t} ${gi.r} ${gi.g} ${gi.b})`:`rgb(${gi.r*255|0},${gi.g*255|0},${gi.b*255|0})`}offsetHSL(t,r,i){return this.getHSL(sa),sa.h+=t,sa.s+=r,sa.l+=i,this.setHSL(sa.h,sa.s,sa.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpColors(t,r,i){return this.r=t.r+(r.r-t.r)*i,this.g=t.g+(r.g-t.g)*i,this.b=t.b+(r.b-t.b)*i,this}lerpHSL(t,r){this.getHSL(sa),t.getHSL(F0);let i=og(sa.h,F0.h,r),n=og(sa.s,F0.s,r),s=og(sa.l,F0.l,r);return this.setHSL(i,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};gt.NAMES=g4;var $h,v4=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{$h===void 0&&($h=mx("canvas")),$h.width=e.width,$h.height=e.height;let r=$h.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=$h}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=mx("canvas");t.width=e.width,t.height=e.height;let r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);let i=r.getImageData(0,0,e.width,e.height),n=i.data;for(let s=0;s<n.length;s++)n[s]=nh(n[s]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){let t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(nh(t[r]/255)*255):t[r]=nh(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},y4=class{constructor(e=null){this.isSource=!0,this.uuid=Ws(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?n.push(tS(i[s].image)):n.push(tS(i[s]))}else n=tS(i);r.url=n}return t||(e.images[this.uuid]=r),r}};function tS(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?v4.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var IQ=0,Mi=class extends Xi{constructor(e=Mi.DEFAULT_IMAGE,t=Mi.DEFAULT_MAPPING,r=ii,i=ii,n=Bt,s=Bf,a=Us,o=cn,l=Mi.DEFAULT_ANISOTROPY,u=yo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:IQ++}),this.uuid=Ws(),this.name="",this.source=new y4(e),this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new J(0,0),this.repeat=new J(1,1),this.center=new J(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==l4)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case xl:e.x=e.x-Math.floor(e.x);break;case ii:e.x=e.x<0?0:1;break;case ZE:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case xl:e.y=e.y-Math.floor(e.y);break;case ii:e.y=e.y<0?0:1;break;case ZE:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Mi.DEFAULT_IMAGE=null;Mi.DEFAULT_MAPPING=l4;Mi.DEFAULT_ANISOTROPY=1;var Lt=class{constructor(e=0,t=0,r=0,i=1){Lt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,r=this.y,i=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*n,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*n,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*n,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,n,s=e.elements,a=s[0],o=s[4],l=s[8],u=s[1],h=s[5],c=s[9],d=s[2],f=s[6],p=s[10];if(Math.abs(o-u)<.01&&Math.abs(l-d)<.01&&Math.abs(c-f)<.01){if(Math.abs(o+u)<.1&&Math.abs(l+d)<.1&&Math.abs(c+f)<.1&&Math.abs(a+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let g=(a+1)/2,v=(h+1)/2,y=(p+1)/2,x=(o+u)/4,w=(l+d)/4,S=(c+f)/4;return g>v&&g>y?g<.01?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(g),i=x/r,n=w/r):v>y?v<.01?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(v),r=x/i,n=S/i):y<.01?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(y),r=w/n,i=S/n),this.set(r,i,n,t),this}let m=Math.sqrt((f-c)*(f-c)+(l-d)*(l-d)+(u-o)*(u-o));return Math.abs(m)<.001&&(m=1),this.x=(f-c)/m,this.y=(l-d)/m,this.z=(u-o)/m,this.w=Math.acos((a+h+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},cr=class extends Xi{constructor(e=1,t=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Lt(0,0,e,t),this.scissorTest=!1,this.viewport=new Lt(0,0,e,t);let i={width:e,height:t,depth:1};this.texture=new Mi(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Bt,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new y4(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},x4=class extends Mi{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=wr,this.minFilter=wr,this.wrapR=ii,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},RQ=class extends Mi{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=wr,this.minFilter=wr,this.wrapR=ii,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},kQ=class extends cr{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<r;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,n=this.texture.length;i<n;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},kt=class{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,n,s,a){let o=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3],c=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=c,e[t+1]=d,e[t+2]=f,e[t+3]=p;return}if(h!==p||o!==c||l!==d||u!==f){let m=1-a,g=o*c+l*d+u*f+h*p,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){let w=Math.sqrt(y),S=Math.atan2(w,g*v);m=Math.sin(m*S)/w,a=Math.sin(a*S)/w}let x=a*v;if(o=o*m+c*x,l=l*m+d*x,u=u*m+f*x,h=h*m+p*x,m===1-a){let w=1/Math.sqrt(o*o+l*l+u*u+h*h);o*=w,l*=w,u*=w,h*=w}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,n,s){let a=r[i],o=r[i+1],l=r[i+2],u=r[i+3],h=n[s],c=n[s+1],d=n[s+2],f=n[s+3];return e[t]=a*f+u*h+o*d-l*c,e[t+1]=o*f+u*c+l*h-a*d,e[t+2]=l*f+u*d+a*c-o*h,e[t+3]=u*f-a*h-o*c-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let r=e._x,i=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(r/2),u=a(i/2),h=a(n/2),c=o(r/2),d=o(i/2),f=o(n/2);switch(s){case"XYZ":this._x=c*u*h+l*d*f,this._y=l*d*h-c*u*f,this._z=l*u*f+c*d*h,this._w=l*u*h-c*d*f;break;case"YXZ":this._x=c*u*h+l*d*f,this._y=l*d*h-c*u*f,this._z=l*u*f-c*d*h,this._w=l*u*h+c*d*f;break;case"ZXY":this._x=c*u*h-l*d*f,this._y=l*d*h+c*u*f,this._z=l*u*f+c*d*h,this._w=l*u*h-c*d*f;break;case"ZYX":this._x=c*u*h-l*d*f,this._y=l*d*h+c*u*f,this._z=l*u*f-c*d*h,this._w=l*u*h+c*d*f;break;case"YZX":this._x=c*u*h+l*d*f,this._y=l*d*h+c*u*f,this._z=l*u*f-c*d*h,this._w=l*u*h-c*d*f;break;case"XZY":this._x=c*u*h-l*d*f,this._y=l*d*h-c*u*f,this._z=l*u*f+c*d*h,this._w=l*u*h+c*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,r=t[0],i=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],u=t[6],h=t[10],c=r+a+h;if(c>0){let d=.5/Math.sqrt(c+1);this._w=.25/d,this._x=(u-o)*d,this._y=(n-l)*d,this._z=(s-i)*d}else if(r>a&&r>h){let d=2*Math.sqrt(1+r-a-h);this._w=(u-o)/d,this._x=.25*d,this._y=(i+s)/d,this._z=(n+l)/d}else if(a>h){let d=2*Math.sqrt(1+a-r-h);this._w=(n-l)/d,this._x=(i+s)/d,this._y=.25*d,this._z=(o+u)/d}else{let d=2*Math.sqrt(1+h-r-a);this._w=(s-i)/d,this._x=(n+l)/d,this._y=(o+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(bi(this.dot(e),-1,1)))}rotateTowards(e,t){let r=this.angleTo(e);if(r===0)return this;let i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let r=e._x,i=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,u=t._w;return this._x=r*u+s*a+i*l-n*o,this._y=i*u+s*o+n*a-r*l,this._z=n*u+s*l+r*o-i*a,this._w=s*u-r*a-i*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let r=this._x,i=this._y,n=this._z,s=this._w,a=s*e._w+r*e._x+i*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=r,this._y=i,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*r+t*this._x,this._y=d*i+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,c=Math.sin(t*u)/l;return this._w=s*h+this._w*c,this._x=r*h+this._x*c,this._y=i*h+this._y*c,this._z=n*h+this._z*c,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){let e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(n),r*Math.cos(n),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},P=class{constructor(e=0,t=0,r=0){P.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(EL.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(EL.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,r=this.y,i=this.z,n=e.elements,s=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*s,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*s,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*s,this}applyQuaternion(e){let t=this.x,r=this.y,i=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*i-a*r,u=o*r+a*t-n*i,h=o*i+n*r-s*t,c=-n*t-s*r-a*i;return this.x=l*o+c*-n+u*-a-h*-s,this.y=u*o+c*-s+h*-n-l*-a,this.z=h*o+c*-a+l*-s-u*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let r=e.x,i=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-n*a,this.y=n*s-r*o,this.z=r*a-i*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return rS.copy(this).projectOnVector(e),this.sub(rS)}reflect(e){return this.sub(rS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let r=this.dot(e)/t;return Math.acos(bi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){let i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},rS=new P,EL=new kt,ai=class{constructor(e=new P(1/0,1/0,1/0),t=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let u=e[o],h=e[o+1],c=e[o+2];u<t&&(t=u),h<r&&(r=h),c<i&&(i=c),u>n&&(n=u),h>s&&(s=h),c>a&&(a=c)}return this.min.set(t,r,i),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let u=e.getX(o),h=e.getY(o),c=e.getZ(o);u<t&&(t=u),h<r&&(r=h),c<i&&(i=c),u>n&&(n=u),h>s&&(s=h),c>a&&(a=c)}return this.min.set(t,r,i),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=wc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let r=e.geometry;if(r!==void 0)if(t&&r.attributes!=null&&r.attributes.position!==void 0){let n=r.attributes.position;for(let s=0,a=n.count;s<a;s++)wc.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(wc)}else r.boundingBox===null&&r.computeBoundingBox(),iS.copy(r.boundingBox),iS.applyMatrix4(e.matrixWorld),this.union(iS);let i=e.children;for(let n=0,s=i.length;n<s;n++)this.expandByObject(i[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wc),wc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(tm),j0.subVectors(this.max,tm),Qh.subVectors(e.a,tm),Kh.subVectors(e.b,tm),Zh.subVectors(e.c,tm),tu.subVectors(Kh,Qh),ru.subVectors(Zh,Kh),bc.subVectors(Qh,Zh);let t=[0,-tu.z,tu.y,0,-ru.z,ru.y,0,-bc.z,bc.y,tu.z,0,-tu.x,ru.z,0,-ru.x,bc.z,0,-bc.x,-tu.y,tu.x,0,-ru.y,ru.x,0,-bc.y,bc.x,0];return!nS(t,Qh,Kh,Zh,j0)||(t=[1,0,0,0,1,0,0,0,1],!nS(t,Qh,Kh,Zh,j0))?!1:(H0.crossVectors(tu,ru),t=[H0.x,H0.y,H0.z],nS(t,Qh,Kh,Zh,j0))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return wc.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(wc).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Vo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Vo=[new P,new P,new P,new P,new P,new P,new P,new P],wc=new P,iS=new ai,Qh=new P,Kh=new P,Zh=new P,tu=new P,ru=new P,bc=new P,tm=new P,j0=new P,H0=new P,_c=new P;function nS(e,t,r,i,n){for(let s=0,a=e.length-3;s<=a;s+=3){_c.fromArray(e,s);let o=n.x*Math.abs(_c.x)+n.y*Math.abs(_c.y)+n.z*Math.abs(_c.z),l=t.dot(_c),u=r.dot(_c),h=i.dot(_c);if(Math.max(-Math.max(l,u,h),Math.min(l,u,h))>o)return!1}return!0}var zQ=new ai,rm=new P,sS=new P,ys=class{constructor(e=new P,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let r=this.center;t!==void 0?r.copy(t):zQ.setFromPoints(e).getCenter(r);let i=0;for(let n=0,s=e.length;n<s;n++)i=Math.max(i,r.distanceToSquared(e[n]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;rm.subVectors(e,this.center);let t=rm.lengthSq();if(t>this.radius*this.radius){let r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(rm,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(sS.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(rm.copy(e.center).add(sS)),this.expandByPoint(rm.copy(e.center).sub(sS))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Wo=new P,aS=new P,V0=new P,iu=new P,oS=new P,W0=new P,lS=new P,pp=class{constructor(e=new P,t=new P(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Wo)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Wo.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Wo.copy(this.direction).multiplyScalar(t).add(this.origin),Wo.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){aS.copy(e).add(t).multiplyScalar(.5),V0.copy(t).sub(e).normalize(),iu.copy(this.origin).sub(aS);let n=e.distanceTo(t)*.5,s=-this.direction.dot(V0),a=iu.dot(this.direction),o=-iu.dot(V0),l=iu.lengthSq(),u=Math.abs(1-s*s),h,c,d,f;if(u>0)if(h=s*o-a,c=s*a-o,f=n*u,h>=0)if(c>=-f)if(c<=f){let p=1/u;h*=p,c*=p,d=h*(h+s*c+2*a)+c*(s*h+c+2*o)+l}else c=n,h=Math.max(0,-(s*c+a)),d=-h*h+c*(c+2*o)+l;else c=-n,h=Math.max(0,-(s*c+a)),d=-h*h+c*(c+2*o)+l;else c<=-f?(h=Math.max(0,-(-s*n+a)),c=h>0?-n:Math.min(Math.max(-n,-o),n),d=-h*h+c*(c+2*o)+l):c<=f?(h=0,c=Math.min(Math.max(-n,-o),n),d=c*(c+2*o)+l):(h=Math.max(0,-(s*n+a)),c=h>0?n:Math.min(Math.max(-n,-o),n),d=-h*h+c*(c+2*o)+l);else c=s>0?-n:n,h=Math.max(0,-(s*c+a)),d=-h*h+c*(c+2*o)+l;return r&&r.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(V0).multiplyScalar(c).add(aS),d}intersectSphere(e,t){Wo.subVectors(e.center,this.origin);let r=Wo.dot(this.direction),i=Wo.dot(Wo)-r*r,n=e.radius*e.radius;if(i>n)return null;let s=Math.sqrt(n-i),a=r-s,o=r+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){let r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,n,s,a,o,l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(r=(e.min.x-c.x)*l,i=(e.max.x-c.x)*l):(r=(e.max.x-c.x)*l,i=(e.min.x-c.x)*l),u>=0?(n=(e.min.y-c.y)*u,s=(e.max.y-c.y)*u):(n=(e.max.y-c.y)*u,s=(e.min.y-c.y)*u),r>s||n>i||((n>r||isNaN(r))&&(r=n),(s<i||isNaN(i))&&(i=s),h>=0?(a=(e.min.z-c.z)*h,o=(e.max.z-c.z)*h):(a=(e.max.z-c.z)*h,o=(e.min.z-c.z)*h),r>o||a>i)||((a>r||r!==r)&&(r=a),(o<i||i!==i)&&(i=o),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Wo)!==null}intersectTriangle(e,t,r,i,n){oS.subVectors(t,e),W0.subVectors(r,e),lS.crossVectors(oS,W0);let s=this.direction.dot(lS),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;iu.subVectors(this.origin,e);let o=a*this.direction.dot(W0.crossVectors(iu,W0));if(o<0)return null;let l=a*this.direction.dot(oS.cross(iu));if(l<0||o+l>s)return null;let u=-a*iu.dot(lS);return u<0?null:this.at(u/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Oe=class{constructor(){Oe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,r,i,n,s,a,o,l,u,h,c,d,f,p,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=u,g[10]=h,g[14]=c,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Oe().fromArray(this.elements)}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){let t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,r=e.elements,i=1/Jh.setFromMatrixColumn(e,0).length(),n=1/Jh.setFromMatrixColumn(e,1).length(),s=1/Jh.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,r=e.x,i=e.y,n=e.z,s=Math.cos(r),a=Math.sin(r),o=Math.cos(i),l=Math.sin(i),u=Math.cos(n),h=Math.sin(n);if(e.order==="XYZ"){let c=s*u,d=s*h,f=a*u,p=a*h;t[0]=o*u,t[4]=-o*h,t[8]=l,t[1]=d+f*l,t[5]=c-p*l,t[9]=-a*o,t[2]=p-c*l,t[6]=f+d*l,t[10]=s*o}else if(e.order==="YXZ"){let c=o*u,d=o*h,f=l*u,p=l*h;t[0]=c+p*a,t[4]=f*a-d,t[8]=s*l,t[1]=s*h,t[5]=s*u,t[9]=-a,t[2]=d*a-f,t[6]=p+c*a,t[10]=s*o}else if(e.order==="ZXY"){let c=o*u,d=o*h,f=l*u,p=l*h;t[0]=c-p*a,t[4]=-s*h,t[8]=f+d*a,t[1]=d+f*a,t[5]=s*u,t[9]=p-c*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let c=s*u,d=s*h,f=a*u,p=a*h;t[0]=o*u,t[4]=f*l-d,t[8]=c*l+p,t[1]=o*h,t[5]=p*l+c,t[9]=d*l-f,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let c=s*o,d=s*l,f=a*o,p=a*l;t[0]=o*u,t[4]=p-c*h,t[8]=f*h+d,t[1]=h,t[5]=s*u,t[9]=-a*u,t[2]=-l*u,t[6]=d*h+f,t[10]=c-p*h}else if(e.order==="XZY"){let c=s*o,d=s*l,f=a*o,p=a*l;t[0]=o*u,t[4]=-h,t[8]=l*u,t[1]=c*h+p,t[5]=s*u,t[9]=d*h-f,t[2]=f*h-d,t[6]=a*u,t[10]=p*h+c}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(NQ,e,BQ)}lookAt(e,t,r){let i=this.elements;return ns.subVectors(e,t),ns.lengthSq()===0&&(ns.z=1),ns.normalize(),nu.crossVectors(r,ns),nu.lengthSq()===0&&(Math.abs(r.z)===1?ns.x+=1e-4:ns.z+=1e-4,ns.normalize(),nu.crossVectors(r,ns)),nu.normalize(),G0.crossVectors(ns,nu),i[0]=nu.x,i[4]=G0.x,i[8]=ns.x,i[1]=nu.y,i[5]=G0.y,i[9]=ns.y,i[2]=nu.z,i[6]=G0.z,i[10]=ns.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,i=t.elements,n=this.elements,s=r[0],a=r[4],o=r[8],l=r[12],u=r[1],h=r[5],c=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],w=r[15],S=i[0],_=i[4],A=i[8],M=i[12],T=i[1],C=i[5],L=i[9],I=i[13],k=i[2],z=i[6],V=i[10],K=i[14],q=i[3],O=i[7],W=i[11],N=i[15];return n[0]=s*S+a*T+o*k+l*q,n[4]=s*_+a*C+o*z+l*O,n[8]=s*A+a*L+o*V+l*W,n[12]=s*M+a*I+o*K+l*N,n[1]=u*S+h*T+c*k+d*q,n[5]=u*_+h*C+c*z+d*O,n[9]=u*A+h*L+c*V+d*W,n[13]=u*M+h*I+c*K+d*N,n[2]=f*S+p*T+m*k+g*q,n[6]=f*_+p*C+m*z+g*O,n[10]=f*A+p*L+m*V+g*W,n[14]=f*M+p*I+m*K+g*N,n[3]=v*S+y*T+x*k+w*q,n[7]=v*_+y*C+x*z+w*O,n[11]=v*A+y*L+x*V+w*W,n[15]=v*M+y*I+x*K+w*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],u=e[2],h=e[6],c=e[10],d=e[14],f=e[3],p=e[7],m=e[11],g=e[15];return f*(+n*o*h-i*l*h-n*a*c+r*l*c+i*a*d-r*o*d)+p*(+t*o*d-t*l*c+n*s*c-i*s*d+i*l*u-n*o*u)+m*(+t*l*h-t*a*d-n*s*h+r*s*d+n*a*u-r*l*u)+g*(-i*a*u-t*o*h+t*a*c+i*s*h-r*s*c+r*o*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],h=e[9],c=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=h*m*l-p*c*l+p*o*d-a*m*d-h*o*g+a*c*g,y=f*c*l-u*m*l-f*o*d+s*m*d+u*o*g-s*c*g,x=u*p*l-f*h*l+f*a*d-s*p*d-u*a*g+s*h*g,w=f*h*o-u*p*o-f*a*c+s*p*c+u*a*m-s*h*m,S=t*v+r*y+i*x+n*w;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let _=1/S;return e[0]=v*_,e[1]=(p*c*n-h*m*n-p*i*d+r*m*d+h*i*g-r*c*g)*_,e[2]=(a*m*n-p*o*n+p*i*l-r*m*l-a*i*g+r*o*g)*_,e[3]=(h*o*n-a*c*n-h*i*l+r*c*l+a*i*d-r*o*d)*_,e[4]=y*_,e[5]=(u*m*n-f*c*n+f*i*d-t*m*d-u*i*g+t*c*g)*_,e[6]=(f*o*n-s*m*n-f*i*l+t*m*l+s*i*g-t*o*g)*_,e[7]=(s*c*n-u*o*n+u*i*l-t*c*l-s*i*d+t*o*d)*_,e[8]=x*_,e[9]=(f*h*n-u*p*n-f*r*d+t*p*d+u*r*g-t*h*g)*_,e[10]=(s*p*n-f*a*n+f*r*l-t*p*l-s*r*g+t*a*g)*_,e[11]=(u*a*n-s*h*n-u*r*l+t*h*l+s*r*d-t*a*d)*_,e[12]=w*_,e[13]=(u*p*i-f*h*i+f*r*c-t*p*c-u*r*m+t*h*m)*_,e[14]=(f*a*i-s*p*i-f*r*o+t*p*o+s*r*m-t*a*m)*_,e[15]=(s*h*i-u*a*i+u*r*o-t*h*o-s*r*c+t*a*c)*_,this}scale(e){let t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let r=Math.cos(t),i=Math.sin(t),n=1-r,s=e.x,a=e.y,o=e.z,l=n*s,u=n*a;return this.set(l*s+r,l*a-i*o,l*o+i*a,0,l*a+i*o,u*a+r,u*o-i*s,0,l*o-i*a,u*o+i*s,n*o*o+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,s){return this.set(1,r,n,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){let i=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,u=s+s,h=a+a,c=n*l,d=n*u,f=n*h,p=s*u,m=s*h,g=a*h,v=o*l,y=o*u,x=o*h,w=r.x,S=r.y,_=r.z;return i[0]=(1-(p+g))*w,i[1]=(d+x)*w,i[2]=(f-y)*w,i[3]=0,i[4]=(d-x)*S,i[5]=(1-(c+g))*S,i[6]=(m+v)*S,i[7]=0,i[8]=(f+y)*_,i[9]=(m-v)*_,i[10]=(1-(c+p))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){let i=this.elements,n=Jh.set(i[0],i[1],i[2]).length(),s=Jh.set(i[4],i[5],i[6]).length(),a=Jh.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],aa.copy(this);let o=1/n,l=1/s,u=1/a;return aa.elements[0]*=o,aa.elements[1]*=o,aa.elements[2]*=o,aa.elements[4]*=l,aa.elements[5]*=l,aa.elements[6]*=l,aa.elements[8]*=u,aa.elements[9]*=u,aa.elements[10]*=u,t.setFromRotationMatrix(aa),r.x=n,r.y=s,r.z=a,this}makePerspective(e,t,r,i,n,s){let a=this.elements,o=2*n/(t-e),l=2*n/(r-i),u=(t+e)/(t-e),h=(r+i)/(r-i),c=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,r,i,n,s){let a=this.elements,o=1/(t-e),l=1/(r-i),u=1/(s-n),h=(t+e)*o,c=(r+i)*l,d=(s+n)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}},Jh=new P,aa=new Oe,NQ=new P(0,0,0),BQ=new P(1,1,1),nu=new P,G0=new P,ns=new P,AL=new Oe,TL=new kt,Ri=class{constructor(e=0,t=0,r=0,i=Ri.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){let i=e.elements,n=i[0],s=i[4],a=i[8],o=i[1],l=i[5],u=i[9],h=i[2],c=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(bi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-bi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,n),this._z=0);break;case"ZXY":this._x=Math.asin(bi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-bi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(bi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-bi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return AL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(AL,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return TL.setFromEuler(this),this.setFromQuaternion(TL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Ri.DEFAULT_ORDER="XYZ";var oD=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},FQ=0,CL=new P,ed=new kt,Go=new Oe,Y0=new P,im=new P,UQ=new P,jQ=new kt,DL=new P(1,0,0),PL=new P(0,1,0),OL=new P(0,0,1),HQ={type:"added"},LL={type:"removed"},dr=class extends Xi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:FQ++}),this.uuid=Ws(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=dr.DEFAULT_UP.clone();let e=new P,t=new Ri,r=new kt,i=new P(1,1,1);function n(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(n),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Oe},normalMatrix:{value:new zi}}),this.matrix=new Oe,this.matrixWorld=new Oe,this.matrixAutoUpdate=dr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=dr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new oD,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ed.setFromAxisAngle(e,t),this.quaternion.multiply(ed),this}rotateOnWorldAxis(e,t){return ed.setFromAxisAngle(e,t),this.quaternion.premultiply(ed),this}rotateX(e){return this.rotateOnAxis(DL,e)}rotateY(e){return this.rotateOnAxis(PL,e)}rotateZ(e){return this.rotateOnAxis(OL,e)}translateOnAxis(e,t){return CL.copy(e).applyQuaternion(this.quaternion),this.position.add(CL.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(DL,e)}translateY(e){return this.translateOnAxis(PL,e)}translateZ(e){return this.translateOnAxis(OL,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Go.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Y0.copy(e):Y0.set(e,t,r);let i=this.parent;this.updateWorldMatrix(!0,!1),im.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Go.lookAt(im,Y0,this.up):Go.lookAt(Y0,im,this.up),this.quaternion.setFromRotationMatrix(Go),i&&(Go.extractRotation(i.matrixWorld),ed.setFromRotationMatrix(Go),this.quaternion.premultiply(ed.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(HQ)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(LL)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(LL)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Go.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Go.multiply(e.parent.matrixWorld)),e.applyMatrix4(Go),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){let n=this.children[r].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let r=[];this[e]===t&&r.push(this);for(let i=0,n=this.children.length;i<n;i++){let s=this.children[i].getObjectsByProperty(e,t);s.length>0&&(r=r.concat(s))}return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(im,e,UQ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(im,jQ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let r=0,i=t.length;r<i;r++){let n=t[r];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let i=this.children;for(let n=0,s=i.length;n<s;n++){let a=i[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,u=o.length;l<u;l++){let h=o[l];n(e.shapes,h)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));i.material=a}else i.material=n(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];i.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),u=s(e.images),h=s(e.shapes),c=s(e.skeletons),d=s(e.animations),f=s(e.nodes);a.length>0&&(r.geometries=a),o.length>0&&(r.materials=o),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),c.length>0&&(r.skeletons=c),d.length>0&&(r.animations=d),f.length>0&&(r.nodes=f)}return r.object=i,r;function s(a){let o=[];for(let l in a){let u=a[l];delete u.metadata,o.push(u)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){let i=e.children[r];this.add(i.clone())}return this}};dr.DEFAULT_UP=new P(0,1,0);dr.DEFAULT_MATRIX_AUTO_UPDATE=!0;dr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var oa=new P,Yo=new P,uS=new P,qo=new P,td=new P,rd=new P,IL=new P,cS=new P,hS=new P,dS=new P,nn=class{constructor(e=new P,t=new P,r=new P){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),oa.subVectors(e,t),i.cross(oa);let n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){oa.subVectors(i,t),Yo.subVectors(r,t),uS.subVectors(e,t);let s=oa.dot(oa),a=oa.dot(Yo),o=oa.dot(uS),l=Yo.dot(Yo),u=Yo.dot(uS),h=s*l-a*a;if(h===0)return n.set(-2,-1,-1);let c=1/h,d=(l*o-a*u)*c,f=(s*u-a*o)*c;return n.set(1-d-f,f,d)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,qo),qo.x>=0&&qo.y>=0&&qo.x+qo.y<=1}static getUV(e,t,r,i,n,s,a,o){return this.getBarycoord(e,t,r,i,qo),o.set(0,0),o.addScaledVector(n,qo.x),o.addScaledVector(s,qo.y),o.addScaledVector(a,qo.z),o}static isFrontFacing(e,t,r,i){return oa.subVectors(r,t),Yo.subVectors(e,t),oa.cross(Yo).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return oa.subVectors(this.c,this.b),Yo.subVectors(this.a,this.b),oa.cross(Yo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return nn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return nn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,n){return nn.getUV(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return nn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return nn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let r=this.a,i=this.b,n=this.c,s,a;td.subVectors(i,r),rd.subVectors(n,r),cS.subVectors(e,r);let o=td.dot(cS),l=rd.dot(cS);if(o<=0&&l<=0)return t.copy(r);hS.subVectors(e,i);let u=td.dot(hS),h=rd.dot(hS);if(u>=0&&h<=u)return t.copy(i);let c=o*h-u*l;if(c<=0&&o>=0&&u<=0)return s=o/(o-u),t.copy(r).addScaledVector(td,s);dS.subVectors(e,n);let d=td.dot(dS),f=rd.dot(dS);if(f>=0&&d<=f)return t.copy(n);let p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),t.copy(r).addScaledVector(rd,a);let m=u*f-d*h;if(m<=0&&h-u>=0&&d-f>=0)return IL.subVectors(n,i),a=(h-u)/(h-u+(d-f)),t.copy(i).addScaledVector(IL,a);let g=1/(m+p+c);return s=p*g,a=c*g,t.copy(r).addScaledVector(td,s).addScaledVector(rd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},VQ=0,kv=class extends Xi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:VQ++}),this.uuid=Ws(),this.name="",this.type="Material",this.blending=ff,this.side=Ca,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=s4,this.blendDst=a4,this.blendEquation=Dd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$E,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=yQ,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=K_,this.stencilZFail=K_,this.stencilZPass=K_,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let r=e[t];if(r===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==ff&&(r.blending=this.blending),this.side!==Ca&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(r.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=i(e.textures),s=i(e.images);n.length>0&&(r.textures=n),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,r=null;if(t!==null){let i=t.length;r=new Array(i);for(let n=0;n!==i;++n)r[n]=t[n].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},zv=class extends kv{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new gt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=o4,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},li=new P,q0=new J,Mt=class{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=JE,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)q0.fromBufferAttribute(this,t),q0.applyMatrix3(e),this.setXY(t,q0.x,q0.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)li.fromBufferAttribute(this,t),li.applyMatrix3(e),this.setXYZ(t,li.x,li.y,li.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)li.fromBufferAttribute(this,t),li.applyMatrix4(e),this.setXYZ(t,li.x,li.y,li.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)li.fromBufferAttribute(this,t),li.applyNormalMatrix(e),this.setXYZ(t,li.x,li.y,li.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)li.fromBufferAttribute(this,t),li.transformDirection(e),this.setXYZ(t,li.x,li.y,li.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=wl(t,this.array)),t}setX(e,t){return this.normalized&&(t=xr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=wl(t,this.array)),t}setY(e,t){return this.normalized&&(t=xr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=wl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=xr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=wl(t,this.array)),t}setW(e,t){return this.normalized&&(t=xr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=xr(t,this.array),r=xr(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=xr(t,this.array),r=xr(r,this.array),i=xr(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=xr(t,this.array),r=xr(r,this.array),i=xr(i,this.array),n=xr(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==JE&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},w4=class extends Mt{constructor(e,t,r){super(new Uint16Array(e),t,r)}},pf=class extends Mt{constructor(e,t,r){super(new Uint32Array(e),t,r)}},nt=class extends Mt{constructor(e,t,r){super(new Float32Array(e),t,r)}},WQ=0,Ts=new Oe,fS=new dr,id=new P,ss=new ai,nm=new ai,Pi=new P,_t=class extends Xi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:WQ++}),this.uuid=Ws(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(m4(e)?pf:w4)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let r=this.attributes.normal;if(r!==void 0){let n=new zi().getNormalMatrix(e);r.applyNormalMatrix(n),r.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ts.makeRotationFromQuaternion(e),this.applyMatrix4(Ts),this}rotateX(e){return Ts.makeRotationX(e),this.applyMatrix4(Ts),this}rotateY(e){return Ts.makeRotationY(e),this.applyMatrix4(Ts),this}rotateZ(e){return Ts.makeRotationZ(e),this.applyMatrix4(Ts),this}translate(e,t,r){return Ts.makeTranslation(e,t,r),this.applyMatrix4(Ts),this}scale(e,t,r){return Ts.makeScale(e,t,r),this.applyMatrix4(Ts),this}lookAt(e){return fS.lookAt(e),fS.updateMatrix(),this.applyMatrix4(fS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(id).negate(),this.translate(id.x,id.y,id.z),this}setFromPoints(e){let t=[];for(let r=0,i=e.length;r<i;r++){let n=e[r];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new nt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ai);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){let n=t[r];ss.setFromBufferAttribute(n),this.morphTargetsRelative?(Pi.addVectors(this.boundingBox.min,ss.min),this.boundingBox.expandByPoint(Pi),Pi.addVectors(this.boundingBox.max,ss.max),this.boundingBox.expandByPoint(Pi)):(this.boundingBox.expandByPoint(ss.min),this.boundingBox.expandByPoint(ss.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ys);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new P,1/0);return}if(e){let r=this.boundingSphere.center;if(ss.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];nm.setFromBufferAttribute(a),this.morphTargetsRelative?(Pi.addVectors(ss.min,nm.min),ss.expandByPoint(Pi),Pi.addVectors(ss.max,nm.max),ss.expandByPoint(Pi)):(ss.expandByPoint(nm.min),ss.expandByPoint(nm.max))}ss.getCenter(r);let i=0;for(let n=0,s=e.count;n<s;n++)Pi.fromBufferAttribute(e,n),i=Math.max(i,r.distanceToSquared(Pi));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Pi.fromBufferAttribute(a,l),o&&(id.fromBufferAttribute(e,l),Pi.add(id)),i=Math.max(i,r.distanceToSquared(Pi))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=e.array,i=t.position.array,n=t.normal.array,s=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Mt(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],u=[];for(let T=0;T<a;T++)l[T]=new P,u[T]=new P;let h=new P,c=new P,d=new P,f=new J,p=new J,m=new J,g=new P,v=new P;function y(T,C,L){h.fromArray(i,T*3),c.fromArray(i,C*3),d.fromArray(i,L*3),f.fromArray(s,T*2),p.fromArray(s,C*2),m.fromArray(s,L*2),c.sub(h),d.sub(h),p.sub(f),m.sub(f);let I=1/(p.x*m.y-m.x*p.y);!isFinite(I)||(g.copy(c).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(I),v.copy(d).multiplyScalar(p.x).addScaledVector(c,-m.x).multiplyScalar(I),l[T].add(g),l[C].add(g),l[L].add(g),u[T].add(v),u[C].add(v),u[L].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:r.length}]);for(let T=0,C=x.length;T<C;++T){let L=x[T],I=L.start,k=L.count;for(let z=I,V=I+k;z<V;z+=3)y(r[z+0],r[z+1],r[z+2])}let w=new P,S=new P,_=new P,A=new P;function M(T){_.fromArray(n,T*3),A.copy(_);let C=l[T];w.copy(C),w.sub(_.multiplyScalar(_.dot(C))).normalize(),S.crossVectors(A,C);let L=S.dot(u[T])<0?-1:1;o[T*4]=w.x,o[T*4+1]=w.y,o[T*4+2]=w.z,o[T*4+3]=L}for(let T=0,C=x.length;T<C;++T){let L=x[T],I=L.start,k=L.count;for(let z=I,V=I+k;z<V;z+=3)M(r[z+0]),M(r[z+1]),M(r[z+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Mt(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let c=0,d=r.count;c<d;c++)r.setXYZ(c,0,0,0);let i=new P,n=new P,s=new P,a=new P,o=new P,l=new P,u=new P,h=new P;if(e)for(let c=0,d=e.count;c<d;c+=3){let f=e.getX(c+0),p=e.getX(c+1),m=e.getX(c+2);i.fromBufferAttribute(t,f),n.fromBufferAttribute(t,p),s.fromBufferAttribute(t,m),u.subVectors(s,n),h.subVectors(i,n),u.cross(h),a.fromBufferAttribute(r,f),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,m),a.add(u),o.add(u),l.add(u),r.setXYZ(f,a.x,a.y,a.z),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(m,l.x,l.y,l.z)}else for(let c=0,d=t.count;c<d;c+=3)i.fromBufferAttribute(t,c+0),n.fromBufferAttribute(t,c+1),s.fromBufferAttribute(t,c+2),u.subVectors(s,n),h.subVectors(i,n),u.cross(h),r.setXYZ(c+0,u.x,u.y,u.z),r.setXYZ(c+1,u.x,u.y,u.z),r.setXYZ(c+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Pi.fromBufferAttribute(e,t),Pi.normalize(),e.setXYZ(t,Pi.x,Pi.y,Pi.z)}toNonIndexed(){function e(a,o){let l=a.array,u=a.itemSize,h=a.normalized,c=new l.constructor(o.length*u),d=0,f=0;for(let p=0,m=o.length;p<m;p++){a.isInterleavedBufferAttribute?d=o[p]*a.data.stride+a.offset:d=o[p]*u;for(let g=0;g<u;g++)c[f++]=l[d++]}return new Mt(c,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new _t,r=this.index.array,i=this.attributes;for(let a in i){let o=i[a],l=e(o,r);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let u=0,h=l.length;u<h;u++){let c=l[u],d=e(c,r);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let r=this.attributes;for(let o in r){let l=r[o];e.data.attributes[o]=l.toJSON(e.data)}let i={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],u=[];for(let h=0,c=l.length;h<c;h++){let d=l[h];u.push(d.toJSON(e.data))}u.length>0&&(i[o]=u,n=!0)}n&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let r=e.index;r!==null&&this.setIndex(r.clone(t));let i=e.attributes;for(let l in i){let u=i[l];this.setAttribute(l,u.clone(t))}let n=e.morphAttributes;for(let l in n){let u=[],h=n[l];for(let c=0,d=h.length;c<d;c++)u.push(h[c].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,u=s.length;l<u;l++){let h=s[l];this.addGroup(h.start,h.count,h.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},RL=new Oe,nd=new pp,pS=new ys,sm=new P,am=new P,om=new P,mS=new P,X0=new P,$0=new J,Q0=new J,K0=new J,gS=new P,Z0=new P,Hn=class extends dr{constructor(e=new _t,t=new zv){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,n=r.length;i<n;i++){let s=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=i}}}}getVertexPosition(e,t){let r=this.geometry,i=r.attributes.position,n=r.morphAttributes.position,s=r.morphTargetsRelative;t.fromBufferAttribute(i,e);let a=this.morphTargetInfluences;if(n&&a){X0.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let u=a[o],h=n[o];u!==0&&(mS.fromBufferAttribute(h,e),s?X0.addScaledVector(mS,u):X0.addScaledVector(mS.sub(t),u))}t.add(X0)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;if(i===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),pS.copy(r.boundingSphere),pS.applyMatrix4(n),e.ray.intersectsSphere(pS)===!1)||(RL.copy(n).invert(),nd.copy(e.ray).applyMatrix4(RL),r.boundingBox!==null&&nd.intersectsBox(r.boundingBox)===!1))return;let s,a=r.index,o=r.attributes.position,l=r.attributes.uv,u=r.attributes.uv2,h=r.groups,c=r.drawRange;if(a!==null)if(Array.isArray(i))for(let d=0,f=h.length;d<f;d++){let p=h[d],m=i[p.materialIndex],g=Math.max(p.start,c.start),v=Math.min(a.count,Math.min(p.start+p.count,c.start+c.count));for(let y=g,x=v;y<x;y+=3){let w=a.getX(y),S=a.getX(y+1),_=a.getX(y+2);s=J0(this,m,e,nd,l,u,w,S,_),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else{let d=Math.max(0,c.start),f=Math.min(a.count,c.start+c.count);for(let p=d,m=f;p<m;p+=3){let g=a.getX(p),v=a.getX(p+1),y=a.getX(p+2);s=J0(this,i,e,nd,l,u,g,v,y),s&&(s.faceIndex=Math.floor(p/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(i))for(let d=0,f=h.length;d<f;d++){let p=h[d],m=i[p.materialIndex],g=Math.max(p.start,c.start),v=Math.min(o.count,Math.min(p.start+p.count,c.start+c.count));for(let y=g,x=v;y<x;y+=3){let w=y,S=y+1,_=y+2;s=J0(this,m,e,nd,l,u,w,S,_),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=p.materialIndex,t.push(s))}}else{let d=Math.max(0,c.start),f=Math.min(o.count,c.start+c.count);for(let p=d,m=f;p<m;p+=3){let g=p,v=p+1,y=p+2;s=J0(this,i,e,nd,l,u,g,v,y),s&&(s.faceIndex=Math.floor(p/3),t.push(s))}}}};function GQ(e,t,r,i,n,s,a,o){let l;if(t.side===ki?l=i.intersectTriangle(a,s,n,!0,o):l=i.intersectTriangle(n,s,a,t.side===Ca,o),l===null)return null;Z0.copy(o),Z0.applyMatrix4(e.matrixWorld);let u=r.ray.origin.distanceTo(Z0);return u<r.near||u>r.far?null:{distance:u,point:Z0.clone(),object:e}}function J0(e,t,r,i,n,s,a,o,l){e.getVertexPosition(a,sm),e.getVertexPosition(o,am),e.getVertexPosition(l,om);let u=GQ(e,t,r,i,sm,am,om,gS);if(u){n&&($0.fromBufferAttribute(n,a),Q0.fromBufferAttribute(n,o),K0.fromBufferAttribute(n,l),u.uv=nn.getUV(gS,sm,am,om,$0,Q0,K0,new J)),s&&($0.fromBufferAttribute(s,a),Q0.fromBufferAttribute(s,o),K0.fromBufferAttribute(s,l),u.uv2=nn.getUV(gS,sm,am,om,$0,Q0,K0,new J));let h={a,b:o,c:l,normal:new P,materialIndex:0};nn.getNormal(sm,am,om,h.normal),u.face=h}return u}var xo=class extends _t{constructor(e=1,t=1,r=1,i=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:s};let a=this;i=Math.floor(i),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],u=[],h=[],c=0,d=0;f("z","y","x",-1,-1,r,t,e,s,n,0),f("z","y","x",1,-1,r,t,-e,s,n,1),f("x","z","y",1,1,e,r,t,i,s,2),f("x","z","y",1,-1,e,r,-t,i,s,3),f("x","y","z",1,-1,e,t,r,i,n,4),f("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(o),this.setAttribute("position",new nt(l,3)),this.setAttribute("normal",new nt(u,3)),this.setAttribute("uv",new nt(h,2));function f(p,m,g,v,y,x,w,S,_,A,M){let T=x/_,C=w/A,L=x/2,I=w/2,k=S/2,z=_+1,V=A+1,K=0,q=0,O=new P;for(let W=0;W<V;W++){let N=W*C-I;for(let B=0;B<z;B++){let j=B*T-L;O[p]=j*v,O[m]=N*y,O[g]=k,l.push(O.x,O.y,O.z),O[p]=0,O[m]=0,O[g]=S>0?1:-1,u.push(O.x,O.y,O.z),h.push(B/_),h.push(1-W/A),K+=1}}for(let W=0;W<A;W++)for(let N=0;N<_;N++){let B=c+N+z*W,j=c+N+z*(W+1),Q=c+(N+1)+z*(W+1),H=c+(N+1)+z*W;o.push(B,j,H),o.push(j,Q,H),q+=6}a.addGroup(d,q,M),d+=q,c+=K}}static fromJSON(e){return new xo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Uf(e){let t={};for(let r in e){t[r]={};for(let i in e[r]){let n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}function xn(e){let t={};for(let r=0;r<e.length;r++){let i=Uf(e[r]);for(let n in i)t[n]=i[n]}return t}function YQ(e){let t=[];for(let r=0;r<e.length;r++)t.push(e[r].clone());return t}function b4(e){return e.getRenderTarget()===null&&e.outputEncoding===Ot?Ka:fx}var mp={clone:Uf,merge:xn},qQ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,XQ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,br=class extends kv{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=qQ,this.fragmentShader=XQ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Uf(e.uniforms),this.uniformsGroups=YQ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let i in this.uniforms){let n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let r={};for(let i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}},gp=class extends dr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Oe,this.projectionMatrix=new Oe,this.projectionMatrixInverse=new Oe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},rn=class extends gp{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=qg*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(ag*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return qg*2*Math.atan(Math.tan(ag*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(ag*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*i/o,t-=s.offsetY*r/l,i*=s.width/o,r*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},sd=-90,ad=1,$Q=class extends dr{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r;let i=new rn(sd,ad,e,t);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(1,0,0),this.add(i);let n=new rn(sd,ad,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new rn(sd,ad,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new rn(sd,ad,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new rn(sd,ad,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new rn(sd,ad,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let r=this.renderTarget,[i,n,s,a,o,l]=this.children,u=e.getRenderTarget(),h=e.toneMapping,c=e.xr.enabled;e.toneMapping=Al,e.xr.enabled=!1;let d=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,n),e.setRenderTarget(r,2),e.render(t,s),e.setRenderTarget(r,3),e.render(t,a),e.setRenderTarget(r,4),e.render(t,o),r.texture.generateMipmaps=d,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(u),e.toneMapping=h,e.xr.enabled=c,r.texture.needsPMREMUpdate=!0}},lD=class extends Mi{constructor(e,t,r,i,n,s,a,o,l,u){e=e!==void 0?e:[],t=t!==void 0?t:xh,super(e,t,r,i,n,s,a,o,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},QQ=class extends cr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new lD(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Bt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new xo(5,5,5),n=new br({name:"CubemapFromEquirect",uniforms:Uf(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ki,blending:pi});n.uniforms.tEquirect.value=t;let s=new Hn(i,n),a=t.minFilter;return t.minFilter===Bf&&(t.minFilter=Bt),new $Q(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,i){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(n)}},vS=new P,KQ=new P,ZQ=new zi,us=class{constructor(e=new P(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){let i=vS.subVectors(r,t).cross(KQ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let r=e.delta(vS),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:t.copy(r).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let r=t||ZQ.getNormalMatrix(e),i=this.coplanarPoint(vS).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},od=new ys,ey=new P,uD=class{constructor(e=new us,t=new us,r=new us,i=new us,n=new us,s=new us){this.planes=[e,t,r,i,n,s]}set(e,t,r,i,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){let t=this.planes,r=e.elements,i=r[0],n=r[1],s=r[2],a=r[3],o=r[4],l=r[5],u=r[6],h=r[7],c=r[8],d=r[9],f=r[10],p=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-i,h-o,p-c,y-m).normalize(),t[1].setComponents(a+i,h+o,p+c,y+m).normalize(),t[2].setComponents(a+n,h+l,p+d,y+g).normalize(),t[3].setComponents(a-n,h-l,p-d,y-g).normalize(),t[4].setComponents(a-s,h-u,p-f,y-v).normalize(),t[5].setComponents(a+s,h+u,p+f,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),od.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(od)}intersectsSprite(e){return od.center.set(0,0,0),od.radius=.7071067811865476,od.applyMatrix4(e.matrixWorld),this.intersectsSphere(od)}intersectsSphere(e){let t=this.planes,r=e.center,i=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let r=0;r<6;r++){let i=t[r];if(ey.x=i.normal.x>0?e.max.x:e.min.x,ey.y=i.normal.y>0?e.max.y:e.min.y,ey.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ey)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function _4(){let e=null,t=!1,r=null,i=null;function n(s,a){r(s,a),i=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&r!==null&&(i=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(s){r=s},setContext:function(s){e=s}}}function JQ(e,t){let r=t.isWebGL2,i=new WeakMap;function n(u,h){let c=u.array,d=u.usage,f=e.createBuffer();e.bindBuffer(h,f),e.bufferData(h,c,d),u.onUploadCallback();let p;if(c instanceof Float32Array)p=5126;else if(c instanceof Uint16Array)if(u.isFloat16BufferAttribute)if(r)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(c instanceof Int16Array)p=5122;else if(c instanceof Uint32Array)p=5125;else if(c instanceof Int32Array)p=5124;else if(c instanceof Int8Array)p=5120;else if(c instanceof Uint8Array)p=5121;else if(c instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:f,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:u.version}}function s(u,h,c){let d=h.array,f=h.updateRange;e.bindBuffer(c,u),f.count===-1?e.bufferSubData(c,0,d):(r?e.bufferSubData(c,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):e.bufferSubData(c,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),h.onUploadCallback()}function a(u){return u.isInterleavedBufferAttribute&&(u=u.data),i.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);let h=i.get(u);h&&(e.deleteBuffer(h.buffer),i.delete(u))}function l(u,h){if(u.isGLBufferAttribute){let d=i.get(u);(!d||d.version<u.version)&&i.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);let c=i.get(u);c===void 0?i.set(u,n(u,h)):c.version<u.version&&(s(c.buffer,u,h),c.version=u.version)}return{get:a,remove:o,update:l}}var qw=class extends _t{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};let n=e/2,s=t/2,a=Math.floor(r),o=Math.floor(i),l=a+1,u=o+1,h=e/a,c=t/o,d=[],f=[],p=[],m=[];for(let g=0;g<u;g++){let v=g*c-s;for(let y=0;y<l;y++){let x=y*h-n;f.push(x,-v,0),p.push(0,0,1),m.push(y/a),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let v=0;v<a;v++){let y=v+l*g,x=v+l*(g+1),w=v+1+l*(g+1),S=v+1+l*g;d.push(y,x,S),d.push(x,w,S)}this.setIndex(d),this.setAttribute("position",new nt(f,3)),this.setAttribute("normal",new nt(p,3)),this.setAttribute("uv",new nt(m,2))}static fromJSON(e){return new qw(e.width,e.height,e.widthSegments,e.heightSegments)}},eK=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,tK=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rK=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,iK=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,nK=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,sK=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,aK="vec3 transformed = vec3( position );",oK=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,lK=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,uK=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,cK=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,hK=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,dK=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,fK=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,pK=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,mK=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,gK=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,vK=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,yK=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,xK=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,wK=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bK=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,_K=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,SK=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,MK=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,EK=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,AK="gl_FragColor = linearToOutputTexel( gl_FragColor );",TK=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,CK=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,DK=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,PK=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,OK=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,LK=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,IK=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,RK=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,kK=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,zK=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,NK=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,BK=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,FK=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,UK=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,jK=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,HK=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,VK=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,WK=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,GK=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,YK=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,qK=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,XK=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,$K=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,QK=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,KK=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ZK=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,JK=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,eZ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,tZ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,rZ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,iZ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,nZ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,sZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,aZ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,oZ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,lZ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,uZ=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,cZ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,hZ=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,dZ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,fZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,pZ=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,mZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,gZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,vZ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,yZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,xZ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,wZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,bZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,_Z=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,SZ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,MZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,EZ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,AZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,TZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,CZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,DZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,PZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,OZ=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,LZ=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,IZ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,RZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,kZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,zZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,NZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,BZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,FZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,UZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,HZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,VZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,WZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,GZ=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,YZ=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,qZ=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,XZ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,$Z=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,QZ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,KZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,ZZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,JZ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,eJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,tJ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,rJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,iJ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,nJ=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,sJ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,aJ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,oJ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,lJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,uJ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cJ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,hJ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,dJ=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fJ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pJ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mJ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gJ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,vJ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yJ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,xJ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,wJ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bJ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_J=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,SJ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MJ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EJ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AJ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,TJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,CJ=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DJ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,PJ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,OJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Rt={alphamap_fragment:eK,alphamap_pars_fragment:tK,alphatest_fragment:rK,alphatest_pars_fragment:iK,aomap_fragment:nK,aomap_pars_fragment:sK,begin_vertex:aK,beginnormal_vertex:oK,bsdfs:lK,iridescence_fragment:uK,bumpmap_pars_fragment:cK,clipping_planes_fragment:hK,clipping_planes_pars_fragment:dK,clipping_planes_pars_vertex:fK,clipping_planes_vertex:pK,color_fragment:mK,color_pars_fragment:gK,color_pars_vertex:vK,color_vertex:yK,common:xK,cube_uv_reflection_fragment:wK,defaultnormal_vertex:bK,displacementmap_pars_vertex:_K,displacementmap_vertex:SK,emissivemap_fragment:MK,emissivemap_pars_fragment:EK,encodings_fragment:AK,encodings_pars_fragment:TK,envmap_fragment:CK,envmap_common_pars_fragment:DK,envmap_pars_fragment:PK,envmap_pars_vertex:OK,envmap_physical_pars_fragment:VK,envmap_vertex:LK,fog_vertex:IK,fog_pars_vertex:RK,fog_fragment:kK,fog_pars_fragment:zK,gradientmap_pars_fragment:NK,lightmap_fragment:BK,lightmap_pars_fragment:FK,lights_lambert_fragment:UK,lights_lambert_pars_fragment:jK,lights_pars_begin:HK,lights_toon_fragment:WK,lights_toon_pars_fragment:GK,lights_phong_fragment:YK,lights_phong_pars_fragment:qK,lights_physical_fragment:XK,lights_physical_pars_fragment:$K,lights_fragment_begin:QK,lights_fragment_maps:KK,lights_fragment_end:ZK,logdepthbuf_fragment:JK,logdepthbuf_pars_fragment:eZ,logdepthbuf_pars_vertex:tZ,logdepthbuf_vertex:rZ,map_fragment:iZ,map_pars_fragment:nZ,map_particle_fragment:sZ,map_particle_pars_fragment:aZ,metalnessmap_fragment:oZ,metalnessmap_pars_fragment:lZ,morphcolor_vertex:uZ,morphnormal_vertex:cZ,morphtarget_pars_vertex:hZ,morphtarget_vertex:dZ,normal_fragment_begin:fZ,normal_fragment_maps:pZ,normal_pars_fragment:mZ,normal_pars_vertex:gZ,normal_vertex:vZ,normalmap_pars_fragment:yZ,clearcoat_normal_fragment_begin:xZ,clearcoat_normal_fragment_maps:wZ,clearcoat_pars_fragment:bZ,iridescence_pars_fragment:_Z,output_fragment:SZ,packing:MZ,premultiplied_alpha_fragment:EZ,project_vertex:AZ,dithering_fragment:TZ,dithering_pars_fragment:CZ,roughnessmap_fragment:DZ,roughnessmap_pars_fragment:PZ,shadowmap_pars_fragment:OZ,shadowmap_pars_vertex:LZ,shadowmap_vertex:IZ,shadowmask_pars_fragment:RZ,skinbase_vertex:kZ,skinning_pars_vertex:zZ,skinning_vertex:NZ,skinnormal_vertex:BZ,specularmap_fragment:FZ,specularmap_pars_fragment:UZ,tonemapping_fragment:jZ,tonemapping_pars_fragment:HZ,transmission_fragment:VZ,transmission_pars_fragment:WZ,uv_pars_fragment:GZ,uv_pars_vertex:YZ,uv_vertex:qZ,uv2_pars_fragment:XZ,uv2_pars_vertex:$Z,uv2_vertex:QZ,worldpos_vertex:KZ,background_vert:ZZ,background_frag:JZ,backgroundCube_vert:eJ,backgroundCube_frag:tJ,cube_vert:rJ,cube_frag:iJ,depth_vert:nJ,depth_frag:sJ,distanceRGBA_vert:aJ,distanceRGBA_frag:oJ,equirect_vert:lJ,equirect_frag:uJ,linedashed_vert:cJ,linedashed_frag:hJ,meshbasic_vert:dJ,meshbasic_frag:fJ,meshlambert_vert:pJ,meshlambert_frag:mJ,meshmatcap_vert:gJ,meshmatcap_frag:vJ,meshnormal_vert:yJ,meshnormal_frag:xJ,meshphong_vert:wJ,meshphong_frag:bJ,meshphysical_vert:_J,meshphysical_frag:SJ,meshtoon_vert:MJ,meshtoon_frag:EJ,points_vert:AJ,points_frag:TJ,shadow_vert:CJ,shadow_frag:DJ,sprite_vert:PJ,sprite_frag:OJ},je={common:{diffuse:{value:new gt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new zi},uv2Transform:{value:new zi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new J(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new gt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new gt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zi}},sprite:{diffuse:{value:new gt(16777215)},opacity:{value:1},center:{value:new J(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new zi}}},Za={basic:{uniforms:xn([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.fog]),vertexShader:Rt.meshbasic_vert,fragmentShader:Rt.meshbasic_frag},lambert:{uniforms:xn([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new gt(0)}}]),vertexShader:Rt.meshlambert_vert,fragmentShader:Rt.meshlambert_frag},phong:{uniforms:xn([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new gt(0)},specular:{value:new gt(1118481)},shininess:{value:30}}]),vertexShader:Rt.meshphong_vert,fragmentShader:Rt.meshphong_frag},standard:{uniforms:xn([je.common,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.roughnessmap,je.metalnessmap,je.fog,je.lights,{emissive:{value:new gt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Rt.meshphysical_vert,fragmentShader:Rt.meshphysical_frag},toon:{uniforms:xn([je.common,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.gradientmap,je.fog,je.lights,{emissive:{value:new gt(0)}}]),vertexShader:Rt.meshtoon_vert,fragmentShader:Rt.meshtoon_frag},matcap:{uniforms:xn([je.common,je.bumpmap,je.normalmap,je.displacementmap,je.fog,{matcap:{value:null}}]),vertexShader:Rt.meshmatcap_vert,fragmentShader:Rt.meshmatcap_frag},points:{uniforms:xn([je.points,je.fog]),vertexShader:Rt.points_vert,fragmentShader:Rt.points_frag},dashed:{uniforms:xn([je.common,je.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Rt.linedashed_vert,fragmentShader:Rt.linedashed_frag},depth:{uniforms:xn([je.common,je.displacementmap]),vertexShader:Rt.depth_vert,fragmentShader:Rt.depth_frag},normal:{uniforms:xn([je.common,je.bumpmap,je.normalmap,je.displacementmap,{opacity:{value:1}}]),vertexShader:Rt.meshnormal_vert,fragmentShader:Rt.meshnormal_frag},sprite:{uniforms:xn([je.sprite,je.fog]),vertexShader:Rt.sprite_vert,fragmentShader:Rt.sprite_frag},background:{uniforms:{uvTransform:{value:new zi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Rt.background_vert,fragmentShader:Rt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Rt.backgroundCube_vert,fragmentShader:Rt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Rt.cube_vert,fragmentShader:Rt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Rt.equirect_vert,fragmentShader:Rt.equirect_frag},distanceRGBA:{uniforms:xn([je.common,je.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Rt.distanceRGBA_vert,fragmentShader:Rt.distanceRGBA_frag},shadow:{uniforms:xn([je.lights,je.fog,{color:{value:new gt(0)},opacity:{value:1}}]),vertexShader:Rt.shadow_vert,fragmentShader:Rt.shadow_frag}};Za.physical={uniforms:xn([Za.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new J(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new gt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new J},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new gt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new gt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Rt.meshphysical_vert,fragmentShader:Rt.meshphysical_frag};var ty={r:0,b:0,g:0};function LJ(e,t,r,i,n,s,a){let o=new gt(0),l=s===!0?0:1,u,h,c=null,d=0,f=null;function p(g,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?r:t).get(x));let w=e.xr,S=w.getSession&&w.getSession();S&&S.environmentBlendMode==="additive"&&(x=null),x===null?m(o,l):x&&x.isColor&&(m(x,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Rv)?(h===void 0&&(h=new Hn(new xo(1,1,1),new br({name:"BackgroundCubeMaterial",uniforms:Uf(Za.backgroundCube.uniforms),vertexShader:Za.backgroundCube.vertexShader,fragmentShader:Za.backgroundCube.fragmentShader,side:ki,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(_,A,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=x,h.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=x.encoding!==Ot,(c!==x||d!==x.version||f!==e.toneMapping)&&(h.material.needsUpdate=!0,c=x,d=x.version,f=e.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):x&&x.isTexture&&(u===void 0&&(u=new Hn(new qw(2,2),new br({name:"BackgroundMaterial",uniforms:Uf(Za.background.uniforms),vertexShader:Za.background.vertexShader,fragmentShader:Za.background.fragmentShader,side:Ca,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(u)),u.material.uniforms.t2D.value=x,u.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,u.material.toneMapped=x.encoding!==Ot,x.matrixAutoUpdate===!0&&x.updateMatrix(),u.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||d!==x.version||f!==e.toneMapping)&&(u.material.needsUpdate=!0,c=x,d=x.version,f=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null))}function m(g,v){g.getRGB(ty,b4(e)),i.buffers.color.setClear(ty.r,ty.g,ty.b,v,a)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),l=v,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:p}}function IJ(e,t,r,i){let n=e.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||s!==null,o={},l=g(null),u=l,h=!1;function c(z,V,K,q,O){let W=!1;if(a){let N=m(q,K,V);u!==N&&(u=N,f(u.object)),W=v(z,q,K,O),W&&y(z,q,K,O)}else{let N=V.wireframe===!0;(u.geometry!==q.id||u.program!==K.id||u.wireframe!==N)&&(u.geometry=q.id,u.program=K.id,u.wireframe=N,W=!0)}O!==null&&r.update(O,34963),(W||h)&&(h=!1,M(z,V,K,q),O!==null&&e.bindBuffer(34963,r.get(O).buffer))}function d(){return i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function f(z){return i.isWebGL2?e.bindVertexArray(z):s.bindVertexArrayOES(z)}function p(z){return i.isWebGL2?e.deleteVertexArray(z):s.deleteVertexArrayOES(z)}function m(z,V,K){let q=K.wireframe===!0,O=o[z.id];O===void 0&&(O={},o[z.id]=O);let W=O[V.id];W===void 0&&(W={},O[V.id]=W);let N=W[q];return N===void 0&&(N=g(d()),W[q]=N),N}function g(z){let V=[],K=[],q=[];for(let O=0;O<n;O++)V[O]=0,K[O]=0,q[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:K,attributeDivisors:q,object:z,attributes:{},index:null}}function v(z,V,K,q){let O=u.attributes,W=V.attributes,N=0,B=K.getAttributes();for(let j in B)if(B[j].location>=0){let Q=O[j],H=W[j];if(H===void 0&&(j==="instanceMatrix"&&z.instanceMatrix&&(H=z.instanceMatrix),j==="instanceColor"&&z.instanceColor&&(H=z.instanceColor)),Q===void 0||Q.attribute!==H||H&&Q.data!==H.data)return!0;N++}return u.attributesNum!==N||u.index!==q}function y(z,V,K,q){let O={},W=V.attributes,N=0,B=K.getAttributes();for(let j in B)if(B[j].location>=0){let Q=W[j];Q===void 0&&(j==="instanceMatrix"&&z.instanceMatrix&&(Q=z.instanceMatrix),j==="instanceColor"&&z.instanceColor&&(Q=z.instanceColor));let H={};H.attribute=Q,Q&&Q.data&&(H.data=Q.data),O[j]=H,N++}u.attributes=O,u.attributesNum=N,u.index=q}function x(){let z=u.newAttributes;for(let V=0,K=z.length;V<K;V++)z[V]=0}function w(z){S(z,0)}function S(z,V){let K=u.newAttributes,q=u.enabledAttributes,O=u.attributeDivisors;K[z]=1,q[z]===0&&(e.enableVertexAttribArray(z),q[z]=1),O[z]!==V&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](z,V),O[z]=V)}function _(){let z=u.newAttributes,V=u.enabledAttributes;for(let K=0,q=V.length;K<q;K++)V[K]!==z[K]&&(e.disableVertexAttribArray(K),V[K]=0)}function A(z,V,K,q,O,W){i.isWebGL2===!0&&(K===5124||K===5125)?e.vertexAttribIPointer(z,V,K,O,W):e.vertexAttribPointer(z,V,K,q,O,W)}function M(z,V,K,q){if(i.isWebGL2===!1&&(z.isInstancedMesh||q.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();let O=q.attributes,W=K.getAttributes(),N=V.defaultAttributeValues;for(let B in W){let j=W[B];if(j.location>=0){let Q=O[B];if(Q===void 0&&(B==="instanceMatrix"&&z.instanceMatrix&&(Q=z.instanceMatrix),B==="instanceColor"&&z.instanceColor&&(Q=z.instanceColor)),Q!==void 0){let H=Q.normalized,G=Q.itemSize,$=r.get(Q);if($===void 0)continue;let se=$.buffer,re=$.type,ae=$.bytesPerElement;if(Q.isInterleavedBufferAttribute){let ce=Q.data,me=ce.stride,be=Q.offset;if(ce.isInstancedInterleavedBuffer){for(let Ae=0;Ae<j.locationSize;Ae++)S(j.location+Ae,ce.meshPerAttribute);z.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let Ae=0;Ae<j.locationSize;Ae++)w(j.location+Ae);e.bindBuffer(34962,se);for(let Ae=0;Ae<j.locationSize;Ae++)A(j.location+Ae,G/j.locationSize,re,H,me*ae,(be+G/j.locationSize*Ae)*ae)}else{if(Q.isInstancedBufferAttribute){for(let ce=0;ce<j.locationSize;ce++)S(j.location+ce,Q.meshPerAttribute);z.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let ce=0;ce<j.locationSize;ce++)w(j.location+ce);e.bindBuffer(34962,se);for(let ce=0;ce<j.locationSize;ce++)A(j.location+ce,G/j.locationSize,re,H,G*ae,G/j.locationSize*ce*ae)}}else if(N!==void 0){let H=N[B];if(H!==void 0)switch(H.length){case 2:e.vertexAttrib2fv(j.location,H);break;case 3:e.vertexAttrib3fv(j.location,H);break;case 4:e.vertexAttrib4fv(j.location,H);break;default:e.vertexAttrib1fv(j.location,H)}}}}_()}function T(){I();for(let z in o){let V=o[z];for(let K in V){let q=V[K];for(let O in q)p(q[O].object),delete q[O];delete V[K]}delete o[z]}}function C(z){if(o[z.id]===void 0)return;let V=o[z.id];for(let K in V){let q=V[K];for(let O in q)p(q[O].object),delete q[O];delete V[K]}delete o[z.id]}function L(z){for(let V in o){let K=o[V];if(K[z.id]===void 0)continue;let q=K[z.id];for(let O in q)p(q[O].object),delete q[O];delete K[z.id]}}function I(){k(),h=!0,u!==l&&(u=l,f(u.object))}function k(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:c,reset:I,resetDefaultState:k,dispose:T,releaseStatesOfGeometry:C,releaseStatesOfProgram:L,initAttributes:x,enableAttribute:w,disableUnusedAttributes:_}}function RJ(e,t,r,i){let n=i.isWebGL2,s;function a(u){s=u}function o(u,h){e.drawArrays(s,u,h),r.update(h,s,1)}function l(u,h,c){if(c===0)return;let d,f;if(n)d=e,f="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,u,h,c),r.update(h,s,c)}this.setMode=a,this.render=o,this.renderInstances=l}function kJ(e,t,r){let i;function n(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){let A=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(A){if(A==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=r.precision!==void 0?r.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let u=a||t.has("WEBGL_draw_buffers"),h=r.logarithmicDepthBuffer===!0,c=e.getParameter(34930),d=e.getParameter(35660),f=e.getParameter(3379),p=e.getParameter(34076),m=e.getParameter(34921),g=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),x=d>0,w=a||t.has("OES_texture_float"),S=x&&w,_=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:S,maxSamples:_}}function zJ(e){let t=this,r=null,i=0,n=!1,s=!1,a=new us,o=new zi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(c,d){let f=c.length!==0||d||i!==0||n;return n=d,i=c.length,f},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(c,d){r=h(c,d,0)},this.setState=function(c,d,f){let p=c.clippingPlanes,m=c.clipIntersection,g=c.clipShadows,v=e.get(c);if(!n||p===null||p.length===0||s&&!g)s?h(null):u();else{let y=s?0:i,x=y*4,w=v.clippingState||null;l.value=w,w=h(p,d,x,f);for(let S=0;S!==x;++S)w[S]=r[S];v.clippingState=w,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function u(){l.value!==r&&(l.value=r,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function h(c,d,f,p){let m=c!==null?c.length:0,g=null;if(m!==0){if(g=l.value,p!==!0||g===null){let v=f+m*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,w=f;x!==m;++x,w+=4)a.copy(c[x]).applyMatrix4(y,o),a.normal.toArray(g,w),g[w+3]=a.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}}function NJ(e){let t=new WeakMap;function r(a,o){return o===QE?a.mapping=xh:o===KE&&(a.mapping=wh),a}function i(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===QE||o===KE)if(t.has(a)){let l=t.get(a).texture;return r(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let u=new QQ(l.height/2);return u.fromEquirectangularTexture(e,a),t.set(a,u),a.addEventListener("dispose",n),r(u.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:i,dispose:s}}var cD=class extends gp{constructor(e=-1,t=1,r=1,i=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,s=r+e,a=i+t,o=i-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=u*this.view.offsetY,o=a-u*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Zd=4,kL=[.125,.215,.35,.446,.526,.582],Fc=20,yS=new cD,zL=new gt,xS=null,Ic=(1+Math.sqrt(5))/2,ld=1/Ic,NL=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,Ic,ld),new P(0,Ic,-ld),new P(ld,0,Ic),new P(-ld,0,Ic),new P(Ic,ld,0),new P(-Ic,ld,0)],BL=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){xS=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,r,i,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=jL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=UL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xS),e.scissorTest=!1,ry(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===xh||e.mapping===wh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xS=this._renderer.getRenderTarget();let r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Bt,minFilter:Bt,generateMipmaps:!1,type:Ff,format:Us,encoding:yo,depthBuffer:!1},i=FL(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=FL(e,t,r);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=BJ(n)),this._blurMaterial=FJ(n,e,t)}return i}_compileMaterial(e){let t=new Hn(this._lodPlanes[0],e);this._renderer.compile(t,yS)}_sceneToCubeUV(e,t,r,i){let n=new rn(90,1,t,r),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,u=o.toneMapping;o.getClearColor(zL),o.toneMapping=Al,o.autoClear=!1;let h=new zv({name:"PMREM.Background",side:ki,depthWrite:!1,depthTest:!1}),c=new Hn(new xo,h),d=!1,f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,d=!0):(h.color.copy(zL),d=!0);for(let p=0;p<6;p++){let m=p%3;m===0?(n.up.set(0,s[p],0),n.lookAt(a[p],0,0)):m===1?(n.up.set(0,0,s[p]),n.lookAt(0,a[p],0)):(n.up.set(0,s[p],0),n.lookAt(0,0,a[p]));let g=this._cubeSize;ry(i,m*g,p>2?g:0,g,g),o.setRenderTarget(i),d&&o.render(c,n),o.render(e,n)}c.geometry.dispose(),c.material.dispose(),o.toneMapping=u,o.autoClear=l,e.background=f}_textureToCubeUV(e,t){let r=this._renderer,i=e.mapping===xh||e.mapping===wh;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=jL()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=UL());let n=i?this._cubemapMaterial:this._equirectMaterial,s=new Hn(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;ry(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(s,yS)}_applyPMREM(e){let t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){let n=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),s=NL[(i-1)%NL.length];this._blur(e,i-1,i,n,s)}t.autoClear=r}_blur(e,t,r,i,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",n),this._halfBlur(s,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,h=new Hn(this._lodPlanes[i],l),c=l.uniforms,d=this._sizeLods[r]-1,f=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Fc-1),p=n/f,m=isFinite(n)?1+Math.floor(u*p):Fc;m>Fc&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Fc}`);let g=[],v=0;for(let _=0;_<Fc;++_){let A=_/p,M=Math.exp(-A*A/2);g.push(M),_===0?v+=M:_<m&&(v+=2*M)}for(let _=0;_<g.length;_++)g[_]=g[_]/v;c.envMap.value=e.texture,c.samples.value=m,c.weights.value=g,c.latitudinal.value=s==="latitudinal",a&&(c.poleAxis.value=a);let{_lodMax:y}=this;c.dTheta.value=f,c.mipInt.value=y-r;let x=this._sizeLods[i],w=3*x*(i>y-Zd?i-y+Zd:0),S=4*(this._cubeSize-x);ry(t,w,S,3*x,2*x),o.setRenderTarget(t),o.render(h,yS)}};function BJ(e){let t=[],r=[],i=[],n=e,s=e-Zd+1+kL.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);r.push(o);let l=1/o;a>e-Zd?l=kL[a-e+Zd-1]:a===0&&(l=0),i.push(l);let u=1/(o-2),h=-u,c=1+u,d=[h,h,c,h,c,c,h,h,c,c,h,c],f=6,p=6,m=3,g=2,v=1,y=new Float32Array(m*p*f),x=new Float32Array(g*p*f),w=new Float32Array(v*p*f);for(let _=0;_<f;_++){let A=_%3*2/3-1,M=_>2?0:-1,T=[A,M,0,A+2/3,M,0,A+2/3,M+1,0,A,M,0,A+2/3,M+1,0,A,M+1,0];y.set(T,m*p*_),x.set(d,g*p*_);let C=[_,_,_,_,_,_];w.set(C,v*p*_)}let S=new _t;S.setAttribute("position",new Mt(y,m)),S.setAttribute("uv",new Mt(x,g)),S.setAttribute("faceIndex",new Mt(w,v)),t.push(S),n>Zd&&n--}return{lodPlanes:t,sizeLods:r,sigmas:i}}function FL(e,t,r){let i=new cr(e,t,r);return i.texture.mapping=Rv,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ry(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function FJ(e,t,r){let i=new Float32Array(Fc),n=new P(0,1,0);return new br({name:"SphericalGaussianBlur",defines:{n:Fc,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/r,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:hD(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:pi,depthTest:!1,depthWrite:!1})}function UL(){return new br({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:hD(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:pi,depthTest:!1,depthWrite:!1})}function jL(){return new br({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:hD(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:pi,depthTest:!1,depthWrite:!1})}function hD(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function UJ(e){let t=new WeakMap,r=null;function i(o){if(o&&o.isTexture){let l=o.mapping,u=l===QE||l===KE,h=l===xh||l===wh;if(u||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let c=t.get(o);return r===null&&(r=new BL(e)),c=u?r.fromEquirectangular(o,c):r.fromCubemap(o,c),t.set(o,c),c.texture}else{if(t.has(o))return t.get(o).texture;{let c=o.image;if(u&&c&&c.height>0||h&&c&&n(c)){r===null&&(r=new BL(e));let d=u?r.fromEquirectangular(o):r.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,u=6;for(let h=0;h<u;h++)o[h]!==void 0&&l++;return l===u}function s(o){let l=o.target;l.removeEventListener("dispose",s);let u=t.get(l);u!==void 0&&(t.delete(l),u.dispose())}function a(){t=new WeakMap,r!==null&&(r.dispose(),r=null)}return{get:i,dispose:a}}function jJ(e){let t={};function r(i){if(t[i]!==void 0)return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(i){return r(i)!==null},init:function(i){i.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(i){let n=r(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function HJ(e,t,r,i){let n={},s=new WeakMap;function a(c){let d=c.target;d.index!==null&&t.remove(d.index);for(let p in d.attributes)t.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];let f=s.get(d);f&&(t.remove(f),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,r.memory.geometries--}function o(c,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,r.memory.geometries++),d}function l(c){let d=c.attributes;for(let p in d)t.update(d[p],34962);let f=c.morphAttributes;for(let p in f){let m=f[p];for(let g=0,v=m.length;g<v;g++)t.update(m[g],34962)}}function u(c){let d=[],f=c.index,p=c.attributes.position,m=0;if(f!==null){let y=f.array;m=f.version;for(let x=0,w=y.length;x<w;x+=3){let S=y[x+0],_=y[x+1],A=y[x+2];d.push(S,_,_,A,A,S)}}else{let y=p.array;m=p.version;for(let x=0,w=y.length/3-1;x<w;x+=3){let S=x+0,_=x+1,A=x+2;d.push(S,_,_,A,A,S)}}let g=new(m4(d)?pf:w4)(d,1);g.version=m;let v=s.get(c);v&&t.remove(v),s.set(c,g)}function h(c){let d=s.get(c);if(d){let f=c.index;f!==null&&d.version<f.version&&u(c)}else u(c);return s.get(c)}return{get:o,update:l,getWireframeAttribute:h}}function VJ(e,t,r,i){let n=i.isWebGL2,s;function a(d){s=d}let o,l;function u(d){o=d.type,l=d.bytesPerElement}function h(d,f){e.drawElements(s,f,o,d*l),r.update(f,s,1)}function c(d,f,p){if(p===0)return;let m,g;if(n)m=e,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](s,f,o,d*l,p),r.update(f,s,p)}this.setMode=a,this.setIndex=u,this.render=h,this.renderInstances=c}function WJ(e){let t={geometries:0,textures:0},r={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(r.calls++,a){case 4:r.triangles+=o*(s/3);break;case 1:r.lines+=o*(s/2);break;case 3:r.lines+=o*(s-1);break;case 2:r.lines+=o*s;break;case 0:r.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0}return{memory:t,render:r,programs:null,autoReset:!0,reset:n,update:i}}function GJ(e,t){return e[0]-t[0]}function YJ(e,t){return Math.abs(t[1])-Math.abs(e[1])}function qJ(e,t,r){let i={},n=new Float32Array(8),s=new WeakMap,a=new Lt,o=[];for(let u=0;u<8;u++)o[u]=[u,0];function l(u,h,c,d){let f=u.morphTargetInfluences;if(t.isWebGL2===!0){let p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=p!==void 0?p.length:0,g=s.get(h);if(g===void 0||g.count!==m){let x=function(){z.dispose(),s.delete(h),h.removeEventListener("dispose",x)};g!==void 0&&g.texture.dispose();let w=h.morphAttributes.position!==void 0,S=h.morphAttributes.normal!==void 0,_=h.morphAttributes.color!==void 0,A=h.morphAttributes.position||[],M=h.morphAttributes.normal||[],T=h.morphAttributes.color||[],C=0;w===!0&&(C=1),S===!0&&(C=2),_===!0&&(C=3);let L=h.attributes.position.count*C,I=1;L>t.maxTextureSize&&(I=Math.ceil(L/t.maxTextureSize),L=t.maxTextureSize);let k=new Float32Array(L*I*4*m),z=new x4(k,L,I,m);z.type=fs,z.needsUpdate=!0;let V=C*4;for(let K=0;K<m;K++){let q=A[K],O=M[K],W=T[K],N=L*I*4*K;for(let B=0;B<q.count;B++){let j=B*V;w===!0&&(a.fromBufferAttribute(q,B),k[N+j+0]=a.x,k[N+j+1]=a.y,k[N+j+2]=a.z,k[N+j+3]=0),S===!0&&(a.fromBufferAttribute(O,B),k[N+j+4]=a.x,k[N+j+5]=a.y,k[N+j+6]=a.z,k[N+j+7]=0),_===!0&&(a.fromBufferAttribute(W,B),k[N+j+8]=a.x,k[N+j+9]=a.y,k[N+j+10]=a.z,k[N+j+11]=W.itemSize===4?a.w:1)}}g={count:m,texture:z,size:new J(L,I)},s.set(h,g),h.addEventListener("dispose",x)}let v=0;for(let x=0;x<f.length;x++)v+=f[x];let y=h.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",f),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,r),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let p=f===void 0?0:f.length,m=i[h.id];if(m===void 0||m.length!==p){m=[];for(let w=0;w<p;w++)m[w]=[w,0];i[h.id]=m}for(let w=0;w<p;w++){let S=m[w];S[0]=w,S[1]=f[w]}m.sort(YJ);for(let w=0;w<8;w++)w<p&&m[w][1]?(o[w][0]=m[w][0],o[w][1]=m[w][1]):(o[w][0]=Number.MAX_SAFE_INTEGER,o[w][1]=0);o.sort(GJ);let g=h.morphAttributes.position,v=h.morphAttributes.normal,y=0;for(let w=0;w<8;w++){let S=o[w],_=S[0],A=S[1];_!==Number.MAX_SAFE_INTEGER&&A?(g&&h.getAttribute("morphTarget"+w)!==g[_]&&h.setAttribute("morphTarget"+w,g[_]),v&&h.getAttribute("morphNormal"+w)!==v[_]&&h.setAttribute("morphNormal"+w,v[_]),n[w]=A,y+=A):(g&&h.hasAttribute("morphTarget"+w)===!0&&h.deleteAttribute("morphTarget"+w),v&&h.hasAttribute("morphNormal"+w)===!0&&h.deleteAttribute("morphNormal"+w),n[w]=0)}let x=h.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function XJ(e,t,r,i){let n=new WeakMap;function s(l){let u=i.render.frame,h=l.geometry,c=t.get(l,h);return n.get(c)!==u&&(t.update(c),n.set(c,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),r.update(l.instanceMatrix,34962),l.instanceColor!==null&&r.update(l.instanceColor,34962)),c}function a(){n=new WeakMap}function o(l){let u=l.target;u.removeEventListener("dispose",o),r.remove(u.instanceMatrix),u.instanceColor!==null&&r.remove(u.instanceColor)}return{update:s,dispose:a}}var S4=new Mi,M4=new x4,E4=new RQ,A4=new lD,HL=[],VL=[],WL=new Float32Array(16),GL=new Float32Array(9),YL=new Float32Array(4);function vp(e,t,r){let i=e[0];if(i<=0||i>0)return e;let n=t*r,s=HL[n];if(s===void 0&&(s=new Float32Array(n),HL[n]=s),t!==0){i.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=r,e[a].toArray(s,o)}return s}function Ti(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function Ci(e,t){for(let r=0,i=t.length;r<i;r++)e[r]=t[r]}function Xw(e,t){let r=VL[t];r===void 0&&(r=new Int32Array(t),VL[t]=r);for(let i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function $J(e,t){let r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function QJ(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Ti(r,t))return;e.uniform2fv(this.addr,t),Ci(r,t)}}function KJ(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(t.r!==void 0)(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Ti(r,t))return;e.uniform3fv(this.addr,t),Ci(r,t)}}function ZJ(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Ti(r,t))return;e.uniform4fv(this.addr,t),Ci(r,t)}}function JJ(e,t){let r=this.cache,i=t.elements;if(i===void 0){if(Ti(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ci(r,t)}else{if(Ti(r,i))return;YL.set(i),e.uniformMatrix2fv(this.addr,!1,YL),Ci(r,i)}}function eee(e,t){let r=this.cache,i=t.elements;if(i===void 0){if(Ti(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ci(r,t)}else{if(Ti(r,i))return;GL.set(i),e.uniformMatrix3fv(this.addr,!1,GL),Ci(r,i)}}function tee(e,t){let r=this.cache,i=t.elements;if(i===void 0){if(Ti(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ci(r,t)}else{if(Ti(r,i))return;WL.set(i),e.uniformMatrix4fv(this.addr,!1,WL),Ci(r,i)}}function ree(e,t){let r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function iee(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Ti(r,t))return;e.uniform2iv(this.addr,t),Ci(r,t)}}function nee(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(Ti(r,t))return;e.uniform3iv(this.addr,t),Ci(r,t)}}function see(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Ti(r,t))return;e.uniform4iv(this.addr,t),Ci(r,t)}}function aee(e,t){let r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function oee(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Ti(r,t))return;e.uniform2uiv(this.addr,t),Ci(r,t)}}function lee(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(Ti(r,t))return;e.uniform3uiv(this.addr,t),Ci(r,t)}}function uee(e,t){let r=this.cache;if(t.x!==void 0)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Ti(r,t))return;e.uniform4uiv(this.addr,t),Ci(r,t)}}function cee(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||S4,n)}function hee(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||E4,n)}function dee(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||A4,n)}function fee(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||M4,n)}function pee(e){switch(e){case 5126:return $J;case 35664:return QJ;case 35665:return KJ;case 35666:return ZJ;case 35674:return JJ;case 35675:return eee;case 35676:return tee;case 5124:case 35670:return ree;case 35667:case 35671:return iee;case 35668:case 35672:return nee;case 35669:case 35673:return see;case 5125:return aee;case 36294:return oee;case 36295:return lee;case 36296:return uee;case 35678:case 36198:case 36298:case 36306:case 35682:return cee;case 35679:case 36299:case 36307:return hee;case 35680:case 36300:case 36308:case 36293:return dee;case 36289:case 36303:case 36311:case 36292:return fee}}function mee(e,t){e.uniform1fv(this.addr,t)}function gee(e,t){let r=vp(t,this.size,2);e.uniform2fv(this.addr,r)}function vee(e,t){let r=vp(t,this.size,3);e.uniform3fv(this.addr,r)}function yee(e,t){let r=vp(t,this.size,4);e.uniform4fv(this.addr,r)}function xee(e,t){let r=vp(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function wee(e,t){let r=vp(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function bee(e,t){let r=vp(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function _ee(e,t){e.uniform1iv(this.addr,t)}function See(e,t){e.uniform2iv(this.addr,t)}function Mee(e,t){e.uniform3iv(this.addr,t)}function Eee(e,t){e.uniform4iv(this.addr,t)}function Aee(e,t){e.uniform1uiv(this.addr,t)}function Tee(e,t){e.uniform2uiv(this.addr,t)}function Cee(e,t){e.uniform3uiv(this.addr,t)}function Dee(e,t){e.uniform4uiv(this.addr,t)}function Pee(e,t,r){let i=this.cache,n=t.length,s=Xw(r,n);Ti(i,s)||(e.uniform1iv(this.addr,s),Ci(i,s));for(let a=0;a!==n;++a)r.setTexture2D(t[a]||S4,s[a])}function Oee(e,t,r){let i=this.cache,n=t.length,s=Xw(r,n);Ti(i,s)||(e.uniform1iv(this.addr,s),Ci(i,s));for(let a=0;a!==n;++a)r.setTexture3D(t[a]||E4,s[a])}function Lee(e,t,r){let i=this.cache,n=t.length,s=Xw(r,n);Ti(i,s)||(e.uniform1iv(this.addr,s),Ci(i,s));for(let a=0;a!==n;++a)r.setTextureCube(t[a]||A4,s[a])}function Iee(e,t,r){let i=this.cache,n=t.length,s=Xw(r,n);Ti(i,s)||(e.uniform1iv(this.addr,s),Ci(i,s));for(let a=0;a!==n;++a)r.setTexture2DArray(t[a]||M4,s[a])}function Ree(e){switch(e){case 5126:return mee;case 35664:return gee;case 35665:return vee;case 35666:return yee;case 35674:return xee;case 35675:return wee;case 35676:return bee;case 5124:case 35670:return _ee;case 35667:case 35671:return See;case 35668:case 35672:return Mee;case 35669:case 35673:return Eee;case 5125:return Aee;case 36294:return Tee;case 36295:return Cee;case 36296:return Dee;case 35678:case 36198:case 36298:case 36306:case 35682:return Pee;case 35679:case 36299:case 36307:return Oee;case 35680:case 36300:case 36308:case 36293:return Lee;case 36289:case 36303:case 36311:case 36292:return Iee}}var kee=class{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=pee(t.type)}},zee=class{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=Ree(t.type)}},Nee=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){let i=this.seq;for(let n=0,s=i.length;n!==s;++n){let a=i[n];a.setValue(e,t[a.id],r)}}},wS=/(\w+)(\])?(\[|\.)?/g;function qL(e,t){e.seq.push(t),e.map[t.id]=t}function Bee(e,t,r){let i=e.name,n=i.length;for(wS.lastIndex=0;;){let s=wS.exec(i),a=wS.lastIndex,o=s[1],l=s[2]==="]",u=s[3];if(l&&(o=o|0),u===void 0||u==="["&&a+2===n){qL(r,u===void 0?new kee(o,e,t):new zee(o,e,t));break}else{let h=r.map[o];h===void 0&&(h=new Nee(o),qL(r,h)),r=h}}}var w1=class{constructor(e,t){this.seq=[],this.map={};let r=e.getProgramParameter(t,35718);for(let i=0;i<r;++i){let n=e.getActiveUniform(t,i),s=e.getUniformLocation(t,n.name);Bee(n,s,this)}}setValue(e,t,r,i){let n=this.map[t];n!==void 0&&n.setValue(e,r,i)}setOptional(e,t,r){let i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=r[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,i)}}static seqWithValue(e,t){let r=[];for(let i=0,n=e.length;i!==n;++i){let s=e[i];s.id in t&&r.push(s)}return r}};function XL(e,t,r){let i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}var Fee=0;function Uee(e,t){let r=e.split(`
`),i=[],n=Math.max(t-6,0),s=Math.min(t+6,r.length);for(let a=n;a<s;a++){let o=a+1;i.push(`${o===t?">":" "} ${o}: ${r[a]}`)}return i.join(`
`)}function jee(e){switch(e){case yo:return["Linear","( value )"];case Ot:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function $L(e,t,r){let i=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(i&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return r.toUpperCase()+`

`+n+`

`+Uee(e.getShaderSource(t),a)}else return n}function Hee(e,t){let r=jee(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function Vee(e,t){let r;switch(t){case $$:r="Linear";break;case Q$:r="Reinhard";break;case K$:r="OptimizedCineon";break;case Z$:r="ACESFilmic";break;case J$:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Wee(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(jm).join(`
`)}function Gee(e){let t=[];for(let r in e){let i=e[r];i!==!1&&t.push("#define "+r+" "+i)}return t.join(`
`)}function Yee(e,t){let r={},i=e.getProgramParameter(t,35721);for(let n=0;n<i;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),r[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return r}function jm(e){return e!==""}function QL(e,t){let r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function KL(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var qee=/^[ \t]*#include +<([\w\d./]+)>/gm;function rA(e){return e.replace(qee,Xee)}function Xee(e,t){let r=Rt[t];if(r===void 0)throw new Error("Can not resolve #include <"+t+">");return rA(r)}var $ee=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ZL(e){return e.replace($ee,Qee)}function Qee(e,t,r,i){let n="";for(let s=parseInt(t);s<parseInt(r);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function JL(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Kee(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===iD?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===T$?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Um&&(t="SHADOWMAP_TYPE_VSM"),t}function Zee(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case xh:case wh:t="ENVMAP_TYPE_CUBE";break;case Rv:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Jee(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case wh:t="ENVMAP_MODE_REFRACTION";break}return t}function ete(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case o4:t="ENVMAP_BLENDING_MULTIPLY";break;case q$:t="ENVMAP_BLENDING_MIX";break;case X$:t="ENVMAP_BLENDING_ADD";break}return t}function tte(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let r=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,r),7*16)),texelHeight:i,maxMip:r}}function rte(e,t,r,i){let n=e.getContext(),s=r.defines,a=r.vertexShader,o=r.fragmentShader,l=Kee(r),u=Zee(r),h=Jee(r),c=ete(r),d=tte(r),f=r.isWebGL2?"":Wee(r),p=Gee(s),m=n.createProgram(),g,v,y=r.glslVersion?"#version "+r.glslVersion+`
`:"";r.isRawShaderMaterial?(g=[p].filter(jm).join(`
`),g.length>0&&(g+=`
`),v=[f,p].filter(jm).join(`
`),v.length>0&&(v+=`
`)):(g=[JL(r),"#define SHADER_NAME "+r.shaderName,p,r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+h:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&r.flatShading===!1?"#define USE_MORPHNORMALS":"",r.morphColors&&r.isWebGL2?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(jm).join(`
`),v=[f,JL(r),"#define SHADER_NAME "+r.shaderName,p,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.envMap?"#define "+h:"",r.envMap?"#define "+c:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",r.specularColorMap?"#define USE_SPECULARCOLORMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEENCOLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+l:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==Al?"#define TONE_MAPPING":"",r.toneMapping!==Al?Rt.tonemapping_pars_fragment:"",r.toneMapping!==Al?Vee("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",Rt.encodings_pars_fragment,Hee("linearToOutputTexel",r.outputEncoding),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"",`
`].filter(jm).join(`
`)),a=rA(a),a=QL(a,r),a=KL(a,r),o=rA(o),o=QL(o,r),o=KL(o,r),a=ZL(a),o=ZL(o),r.isWebGL2&&r.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",r.glslVersion===SL?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===SL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+g+a,w=y+v+o,S=XL(n,35633,x),_=XL(n,35632,w);if(n.attachShader(m,S),n.attachShader(m,_),r.index0AttributeName!==void 0?n.bindAttribLocation(m,0,r.index0AttributeName):r.morphTargets===!0&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),e.debug.checkShaderErrors){let T=n.getProgramInfoLog(m).trim(),C=n.getShaderInfoLog(S).trim(),L=n.getShaderInfoLog(_).trim(),I=!0,k=!0;if(n.getProgramParameter(m,35714)===!1){I=!1;let z=$L(n,S,"vertex"),V=$L(n,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,35715)+`

Program Info Log: `+T+`
`+z+`
`+V)}else T!==""?console.warn("THREE.WebGLProgram: Program Info Log:",T):(C===""||L==="")&&(k=!1);k&&(this.diagnostics={runnable:I,programLog:T,vertexShader:{log:C,prefix:g},fragmentShader:{log:L,prefix:v}})}n.deleteShader(S),n.deleteShader(_);let A;this.getUniforms=function(){return A===void 0&&(A=new w1(n,m)),A};let M;return this.getAttributes=function(){return M===void 0&&(M=Yee(n,m)),M},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.name=r.shaderName,this.id=Fee++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=S,this.fragmentShader=_,this}var ite=0,nte=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),n=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){let t=this.shaderCache,r=t.get(e);return r===void 0&&(r=new ste(e),t.set(e,r)),r}},ste=class{constructor(e){this.id=ite++,this.code=e,this.usedTimes=0}};function ate(e,t,r,i,n,s,a){let o=new oD,l=new nte,u=[],h=n.isWebGL2,c=n.logarithmicDepthBuffer,d=n.vertexTextures,f=n.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(M,T,C,L,I){let k=L.fog,z=I.geometry,V=M.isMeshStandardMaterial?L.environment:null,K=(M.isMeshStandardMaterial?r:t).get(M.envMap||V),q=K&&K.mapping===Rv?K.image.height:null,O=p[M.type];M.precision!==null&&(f=n.getMaxPrecision(M.precision),f!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",f,"instead."));let W=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,N=W!==void 0?W.length:0,B=0;z.morphAttributes.position!==void 0&&(B=1),z.morphAttributes.normal!==void 0&&(B=2),z.morphAttributes.color!==void 0&&(B=3);let j,Q,H,G;if(O){let ce=Za[O];j=ce.vertexShader,Q=ce.fragmentShader}else j=M.vertexShader,Q=M.fragmentShader,l.update(M),H=l.getVertexShaderID(M),G=l.getFragmentShaderID(M);let $=e.getRenderTarget(),se=M.alphaTest>0,re=M.clearcoat>0,ae=M.iridescence>0;return{isWebGL2:h,shaderID:O,shaderName:M.type,vertexShader:j,fragmentShader:Q,defines:M.defines,customVertexShaderID:H,customFragmentShaderID:G,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:f,instancing:I.isInstancedMesh===!0,instancingColor:I.isInstancedMesh===!0&&I.instanceColor!==null,supportsVertexTextures:d,outputEncoding:$===null?e.outputEncoding:$.isXRRenderTarget===!0?$.texture.encoding:yo,map:!!M.map,matcap:!!M.matcap,envMap:!!K,envMapMode:K&&K.mapping,envMapCubeUVHeight:q,lightMap:!!M.lightMap,aoMap:!!M.aoMap,emissiveMap:!!M.emissiveMap,bumpMap:!!M.bumpMap,normalMap:!!M.normalMap,objectSpaceNormalMap:M.normalMapType===vQ,tangentSpaceNormalMap:M.normalMapType===gQ,decodeVideoTexture:!!M.map&&M.map.isVideoTexture===!0&&M.map.encoding===Ot,clearcoat:re,clearcoatMap:re&&!!M.clearcoatMap,clearcoatRoughnessMap:re&&!!M.clearcoatRoughnessMap,clearcoatNormalMap:re&&!!M.clearcoatNormalMap,iridescence:ae,iridescenceMap:ae&&!!M.iridescenceMap,iridescenceThicknessMap:ae&&!!M.iridescenceThicknessMap,displacementMap:!!M.displacementMap,roughnessMap:!!M.roughnessMap,metalnessMap:!!M.metalnessMap,specularMap:!!M.specularMap,specularIntensityMap:!!M.specularIntensityMap,specularColorMap:!!M.specularColorMap,opaque:M.transparent===!1&&M.blending===ff,alphaMap:!!M.alphaMap,alphaTest:se,gradientMap:!!M.gradientMap,sheen:M.sheen>0,sheenColorMap:!!M.sheenColorMap,sheenRoughnessMap:!!M.sheenRoughnessMap,transmission:M.transmission>0,transmissionMap:!!M.transmissionMap,thicknessMap:!!M.thicknessMap,combine:M.combine,vertexTangents:!!M.normalMap&&!!z.attributes.tangent,vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,vertexUvs:!!M.map||!!M.bumpMap||!!M.normalMap||!!M.specularMap||!!M.alphaMap||!!M.emissiveMap||!!M.roughnessMap||!!M.metalnessMap||!!M.clearcoatMap||!!M.clearcoatRoughnessMap||!!M.clearcoatNormalMap||!!M.iridescenceMap||!!M.iridescenceThicknessMap||!!M.displacementMap||!!M.transmissionMap||!!M.thicknessMap||!!M.specularIntensityMap||!!M.specularColorMap||!!M.sheenColorMap||!!M.sheenRoughnessMap,uvsVertexOnly:!(M.map||M.bumpMap||M.normalMap||M.specularMap||M.alphaMap||M.emissiveMap||M.roughnessMap||M.metalnessMap||M.clearcoatNormalMap||M.iridescenceMap||M.iridescenceThicknessMap||M.transmission>0||M.transmissionMap||M.thicknessMap||M.specularIntensityMap||M.specularColorMap||M.sheen>0||M.sheenColorMap||M.sheenRoughnessMap)&&!!M.displacementMap,fog:!!k,useFog:M.fog===!0,fogExp2:k&&k.isFogExp2,flatShading:!!M.flatShading,sizeAttenuation:M.sizeAttenuation,logarithmicDepthBuffer:c,skinning:I.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:N,morphTextureStride:B,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:M.dithering,shadowMapEnabled:e.shadowMap.enabled&&C.length>0,shadowMapType:e.shadowMap.type,toneMapping:M.toneMapped?e.toneMapping:Al,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===ds,flipSided:M.side===ki,useDepthPacking:!!M.depthPacking,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionDerivatives:M.extensions&&M.extensions.derivatives,extensionFragDepth:M.extensions&&M.extensions.fragDepth,extensionDrawBuffers:M.extensions&&M.extensions.drawBuffers,extensionShaderTextureLOD:M.extensions&&M.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:M.customProgramCacheKey()}}function g(M){let T=[];if(M.shaderID?T.push(M.shaderID):(T.push(M.customVertexShaderID),T.push(M.customFragmentShaderID)),M.defines!==void 0)for(let C in M.defines)T.push(C),T.push(M.defines[C]);return M.isRawShaderMaterial===!1&&(v(T,M),y(T,M),T.push(e.outputEncoding)),T.push(M.customProgramCacheKey),T.join()}function v(M,T){M.push(T.precision),M.push(T.outputEncoding),M.push(T.envMapMode),M.push(T.envMapCubeUVHeight),M.push(T.combine),M.push(T.vertexUvs),M.push(T.fogExp2),M.push(T.sizeAttenuation),M.push(T.morphTargetsCount),M.push(T.morphAttributeCount),M.push(T.numDirLights),M.push(T.numPointLights),M.push(T.numSpotLights),M.push(T.numSpotLightMaps),M.push(T.numHemiLights),M.push(T.numRectAreaLights),M.push(T.numDirLightShadows),M.push(T.numPointLightShadows),M.push(T.numSpotLightShadows),M.push(T.numSpotLightShadowsWithMaps),M.push(T.shadowMapType),M.push(T.toneMapping),M.push(T.numClippingPlanes),M.push(T.numClipIntersection),M.push(T.depthPacking)}function y(M,T){o.disableAll(),T.isWebGL2&&o.enable(0),T.supportsVertexTextures&&o.enable(1),T.instancing&&o.enable(2),T.instancingColor&&o.enable(3),T.map&&o.enable(4),T.matcap&&o.enable(5),T.envMap&&o.enable(6),T.lightMap&&o.enable(7),T.aoMap&&o.enable(8),T.emissiveMap&&o.enable(9),T.bumpMap&&o.enable(10),T.normalMap&&o.enable(11),T.objectSpaceNormalMap&&o.enable(12),T.tangentSpaceNormalMap&&o.enable(13),T.clearcoat&&o.enable(14),T.clearcoatMap&&o.enable(15),T.clearcoatRoughnessMap&&o.enable(16),T.clearcoatNormalMap&&o.enable(17),T.iridescence&&o.enable(18),T.iridescenceMap&&o.enable(19),T.iridescenceThicknessMap&&o.enable(20),T.displacementMap&&o.enable(21),T.specularMap&&o.enable(22),T.roughnessMap&&o.enable(23),T.metalnessMap&&o.enable(24),T.gradientMap&&o.enable(25),T.alphaMap&&o.enable(26),T.alphaTest&&o.enable(27),T.vertexColors&&o.enable(28),T.vertexAlphas&&o.enable(29),T.vertexUvs&&o.enable(30),T.vertexTangents&&o.enable(31),T.uvsVertexOnly&&o.enable(32),M.push(o.mask),o.disableAll(),T.fog&&o.enable(0),T.useFog&&o.enable(1),T.flatShading&&o.enable(2),T.logarithmicDepthBuffer&&o.enable(3),T.skinning&&o.enable(4),T.morphTargets&&o.enable(5),T.morphNormals&&o.enable(6),T.morphColors&&o.enable(7),T.premultipliedAlpha&&o.enable(8),T.shadowMapEnabled&&o.enable(9),T.physicallyCorrectLights&&o.enable(10),T.doubleSided&&o.enable(11),T.flipSided&&o.enable(12),T.useDepthPacking&&o.enable(13),T.dithering&&o.enable(14),T.specularIntensityMap&&o.enable(15),T.specularColorMap&&o.enable(16),T.transmission&&o.enable(17),T.transmissionMap&&o.enable(18),T.thicknessMap&&o.enable(19),T.sheen&&o.enable(20),T.sheenColorMap&&o.enable(21),T.sheenRoughnessMap&&o.enable(22),T.decodeVideoTexture&&o.enable(23),T.opaque&&o.enable(24),M.push(o.mask)}function x(M){let T=p[M.type],C;if(T){let L=Za[T];C=mp.clone(L.uniforms)}else C=M.uniforms;return C}function w(M,T){let C;for(let L=0,I=u.length;L<I;L++){let k=u[L];if(k.cacheKey===T){C=k,++C.usedTimes;break}}return C===void 0&&(C=new rte(e,T,M,s),u.push(C)),C}function S(M){if(--M.usedTimes===0){let T=u.indexOf(M);u[T]=u[u.length-1],u.pop(),M.destroy()}}function _(M){l.remove(M)}function A(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:x,acquireProgram:w,releaseProgram:S,releaseShaderCache:_,programs:u,dispose:A}}function ote(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function r(s){e.delete(s)}function i(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:r,update:i,dispose:n}}function lte(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function eI(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function tI(){let e=[],t=0,r=[],i=[],n=[];function s(){t=0,r.length=0,i.length=0,n.length=0}function a(c,d,f,p,m,g){let v=e[t];return v===void 0?(v={id:c.id,object:c,geometry:d,material:f,groupOrder:p,renderOrder:c.renderOrder,z:m,group:g},e[t]=v):(v.id=c.id,v.object=c,v.geometry=d,v.material=f,v.groupOrder=p,v.renderOrder=c.renderOrder,v.z=m,v.group=g),t++,v}function o(c,d,f,p,m,g){let v=a(c,d,f,p,m,g);f.transmission>0?i.push(v):f.transparent===!0?n.push(v):r.push(v)}function l(c,d,f,p,m,g){let v=a(c,d,f,p,m,g);f.transmission>0?i.unshift(v):f.transparent===!0?n.unshift(v):r.unshift(v)}function u(c,d){r.length>1&&r.sort(c||lte),i.length>1&&i.sort(d||eI),n.length>1&&n.sort(d||eI)}function h(){for(let c=t,d=e.length;c<d;c++){let f=e[c];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:r,transmissive:i,transparent:n,init:s,push:o,unshift:l,finish:h,sort:u}}function ute(){let e=new WeakMap;function t(i,n){let s=e.get(i),a;return s===void 0?(a=new tI,e.set(i,[a])):n>=s.length?(a=new tI,s.push(a)):a=s[n],a}function r(){e=new WeakMap}return{get:t,dispose:r}}function cte(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let r;switch(t.type){case"DirectionalLight":r={direction:new P,color:new gt};break;case"SpotLight":r={position:new P,direction:new P,color:new gt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new P,color:new gt,distance:0,decay:0};break;case"HemisphereLight":r={direction:new P,skyColor:new gt,groundColor:new gt};break;case"RectAreaLight":r={color:new gt,position:new P,halfWidth:new P,halfHeight:new P};break}return e[t.id]=r,r}}}function hte(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let r;switch(t.type){case"DirectionalLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=r,r}}}var dte=0;function fte(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function pte(e,t){let r=new cte,i=hte(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)n.probe.push(new P);let s=new P,a=new Oe,o=new Oe;function l(h,c){let d=0,f=0,p=0;for(let L=0;L<9;L++)n.probe[L].set(0,0,0);let m=0,g=0,v=0,y=0,x=0,w=0,S=0,_=0,A=0,M=0;h.sort(fte);let T=c!==!0?Math.PI:1;for(let L=0,I=h.length;L<I;L++){let k=h[L],z=k.color,V=k.intensity,K=k.distance,q=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)d+=z.r*V*T,f+=z.g*V*T,p+=z.b*V*T;else if(k.isLightProbe)for(let O=0;O<9;O++)n.probe[O].addScaledVector(k.sh.coefficients[O],V);else if(k.isDirectionalLight){let O=r.get(k);if(O.color.copy(k.color).multiplyScalar(k.intensity*T),k.castShadow){let W=k.shadow,N=i.get(k);N.shadowBias=W.bias,N.shadowNormalBias=W.normalBias,N.shadowRadius=W.radius,N.shadowMapSize=W.mapSize,n.directionalShadow[m]=N,n.directionalShadowMap[m]=q,n.directionalShadowMatrix[m]=k.shadow.matrix,w++}n.directional[m]=O,m++}else if(k.isSpotLight){let O=r.get(k);O.position.setFromMatrixPosition(k.matrixWorld),O.color.copy(z).multiplyScalar(V*T),O.distance=K,O.coneCos=Math.cos(k.angle),O.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),O.decay=k.decay,n.spot[v]=O;let W=k.shadow;if(k.map&&(n.spotLightMap[A]=k.map,A++,W.updateMatrices(k),k.castShadow&&M++),n.spotLightMatrix[v]=W.matrix,k.castShadow){let N=i.get(k);N.shadowBias=W.bias,N.shadowNormalBias=W.normalBias,N.shadowRadius=W.radius,N.shadowMapSize=W.mapSize,n.spotShadow[v]=N,n.spotShadowMap[v]=q,_++}v++}else if(k.isRectAreaLight){let O=r.get(k);O.color.copy(z).multiplyScalar(V),O.halfWidth.set(k.width*.5,0,0),O.halfHeight.set(0,k.height*.5,0),n.rectArea[y]=O,y++}else if(k.isPointLight){let O=r.get(k);if(O.color.copy(k.color).multiplyScalar(k.intensity*T),O.distance=k.distance,O.decay=k.decay,k.castShadow){let W=k.shadow,N=i.get(k);N.shadowBias=W.bias,N.shadowNormalBias=W.normalBias,N.shadowRadius=W.radius,N.shadowMapSize=W.mapSize,N.shadowCameraNear=W.camera.near,N.shadowCameraFar=W.camera.far,n.pointShadow[g]=N,n.pointShadowMap[g]=q,n.pointShadowMatrix[g]=k.shadow.matrix,S++}n.point[g]=O,g++}else if(k.isHemisphereLight){let O=r.get(k);O.skyColor.copy(k.color).multiplyScalar(V*T),O.groundColor.copy(k.groundColor).multiplyScalar(V*T),n.hemi[x]=O,x++}}y>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=je.LTC_FLOAT_1,n.rectAreaLTC2=je.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=je.LTC_HALF_1,n.rectAreaLTC2=je.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=p;let C=n.hash;(C.directionalLength!==m||C.pointLength!==g||C.spotLength!==v||C.rectAreaLength!==y||C.hemiLength!==x||C.numDirectionalShadows!==w||C.numPointShadows!==S||C.numSpotShadows!==_||C.numSpotMaps!==A)&&(n.directional.length=m,n.spot.length=v,n.rectArea.length=y,n.point.length=g,n.hemi.length=x,n.directionalShadow.length=w,n.directionalShadowMap.length=w,n.pointShadow.length=S,n.pointShadowMap.length=S,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=w,n.pointShadowMatrix.length=S,n.spotLightMatrix.length=_+A-M,n.spotLightMap.length=A,n.numSpotLightShadowsWithMaps=M,C.directionalLength=m,C.pointLength=g,C.spotLength=v,C.rectAreaLength=y,C.hemiLength=x,C.numDirectionalShadows=w,C.numPointShadows=S,C.numSpotShadows=_,C.numSpotMaps=A,n.version=dte++)}function u(h,c){let d=0,f=0,p=0,m=0,g=0,v=c.matrixWorldInverse;for(let y=0,x=h.length;y<x;y++){let w=h[y];if(w.isDirectionalLight){let S=n.directional[d];S.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),d++}else if(w.isSpotLight){let S=n.spot[p];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),S.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),p++}else if(w.isRectAreaLight){let S=n.rectArea[m];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),o.identity(),a.copy(w.matrixWorld),a.premultiply(v),o.extractRotation(a),S.halfWidth.set(w.width*.5,0,0),S.halfHeight.set(0,w.height*.5,0),S.halfWidth.applyMatrix4(o),S.halfHeight.applyMatrix4(o),m++}else if(w.isPointLight){let S=n.point[f];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),f++}else if(w.isHemisphereLight){let S=n.hemi[g];S.direction.setFromMatrixPosition(w.matrixWorld),S.direction.transformDirection(v),g++}}}return{setup:l,setupView:u,state:n}}function rI(e,t){let r=new pte(e,t),i=[],n=[];function s(){i.length=0,n.length=0}function a(h){i.push(h)}function o(h){n.push(h)}function l(h){r.setup(i,h)}function u(h){r.setupView(i,h)}return{init:s,state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:l,setupLightsView:u,pushLight:a,pushShadow:o}}function mte(e,t){let r=new WeakMap;function i(s,a=0){let o=r.get(s),l;return o===void 0?(l=new rI(e,t),r.set(s,[l])):a>=o.length?(l=new rI(e,t),o.push(l)):l=o[a],l}function n(){r=new WeakMap}return{get:i,dispose:n}}var T4=class extends kv{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Wl,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},gte=class extends kv{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new P,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},vte=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yte=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function xte(e,t,r){let i=new uD,n=new J,s=new J,a=new Lt,o=new T4({depthPacking:f4}),l=new gte,u={},h=r.maxTextureSize,c={[Ca]:ki,[ki]:Ca,[ds]:ds},d=new br({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new J},radius:{value:4}},vertexShader:vte,fragmentShader:yte}),f=d.clone();f.defines.HORIZONTAL_PASS=1;let p=new _t;p.setAttribute("position",new Mt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Hn(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=iD,this.render=function(w,S,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||w.length===0)return;let A=e.getRenderTarget(),M=e.getActiveCubeFace(),T=e.getActiveMipmapLevel(),C=e.state;C.setBlending(pi),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let L=0,I=w.length;L<I;L++){let k=w[L],z=k.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;n.copy(z.mapSize);let V=z.getFrameExtents();if(n.multiply(V),s.copy(z.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/V.x),n.x=s.x*V.x,z.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/V.y),n.y=s.y*V.y,z.mapSize.y=s.y)),z.map===null){let q=this.type!==Um?{minFilter:wr,magFilter:wr}:{};z.map=new cr(n.x,n.y,q),z.map.texture.name=k.name+".shadowMap",z.camera.updateProjectionMatrix()}e.setRenderTarget(z.map),e.clear();let K=z.getViewportCount();for(let q=0;q<K;q++){let O=z.getViewport(q);a.set(s.x*O.x,s.y*O.y,s.x*O.z,s.y*O.w),C.viewport(a),z.updateMatrices(k,q),i=z.getFrustum(),x(S,_,z.camera,k,this.type)}z.isPointLightShadow!==!0&&this.type===Um&&v(z,_),z.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(A,M,T)};function v(w,S){let _=t.update(m);d.defines.VSM_SAMPLES!==w.blurSamples&&(d.defines.VSM_SAMPLES=w.blurSamples,f.defines.VSM_SAMPLES=w.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new cr(n.x,n.y)),d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,e.setRenderTarget(w.mapPass),e.clear(),e.renderBufferDirect(S,null,_,d,m,null),f.uniforms.shadow_pass.value=w.mapPass.texture,f.uniforms.resolution.value=w.mapSize,f.uniforms.radius.value=w.radius,e.setRenderTarget(w.map),e.clear(),e.renderBufferDirect(S,null,_,f,m,null)}function y(w,S,_,A,M,T){let C=null,L=_.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(L!==void 0)C=L;else if(C=_.isPointLight===!0?l:o,e.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){let I=C.uuid,k=S.uuid,z=u[I];z===void 0&&(z={},u[I]=z);let V=z[k];V===void 0&&(V=C.clone(),z[k]=V),C=V}return C.visible=S.visible,C.wireframe=S.wireframe,T===Um?C.side=S.shadowSide!==null?S.shadowSide:S.side:C.side=S.shadowSide!==null?S.shadowSide:c[S.side],C.alphaMap=S.alphaMap,C.alphaTest=S.alphaTest,C.map=S.map,C.clipShadows=S.clipShadows,C.clippingPlanes=S.clippingPlanes,C.clipIntersection=S.clipIntersection,C.displacementMap=S.displacementMap,C.displacementScale=S.displacementScale,C.displacementBias=S.displacementBias,C.wireframeLinewidth=S.wireframeLinewidth,C.linewidth=S.linewidth,_.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(_.matrixWorld),C.nearDistance=A,C.farDistance=M),C}function x(w,S,_,A,M){if(w.visible===!1)return;if(w.layers.test(S.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&M===Um)&&(!w.frustumCulled||i.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,w.matrixWorld);let C=t.update(w),L=w.material;if(Array.isArray(L)){let I=C.groups;for(let k=0,z=I.length;k<z;k++){let V=I[k],K=L[V.materialIndex];if(K&&K.visible){let q=y(w,K,A,_.near,_.far,M);e.renderBufferDirect(_,null,C,q,w,V)}}}else if(L.visible){let I=y(w,L,A,_.near,_.far,M);e.renderBufferDirect(_,null,C,I,w,null)}}let T=w.children;for(let C=0,L=T.length;C<L;C++)x(T[C],S,_,A,M)}}function wte(e,t,r){let i=r.isWebGL2;function n(){let Z=!1,ie=new Lt,de=null,_e=new Lt(0,0,0,0);return{setMask:function(Ve){de!==Ve&&!Z&&(e.colorMask(Ve,Ve,Ve,Ve),de=Ve)},setLocked:function(Ve){Z=Ve},setClear:function(Ve,ct,yt,Dt,nr){nr===!0&&(Ve*=Dt,ct*=Dt,yt*=Dt),ie.set(Ve,ct,yt,Dt),_e.equals(ie)===!1&&(e.clearColor(Ve,ct,yt,Dt),_e.copy(ie))},reset:function(){Z=!1,de=null,_e.set(-1,0,0,0)}}}function s(){let Z=!1,ie=null,de=null,_e=null;return{setTest:function(Ve){Ve?se(2929):re(2929)},setMask:function(Ve){ie!==Ve&&!Z&&(e.depthMask(Ve),ie=Ve)},setFunc:function(Ve){if(de!==Ve){switch(Ve){case U$:e.depthFunc(512);break;case j$:e.depthFunc(519);break;case H$:e.depthFunc(513);break;case $E:e.depthFunc(515);break;case V$:e.depthFunc(514);break;case W$:e.depthFunc(518);break;case G$:e.depthFunc(516);break;case Y$:e.depthFunc(517);break;default:e.depthFunc(515)}de=Ve}},setLocked:function(Ve){Z=Ve},setClear:function(Ve){_e!==Ve&&(e.clearDepth(Ve),_e=Ve)},reset:function(){Z=!1,ie=null,de=null,_e=null}}}function a(){let Z=!1,ie=null,de=null,_e=null,Ve=null,ct=null,yt=null,Dt=null,nr=null;return{setTest:function(Qt){Z||(Qt?se(2960):re(2960))},setMask:function(Qt){ie!==Qt&&!Z&&(e.stencilMask(Qt),ie=Qt)},setFunc:function(Qt,Vr,oi){(de!==Qt||_e!==Vr||Ve!==oi)&&(e.stencilFunc(Qt,Vr,oi),de=Qt,_e=Vr,Ve=oi)},setOp:function(Qt,Vr,oi){(ct!==Qt||yt!==Vr||Dt!==oi)&&(e.stencilOp(Qt,Vr,oi),ct=Qt,yt=Vr,Dt=oi)},setLocked:function(Qt){Z=Qt},setClear:function(Qt){nr!==Qt&&(e.clearStencil(Qt),nr=Qt)},reset:function(){Z=!1,ie=null,de=null,_e=null,Ve=null,ct=null,yt=null,Dt=null,nr=null}}}let o=new n,l=new s,u=new a,h=new WeakMap,c=new WeakMap,d={},f={},p=new WeakMap,m=[],g=null,v=!1,y=null,x=null,w=null,S=null,_=null,A=null,M=null,T=!1,C=null,L=null,I=null,k=null,z=null,V=e.getParameter(35661),K=!1,q=0,O=e.getParameter(7938);O.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(O)[1]),K=q>=1):O.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),K=q>=2);let W=null,N={},B=e.getParameter(3088),j=e.getParameter(2978),Q=new Lt().fromArray(B),H=new Lt().fromArray(j);function G(Z,ie,de){let _e=new Uint8Array(4),Ve=e.createTexture();e.bindTexture(Z,Ve),e.texParameteri(Z,10241,9728),e.texParameteri(Z,10240,9728);for(let ct=0;ct<de;ct++)e.texImage2D(ie+ct,0,6408,1,1,0,6408,5121,_e);return Ve}let $={};$[3553]=G(3553,3553,1),$[34067]=G(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),u.setClear(0),se(2929),l.setFunc($E),Qe(!1),Xe(q3),se(2884),$e(pi);function se(Z){d[Z]!==!0&&(e.enable(Z),d[Z]=!0)}function re(Z){d[Z]!==!1&&(e.disable(Z),d[Z]=!1)}function ae(Z,ie){return f[Z]!==ie?(e.bindFramebuffer(Z,ie),f[Z]=ie,i&&(Z===36009&&(f[36160]=ie),Z===36160&&(f[36009]=ie)),!0):!1}function ce(Z,ie){let de=m,_e=!1;if(Z)if(de=p.get(ie),de===void 0&&(de=[],p.set(ie,de)),Z.isWebGLMultipleRenderTargets){let Ve=Z.texture;if(de.length!==Ve.length||de[0]!==36064){for(let ct=0,yt=Ve.length;ct<yt;ct++)de[ct]=36064+ct;de.length=Ve.length,_e=!0}}else de[0]!==36064&&(de[0]=36064,_e=!0);else de[0]!==1029&&(de[0]=1029,_e=!0);_e&&(r.isWebGL2?e.drawBuffers(de):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(de))}function me(Z){return g!==Z?(e.useProgram(Z),g=Z,!0):!1}let be={[Dd]:32774,[D$]:32778,[P$]:32779};if(i)be[K3]=32775,be[Z3]=32776;else{let Z=t.get("EXT_blend_minmax");Z!==null&&(be[K3]=Z.MIN_EXT,be[Z3]=Z.MAX_EXT)}let Ae={[O$]:0,[L$]:1,[I$]:768,[s4]:770,[F$]:776,[N$]:774,[k$]:772,[R$]:769,[a4]:771,[B$]:775,[z$]:773};function $e(Z,ie,de,_e,Ve,ct,yt,Dt){if(Z===pi){v===!0&&(re(3042),v=!1);return}if(v===!1&&(se(3042),v=!0),Z!==C$){if(Z!==y||Dt!==T){if((x!==Dd||_!==Dd)&&(e.blendEquation(32774),x=Dd,_=Dd),Dt)switch(Z){case ff:e.blendFuncSeparate(1,771,1,771);break;case X3:e.blendFunc(1,1);break;case $3:e.blendFuncSeparate(0,769,0,1);break;case Q3:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case ff:e.blendFuncSeparate(770,771,1,771);break;case X3:e.blendFunc(770,1);break;case $3:e.blendFuncSeparate(0,769,0,1);break;case Q3:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}w=null,S=null,A=null,M=null,y=Z,T=Dt}return}Ve=Ve||ie,ct=ct||de,yt=yt||_e,(ie!==x||Ve!==_)&&(e.blendEquationSeparate(be[ie],be[Ve]),x=ie,_=Ve),(de!==w||_e!==S||ct!==A||yt!==M)&&(e.blendFuncSeparate(Ae[de],Ae[_e],Ae[ct],Ae[yt]),w=de,S=_e,A=ct,M=yt),y=Z,T=!1}function Le(Z,ie){Z.side===ds?re(2884):se(2884);let de=Z.side===ki;ie&&(de=!de),Qe(de),Z.blending===ff&&Z.transparent===!1?$e(pi):$e(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.premultipliedAlpha),l.setFunc(Z.depthFunc),l.setTest(Z.depthTest),l.setMask(Z.depthWrite),o.setMask(Z.colorWrite);let _e=Z.stencilWrite;u.setTest(_e),_e&&(u.setMask(Z.stencilWriteMask),u.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),u.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),Ie(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?se(32926):re(32926)}function Qe(Z){C!==Z&&(Z?e.frontFace(2304):e.frontFace(2305),C=Z)}function Xe(Z){Z!==E$?(se(2884),Z!==L&&(Z===q3?e.cullFace(1029):Z===A$?e.cullFace(1028):e.cullFace(1032))):re(2884),L=Z}function Re(Z){Z!==I&&(K&&e.lineWidth(Z),I=Z)}function Ie(Z,ie,de){Z?(se(32823),(k!==ie||z!==de)&&(e.polygonOffset(ie,de),k=ie,z=de)):re(32823)}function Ge(Z){Z?se(3089):re(3089)}function He(Z){Z===void 0&&(Z=33984+V-1),W!==Z&&(e.activeTexture(Z),W=Z)}function Y(Z,ie,de){de===void 0&&(W===null?de=33984+V-1:de=W);let _e=N[de];_e===void 0&&(_e={type:void 0,texture:void 0},N[de]=_e),(_e.type!==Z||_e.texture!==ie)&&(W!==de&&(e.activeTexture(de),W=de),e.bindTexture(Z,ie||$[Z]),_e.type=Z,_e.texture=ie)}function U(){let Z=N[W];Z!==void 0&&Z.type!==void 0&&(e.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function he(){try{e.compressedTexImage2D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ee(){try{e.compressedTexImage3D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ce(){try{e.texSubImage2D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ke(){try{e.texSubImage3D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ye(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function De(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function xe(){try{e.texStorage2D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function et(){try{e.texStorage3D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ot(){try{e.texImage2D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ut(){try{e.texImage3D.apply(e,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ne(Z){Q.equals(Z)===!1&&(e.scissor(Z.x,Z.y,Z.z,Z.w),Q.copy(Z))}function oe(Z){H.equals(Z)===!1&&(e.viewport(Z.x,Z.y,Z.z,Z.w),H.copy(Z))}function ve(Z,ie){let de=c.get(ie);de===void 0&&(de=new WeakMap,c.set(ie,de));let _e=de.get(Z);_e===void 0&&(_e=e.getUniformBlockIndex(ie,Z.name),de.set(Z,_e))}function ze(Z,ie){let de=c.get(ie).get(Z);h.get(ie)!==de&&(e.uniformBlockBinding(ie,de,Z.__bindingPointIndex),h.set(ie,de))}function rt(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),i===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},W=null,N={},f={},p=new WeakMap,m=[],g=null,v=!1,y=null,x=null,w=null,S=null,_=null,A=null,M=null,T=!1,C=null,L=null,I=null,k=null,z=null,Q.set(0,0,e.canvas.width,e.canvas.height),H.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),u.reset()}return{buffers:{color:o,depth:l,stencil:u},enable:se,disable:re,bindFramebuffer:ae,drawBuffers:ce,useProgram:me,setBlending:$e,setMaterial:Le,setFlipSided:Qe,setCullFace:Xe,setLineWidth:Re,setPolygonOffset:Ie,setScissorTest:Ge,activeTexture:He,bindTexture:Y,unbindTexture:U,compressedTexImage2D:he,compressedTexImage3D:Ee,texImage2D:ot,texImage3D:ut,updateUBOMapping:ve,uniformBlockBinding:ze,texStorage2D:xe,texStorage3D:et,texSubImage2D:Ce,texSubImage3D:ke,compressedTexSubImage2D:Ye,compressedTexSubImage3D:De,scissor:ne,viewport:oe,reset:rt}}function bte(e,t,r,i,n,s,a){let o=n.isWebGL2,l=n.maxTextures,u=n.maxCubemapSize,h=n.maxTextureSize,c=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,m,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(Y,U){return v?new OffscreenCanvas(Y,U):mx("canvas")}function x(Y,U,he,Ee){let Ce=1;if((Y.width>Ee||Y.height>Ee)&&(Ce=Ee/Math.max(Y.width,Y.height)),Ce<1||U===!0)if(typeof HTMLImageElement<"u"&&Y instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Y instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Y instanceof ImageBitmap){let ke=U?px:Math.floor,Ye=ke(Ce*Y.width),De=ke(Ce*Y.height);m===void 0&&(m=y(Ye,De));let xe=he?y(Ye,De):m;return xe.width=Ye,xe.height=De,xe.getContext("2d").drawImage(Y,0,0,Ye,De),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Y.width+"x"+Y.height+") to ("+Ye+"x"+De+")."),xe}else return"data"in Y&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Y.width+"x"+Y.height+")."),Y;return Y}function w(Y){return tA(Y.width)&&tA(Y.height)}function S(Y){return o?!1:Y.wrapS!==ii||Y.wrapT!==ii||Y.minFilter!==wr&&Y.minFilter!==Bt}function _(Y,U){return Y.generateMipmaps&&U&&Y.minFilter!==wr&&Y.minFilter!==Bt}function A(Y){e.generateMipmap(Y)}function M(Y,U,he,Ee,Ce=!1){if(o===!1)return U;if(Y!==null){if(e[Y]!==void 0)return e[Y];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Y+"'")}let ke=U;return U===6403&&(he===5126&&(ke=33326),he===5131&&(ke=33325),he===5121&&(ke=33321)),U===33319&&(he===5126&&(ke=33328),he===5131&&(ke=33327),he===5121&&(ke=33323)),U===6408&&(he===5126&&(ke=34836),he===5131&&(ke=34842),he===5121&&(ke=Ee===Ot&&Ce===!1?35907:32856),he===32819&&(ke=32854),he===32820&&(ke=32855)),(ke===33325||ke===33326||ke===33327||ke===33328||ke===34842||ke===34836)&&t.get("EXT_color_buffer_float"),ke}function T(Y,U,he){return _(Y,he)===!0||Y.isFramebufferTexture&&Y.minFilter!==wr&&Y.minFilter!==Bt?Math.log2(Math.max(U.width,U.height))+1:Y.mipmaps!==void 0&&Y.mipmaps.length>0?Y.mipmaps.length:Y.isCompressedTexture&&Array.isArray(Y.image)?U.mipmaps.length:1}function C(Y){return Y===wr||Y===J3||Y===W_?9728:9729}function L(Y){let U=Y.target;U.removeEventListener("dispose",L),k(U),U.isVideoTexture&&p.delete(U)}function I(Y){let U=Y.target;U.removeEventListener("dispose",I),V(U)}function k(Y){let U=i.get(Y);if(U.__webglInit===void 0)return;let he=Y.source,Ee=g.get(he);if(Ee){let Ce=Ee[U.__cacheKey];Ce.usedTimes--,Ce.usedTimes===0&&z(Y),Object.keys(Ee).length===0&&g.delete(he)}i.remove(Y)}function z(Y){let U=i.get(Y);e.deleteTexture(U.__webglTexture);let he=Y.source,Ee=g.get(he);delete Ee[U.__cacheKey],a.memory.textures--}function V(Y){let U=Y.texture,he=i.get(Y),Ee=i.get(U);if(Ee.__webglTexture!==void 0&&(e.deleteTexture(Ee.__webglTexture),a.memory.textures--),Y.depthTexture&&Y.depthTexture.dispose(),Y.isWebGLCubeRenderTarget)for(let Ce=0;Ce<6;Ce++)e.deleteFramebuffer(he.__webglFramebuffer[Ce]),he.__webglDepthbuffer&&e.deleteRenderbuffer(he.__webglDepthbuffer[Ce]);else{if(e.deleteFramebuffer(he.__webglFramebuffer),he.__webglDepthbuffer&&e.deleteRenderbuffer(he.__webglDepthbuffer),he.__webglMultisampledFramebuffer&&e.deleteFramebuffer(he.__webglMultisampledFramebuffer),he.__webglColorRenderbuffer)for(let Ce=0;Ce<he.__webglColorRenderbuffer.length;Ce++)he.__webglColorRenderbuffer[Ce]&&e.deleteRenderbuffer(he.__webglColorRenderbuffer[Ce]);he.__webglDepthRenderbuffer&&e.deleteRenderbuffer(he.__webglDepthRenderbuffer)}if(Y.isWebGLMultipleRenderTargets)for(let Ce=0,ke=U.length;Ce<ke;Ce++){let Ye=i.get(U[Ce]);Ye.__webglTexture&&(e.deleteTexture(Ye.__webglTexture),a.memory.textures--),i.remove(U[Ce])}i.remove(U),i.remove(Y)}let K=0;function q(){K=0}function O(){let Y=K;return Y>=l&&console.warn("THREE.WebGLTextures: Trying to use "+Y+" texture units while this GPU supports only "+l),K+=1,Y}function W(Y){let U=[];return U.push(Y.wrapS),U.push(Y.wrapT),U.push(Y.wrapR||0),U.push(Y.magFilter),U.push(Y.minFilter),U.push(Y.anisotropy),U.push(Y.internalFormat),U.push(Y.format),U.push(Y.type),U.push(Y.generateMipmaps),U.push(Y.premultiplyAlpha),U.push(Y.flipY),U.push(Y.unpackAlignment),U.push(Y.encoding),U.join()}function N(Y,U){let he=i.get(Y);if(Y.isVideoTexture&&Ge(Y),Y.isRenderTargetTexture===!1&&Y.version>0&&he.__version!==Y.version){let Ee=Y.image;if(Ee===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{re(he,Y,U);return}}r.bindTexture(3553,he.__webglTexture,33984+U)}function B(Y,U){let he=i.get(Y);if(Y.version>0&&he.__version!==Y.version){re(he,Y,U);return}r.bindTexture(35866,he.__webglTexture,33984+U)}function j(Y,U){let he=i.get(Y);if(Y.version>0&&he.__version!==Y.version){re(he,Y,U);return}r.bindTexture(32879,he.__webglTexture,33984+U)}function Q(Y,U){let he=i.get(Y);if(Y.version>0&&he.__version!==Y.version){ae(he,Y,U);return}r.bindTexture(34067,he.__webglTexture,33984+U)}let H={[xl]:10497,[ii]:33071,[ZE]:33648},G={[wr]:9728,[J3]:9984,[W_]:9986,[Bt]:9729,[eQ]:9985,[Bf]:9987};function $(Y,U,he){if(he?(e.texParameteri(Y,10242,H[U.wrapS]),e.texParameteri(Y,10243,H[U.wrapT]),(Y===32879||Y===35866)&&e.texParameteri(Y,32882,H[U.wrapR]),e.texParameteri(Y,10240,G[U.magFilter]),e.texParameteri(Y,10241,G[U.minFilter])):(e.texParameteri(Y,10242,33071),e.texParameteri(Y,10243,33071),(Y===32879||Y===35866)&&e.texParameteri(Y,32882,33071),(U.wrapS!==ii||U.wrapT!==ii)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(Y,10240,C(U.magFilter)),e.texParameteri(Y,10241,C(U.minFilter)),U.minFilter!==wr&&U.minFilter!==Bt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let Ee=t.get("EXT_texture_filter_anisotropic");if(U.magFilter===wr||U.minFilter!==W_&&U.minFilter!==Bf||U.type===fs&&t.has("OES_texture_float_linear")===!1||o===!1&&U.type===Ff&&t.has("OES_texture_half_float_linear")===!1)return;(U.anisotropy>1||i.get(U).__currentAnisotropy)&&(e.texParameterf(Y,Ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(U.anisotropy,n.getMaxAnisotropy())),i.get(U).__currentAnisotropy=U.anisotropy)}}function se(Y,U){let he=!1;Y.__webglInit===void 0&&(Y.__webglInit=!0,U.addEventListener("dispose",L));let Ee=U.source,Ce=g.get(Ee);Ce===void 0&&(Ce={},g.set(Ee,Ce));let ke=W(U);if(ke!==Y.__cacheKey){Ce[ke]===void 0&&(Ce[ke]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,he=!0),Ce[ke].usedTimes++;let Ye=Ce[Y.__cacheKey];Ye!==void 0&&(Ce[Y.__cacheKey].usedTimes--,Ye.usedTimes===0&&z(U)),Y.__cacheKey=ke,Y.__webglTexture=Ce[ke].texture}return he}function re(Y,U,he){let Ee=3553;(U.isDataArrayTexture||U.isCompressedArrayTexture)&&(Ee=35866),U.isData3DTexture&&(Ee=32879);let Ce=se(Y,U),ke=U.source;r.bindTexture(Ee,Y.__webglTexture,33984+he);let Ye=i.get(ke);if(ke.version!==Ye.__version||Ce===!0){r.activeTexture(33984+he),e.pixelStorei(37440,U.flipY),e.pixelStorei(37441,U.premultiplyAlpha),e.pixelStorei(3317,U.unpackAlignment),e.pixelStorei(37443,0);let De=S(U)&&w(U.image)===!1,xe=x(U.image,De,!1,h);xe=He(U,xe);let et=w(xe)||o,ot=s.convert(U.format,U.encoding),ut=s.convert(U.type),ne=M(U.internalFormat,ot,ut,U.encoding,U.isVideoTexture);$(Ee,U,et);let oe,ve=U.mipmaps,ze=o&&U.isVideoTexture!==!0,rt=Ye.__version===void 0||Ce===!0,Z=T(U,xe,et);if(U.isDepthTexture)ne=6402,o?U.type===fs?ne=36012:U.type===Cu?ne=33190:U.type===rh?ne=35056:ne=33189:U.type===fs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),U.format===ih&&ne===6402&&U.type!==u4&&U.type!==Cu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),U.type=Cu,ut=s.convert(U.type)),U.format===bh&&ne===6402&&(ne=34041,U.type!==rh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),U.type=rh,ut=s.convert(U.type))),rt&&(ze?r.texStorage2D(3553,1,ne,xe.width,xe.height):r.texImage2D(3553,0,ne,xe.width,xe.height,0,ot,ut,null));else if(U.isDataTexture)if(ve.length>0&&et){ze&&rt&&r.texStorage2D(3553,Z,ne,ve[0].width,ve[0].height);for(let ie=0,de=ve.length;ie<de;ie++)oe=ve[ie],ze?r.texSubImage2D(3553,ie,0,0,oe.width,oe.height,ot,ut,oe.data):r.texImage2D(3553,ie,ne,oe.width,oe.height,0,ot,ut,oe.data);U.generateMipmaps=!1}else ze?(rt&&r.texStorage2D(3553,Z,ne,xe.width,xe.height),r.texSubImage2D(3553,0,0,0,xe.width,xe.height,ot,ut,xe.data)):r.texImage2D(3553,0,ne,xe.width,xe.height,0,ot,ut,xe.data);else if(U.isCompressedTexture)if(U.isCompressedArrayTexture){ze&&rt&&r.texStorage3D(35866,Z,ne,ve[0].width,ve[0].height,xe.depth);for(let ie=0,de=ve.length;ie<de;ie++)oe=ve[ie],U.format!==Us?ot!==null?ze?r.compressedTexSubImage3D(35866,ie,0,0,0,oe.width,oe.height,xe.depth,ot,oe.data,0,0):r.compressedTexImage3D(35866,ie,ne,oe.width,oe.height,xe.depth,0,oe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ze?r.texSubImage3D(35866,ie,0,0,0,oe.width,oe.height,xe.depth,ot,ut,oe.data):r.texImage3D(35866,ie,ne,oe.width,oe.height,xe.depth,0,ot,ut,oe.data)}else{ze&&rt&&r.texStorage2D(3553,Z,ne,ve[0].width,ve[0].height);for(let ie=0,de=ve.length;ie<de;ie++)oe=ve[ie],U.format!==Us?ot!==null?ze?r.compressedTexSubImage2D(3553,ie,0,0,oe.width,oe.height,ot,oe.data):r.compressedTexImage2D(3553,ie,ne,oe.width,oe.height,0,oe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ze?r.texSubImage2D(3553,ie,0,0,oe.width,oe.height,ot,ut,oe.data):r.texImage2D(3553,ie,ne,oe.width,oe.height,0,ot,ut,oe.data)}else if(U.isDataArrayTexture)ze?(rt&&r.texStorage3D(35866,Z,ne,xe.width,xe.height,xe.depth),r.texSubImage3D(35866,0,0,0,0,xe.width,xe.height,xe.depth,ot,ut,xe.data)):r.texImage3D(35866,0,ne,xe.width,xe.height,xe.depth,0,ot,ut,xe.data);else if(U.isData3DTexture)ze?(rt&&r.texStorage3D(32879,Z,ne,xe.width,xe.height,xe.depth),r.texSubImage3D(32879,0,0,0,0,xe.width,xe.height,xe.depth,ot,ut,xe.data)):r.texImage3D(32879,0,ne,xe.width,xe.height,xe.depth,0,ot,ut,xe.data);else if(U.isFramebufferTexture){if(rt)if(ze)r.texStorage2D(3553,Z,ne,xe.width,xe.height);else{let ie=xe.width,de=xe.height;for(let _e=0;_e<Z;_e++)r.texImage2D(3553,_e,ne,ie,de,0,ot,ut,null),ie>>=1,de>>=1}}else if(ve.length>0&&et){ze&&rt&&r.texStorage2D(3553,Z,ne,ve[0].width,ve[0].height);for(let ie=0,de=ve.length;ie<de;ie++)oe=ve[ie],ze?r.texSubImage2D(3553,ie,0,0,ot,ut,oe):r.texImage2D(3553,ie,ne,ot,ut,oe);U.generateMipmaps=!1}else ze?(rt&&r.texStorage2D(3553,Z,ne,xe.width,xe.height),r.texSubImage2D(3553,0,0,0,ot,ut,xe)):r.texImage2D(3553,0,ne,ot,ut,xe);_(U,et)&&A(Ee),Ye.__version=ke.version,U.onUpdate&&U.onUpdate(U)}Y.__version=U.version}function ae(Y,U,he){if(U.image.length!==6)return;let Ee=se(Y,U),Ce=U.source;r.bindTexture(34067,Y.__webglTexture,33984+he);let ke=i.get(Ce);if(Ce.version!==ke.__version||Ee===!0){r.activeTexture(33984+he),e.pixelStorei(37440,U.flipY),e.pixelStorei(37441,U.premultiplyAlpha),e.pixelStorei(3317,U.unpackAlignment),e.pixelStorei(37443,0);let Ye=U.isCompressedTexture||U.image[0].isCompressedTexture,De=U.image[0]&&U.image[0].isDataTexture,xe=[];for(let ie=0;ie<6;ie++)!Ye&&!De?xe[ie]=x(U.image[ie],!1,!0,u):xe[ie]=De?U.image[ie].image:U.image[ie],xe[ie]=He(U,xe[ie]);let et=xe[0],ot=w(et)||o,ut=s.convert(U.format,U.encoding),ne=s.convert(U.type),oe=M(U.internalFormat,ut,ne,U.encoding),ve=o&&U.isVideoTexture!==!0,ze=ke.__version===void 0||Ee===!0,rt=T(U,et,ot);$(34067,U,ot);let Z;if(Ye){ve&&ze&&r.texStorage2D(34067,rt,oe,et.width,et.height);for(let ie=0;ie<6;ie++){Z=xe[ie].mipmaps;for(let de=0;de<Z.length;de++){let _e=Z[de];U.format!==Us?ut!==null?ve?r.compressedTexSubImage2D(34069+ie,de,0,0,_e.width,_e.height,ut,_e.data):r.compressedTexImage2D(34069+ie,de,oe,_e.width,_e.height,0,_e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ve?r.texSubImage2D(34069+ie,de,0,0,_e.width,_e.height,ut,ne,_e.data):r.texImage2D(34069+ie,de,oe,_e.width,_e.height,0,ut,ne,_e.data)}}}else{Z=U.mipmaps,ve&&ze&&(Z.length>0&&rt++,r.texStorage2D(34067,rt,oe,xe[0].width,xe[0].height));for(let ie=0;ie<6;ie++)if(De){ve?r.texSubImage2D(34069+ie,0,0,0,xe[ie].width,xe[ie].height,ut,ne,xe[ie].data):r.texImage2D(34069+ie,0,oe,xe[ie].width,xe[ie].height,0,ut,ne,xe[ie].data);for(let de=0;de<Z.length;de++){let _e=Z[de].image[ie].image;ve?r.texSubImage2D(34069+ie,de+1,0,0,_e.width,_e.height,ut,ne,_e.data):r.texImage2D(34069+ie,de+1,oe,_e.width,_e.height,0,ut,ne,_e.data)}}else{ve?r.texSubImage2D(34069+ie,0,0,0,ut,ne,xe[ie]):r.texImage2D(34069+ie,0,oe,ut,ne,xe[ie]);for(let de=0;de<Z.length;de++){let _e=Z[de];ve?r.texSubImage2D(34069+ie,de+1,0,0,ut,ne,_e.image[ie]):r.texImage2D(34069+ie,de+1,oe,ut,ne,_e.image[ie])}}}_(U,ot)&&A(34067),ke.__version=Ce.version,U.onUpdate&&U.onUpdate(U)}Y.__version=U.version}function ce(Y,U,he,Ee,Ce){let ke=s.convert(he.format,he.encoding),Ye=s.convert(he.type),De=M(he.internalFormat,ke,Ye,he.encoding);i.get(U).__hasExternalTextures||(Ce===32879||Ce===35866?r.texImage3D(Ce,0,De,U.width,U.height,U.depth,0,ke,Ye,null):r.texImage2D(Ce,0,De,U.width,U.height,0,ke,Ye,null)),r.bindFramebuffer(36160,Y),Ie(U)?d.framebufferTexture2DMultisampleEXT(36160,Ee,Ce,i.get(he).__webglTexture,0,Re(U)):(Ce===3553||Ce>=34069&&Ce<=34074)&&e.framebufferTexture2D(36160,Ee,Ce,i.get(he).__webglTexture,0),r.bindFramebuffer(36160,null)}function me(Y,U,he){if(e.bindRenderbuffer(36161,Y),U.depthBuffer&&!U.stencilBuffer){let Ee=33189;if(he||Ie(U)){let Ce=U.depthTexture;Ce&&Ce.isDepthTexture&&(Ce.type===fs?Ee=36012:Ce.type===Cu&&(Ee=33190));let ke=Re(U);Ie(U)?d.renderbufferStorageMultisampleEXT(36161,ke,Ee,U.width,U.height):e.renderbufferStorageMultisample(36161,ke,Ee,U.width,U.height)}else e.renderbufferStorage(36161,Ee,U.width,U.height);e.framebufferRenderbuffer(36160,36096,36161,Y)}else if(U.depthBuffer&&U.stencilBuffer){let Ee=Re(U);he&&Ie(U)===!1?e.renderbufferStorageMultisample(36161,Ee,35056,U.width,U.height):Ie(U)?d.renderbufferStorageMultisampleEXT(36161,Ee,35056,U.width,U.height):e.renderbufferStorage(36161,34041,U.width,U.height),e.framebufferRenderbuffer(36160,33306,36161,Y)}else{let Ee=U.isWebGLMultipleRenderTargets===!0?U.texture:[U.texture];for(let Ce=0;Ce<Ee.length;Ce++){let ke=Ee[Ce],Ye=s.convert(ke.format,ke.encoding),De=s.convert(ke.type),xe=M(ke.internalFormat,Ye,De,ke.encoding),et=Re(U);he&&Ie(U)===!1?e.renderbufferStorageMultisample(36161,et,xe,U.width,U.height):Ie(U)?d.renderbufferStorageMultisampleEXT(36161,et,xe,U.width,U.height):e.renderbufferStorage(36161,xe,U.width,U.height)}}e.bindRenderbuffer(36161,null)}function be(Y,U){if(U&&U.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(36160,Y),!(U.depthTexture&&U.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(U.depthTexture).__webglTexture||U.depthTexture.image.width!==U.width||U.depthTexture.image.height!==U.height)&&(U.depthTexture.image.width=U.width,U.depthTexture.image.height=U.height,U.depthTexture.needsUpdate=!0),N(U.depthTexture,0);let he=i.get(U.depthTexture).__webglTexture,Ee=Re(U);if(U.depthTexture.format===ih)Ie(U)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,he,0,Ee):e.framebufferTexture2D(36160,36096,3553,he,0);else if(U.depthTexture.format===bh)Ie(U)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,he,0,Ee):e.framebufferTexture2D(36160,33306,3553,he,0);else throw new Error("Unknown depthTexture format")}function Ae(Y){let U=i.get(Y),he=Y.isWebGLCubeRenderTarget===!0;if(Y.depthTexture&&!U.__autoAllocateDepthBuffer){if(he)throw new Error("target.depthTexture not supported in Cube render targets");be(U.__webglFramebuffer,Y)}else if(he){U.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)r.bindFramebuffer(36160,U.__webglFramebuffer[Ee]),U.__webglDepthbuffer[Ee]=e.createRenderbuffer(),me(U.__webglDepthbuffer[Ee],Y,!1)}else r.bindFramebuffer(36160,U.__webglFramebuffer),U.__webglDepthbuffer=e.createRenderbuffer(),me(U.__webglDepthbuffer,Y,!1);r.bindFramebuffer(36160,null)}function $e(Y,U,he){let Ee=i.get(Y);U!==void 0&&ce(Ee.__webglFramebuffer,Y,Y.texture,36064,3553),he!==void 0&&Ae(Y)}function Le(Y){let U=Y.texture,he=i.get(Y),Ee=i.get(U);Y.addEventListener("dispose",I),Y.isWebGLMultipleRenderTargets!==!0&&(Ee.__webglTexture===void 0&&(Ee.__webglTexture=e.createTexture()),Ee.__version=U.version,a.memory.textures++);let Ce=Y.isWebGLCubeRenderTarget===!0,ke=Y.isWebGLMultipleRenderTargets===!0,Ye=w(Y)||o;if(Ce){he.__webglFramebuffer=[];for(let De=0;De<6;De++)he.__webglFramebuffer[De]=e.createFramebuffer()}else{if(he.__webglFramebuffer=e.createFramebuffer(),ke)if(n.drawBuffers){let De=Y.texture;for(let xe=0,et=De.length;xe<et;xe++){let ot=i.get(De[xe]);ot.__webglTexture===void 0&&(ot.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&Y.samples>0&&Ie(Y)===!1){let De=ke?U:[U];he.__webglMultisampledFramebuffer=e.createFramebuffer(),he.__webglColorRenderbuffer=[],r.bindFramebuffer(36160,he.__webglMultisampledFramebuffer);for(let xe=0;xe<De.length;xe++){let et=De[xe];he.__webglColorRenderbuffer[xe]=e.createRenderbuffer(),e.bindRenderbuffer(36161,he.__webglColorRenderbuffer[xe]);let ot=s.convert(et.format,et.encoding),ut=s.convert(et.type),ne=M(et.internalFormat,ot,ut,et.encoding,Y.isXRRenderTarget===!0),oe=Re(Y);e.renderbufferStorageMultisample(36161,oe,ne,Y.width,Y.height),e.framebufferRenderbuffer(36160,36064+xe,36161,he.__webglColorRenderbuffer[xe])}e.bindRenderbuffer(36161,null),Y.depthBuffer&&(he.__webglDepthRenderbuffer=e.createRenderbuffer(),me(he.__webglDepthRenderbuffer,Y,!0)),r.bindFramebuffer(36160,null)}}if(Ce){r.bindTexture(34067,Ee.__webglTexture),$(34067,U,Ye);for(let De=0;De<6;De++)ce(he.__webglFramebuffer[De],Y,U,36064,34069+De);_(U,Ye)&&A(34067),r.unbindTexture()}else if(ke){let De=Y.texture;for(let xe=0,et=De.length;xe<et;xe++){let ot=De[xe],ut=i.get(ot);r.bindTexture(3553,ut.__webglTexture),$(3553,ot,Ye),ce(he.__webglFramebuffer,Y,ot,36064+xe,3553),_(ot,Ye)&&A(3553)}r.unbindTexture()}else{let De=3553;(Y.isWebGL3DRenderTarget||Y.isWebGLArrayRenderTarget)&&(o?De=Y.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),r.bindTexture(De,Ee.__webglTexture),$(De,U,Ye),ce(he.__webglFramebuffer,Y,U,36064,De),_(U,Ye)&&A(De),r.unbindTexture()}Y.depthBuffer&&Ae(Y)}function Qe(Y){let U=w(Y)||o,he=Y.isWebGLMultipleRenderTargets===!0?Y.texture:[Y.texture];for(let Ee=0,Ce=he.length;Ee<Ce;Ee++){let ke=he[Ee];if(_(ke,U)){let Ye=Y.isWebGLCubeRenderTarget?34067:3553,De=i.get(ke).__webglTexture;r.bindTexture(Ye,De),A(Ye),r.unbindTexture()}}}function Xe(Y){if(o&&Y.samples>0&&Ie(Y)===!1){let U=Y.isWebGLMultipleRenderTargets?Y.texture:[Y.texture],he=Y.width,Ee=Y.height,Ce=16384,ke=[],Ye=Y.stencilBuffer?33306:36096,De=i.get(Y),xe=Y.isWebGLMultipleRenderTargets===!0;if(xe)for(let et=0;et<U.length;et++)r.bindFramebuffer(36160,De.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+et,36161,null),r.bindFramebuffer(36160,De.__webglFramebuffer),e.framebufferTexture2D(36009,36064+et,3553,null,0);r.bindFramebuffer(36008,De.__webglMultisampledFramebuffer),r.bindFramebuffer(36009,De.__webglFramebuffer);for(let et=0;et<U.length;et++){ke.push(36064+et),Y.depthBuffer&&ke.push(Ye);let ot=De.__ignoreDepthValues!==void 0?De.__ignoreDepthValues:!1;if(ot===!1&&(Y.depthBuffer&&(Ce|=256),Y.stencilBuffer&&(Ce|=1024)),xe&&e.framebufferRenderbuffer(36008,36064,36161,De.__webglColorRenderbuffer[et]),ot===!0&&(e.invalidateFramebuffer(36008,[Ye]),e.invalidateFramebuffer(36009,[Ye])),xe){let ut=i.get(U[et]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,ut,0)}e.blitFramebuffer(0,0,he,Ee,0,0,he,Ee,Ce,9728),f&&e.invalidateFramebuffer(36008,ke)}if(r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),xe)for(let et=0;et<U.length;et++){r.bindFramebuffer(36160,De.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+et,36161,De.__webglColorRenderbuffer[et]);let ot=i.get(U[et]).__webglTexture;r.bindFramebuffer(36160,De.__webglFramebuffer),e.framebufferTexture2D(36009,36064+et,3553,ot,0)}r.bindFramebuffer(36009,De.__webglMultisampledFramebuffer)}}function Re(Y){return Math.min(c,Y.samples)}function Ie(Y){let U=i.get(Y);return o&&Y.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&U.__useRenderToTexture!==!1}function Ge(Y){let U=a.render.frame;p.get(Y)!==U&&(p.set(Y,U),Y.update())}function He(Y,U){let he=Y.encoding,Ee=Y.format,Ce=Y.type;return Y.isCompressedTexture===!0||Y.isVideoTexture===!0||Y.format===eA||he!==yo&&(he===Ot?o===!1?t.has("EXT_sRGB")===!0&&Ee===Us?(Y.format=eA,Y.minFilter=Bt,Y.generateMipmaps=!1):U=v4.sRGBToLinear(U):(Ee!==Us||Ce!==cn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",he)),U}this.allocateTextureUnit=O,this.resetTextureUnits=q,this.setTexture2D=N,this.setTexture2DArray=B,this.setTexture3D=j,this.setTextureCube=Q,this.rebindTextures=$e,this.setupRenderTarget=Le,this.updateRenderTargetMipmap=Qe,this.updateMultisampleRenderTarget=Xe,this.setupDepthRenderbuffer=Ae,this.setupFrameBufferTexture=ce,this.useMultisampledRTT=Ie}function _te(e,t,r){let i=r.isWebGL2;function n(s,a=null){let o;if(s===cn)return 5121;if(s===nQ)return 32819;if(s===sQ)return 32820;if(s===tQ)return 5120;if(s===rQ)return 5122;if(s===u4)return 5123;if(s===iQ)return 5124;if(s===Cu)return 5125;if(s===fs)return 5126;if(s===Ff)return i?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===aQ)return 6406;if(s===Us)return 6408;if(s===oQ)return 6409;if(s===lQ)return 6410;if(s===ih)return 6402;if(s===bh)return 34041;if(s===eA)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===uQ)return 6403;if(s===cQ)return 36244;if(s===c4)return 33319;if(s===hQ)return 33320;if(s===dQ)return 36249;if(s===G_||s===Y_||s===q_||s===X_)if(a===Ot)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===G_)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Y_)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===q_)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===X_)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===G_)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Y_)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===q_)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===X_)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===eL||s===tL||s===rL||s===iL)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===eL)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===tL)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===rL)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===iL)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===fQ)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===nL||s===sL)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===nL)return a===Ot?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===sL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===aL||s===oL||s===lL||s===uL||s===cL||s===hL||s===dL||s===fL||s===pL||s===mL||s===gL||s===vL||s===yL||s===xL)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===aL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===oL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===lL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===uL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===cL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===hL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===dL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===fL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===pL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===mL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===gL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===vL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===yL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===xL)return a===Ot?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===$_)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===$_)return a===Ot?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===pQ||s===wL||s===bL||s===_L)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===$_)return o.COMPRESSED_RED_RGTC1_EXT;if(s===wL)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===bL)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===_L)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===rh?i?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var Ste=class extends rn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Jd=class extends dr{constructor(){super(),this.isGroup=!0,this.type="Group"}},Mte={type:"move"},bS=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Jd,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Jd,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Jd,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let p of e.hand.values()){let m=t.getJointPose(p,r),g=this._getHandJoint(l,p);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=m!==null}let u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],c=u.position.distanceTo(h.position),d=.02,f=.005;l.inputState.pinching&&c>d+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&c<=d-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,r),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&n!==null&&(i=n),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Mte)))}return a!==null&&(a.visible=i!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let r=new Jd;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}},jf=class extends Mi{constructor(e,t,r,i,n,s,a,o,l,u){if(u=u!==void 0?u:ih,u!==ih&&u!==bh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===ih&&(r=Cu),r===void 0&&u===bh&&(r=rh),super(null,i,n,s,a,o,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:wr,this.minFilter=o!==void 0?o:wr,this.flipY=!1,this.generateMipmaps=!1}},Ete=class extends Xi{constructor(e,t){super();let r=this,i=null,n=1,s=null,a="local-floor",o=1,l=null,u=null,h=null,c=null,d=null,f=null,p=t.getContextAttributes(),m=null,g=null,v=[],y=[],x=new Set,w=new Map,S=new rn;S.layers.enable(1),S.viewport=new Lt;let _=new rn;_.layers.enable(2),_.viewport=new Lt;let A=[S,_],M=new Ste;M.layers.enable(1),M.layers.enable(2);let T=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(B){let j=v[B];return j===void 0&&(j=new bS,v[B]=j),j.getTargetRaySpace()},this.getControllerGrip=function(B){let j=v[B];return j===void 0&&(j=new bS,v[B]=j),j.getGripSpace()},this.getHand=function(B){let j=v[B];return j===void 0&&(j=new bS,v[B]=j),j.getHandSpace()};function L(B){let j=y.indexOf(B.inputSource);if(j===-1)return;let Q=v[j];Q!==void 0&&Q.dispatchEvent({type:B.type,data:B.inputSource})}function I(){i.removeEventListener("select",L),i.removeEventListener("selectstart",L),i.removeEventListener("selectend",L),i.removeEventListener("squeeze",L),i.removeEventListener("squeezestart",L),i.removeEventListener("squeezeend",L),i.removeEventListener("end",I),i.removeEventListener("inputsourceschange",k);for(let B=0;B<v.length;B++){let j=y[B];j!==null&&(y[B]=null,v[B].disconnect(j))}T=null,C=null,e.setRenderTarget(m),d=null,c=null,h=null,i=null,g=null,N.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(B){n=B,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(B){a=B,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(B){l=B},this.getBaseLayer=function(){return c!==null?c:d},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return i},this.setSession=async function(B){if(i=B,i!==null){if(m=e.getRenderTarget(),i.addEventListener("select",L),i.addEventListener("selectstart",L),i.addEventListener("selectend",L),i.addEventListener("squeeze",L),i.addEventListener("squeezestart",L),i.addEventListener("squeezeend",L),i.addEventListener("end",I),i.addEventListener("inputsourceschange",k),p.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let j={antialias:i.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(i,t,j),i.updateRenderState({baseLayer:d}),g=new cr(d.framebufferWidth,d.framebufferHeight,{format:Us,type:cn,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let j=null,Q=null,H=null;p.depth&&(H=p.stencil?35056:33190,j=p.stencil?bh:ih,Q=p.stencil?rh:Cu);let G={colorFormat:32856,depthFormat:H,scaleFactor:n};h=new XRWebGLBinding(i,t),c=h.createProjectionLayer(G),i.updateRenderState({layers:[c]}),g=new cr(c.textureWidth,c.textureHeight,{format:Us,type:cn,depthTexture:new jf(c.textureWidth,c.textureHeight,Q,void 0,void 0,void 0,void 0,void 0,void 0,j),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});let $=e.properties.get(g);$.__ignoreDepthValues=c.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),N.setContext(i),N.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function k(B){for(let j=0;j<B.removed.length;j++){let Q=B.removed[j],H=y.indexOf(Q);H>=0&&(y[H]=null,v[H].disconnect(Q))}for(let j=0;j<B.added.length;j++){let Q=B.added[j],H=y.indexOf(Q);if(H===-1){for(let $=0;$<v.length;$++)if($>=y.length){y.push(Q),H=$;break}else if(y[$]===null){y[$]=Q,H=$;break}if(H===-1)break}let G=v[H];G&&G.connect(Q)}}let z=new P,V=new P;function K(B,j,Q){z.setFromMatrixPosition(j.matrixWorld),V.setFromMatrixPosition(Q.matrixWorld);let H=z.distanceTo(V),G=j.projectionMatrix.elements,$=Q.projectionMatrix.elements,se=G[14]/(G[10]-1),re=G[14]/(G[10]+1),ae=(G[9]+1)/G[5],ce=(G[9]-1)/G[5],me=(G[8]-1)/G[0],be=($[8]+1)/$[0],Ae=se*me,$e=se*be,Le=H/(-me+be),Qe=Le*-me;j.matrixWorld.decompose(B.position,B.quaternion,B.scale),B.translateX(Qe),B.translateZ(Le),B.matrixWorld.compose(B.position,B.quaternion,B.scale),B.matrixWorldInverse.copy(B.matrixWorld).invert();let Xe=se+Le,Re=re+Le,Ie=Ae-Qe,Ge=$e+(H-Qe),He=ae*re/Re*Xe,Y=ce*re/Re*Xe;B.projectionMatrix.makePerspective(Ie,Ge,He,Y,Xe,Re)}function q(B,j){j===null?B.matrixWorld.copy(B.matrix):B.matrixWorld.multiplyMatrices(j.matrixWorld,B.matrix),B.matrixWorldInverse.copy(B.matrixWorld).invert()}this.updateCamera=function(B){if(i===null)return;M.near=_.near=S.near=B.near,M.far=_.far=S.far=B.far,(T!==M.near||C!==M.far)&&(i.updateRenderState({depthNear:M.near,depthFar:M.far}),T=M.near,C=M.far);let j=B.parent,Q=M.cameras;q(M,j);for(let G=0;G<Q.length;G++)q(Q[G],j);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),B.matrix.copy(M.matrix),B.matrix.decompose(B.position,B.quaternion,B.scale);let H=B.children;for(let G=0,$=H.length;G<$;G++)H[G].updateMatrixWorld(!0);Q.length===2?K(M,S,_):M.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(!(c===null&&d===null))return o},this.setFoveation=function(B){o=B,c!==null&&(c.fixedFoveation=B),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=B)},this.getPlanes=function(){return x};let O=null;function W(B,j){if(u=j.getViewerPose(l||s),f=j,u!==null){let Q=u.views;d!==null&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let H=!1;Q.length!==M.cameras.length&&(M.cameras.length=0,H=!0);for(let G=0;G<Q.length;G++){let $=Q[G],se=null;if(d!==null)se=d.getViewport($);else{let ae=h.getViewSubImage(c,$);se=ae.viewport,G===0&&(e.setRenderTargetTextures(g,ae.colorTexture,c.ignoreDepthValues?void 0:ae.depthStencilTexture),e.setRenderTarget(g))}let re=A[G];re===void 0&&(re=new rn,re.layers.enable(G),re.viewport=new Lt,A[G]=re),re.matrix.fromArray($.transform.matrix),re.projectionMatrix.fromArray($.projectionMatrix),re.viewport.set(se.x,se.y,se.width,se.height),G===0&&M.matrix.copy(re.matrix),H===!0&&M.cameras.push(re)}}for(let Q=0;Q<v.length;Q++){let H=y[Q],G=v[Q];H!==null&&G!==void 0&&G.update(H,j,l||s)}if(O&&O(B,j),j.detectedPlanes){r.dispatchEvent({type:"planesdetected",data:j.detectedPlanes});let Q=null;for(let H of x)j.detectedPlanes.has(H)||(Q===null&&(Q=[]),Q.push(H));if(Q!==null)for(let H of Q)x.delete(H),w.delete(H),r.dispatchEvent({type:"planeremoved",data:H});for(let H of j.detectedPlanes)if(!x.has(H))x.add(H),w.set(H,j.lastChangedTime),r.dispatchEvent({type:"planeadded",data:H});else{let G=w.get(H);H.lastChangedTime>G&&(w.set(H,H.lastChangedTime),r.dispatchEvent({type:"planechanged",data:H}))}}f=null}let N=new _4;N.setAnimationLoop(W),this.setAnimationLoop=function(B){O=B},this.dispose=function(){}}};function Ate(e,t){function r(m,g){g.color.getRGB(m.fogColor.value,b4(e)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function i(m,g,v,y,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?n(m,g):g.isMeshToonMaterial?(n(m,g),h(m,g)):g.isMeshPhongMaterial?(n(m,g),u(m,g)):g.isMeshStandardMaterial?(n(m,g),c(m,g),g.isMeshPhysicalMaterial&&d(m,g,x)):g.isMeshMatcapMaterial?(n(m,g),f(m,g)):g.isMeshDepthMaterial?n(m,g):g.isMeshDistanceMaterial?(n(m,g),p(m,g)):g.isMeshNormalMaterial?n(m,g):g.isLineBasicMaterial?(s(m,g),g.isLineDashedMaterial&&a(m,g)):g.isPointsMaterial?o(m,g,v,y):g.isSpriteMaterial?l(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===ki&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===ki&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v=t.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let w=e.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*w}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let y;g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let x;g.aoMap?x=g.aoMap:g.lightMap&&(x=g.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uv2Transform.value.copy(x.matrix))}function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function a(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=y*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}function l(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function u(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function c(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function d(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===ki&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}function p(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Tte(e,t,r,i){let n={},s={},a=[],o=r.isWebGL2?e.getParameter(35375):0;function l(y,x){let w=x.program;i.uniformBlockBinding(y,w)}function u(y,x){let w=n[y.id];w===void 0&&(p(y),w=h(y),n[y.id]=w,y.addEventListener("dispose",g));let S=x.program;i.updateUBOMapping(y,S);let _=t.render.frame;s[y.id]!==_&&(d(y),s[y.id]=_)}function h(y){let x=c();y.__bindingPointIndex=x;let w=e.createBuffer(),S=y.__size,_=y.usage;return e.bindBuffer(35345,w),e.bufferData(35345,S,_),e.bindBuffer(35345,null),e.bindBufferBase(35345,x,w),w}function c(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=n[y.id],w=y.uniforms,S=y.__cache;e.bindBuffer(35345,x);for(let _=0,A=w.length;_<A;_++){let M=w[_];if(f(M,_,S)===!0){let T=M.__offset,C=Array.isArray(M.value)?M.value:[M.value],L=0;for(let I=0;I<C.length;I++){let k=C[I],z=m(k);typeof k=="number"?(M.__data[0]=k,e.bufferSubData(35345,T+L,M.__data)):k.isMatrix3?(M.__data[0]=k.elements[0],M.__data[1]=k.elements[1],M.__data[2]=k.elements[2],M.__data[3]=k.elements[0],M.__data[4]=k.elements[3],M.__data[5]=k.elements[4],M.__data[6]=k.elements[5],M.__data[7]=k.elements[0],M.__data[8]=k.elements[6],M.__data[9]=k.elements[7],M.__data[10]=k.elements[8],M.__data[11]=k.elements[0]):(k.toArray(M.__data,L),L+=z.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,T,M.__data)}}e.bindBuffer(35345,null)}function f(y,x,w){let S=y.value;if(w[x]===void 0){if(typeof S=="number")w[x]=S;else{let _=Array.isArray(S)?S:[S],A=[];for(let M=0;M<_.length;M++)A.push(_[M].clone());w[x]=A}return!0}else if(typeof S=="number"){if(w[x]!==S)return w[x]=S,!0}else{let _=Array.isArray(w[x])?w[x]:[w[x]],A=Array.isArray(S)?S:[S];for(let M=0;M<_.length;M++){let T=_[M];if(T.equals(A[M])===!1)return T.copy(A[M]),!0}}return!1}function p(y){let x=y.uniforms,w=0,S=16,_=0;for(let A=0,M=x.length;A<M;A++){let T=x[A],C={boundary:0,storage:0},L=Array.isArray(T.value)?T.value:[T.value];for(let I=0,k=L.length;I<k;I++){let z=L[I],V=m(z);C.boundary+=V.boundary,C.storage+=V.storage}if(T.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=w,A>0){_=w%S;let I=S-_;_!==0&&I-C.boundary<0&&(w+=S-_,T.__offset=w)}w+=C.storage}return _=w%S,_>0&&(w+=S-_),y.__size=w,y.__cache={},this}function m(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){let x=y.target;x.removeEventListener("dispose",g);let w=a.indexOf(x.__bindingPointIndex);a.splice(w,1),e.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function v(){for(let y in n)e.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:u,dispose:v}}function Cte(){let e=mx("canvas");return e.style.display="block",e}function C4(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:Cte(),r=e.context!==void 0?e.context:null,i=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,h;r!==null?h=r.getContextAttributes().alpha:h=e.alpha!==void 0?e.alpha:!1;let c=null,d=null,f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=yo,this.physicallyCorrectLights=!1,this.toneMapping=Al,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,x=null,w=-1,S=null,_=new Lt,A=new Lt,M=null,T=t.width,C=t.height,L=1,I=null,k=null,z=new Lt(0,0,T,C),V=new Lt(0,0,T,C),K=!1,q=new uD,O=!1,W=!1,N=null,B=new Oe,j=new J,Q=new P,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return x===null?L:1}let $=r;function se(X,le){for(let Me=0;Me<X.length;Me++){let ee=X[Me],we=t.getContext(ee,le);if(we!==null)return we}return null}try{let X={alpha:!0,depth:i,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${fp}`),t.addEventListener("webglcontextlost",ne,!1),t.addEventListener("webglcontextrestored",oe,!1),t.addEventListener("webglcontextcreationerror",ve,!1),$===null){let le=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&le.shift(),$=se(le,X),$===null)throw se(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(X){throw console.error("THREE.WebGLRenderer: "+X.message),X}let re,ae,ce,me,be,Ae,$e,Le,Qe,Xe,Re,Ie,Ge,He,Y,U,he,Ee,Ce,ke,Ye,De,xe,et;function ot(){re=new jJ($),ae=new kJ($,re,e),re.init(ae),De=new _te($,re,ae),ce=new wte($,re,ae),me=new WJ,be=new ote,Ae=new bte($,re,ce,be,ae,De,me),$e=new NJ(m),Le=new UJ(m),Qe=new JQ($,ae),xe=new IJ($,re,Qe,ae),Xe=new HJ($,Qe,me,xe),Re=new XJ($,Xe,Qe,me),Ce=new qJ($,ae,Ae),U=new zJ(be),Ie=new ate(m,$e,Le,re,ae,xe,U),Ge=new Ate(m,be),He=new ute,Y=new mte(re,ae),Ee=new LJ(m,$e,Le,ce,Re,h,a),he=new xte(m,Re,ae),et=new Tte($,me,ae,ce),ke=new RJ($,re,me,ae),Ye=new VJ($,re,me,ae),me.programs=Ie.programs,m.capabilities=ae,m.extensions=re,m.properties=be,m.renderLists=He,m.shadowMap=he,m.state=ce,m.info=me}ot();let ut=new Ete(m,$);this.xr=ut,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){let X=re.get("WEBGL_lose_context");X&&X.loseContext()},this.forceContextRestore=function(){let X=re.get("WEBGL_lose_context");X&&X.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(X){X!==void 0&&(L=X,this.setSize(T,C,!1))},this.getSize=function(X){return X.set(T,C)},this.setSize=function(X,le,Me){if(ut.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=X,C=le,t.width=Math.floor(X*L),t.height=Math.floor(le*L),Me!==!1&&(t.style.width=X+"px",t.style.height=le+"px"),this.setViewport(0,0,X,le)},this.getDrawingBufferSize=function(X){return X.set(T*L,C*L).floor()},this.setDrawingBufferSize=function(X,le,Me){T=X,C=le,L=Me,t.width=Math.floor(X*Me),t.height=Math.floor(le*Me),this.setViewport(0,0,X,le)},this.getCurrentViewport=function(X){return X.copy(_)},this.getViewport=function(X){return X.copy(z)},this.setViewport=function(X,le,Me,ee){X.isVector4?z.set(X.x,X.y,X.z,X.w):z.set(X,le,Me,ee),ce.viewport(_.copy(z).multiplyScalar(L).floor())},this.getScissor=function(X){return X.copy(V)},this.setScissor=function(X,le,Me,ee){X.isVector4?V.set(X.x,X.y,X.z,X.w):V.set(X,le,Me,ee),ce.scissor(A.copy(V).multiplyScalar(L).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(X){ce.setScissorTest(K=X)},this.setOpaqueSort=function(X){I=X},this.setTransparentSort=function(X){k=X},this.getClearColor=function(X){return X.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(X=!0,le=!0,Me=!0){let ee=0;X&&(ee|=16384),le&&(ee|=256),Me&&(ee|=1024),$.clear(ee)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ne,!1),t.removeEventListener("webglcontextrestored",oe,!1),t.removeEventListener("webglcontextcreationerror",ve,!1),He.dispose(),Y.dispose(),be.dispose(),$e.dispose(),Le.dispose(),Re.dispose(),xe.dispose(),et.dispose(),Ie.dispose(),ut.dispose(),ut.removeEventListener("sessionstart",_e),ut.removeEventListener("sessionend",Ve),N&&(N.dispose(),N=null),ct.stop()};function ne(X){X.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function oe(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let X=me.autoReset,le=he.enabled,Me=he.autoUpdate,ee=he.needsUpdate,we=he.type;ot(),me.autoReset=X,he.enabled=le,he.autoUpdate=Me,he.needsUpdate=ee,he.type=we}function ve(X){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",X.statusMessage)}function ze(X){let le=X.target;le.removeEventListener("dispose",ze),rt(le)}function rt(X){Z(X),be.remove(X)}function Z(X){let le=be.get(X).programs;le!==void 0&&(le.forEach(function(Me){Ie.releaseProgram(Me)}),X.isShaderMaterial&&Ie.releaseShaderCache(X))}this.renderBufferDirect=function(X,le,Me,ee,we,tt){le===null&&(le=H);let lt=we.isMesh&&we.matrixWorld.determinant()<0,it=$i(X,le,Me,ee,we);ce.setMaterial(ee,lt);let vt=Me.index,Et=1;ee.wireframe===!0&&(vt=Xe.getWireframeAttribute(Me),Et=2);let Tt=Me.drawRange,It=Me.attributes.position,Ir=Tt.start*Et,fn=(Tt.start+Tt.count)*Et;tt!==null&&(Ir=Math.max(Ir,tt.start*Et),fn=Math.min(fn,(tt.start+tt.count)*Et)),vt!==null?(Ir=Math.max(Ir,0),fn=Math.min(fn,vt.count)):It!=null&&(Ir=Math.max(Ir,0),fn=Math.min(fn,It.count));let ra=fn-Ir;if(ra<0||ra===1/0)return;xe.setup(we,ee,it,Me,vt);let ko,Nt=ke;if(vt!==null&&(ko=Qe.get(vt),Nt=Ye,Nt.setIndex(ko)),we.isMesh)ee.wireframe===!0?(ce.setLineWidth(ee.wireframeLinewidth*G()),Nt.setMode(1)):Nt.setMode(4);else if(we.isLine){let Ht=ee.linewidth;Ht===void 0&&(Ht=1),ce.setLineWidth(Ht*G()),we.isLineSegments?Nt.setMode(1):we.isLineLoop?Nt.setMode(2):Nt.setMode(3)}else we.isPoints?Nt.setMode(0):we.isSprite&&Nt.setMode(4);if(we.isInstancedMesh)Nt.renderInstances(Ir,ra,we.count);else if(Me.isInstancedBufferGeometry){let Ht=Me._maxInstanceCount!==void 0?Me._maxInstanceCount:1/0,Rp=Math.min(Me.instanceCount,Ht);Nt.renderInstances(Ir,ra,Rp)}else Nt.render(Ir,ra)},this.compile=function(X,le){function Me(ee,we,tt){ee.transparent===!0&&ee.side===ds&&ee.forceSinglePass===!1?(ee.side=ki,ee.needsUpdate=!0,oi(ee,we,tt),ee.side=Ca,ee.needsUpdate=!0,oi(ee,we,tt),ee.side=ds):oi(ee,we,tt)}d=Y.get(X),d.init(),p.push(d),X.traverseVisible(function(ee){ee.isLight&&ee.layers.test(le.layers)&&(d.pushLight(ee),ee.castShadow&&d.pushShadow(ee))}),d.setupLights(m.physicallyCorrectLights),X.traverse(function(ee){let we=ee.material;if(we)if(Array.isArray(we))for(let tt=0;tt<we.length;tt++){let lt=we[tt];Me(lt,X,ee)}else Me(we,X,ee)}),p.pop(),d=null};let ie=null;function de(X){ie&&ie(X)}function _e(){ct.stop()}function Ve(){ct.start()}let ct=new _4;ct.setAnimationLoop(de),typeof self<"u"&&ct.setContext(self),this.setAnimationLoop=function(X){ie=X,ut.setAnimationLoop(X),X===null?ct.stop():ct.start()},ut.addEventListener("sessionstart",_e),ut.addEventListener("sessionend",Ve),this.render=function(X,le){if(le!==void 0&&le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;X.matrixWorldAutoUpdate===!0&&X.updateMatrixWorld(),le.parent===null&&le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),ut.enabled===!0&&ut.isPresenting===!0&&(ut.cameraAutoUpdate===!0&&ut.updateCamera(le),le=ut.getCamera()),X.isScene===!0&&X.onBeforeRender(m,X,le,x),d=Y.get(X,p.length),d.init(),p.push(d),B.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),q.setFromProjectionMatrix(B),W=this.localClippingEnabled,O=U.init(this.clippingPlanes,W),c=He.get(X,f.length),c.init(),f.push(c),yt(X,le,0,m.sortObjects),c.finish(),m.sortObjects===!0&&c.sort(I,k),O===!0&&U.beginShadows();let Me=d.state.shadowsArray;if(he.render(Me,X,le),O===!0&&U.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ee.render(c,X),d.setupLights(m.physicallyCorrectLights),le.isArrayCamera){let ee=le.cameras;for(let we=0,tt=ee.length;we<tt;we++){let lt=ee[we];Dt(c,X,lt,lt.viewport)}}else Dt(c,X,le);x!==null&&(Ae.updateMultisampleRenderTarget(x),Ae.updateRenderTargetMipmap(x)),X.isScene===!0&&X.onAfterRender(m,X,le),xe.resetDefaultState(),w=-1,S=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,f.pop(),f.length>0?c=f[f.length-1]:c=null};function yt(X,le,Me,ee){if(X.visible===!1)return;if(X.layers.test(le.layers)){if(X.isGroup)Me=X.renderOrder;else if(X.isLOD)X.autoUpdate===!0&&X.update(le);else if(X.isLight)d.pushLight(X),X.castShadow&&d.pushShadow(X);else if(X.isSprite){if(!X.frustumCulled||q.intersectsSprite(X)){ee&&Q.setFromMatrixPosition(X.matrixWorld).applyMatrix4(B);let tt=Re.update(X),lt=X.material;lt.visible&&c.push(X,tt,lt,Me,Q.z,null)}}else if((X.isMesh||X.isLine||X.isPoints)&&(X.isSkinnedMesh&&X.skeleton.frame!==me.render.frame&&(X.skeleton.update(),X.skeleton.frame=me.render.frame),!X.frustumCulled||q.intersectsObject(X))){ee&&Q.setFromMatrixPosition(X.matrixWorld).applyMatrix4(B);let tt=Re.update(X),lt=X.material;if(Array.isArray(lt)){let it=tt.groups;for(let vt=0,Et=it.length;vt<Et;vt++){let Tt=it[vt],It=lt[Tt.materialIndex];It&&It.visible&&c.push(X,tt,It,Me,Q.z,Tt)}}else lt.visible&&c.push(X,tt,lt,Me,Q.z,null)}}let we=X.children;for(let tt=0,lt=we.length;tt<lt;tt++)yt(we[tt],le,Me,ee)}function Dt(X,le,Me,ee){let we=X.opaque,tt=X.transmissive,lt=X.transparent;d.setupLightsView(Me),O===!0&&U.setGlobalState(m.clippingPlanes,Me),tt.length>0&&nr(we,le,Me),ee&&ce.viewport(_.copy(ee)),we.length>0&&Qt(we,le,Me),tt.length>0&&Qt(tt,le,Me),lt.length>0&&Qt(lt,le,Me),ce.buffers.depth.setTest(!0),ce.buffers.depth.setMask(!0),ce.buffers.color.setMask(!0),ce.setPolygonOffset(!1)}function nr(X,le,Me){let ee=ae.isWebGL2;N===null&&(N=new cr(1,1,{generateMipmaps:!0,type:re.has("EXT_color_buffer_half_float")?Ff:cn,minFilter:Bf,samples:ee&&s===!0?4:0})),m.getDrawingBufferSize(j),ee?N.setSize(j.x,j.y):N.setSize(px(j.x),px(j.y));let we=m.getRenderTarget();m.setRenderTarget(N),m.clear();let tt=m.toneMapping;m.toneMapping=Al,Qt(X,le,Me),m.toneMapping=tt,Ae.updateMultisampleRenderTarget(N),Ae.updateRenderTargetMipmap(N),m.setRenderTarget(we)}function Qt(X,le,Me){let ee=le.isScene===!0?le.overrideMaterial:null;for(let we=0,tt=X.length;we<tt;we++){let lt=X[we],it=lt.object,vt=lt.geometry,Et=ee===null?lt.material:ee,Tt=lt.group;it.layers.test(Me.layers)&&Vr(it,le,Me,vt,Et,Tt)}}function Vr(X,le,Me,ee,we,tt){X.onBeforeRender(m,le,Me,ee,we,tt),X.modelViewMatrix.multiplyMatrices(Me.matrixWorldInverse,X.matrixWorld),X.normalMatrix.getNormalMatrix(X.modelViewMatrix),we.onBeforeRender(m,le,Me,ee,X,tt),we.transparent===!0&&we.side===ds&&we.forceSinglePass===!1?(we.side=ki,we.needsUpdate=!0,m.renderBufferDirect(Me,le,ee,we,X,tt),we.side=Ca,we.needsUpdate=!0,m.renderBufferDirect(Me,le,ee,we,X,tt),we.side=ds):m.renderBufferDirect(Me,le,ee,we,X,tt),X.onAfterRender(m,le,Me,ee,we,tt)}function oi(X,le,Me){le.isScene!==!0&&(le=H);let ee=be.get(X),we=d.state.lights,tt=d.state.shadowsArray,lt=we.state.version,it=Ie.getParameters(X,we.state,tt,le,Me),vt=Ie.getProgramCacheKey(it),Et=ee.programs;ee.environment=X.isMeshStandardMaterial?le.environment:null,ee.fog=le.fog,ee.envMap=(X.isMeshStandardMaterial?Le:$e).get(X.envMap||ee.environment),Et===void 0&&(X.addEventListener("dispose",ze),Et=new Map,ee.programs=Et);let Tt=Et.get(vt);if(Tt!==void 0){if(ee.currentProgram===Tt&&ee.lightsStateVersion===lt)return Es(X,it),Tt}else it.uniforms=Ie.getUniforms(X),X.onBuild(Me,it,m),X.onBeforeCompile(it,m),Tt=Ie.acquireProgram(it,vt),Et.set(vt,Tt),ee.uniforms=it.uniforms;let It=ee.uniforms;(!X.isShaderMaterial&&!X.isRawShaderMaterial||X.clipping===!0)&&(It.clippingPlanes=U.uniform),Es(X,it),ee.needsLights=Ql(X),ee.lightsStateVersion=lt,ee.needsLights&&(It.ambientLightColor.value=we.state.ambient,It.lightProbe.value=we.state.probe,It.directionalLights.value=we.state.directional,It.directionalLightShadows.value=we.state.directionalShadow,It.spotLights.value=we.state.spot,It.spotLightShadows.value=we.state.spotShadow,It.rectAreaLights.value=we.state.rectArea,It.ltc_1.value=we.state.rectAreaLTC1,It.ltc_2.value=we.state.rectAreaLTC2,It.pointLights.value=we.state.point,It.pointLightShadows.value=we.state.pointShadow,It.hemisphereLights.value=we.state.hemi,It.directionalShadowMap.value=we.state.directionalShadowMap,It.directionalShadowMatrix.value=we.state.directionalShadowMatrix,It.spotShadowMap.value=we.state.spotShadowMap,It.spotLightMatrix.value=we.state.spotLightMatrix,It.spotLightMap.value=we.state.spotLightMap,It.pointShadowMap.value=we.state.pointShadowMap,It.pointShadowMatrix.value=we.state.pointShadowMatrix);let Ir=Tt.getUniforms(),fn=w1.seqWithValue(Ir.seq,It);return ee.currentProgram=Tt,ee.uniformsList=fn,Tt}function Es(X,le){let Me=be.get(X);Me.outputEncoding=le.outputEncoding,Me.instancing=le.instancing,Me.skinning=le.skinning,Me.morphTargets=le.morphTargets,Me.morphNormals=le.morphNormals,Me.morphColors=le.morphColors,Me.morphTargetsCount=le.morphTargetsCount,Me.numClippingPlanes=le.numClippingPlanes,Me.numIntersection=le.numClipIntersection,Me.vertexAlphas=le.vertexAlphas,Me.vertexTangents=le.vertexTangents,Me.toneMapping=le.toneMapping}function $i(X,le,Me,ee,we){le.isScene!==!0&&(le=H),Ae.resetTextureUnits();let tt=le.fog,lt=ee.isMeshStandardMaterial?le.environment:null,it=x===null?m.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:yo,vt=(ee.isMeshStandardMaterial?Le:$e).get(ee.envMap||lt),Et=ee.vertexColors===!0&&!!Me.attributes.color&&Me.attributes.color.itemSize===4,Tt=!!ee.normalMap&&!!Me.attributes.tangent,It=!!Me.morphAttributes.position,Ir=!!Me.morphAttributes.normal,fn=!!Me.morphAttributes.color,ra=ee.toneMapped?m.toneMapping:Al,ko=Me.morphAttributes.position||Me.morphAttributes.normal||Me.morphAttributes.color,Nt=ko!==void 0?ko.length:0,Ht=be.get(ee),Rp=d.state.lights;if(O===!0&&(W===!0||X!==S)){let Qi=X===S&&ee.id===w;U.setState(ee,X,Qi)}let jh=!1;ee.version===Ht.__version?(Ht.needsLights&&Ht.lightsStateVersion!==Rp.state.version||Ht.outputEncoding!==it||we.isInstancedMesh&&Ht.instancing===!1||!we.isInstancedMesh&&Ht.instancing===!0||we.isSkinnedMesh&&Ht.skinning===!1||!we.isSkinnedMesh&&Ht.skinning===!0||Ht.envMap!==vt||ee.fog===!0&&Ht.fog!==tt||Ht.numClippingPlanes!==void 0&&(Ht.numClippingPlanes!==U.numPlanes||Ht.numIntersection!==U.numIntersection)||Ht.vertexAlphas!==Et||Ht.vertexTangents!==Tt||Ht.morphTargets!==It||Ht.morphNormals!==Ir||Ht.morphColors!==fn||Ht.toneMapping!==ra||ae.isWebGL2===!0&&Ht.morphTargetsCount!==Nt)&&(jh=!0):(jh=!0,Ht.__version=ee.version);let ka=Ht.currentProgram;jh===!0&&(ka=oi(ee,le,we));let o0=!1,vc=!1,kp=!1,mi=ka.getUniforms(),zo=Ht.uniforms;if(ce.useProgram(ka.program)&&(o0=!0,vc=!0,kp=!0),ee.id!==w&&(w=ee.id,vc=!0),o0||S!==X){if(mi.setValue($,"projectionMatrix",X.projectionMatrix),ae.logarithmicDepthBuffer&&mi.setValue($,"logDepthBufFC",2/(Math.log(X.far+1)/Math.LN2)),S!==X&&(S=X,vc=!0,kp=!0),ee.isShaderMaterial||ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshStandardMaterial||ee.envMap){let Qi=mi.map.cameraPosition;Qi!==void 0&&Qi.setValue($,Q.setFromMatrixPosition(X.matrixWorld))}(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial)&&mi.setValue($,"isOrthographic",X.isOrthographicCamera===!0),(ee.isMeshPhongMaterial||ee.isMeshToonMaterial||ee.isMeshLambertMaterial||ee.isMeshBasicMaterial||ee.isMeshStandardMaterial||ee.isShaderMaterial||ee.isShadowMaterial||we.isSkinnedMesh)&&mi.setValue($,"viewMatrix",X.matrixWorldInverse)}if(we.isSkinnedMesh){mi.setOptional($,we,"bindMatrix"),mi.setOptional($,we,"bindMatrixInverse");let Qi=we.skeleton;Qi&&(ae.floatVertexTextures?(Qi.boneTexture===null&&Qi.computeBoneTexture(),mi.setValue($,"boneTexture",Qi.boneTexture,Ae),mi.setValue($,"boneTextureSize",Qi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let zp=Me.morphAttributes;if((zp.position!==void 0||zp.normal!==void 0||zp.color!==void 0&&ae.isWebGL2===!0)&&Ce.update(we,Me,ee,ka),(vc||Ht.receiveShadow!==we.receiveShadow)&&(Ht.receiveShadow=we.receiveShadow,mi.setValue($,"receiveShadow",we.receiveShadow)),ee.isMeshGouraudMaterial&&ee.envMap!==null&&(zo.envMap.value=vt,zo.flipEnvMap.value=vt.isCubeTexture&&vt.isRenderTargetTexture===!1?-1:1),vc&&(mi.setValue($,"toneMappingExposure",m.toneMappingExposure),Ht.needsLights&&qe(zo,kp),tt&&ee.fog===!0&&Ge.refreshFogUniforms(zo,tt),Ge.refreshMaterialUniforms(zo,ee,L,C,N),w1.upload($,Ht.uniformsList,zo,Ae)),ee.isShaderMaterial&&ee.uniformsNeedUpdate===!0&&(w1.upload($,Ht.uniformsList,zo,Ae),ee.uniformsNeedUpdate=!1),ee.isSpriteMaterial&&mi.setValue($,"center",we.center),mi.setValue($,"modelViewMatrix",we.modelViewMatrix),mi.setValue($,"normalMatrix",we.normalMatrix),mi.setValue($,"modelMatrix",we.matrixWorld),we.previousModelViewMatrix&&mi.setValue($,"previousModelViewMatrix",we.previousModelViewMatrix),X.previousProjectionMatrix&&mi.setValue($,"previousProjectionMatrix",X.previousProjectionMatrix),ee.isShaderMaterial||ee.isRawShaderMaterial){let Qi=ee.uniformsGroups;for(let Hh=0,Qb=Qi.length;Hh<Qb;Hh++)if(ae.isWebGL2){let l0=Qi[Hh];et.update(l0,ka),et.bind(l0,ka)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ka}function qe(X,le){X.ambientLightColor.needsUpdate=le,X.lightProbe.needsUpdate=le,X.directionalLights.needsUpdate=le,X.directionalLightShadows.needsUpdate=le,X.pointLights.needsUpdate=le,X.pointLightShadows.needsUpdate=le,X.spotLights.needsUpdate=le,X.spotLightShadows.needsUpdate=le,X.rectAreaLights.needsUpdate=le,X.hemisphereLights.needsUpdate=le}function Ql(X){return X.isMeshLambertMaterial||X.isMeshToonMaterial||X.isMeshPhongMaterial||X.isMeshStandardMaterial||X.isShadowMaterial||X.isShaderMaterial&&X.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(X,le,Me){be.get(X.texture).__webglTexture=le,be.get(X.depthTexture).__webglTexture=Me;let ee=be.get(X);ee.__hasExternalTextures=!0,ee.__hasExternalTextures&&(ee.__autoAllocateDepthBuffer=Me===void 0,ee.__autoAllocateDepthBuffer||re.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ee.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(X,le){let Me=be.get(X);Me.__webglFramebuffer=le,Me.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(X,le=0,Me=0){x=X,v=le,y=Me;let ee=!0,we=null,tt=!1,lt=!1;if(X){let it=be.get(X);it.__useDefaultFramebuffer!==void 0?(ce.bindFramebuffer(36160,null),ee=!1):it.__webglFramebuffer===void 0?Ae.setupRenderTarget(X):it.__hasExternalTextures&&Ae.rebindTextures(X,be.get(X.texture).__webglTexture,be.get(X.depthTexture).__webglTexture);let vt=X.texture;(vt.isData3DTexture||vt.isDataArrayTexture||vt.isCompressedArrayTexture)&&(lt=!0);let Et=be.get(X).__webglFramebuffer;X.isWebGLCubeRenderTarget?(we=Et[le],tt=!0):ae.isWebGL2&&X.samples>0&&Ae.useMultisampledRTT(X)===!1?we=be.get(X).__webglMultisampledFramebuffer:we=Et,_.copy(X.viewport),A.copy(X.scissor),M=X.scissorTest}else _.copy(z).multiplyScalar(L).floor(),A.copy(V).multiplyScalar(L).floor(),M=K;if(ce.bindFramebuffer(36160,we)&&ae.drawBuffers&&ee&&ce.drawBuffers(X,we),ce.viewport(_),ce.scissor(A),ce.setScissorTest(M),tt){let it=be.get(X.texture);$.framebufferTexture2D(36160,36064,34069+le,it.__webglTexture,Me)}else if(lt){let it=be.get(X.texture),vt=le||0;$.framebufferTextureLayer(36160,36064,it.__webglTexture,Me||0,vt)}w=-1},this.readRenderTargetPixels=function(X,le,Me,ee,we,tt,lt){if(!(X&&X.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let it=be.get(X).__webglFramebuffer;if(X.isWebGLCubeRenderTarget&&lt!==void 0&&(it=it[lt]),it){ce.bindFramebuffer(36160,it);try{let vt=X.texture,Et=vt.format,Tt=vt.type;if(Et!==Us&&De.convert(Et)!==$.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let It=Tt===Ff&&(re.has("EXT_color_buffer_half_float")||ae.isWebGL2&&re.has("EXT_color_buffer_float"));if(Tt!==cn&&De.convert(Tt)!==$.getParameter(35738)&&!(Tt===fs&&(ae.isWebGL2||re.has("OES_texture_float")||re.has("WEBGL_color_buffer_float")))&&!It){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}le>=0&&le<=X.width-ee&&Me>=0&&Me<=X.height-we&&$.readPixels(le,Me,ee,we,De.convert(Et),De.convert(Tt),tt)}finally{let vt=x!==null?be.get(x).__webglFramebuffer:null;ce.bindFramebuffer(36160,vt)}}},this.copyFramebufferToTexture=function(X,le,Me=0){let ee=Math.pow(2,-Me),we=Math.floor(le.image.width*ee),tt=Math.floor(le.image.height*ee);Ae.setTexture2D(le,0),$.copyTexSubImage2D(3553,Me,0,0,X.x,X.y,we,tt),ce.unbindTexture()},this.copyTextureToTexture=function(X,le,Me,ee=0){let we=le.image.width,tt=le.image.height,lt=De.convert(Me.format),it=De.convert(Me.type);Ae.setTexture2D(Me,0),$.pixelStorei(37440,Me.flipY),$.pixelStorei(37441,Me.premultiplyAlpha),$.pixelStorei(3317,Me.unpackAlignment),le.isDataTexture?$.texSubImage2D(3553,ee,X.x,X.y,we,tt,lt,it,le.image.data):le.isCompressedTexture?$.compressedTexSubImage2D(3553,ee,X.x,X.y,le.mipmaps[0].width,le.mipmaps[0].height,lt,le.mipmaps[0].data):$.texSubImage2D(3553,ee,X.x,X.y,lt,it,le.image),ee===0&&Me.generateMipmaps&&$.generateMipmap(3553),ce.unbindTexture()},this.copyTextureToTexture3D=function(X,le,Me,ee,we=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let tt=X.max.x-X.min.x+1,lt=X.max.y-X.min.y+1,it=X.max.z-X.min.z+1,vt=De.convert(ee.format),Et=De.convert(ee.type),Tt;if(ee.isData3DTexture)Ae.setTexture3D(ee,0),Tt=32879;else if(ee.isDataArrayTexture)Ae.setTexture2DArray(ee,0),Tt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei(37440,ee.flipY),$.pixelStorei(37441,ee.premultiplyAlpha),$.pixelStorei(3317,ee.unpackAlignment);let It=$.getParameter(3314),Ir=$.getParameter(32878),fn=$.getParameter(3316),ra=$.getParameter(3315),ko=$.getParameter(32877),Nt=Me.isCompressedTexture?Me.mipmaps[0]:Me.image;$.pixelStorei(3314,Nt.width),$.pixelStorei(32878,Nt.height),$.pixelStorei(3316,X.min.x),$.pixelStorei(3315,X.min.y),$.pixelStorei(32877,X.min.z),Me.isDataTexture||Me.isData3DTexture?$.texSubImage3D(Tt,we,le.x,le.y,le.z,tt,lt,it,vt,Et,Nt.data):Me.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(Tt,we,le.x,le.y,le.z,tt,lt,it,vt,Nt.data)):$.texSubImage3D(Tt,we,le.x,le.y,le.z,tt,lt,it,vt,Et,Nt),$.pixelStorei(3314,It),$.pixelStorei(32878,Ir),$.pixelStorei(3316,fn),$.pixelStorei(3315,ra),$.pixelStorei(32877,ko),we===0&&ee.generateMipmaps&&$.generateMipmap(Tt),ce.unbindTexture()},this.initTexture=function(X){X.isCubeTexture?Ae.setTextureCube(X,0):X.isData3DTexture?Ae.setTexture3D(X,0):X.isDataArrayTexture||X.isCompressedArrayTexture?Ae.setTexture2DArray(X,0):Ae.setTexture2D(X,0),ce.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,ce.reset(),xe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Dte=class extends C4{};Dte.prototype.isWebGL1Renderer=!0;var D4=class{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new gt(e),this.near=t,this.far=r}clone(){return new D4(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Yu=class extends dr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,r){return super.copy(t,r),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let r=super.toJSON(t);return this.fog!==null&&(r.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(r.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(r.object.backgroundIntensity=this.backgroundIntensity),r}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},Pte=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=JE,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ws()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},gn=new P,iA=class{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)gn.fromBufferAttribute(this,t),gn.applyMatrix4(e),this.setXYZ(t,gn.x,gn.y,gn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)gn.fromBufferAttribute(this,t),gn.applyNormalMatrix(e),this.setXYZ(t,gn.x,gn.y,gn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)gn.fromBufferAttribute(this,t),gn.transformDirection(e),this.setXYZ(t,gn.x,gn.y,gn.z);return this}setX(e,t){return this.normalized&&(t=xr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=xr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=xr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=xr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=wl(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=wl(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=wl(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=wl(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=xr(t,this.array),r=xr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=xr(t,this.array),r=xr(r,this.array),i=xr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=xr(t,this.array),r=xr(r,this.array),i=xr(i,this.array),n=xr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let r=0;r<this.count;r++){let i=r*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[i+n])}return new Mt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new iA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let r=0;r<this.count;r++){let i=r*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},P4=class extends dr{constructor(){super(),this.isBone=!0,this.type="Bone"}},gx=class extends Mi{constructor(e=null,t=1,r=1,i,n,s,a,o,l=wr,u=wr,h,c){super(null,s,a,o,l,u,i,n,h,c),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},iI=new Oe,Ote=new Oe,dD=class{constructor(e=[],t=[]){this.uuid=Ws(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new Oe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let r=new Oe;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){let e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:Ote;iI.multiplyMatrices(a,t[n]),iI.toArray(r,n*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new dD(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=p4(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let r=new gx(t,e,e,Us,fs);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){let n=e.bones[r],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new P4),this.bones.push(s),this.boneInverses.push(new Oe().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,r=this.boneInverses;for(let i=0,n=t.length;i<n;i++){let s=t[i];e.bones.push(s.uuid);let a=r[i];e.boneInverses.push(a.toArray())}return e}},Lte=class extends Mt{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},dc=class extends kv{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new gt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},nI=new P,sI=new P,aI=new Oe,_S=new pp,iy=new ys,vx=class extends dr{constructor(e=new _t,t=new dc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,r=[0];for(let i=1,n=t.count;i<n;i++)nI.fromBufferAttribute(t,i-1),sI.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=nI.distanceTo(sI);e.setAttribute("lineDistance",new nt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),iy.copy(r.boundingSphere),iy.applyMatrix4(i),iy.radius+=n,e.ray.intersectsSphere(iy)===!1)return;aI.copy(i).invert(),_S.copy(e.ray).applyMatrix4(aI);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new P,u=new P,h=new P,c=new P,d=this.isLineSegments?2:1,f=r.index,p=r.attributes.position;if(f!==null){let m=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count);for(let v=m,y=g-1;v<y;v+=d){let x=f.getX(v),w=f.getX(v+1);if(l.fromBufferAttribute(p,x),u.fromBufferAttribute(p,w),_S.distanceSqToSegment(l,u,c,h)>o)continue;c.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(c);S<e.near||S>e.far||t.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let m=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count);for(let v=m,y=g-1;v<y;v+=d){if(l.fromBufferAttribute(p,v),u.fromBufferAttribute(p,v+1),_S.distanceSqToSegment(l,u,c,h)>o)continue;c.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(c);x<e.near||x>e.far||t.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,n=r.length;i<n;i++){let s=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=i}}}}},oI=new P,lI=new P,Nv=class extends vx{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,r=[];for(let i=0,n=t.count;i<n;i+=2)oI.fromBufferAttribute(t,i),lI.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+oI.distanceTo(lI);e.setAttribute("lineDistance",new nt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Ite=class extends Mi{constructor(e,t,r,i,n,s,a,o,l){super(e,t,r,i,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:Bt,this.magFilter=n!==void 0?n:Bt,this.generateMipmaps=!1;let u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Co=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],r,i=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)r=this.getPoint(s/e),n+=r.distanceTo(i),t.push(n),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let r=this.getLengths(),i=0,n=r.length,s;t?s=t:s=e*r[n-1];let a=0,o=n-1,l;for(;a<=o;)if(i=Math.floor(a+(o-a)/2),l=r[i]-s,l<0)a=i+1;else if(l>0)o=i-1;else{o=i;break}if(i=o,r[i]===s)return i/(n-1);let u=r[i],h=r[i+1]-u,c=(s-u)/h;return(i+c)/(n-1)}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),i>1&&(i=1);let n=this.getPoint(r),s=this.getPoint(i),a=t||(n.isVector2?new J:new P);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){let r=new P,i=[],n=[],s=[],a=new P,o=new Oe;for(let d=0;d<=e;d++){let f=d/e;i[d]=this.getTangentAt(f,new P)}n[0]=new P,s[0]=new P;let l=Number.MAX_VALUE,u=Math.abs(i[0].x),h=Math.abs(i[0].y),c=Math.abs(i[0].z);u<=l&&(l=u,r.set(1,0,0)),h<=l&&(l=h,r.set(0,1,0)),c<=l&&r.set(0,0,1),a.crossVectors(i[0],r).normalize(),n[0].crossVectors(i[0],a),s[0].crossVectors(i[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();let f=Math.acos(bi(i[d-1].dot(i[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,f))}s[d].crossVectors(i[d],n[d])}if(t===!0){let d=Math.acos(bi(n[0].dot(n[e]),-1,1));d/=e,i[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let f=1;f<=e;f++)n[f].applyMatrix4(o.makeRotationAxis(i[f],d*f)),s[f].crossVectors(i[f],n[f])}return{tangents:i,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},$w=class extends Co{constructor(e=0,t=0,r=1,i=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let r=t||new J,i=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(s?n=0:n=i),this.aClockwise===!0&&!s&&(n===i?n=-i:n=n-i);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),c=o-this.aX,d=l-this.aY;o=c*u-d*h+this.aX,l=c*h+d*u+this.aY}return r.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},Rte=class extends $w{constructor(e,t,r,i,n,s){super(e,t,r,r,i,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function fD(){let e=0,t=0,r=0,i=0;function n(s,a,o,l){e=s,t=o,r=-3*s+3*a-2*o-l,i=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,u){n(a,o,u*(o-s),u*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,u,h,c){let d=(a-s)/u-(o-s)/(u+h)+(o-a)/h,f=(o-a)/h-(l-a)/(h+c)+(l-o)/c;d*=h,f*=h,n(a,o,d,f)},calc:function(s){let a=s*s,o=a*s;return e+t*s+r*a+i*o}}}var ny=new P,SS=new fD,MS=new fD,ES=new fD,kte=class extends Co{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new P){let r=t,i=this.points,n=i.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,u;this.closed||a>0?l=i[(a-1)%n]:(ny.subVectors(i[0],i[1]).add(i[0]),l=ny);let h=i[a%n],c=i[(a+1)%n];if(this.closed||a+2<n?u=i[(a+2)%n]:(ny.subVectors(i[n-1],i[n-2]).add(i[n-1]),u=ny),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,f=Math.pow(l.distanceToSquared(h),d),p=Math.pow(h.distanceToSquared(c),d),m=Math.pow(c.distanceToSquared(u),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),SS.initNonuniformCatmullRom(l.x,h.x,c.x,u.x,f,p,m),MS.initNonuniformCatmullRom(l.y,h.y,c.y,u.y,f,p,m),ES.initNonuniformCatmullRom(l.z,h.z,c.z,u.z,f,p,m)}else this.curveType==="catmullrom"&&(SS.initCatmullRom(l.x,h.x,c.x,u.x,this.tension),MS.initCatmullRom(l.y,h.y,c.y,u.y,this.tension),ES.initCatmullRom(l.z,h.z,c.z,u.z,this.tension));return r.set(SS.calc(o),MS.calc(o),ES.calc(o)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let i=e.points[t];this.points.push(new P().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function uI(e,t,r,i,n){let s=(i-t)*.5,a=(n-r)*.5,o=e*e,l=e*o;return(2*r-2*i+s+a)*l+(-3*r+3*i-2*s-a)*o+s*e+r}function zte(e,t){let r=1-e;return r*r*t}function Nte(e,t){return 2*(1-e)*e*t}function Bte(e,t){return e*e*t}function lg(e,t,r,i){return zte(e,t)+Nte(e,r)+Bte(e,i)}function Fte(e,t){let r=1-e;return r*r*r*t}function Ute(e,t){let r=1-e;return 3*r*r*e*t}function jte(e,t){return 3*(1-e)*e*e*t}function Hte(e,t){return e*e*e*t}function ug(e,t,r,i,n){return Fte(e,t)+Ute(e,r)+jte(e,i)+Hte(e,n)}var ya=class extends Co{constructor(t=new J,r=new J,i=new J,n=new J){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=r,this.v2=i,this.v3=n}getPoint(t,r=new J){let i=r,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return i.set(ug(t,n.x,s.x,a.x,o.x),ug(t,n.y,s.y,a.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},b1=class extends Co{constructor(e=new P,t=new P,r=new P,i=new P){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new P){let r=t,i=this.v0,n=this.v1,s=this.v2,a=this.v3;return r.set(ug(e,i.x,n.x,s.x,a.x),ug(e,i.y,n.y,s.y,a.y),ug(e,i.z,n.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Aa=class extends Co{constructor(t=new J,r=new J){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=r}getPoint(t,r=new J){let i=r;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,r){return this.getPoint(t,r)}getTangent(t,r){let i=r||new J;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},O4=class extends Co{constructor(e=new P,t=new P){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new P){let r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},tc=class extends Co{constructor(e=new J,t=new J,r=new J){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new J){let r=t,i=this.v0,n=this.v1,s=this.v2;return r.set(lg(e,i.x,n.x,s.x),lg(e,i.y,n.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Vte=class extends Co{constructor(e=new P,t=new P,r=new P){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new P){let r=t,i=this.v0,n=this.v1,s=this.v2;return r.set(lg(e,i.x,n.x,s.x),lg(e,i.y,n.y,s.y),lg(e,i.z,n.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},pD=class extends Co{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new J){let r=t,i=this.points,n=(i.length-1)*e,s=Math.floor(n),a=n-s,o=i[s===0?s:s-1],l=i[s],u=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return r.set(uI(a,o.x,l.x,u.x,h.x),uI(a,o.y,l.y,u.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let i=e.points[t];this.points.push(new J().fromArray(i))}return this}},Wte=Object.freeze({__proto__:null,ArcCurve:Rte,CatmullRomCurve3:kte,CubicBezierCurve:ya,CubicBezierCurve3:b1,EllipseCurve:$w,LineCurve:Aa,LineCurve3:O4,QuadraticBezierCurve:tc,QuadraticBezierCurve3:Vte,SplineCurve:pD}),L4=class extends Co{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Aa(t,e))}getPoint(e,t){let r=e*this.getLength(),i=this.getCurveLengths(),n=0;for(;n<i.length;){if(i[n]>=r){let s=i[n]-r,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],r;for(let i=0,n=this.curves;i<n.length;i++){let s=n[i],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let u=o[l];r&&r.equals(u)||(t.push(u),r=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let i=e.curves[t];this.curves.push(new Wte[i.type]().fromJSON(i))}return this}},yx=class extends L4{constructor(e){super(),this.type="Path",this.currentPoint=new J,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let r=new Aa(this.currentPoint.clone(),new J(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){let n=new tc(this.currentPoint.clone(),new J(e,t),new J(r,i));return this.curves.push(n),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,s){let a=new ya(this.currentPoint.clone(),new J(e,t),new J(r,i),new J(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),r=new pD(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,r,i,n,s),this}absarc(e,t,r,i,n,s){return this.absellipse(e,t,r,r,i,n,s),this}ellipse(e,t,r,i,n,s,a,o){let l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,r,i,n,s,a,o),this}absellipse(e,t,r,i,n,s,a,o){let l=new $w(e,t,r,i,n,s,a,o);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},I4=class extends _t{constructor(e=[new J(0,-.5),new J(.5,0),new J(0,.5)],t=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=bi(i,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],u=1/t,h=new P,c=new J,d=new P,f=new P,p=new P,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=g*1,d.y=-m,d.z=g*0,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(p.x,p.y,p.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=g*1,d.y=-m,d.z=g*0,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let v=0;v<=t;v++){let y=r+v*u*i,x=Math.sin(y),w=Math.cos(y);for(let S=0;S<=e.length-1;S++){h.x=e[S].x*x,h.y=e[S].y,h.z=e[S].x*w,s.push(h.x,h.y,h.z),c.x=v/t,c.y=S/(e.length-1),a.push(c.x,c.y);let _=o[3*S+0]*x,A=o[3*S+1],M=o[3*S+0]*w;l.push(_,A,M)}}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){let x=y+v*e.length,w=x,S=x+e.length,_=x+e.length+1,A=x+1;n.push(w,S,A),n.push(_,A,S)}this.setIndex(n),this.setAttribute("position",new nt(s,3)),this.setAttribute("uv",new nt(a,2)),this.setAttribute("normal",new nt(l,3))}static fromJSON(e){return new I4(e.points,e.segments,e.phiStart,e.phiLength)}},mD=class extends _t{constructor(e=1,t=1,r=1,i=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;i=Math.floor(i),n=Math.floor(n);let u=[],h=[],c=[],d=[],f=0,p=[],m=r/2,g=0;v(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new nt(h,3)),this.setAttribute("normal",new nt(c,3)),this.setAttribute("uv",new nt(d,2));function v(){let x=new P,w=new P,S=0,_=(t-e)/r;for(let A=0;A<=n;A++){let M=[],T=A/n,C=T*(t-e)+e;for(let L=0;L<=i;L++){let I=L/i,k=I*o+a,z=Math.sin(k),V=Math.cos(k);w.x=C*z,w.y=-T*r+m,w.z=C*V,h.push(w.x,w.y,w.z),x.set(z,_,V).normalize(),c.push(x.x,x.y,x.z),d.push(I,1-T),M.push(f++)}p.push(M)}for(let A=0;A<i;A++)for(let M=0;M<n;M++){let T=p[M][A],C=p[M+1][A],L=p[M+1][A+1],I=p[M][A+1];u.push(T,C,I),u.push(C,L,I),S+=6}l.addGroup(g,S,0),g+=S}function y(x){let w=f,S=new J,_=new P,A=0,M=x===!0?e:t,T=x===!0?1:-1;for(let L=1;L<=i;L++)h.push(0,m*T,0),c.push(0,T,0),d.push(.5,.5),f++;let C=f;for(let L=0;L<=i;L++){let I=L/i*o+a,k=Math.cos(I),z=Math.sin(I);_.x=M*z,_.y=m*T,_.z=M*k,h.push(_.x,_.y,_.z),c.push(0,T,0),S.x=k*.5+.5,S.y=z*.5*T+.5,d.push(S.x,S.y),f++}for(let L=0;L<i;L++){let I=w+L,k=C+L;x===!0?u.push(k,k+1,I):u.push(k+1,k,I),A+=3}l.addGroup(g,A,x===!0?1:2),g+=A}}static fromJSON(e){return new mD(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},R4=class extends mD{constructor(e=1,t=1,r=32,i=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,r,i,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new R4(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},gD=class extends _t{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};let n=[],s=[];a(i),l(r),u(),this.setAttribute("position",new nt(n,3)),this.setAttribute("normal",new nt(n.slice(),3)),this.setAttribute("uv",new nt(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(v){let y=new P,x=new P,w=new P;for(let S=0;S<t.length;S+=3)d(t[S+0],y),d(t[S+1],x),d(t[S+2],w),o(y,x,w,v)}function o(v,y,x,w){let S=w+1,_=[];for(let A=0;A<=S;A++){_[A]=[];let M=v.clone().lerp(x,A/S),T=y.clone().lerp(x,A/S),C=S-A;for(let L=0;L<=C;L++)L===0&&A===S?_[A][L]=M:_[A][L]=M.clone().lerp(T,L/C)}for(let A=0;A<S;A++)for(let M=0;M<2*(S-A)-1;M++){let T=Math.floor(M/2);M%2===0?(c(_[A][T+1]),c(_[A+1][T]),c(_[A][T])):(c(_[A][T+1]),c(_[A+1][T+1]),c(_[A+1][T]))}}function l(v){let y=new P;for(let x=0;x<n.length;x+=3)y.x=n[x+0],y.y=n[x+1],y.z=n[x+2],y.normalize().multiplyScalar(v),n[x+0]=y.x,n[x+1]=y.y,n[x+2]=y.z}function u(){let v=new P;for(let y=0;y<n.length;y+=3){v.x=n[y+0],v.y=n[y+1],v.z=n[y+2];let x=m(v)/2/Math.PI+.5,w=g(v)/Math.PI+.5;s.push(x,1-w)}f(),h()}function h(){for(let v=0;v<s.length;v+=6){let y=s[v+0],x=s[v+2],w=s[v+4],S=Math.max(y,x,w),_=Math.min(y,x,w);S>.9&&_<.1&&(y<.2&&(s[v+0]+=1),x<.2&&(s[v+2]+=1),w<.2&&(s[v+4]+=1))}}function c(v){n.push(v.x,v.y,v.z)}function d(v,y){let x=v*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function f(){let v=new P,y=new P,x=new P,w=new P,S=new J,_=new J,A=new J;for(let M=0,T=0;M<n.length;M+=9,T+=6){v.set(n[M+0],n[M+1],n[M+2]),y.set(n[M+3],n[M+4],n[M+5]),x.set(n[M+6],n[M+7],n[M+8]),S.set(s[T+0],s[T+1]),_.set(s[T+2],s[T+3]),A.set(s[T+4],s[T+5]),w.copy(v).add(y).add(x).divideScalar(3);let C=m(w);p(S,T+0,v,C),p(_,T+2,y,C),p(A,T+4,x,C)}}function p(v,y,x,w){w<0&&v.x===1&&(s[y]=v.x-1),x.x===0&&x.z===0&&(s[y]=w/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(e){return new gD(e.vertices,e.indices,e.radius,e.details)}},k4=class extends gD{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new k4(e.radius,e.detail)}},xx=class extends yx{constructor(e){super(e),this.uuid=Ws(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let i=e.holes[t];this.holes.push(new yx().fromJSON(i))}return this}},Gte={triangulate:function(e,t,r=2){let i=t&&t.length,n=i?t[0]*r:e.length,s=z4(e,0,n,r,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,u,h,c,d,f;if(i&&(s=Qte(e,t,s,r)),e.length>80*r){o=u=e[0],l=h=e[1];for(let p=r;p<n;p+=r)c=e[p],d=e[p+1],c<o&&(o=c),d<l&&(l=d),c>u&&(u=c),d>h&&(h=d);f=Math.max(u-o,h-l),f=f!==0?32767/f:0}return Xg(s,a,r,o,l,f,0),a}};function z4(e,t,r,i,n){let s,a;if(n===ore(e,t,r,i)>0)for(s=t;s<r;s+=i)a=cI(s,e[s],e[s+1],a);else for(s=r-i;s>=t;s-=i)a=cI(s,e[s],e[s+1],a);return a&&Qw(a,a.next)&&(Qg(a),a=a.next),a}function _h(e,t){if(!e)return e;t||(t=e);let r=e,i;do if(i=!1,!r.steiner&&(Qw(r,r.next)||Ur(r.prev,r,r.next)===0)){if(Qg(r),r=t=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==t);return t}function Xg(e,t,r,i,n,s,a){if(!e)return;!a&&s&&tre(e,i,n,s);let o=e,l,u;for(;e.prev!==e.next;){if(l=e.prev,u=e.next,s?qte(e,i,n,s):Yte(e)){t.push(l.i/r|0),t.push(e.i/r|0),t.push(u.i/r|0),Qg(e),e=u.next,o=u.next;continue}if(e=u,e===o){a?a===1?(e=Xte(_h(e),t,r),Xg(e,t,r,i,n,s,2)):a===2&&$te(e,t,r,i,n,s):Xg(_h(e),t,r,i,n,s,1);break}}}function Yte(e){let t=e.prev,r=e,i=e.next;if(Ur(t,r,i)>=0)return!1;let n=t.x,s=r.x,a=i.x,o=t.y,l=r.y,u=i.y,h=n<s?n<a?n:a:s<a?s:a,c=o<l?o<u?o:u:l<u?l:u,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>u?o:u:l>u?l:u,p=i.next;for(;p!==t;){if(p.x>=h&&p.x<=d&&p.y>=c&&p.y<=f&&ef(n,o,s,l,a,u,p.x,p.y)&&Ur(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function qte(e,t,r,i){let n=e.prev,s=e,a=e.next;if(Ur(n,s,a)>=0)return!1;let o=n.x,l=s.x,u=a.x,h=n.y,c=s.y,d=a.y,f=o<l?o<u?o:u:l<u?l:u,p=h<c?h<d?h:d:c<d?c:d,m=o>l?o>u?o:u:l>u?l:u,g=h>c?h>d?h:d:c>d?c:d,v=nA(f,p,t,r,i),y=nA(m,g,t,r,i),x=e.prevZ,w=e.nextZ;for(;x&&x.z>=v&&w&&w.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==a&&ef(o,h,l,c,u,d,x.x,x.y)&&Ur(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=f&&w.x<=m&&w.y>=p&&w.y<=g&&w!==n&&w!==a&&ef(o,h,l,c,u,d,w.x,w.y)&&Ur(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==n&&x!==a&&ef(o,h,l,c,u,d,x.x,x.y)&&Ur(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=y;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=g&&w!==n&&w!==a&&ef(o,h,l,c,u,d,w.x,w.y)&&Ur(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Xte(e,t,r){let i=e;do{let n=i.prev,s=i.next.next;!Qw(n,s)&&N4(n,i,i.next,s)&&$g(n,s)&&$g(s,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(s.i/r|0),Qg(i),Qg(i.next),i=e=s),i=i.next}while(i!==e);return _h(i)}function $te(e,t,r,i,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&nre(a,o)){let l=B4(a,o);a=_h(a,a.next),l=_h(l,l.next),Xg(a,t,r,i,n,s,0),Xg(l,t,r,i,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function Qte(e,t,r,i){let n=[],s,a,o,l,u;for(s=0,a=t.length;s<a;s++)o=t[s]*i,l=s<a-1?t[s+1]*i:e.length,u=z4(e,o,l,i,!1),u===u.next&&(u.steiner=!0),n.push(ire(u));for(n.sort(Kte),s=0;s<n.length;s++)r=Zte(n[s],r);return r}function Kte(e,t){return e.x-t.x}function Zte(e,t){let r=Jte(e,t);if(!r)return t;let i=B4(r,e);return _h(i,i.next),_h(r,r.next)}function Jte(e,t){let r=t,i=-1/0,n,s=e.x,a=e.y;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){let d=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(d<=s&&d>i&&(i=d,n=r.x<r.next.x?r:r.next,d===s))return n}r=r.next}while(r!==t);if(!n)return null;let o=n,l=n.x,u=n.y,h=1/0,c;r=n;do s>=r.x&&r.x>=l&&s!==r.x&&ef(a<u?s:i,a,l,u,a<u?i:s,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(s-r.x),$g(r,e)&&(c<h||c===h&&(r.x>n.x||r.x===n.x&&ere(n,r)))&&(n=r,h=c)),r=r.next;while(r!==o);return n}function ere(e,t){return Ur(e.prev,e,t.prev)<0&&Ur(t.next,e,e.next)<0}function tre(e,t,r,i){let n=e;do n.z===0&&(n.z=nA(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,rre(n)}function rre(e){let t,r,i,n,s,a,o,l,u=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,i=r,o=0,t=0;t<u&&(o++,i=i.nextZ,!!i);t++);for(l=u;o>0||l>0&&i;)o!==0&&(l===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,u*=2}while(a>1);return e}function nA(e,t,r,i,n){return e=(e-r)*n|0,t=(t-i)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function ire(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function ef(e,t,r,i,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(i-o)>=(r-a)*(t-o)&&(r-a)*(s-o)>=(n-a)*(i-o)}function nre(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!sre(e,t)&&($g(e,t)&&$g(t,e)&&are(e,t)&&(Ur(e.prev,e,t.prev)||Ur(e,t.prev,t))||Qw(e,t)&&Ur(e.prev,e,e.next)>0&&Ur(t.prev,t,t.next)>0)}function Ur(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Qw(e,t){return e.x===t.x&&e.y===t.y}function N4(e,t,r,i){let n=ay(Ur(e,t,r)),s=ay(Ur(e,t,i)),a=ay(Ur(r,i,e)),o=ay(Ur(r,i,t));return!!(n!==s&&a!==o||n===0&&sy(e,r,t)||s===0&&sy(e,i,t)||a===0&&sy(r,e,i)||o===0&&sy(r,t,i))}function sy(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function ay(e){return e>0?1:e<0?-1:0}function sre(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&N4(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function $g(e,t){return Ur(e.prev,e,e.next)<0?Ur(e,t,e.next)>=0&&Ur(e,e.prev,t)>=0:Ur(e,t,e.prev)<0||Ur(e,e.next,t)<0}function are(e,t){let r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e);return i}function B4(e,t){let r=new sA(e.i,e.x,e.y),i=new sA(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function cI(e,t,r,i){let n=new sA(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Qg(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function sA(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ore(e,t,r,i){let n=0;for(let s=t,a=r-i;s<r;s+=i)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var F4=class{static area(e){let t=e.length,r=0;for(let i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return r*.5}static isClockWise(e){return F4.area(e)<0}static triangulateShape(e,t){let r=[],i=[],n=[];hI(e),dI(r,e);let s=e.length;t.forEach(hI);for(let o=0;o<t.length;o++)i.push(s),s+=t[o].length,dI(r,t[o]);let a=Gte.triangulate(r,i);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function hI(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function dI(e,t){for(let r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}var U4=class extends gD{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new U4(e.radius,e.detail)}},vD=class extends _t{constructor(e=1,t=32,r=16,i=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));let o=Math.min(s+a,Math.PI),l=0,u=[],h=new P,c=new P,d=[],f=[],p=[],m=[];for(let g=0;g<=r;g++){let v=[],y=g/r,x=0;g==0&&s==0?x=.5/t:g==r&&o==Math.PI&&(x=-.5/t);for(let w=0;w<=t;w++){let S=w/t;h.x=-e*Math.cos(i+S*n)*Math.sin(s+y*a),h.y=e*Math.cos(s+y*a),h.z=e*Math.sin(i+S*n)*Math.sin(s+y*a),f.push(h.x,h.y,h.z),c.copy(h).normalize(),p.push(c.x,c.y,c.z),m.push(S+x,1-y),v.push(l++)}u.push(v)}for(let g=0;g<r;g++)for(let v=0;v<t;v++){let y=u[g][v+1],x=u[g][v],w=u[g+1][v],S=u[g+1][v+1];(g!==0||s>0)&&d.push(y,x,S),(g!==r-1||o<Math.PI)&&d.push(x,w,S)}this.setIndex(d),this.setAttribute("position",new nt(f,3)),this.setAttribute("normal",new nt(p,3)),this.setAttribute("uv",new nt(m,2))}static fromJSON(e){return new vD(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},j4=class extends _t{constructor(e=1,t=.4,r=64,i=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:s},r=Math.floor(r),i=Math.floor(i);let a=[],o=[],l=[],u=[],h=new P,c=new P,d=new P,f=new P,p=new P,m=new P,g=new P;for(let y=0;y<=r;++y){let x=y/r*n*Math.PI*2;v(x,n,s,e,d),v(x+.01,n,s,e,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let w=0;w<=i;++w){let S=w/i*Math.PI*2,_=-t*Math.cos(S),A=t*Math.sin(S);h.x=d.x+(_*g.x+A*p.x),h.y=d.y+(_*g.y+A*p.y),h.z=d.z+(_*g.z+A*p.z),o.push(h.x,h.y,h.z),c.subVectors(h,d).normalize(),l.push(c.x,c.y,c.z),u.push(y/r),u.push(w/i)}}for(let y=1;y<=r;y++)for(let x=1;x<=i;x++){let w=(i+1)*(y-1)+(x-1),S=(i+1)*y+(x-1),_=(i+1)*y+x,A=(i+1)*(y-1)+x;a.push(w,S,A),a.push(S,_,A)}this.setIndex(a),this.setAttribute("position",new nt(o,3)),this.setAttribute("normal",new nt(l,3)),this.setAttribute("uv",new nt(u,2));function v(y,x,w,S,_){let A=Math.cos(y),M=Math.sin(y),T=w/x*y,C=Math.cos(T);_.x=S*(2+C)*.5*A,_.y=S*(2+C)*M*.5,_.z=S*Math.sin(T)*.5}}static fromJSON(e){return new j4(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function su(e,t,r){return H4(e)?new e.constructor(e.subarray(t,r!==void 0?r:e.length)):e.slice(t,r)}function oy(e,t,r){return!e||!r&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function H4(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lre(e){function t(n,s){return e[n]-e[s]}let r=e.length,i=new Array(r);for(let n=0;n!==r;++n)i[n]=n;return i.sort(t),i}function fI(e,t,r){let i=e.length,n=new e.constructor(i);for(let s=0,a=0;a!==i;++s){let o=r[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function V4(e,t,r,i){let n=1,s=e[0];for(;s!==void 0&&s[i]===void 0;)s=e[n++];if(s===void 0)return;let a=s[i];if(a!==void 0)if(Array.isArray(a))do a=s[i],a!==void 0&&(t.push(s.time),r.push.apply(r,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[i],a!==void 0&&(t.push(s.time),a.toArray(r,r.length)),s=e[n++];while(s!==void 0);else do a=s[i],a!==void 0&&(t.push(s.time),r.push(a)),s=e[n++];while(s!==void 0)}var Kw=class{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{let s;r:{i:if(!(e<i)){for(let a=r+2;;){if(i===void 0){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(n=i,i=t[++r],e<i)break t}s=t.length;break r}if(!(e>=n)){let a=t[1];e<a&&(r=2,n=a);for(let o=r-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===o)break;if(i=n,n=t[--r-1],e>=n)break t}s=r,r=0;break r}break e}for(;r<s;){let a=r+s>>>1;e<t[a]?s=a:r=a+1}if(i=t[r],n=t[r-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let s=0;s!==i;++s)t[s]=r[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},ure=class extends Kw{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Qd,endingEnd:Qd}}intervalChanged_(e,t,r){let i=this.parameterPositions,n=e-2,s=e+1,a=i[n],o=i[s];if(a===void 0)switch(this.getSettings_().endingStart){case Kd:n=e,a=2*t-r;break;case dx:n=i.length-2,a=t+i[n]-i[n+1];break;default:n=e,a=r}if(o===void 0)switch(this.getSettings_().endingEnd){case Kd:s=e,o=2*r-t;break;case dx:s=1,o=r+i[1]-i[0];break;default:s=e-1,o=t}let l=(r-t)*.5,u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-r),this._offsetPrev=n*u,this._offsetNext=s*u}interpolate_(e,t,r,i){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=this._offsetPrev,h=this._offsetNext,c=this._weightPrev,d=this._weightNext,f=(r-t)/(i-t),p=f*f,m=p*f,g=-c*m+2*c*p-c*f,v=(1+c)*m+(-1.5-2*c)*p+(-.5+c)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,x=d*m-d*p;for(let w=0;w!==a;++w)n[w]=g*s[u+w]+v*s[l+w]+y*s[o+w]+x*s[h+w];return n}},W4=class extends Kw{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=(r-t)/(i-t),h=1-u;for(let c=0;c!==a;++c)n[c]=s[l+c]*h+s[o+c]*u;return n}},cre=class extends Kw{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}},Do=class{constructor(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=oy(t,this.TimeBufferType),this.values=oy(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:oy(e.times,Array),values:oy(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new cre(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new W4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ure(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case cx:t=this.InterpolantFactoryMethodDiscrete;break;case hx:t=this.InterpolantFactoryMethodLinear;break;case Q_:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return cx;case this.InterpolantFactoryMethodLinear:return hx;case this.InterpolantFactoryMethodSmooth:return Q_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){let r=this.times,i=r.length,n=0,s=i-1;for(;n!==i&&r[n]<e;)++n;for(;s!==-1&&r[s]>t;)--s;if(++s,n!==0||s!==i){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=su(r,n,s),this.values=su(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let r=this.times,i=this.values,n=r.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=r[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(i!==void 0&&H4(i))for(let a=0,o=i.length;a!==o;++a){let l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=su(this.times),t=su(this.values),r=this.getValueSize(),i=this.getInterpolation()===Q_,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],u=e[a+1];if(l!==u&&(a!==1||l!==e[0]))if(i)o=!0;else{let h=a*r,c=h-r,d=h+r;for(let f=0;f!==r;++f){let p=t[h+f];if(p!==t[c+f]||p!==t[d+f]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let h=a*r,c=s*r;for(let d=0;d!==r;++d)t[c+d]=t[h+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*r,o=s*r,l=0;l!==r;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=su(e,0,s),this.values=su(t,0,s*r)):(this.times=e,this.values=t),this}clone(){let e=su(this.times,0),t=su(this.values,0),r=this.constructor,i=new r(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};Do.prototype.TimeBufferType=Float32Array;Do.prototype.ValueBufferType=Float32Array;Do.prototype.DefaultInterpolation=hx;var yp=class extends Do{};yp.prototype.ValueTypeName="bool";yp.prototype.ValueBufferType=Array;yp.prototype.DefaultInterpolation=cx;yp.prototype.InterpolantFactoryMethodLinear=void 0;yp.prototype.InterpolantFactoryMethodSmooth=void 0;var G4=class extends Do{};G4.prototype.ValueTypeName="color";var wx=class extends Do{};wx.prototype.ValueTypeName="number";var hre=class extends Kw{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(r-t)/(i-t),l=e*a;for(let u=l+a;l!==u;l+=4)kt.slerpFlat(n,0,s,l-a,s,l,o);return n}},Bv=class extends Do{InterpolantFactoryMethodLinear(e){return new hre(this.times,this.values,this.getValueSize(),e)}};Bv.prototype.ValueTypeName="quaternion";Bv.prototype.DefaultInterpolation=hx;Bv.prototype.InterpolantFactoryMethodSmooth=void 0;var xp=class extends Do{};xp.prototype.ValueTypeName="string";xp.prototype.ValueBufferType=Array;xp.prototype.DefaultInterpolation=cx;xp.prototype.InterpolantFactoryMethodLinear=void 0;xp.prototype.InterpolantFactoryMethodSmooth=void 0;var bx=class extends Do{};bx.prototype.ValueTypeName="vector";var aA=class{constructor(e,t=-1,r,i=sD){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=Ws(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],r=e.tracks,i=1/(e.fps||1);for(let s=0,a=r.length;s!==a;++s)t.push(fre(r[s]).scale(i));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=r.length;n!==s;++n)t.push(Do.toJSON(r[n]));return i}static CreateFromMorphTargetSequence(e,t,r,i){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let u=lre(o);o=fI(o,1,u),l=fI(l,1,u),!i&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new wx(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/r))}return new this(e,-1,s)}static findByName(e,t){let r=e;if(!Array.isArray(e)){let i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){let i={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],u=l.name.match(n);if(u&&u.length>1){let h=u[1],c=i[h];c||(i[h]=c=[]),c.push(l)}}let s=[];for(let a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,r));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let r=function(u,h,c,d,f){if(c.length!==0){let p=[],m=[];V4(c,p,m,d),p.length!==0&&f.push(new u(h,p,m))}},i=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let u=0;u<l.length;u++){let h=l[u].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let c={},d;for(d=0;d<h.length;d++)if(h[d].morphTargets)for(let f=0;f<h[d].morphTargets.length;f++)c[h[d].morphTargets[f]]=-1;for(let f in c){let p=[],m=[];for(let g=0;g!==h[d].morphTargets.length;++g){let v=h[d];p.push(v.time),m.push(v.morphTarget===f?1:0)}i.push(new wx(".morphTargetInfluence["+f+"]",p,m))}o=c.length*s}else{let c=".bones["+t[u].name+"]";r(bx,c+".position",h,"pos",i),r(Bv,c+".quaternion",h,"rot",i),r(bx,c+".scale",h,"scl",i)}}return i.length===0?null:new this(n,o,i,a)}resetDuration(){let e=this.tracks,t=0;for(let r=0,i=e.length;r!==i;++r){let n=this.tracks[r];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function dre(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wx;case"vector":case"vector2":case"vector3":case"vector4":return bx;case"color":return G4;case"quaternion":return Bv;case"bool":case"boolean":return yp;case"string":return xp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function fre(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=dre(e.type);if(e.times===void 0){let r=[],i=[];V4(e.keys,r,i,"value"),e.times=r,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var pI={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Y4=class{constructor(e,t,r){let i=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,n===!1&&i.onStart!==void 0&&i.onStart(u,s,a),n=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,a),s===a&&(n=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return o?o(u):u},this.setURLModifier=function(u){return o=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){let h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,c=l.length;h<c;h+=2){let d=l[h],f=l[h+1];if(d.global&&(d.lastIndex=0),d.test(u))return f}return null}}},pre=new Y4,yD=class{constructor(e){this.manager=e!==void 0?e:pre,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let r=this;return new Promise(function(i,n){r.load(e,i,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},Xo={},mre=class extends Error{constructor(e,t){super(e),this.response=t}},oA=class extends yD{constructor(e){super(e)}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=pI.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(Xo[e]!==void 0){Xo[e].push({onLoad:t,onProgress:r,onError:i});return}Xo[e]=[],Xo[e].push({onLoad:t,onProgress:r,onError:i});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let u=Xo[e],h=l.body.getReader(),c=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=c?parseInt(c):0,f=d!==0,p=0,m=new ReadableStream({start(g){v();function v(){h.read().then(({done:y,value:x})=>{if(y)g.close();else{p+=x.byteLength;let w=new ProgressEvent("progress",{lengthComputable:f,loaded:p,total:d});for(let S=0,_=u.length;S<_;S++){let A=u[S];A.onProgress&&A.onProgress(w)}g.enqueue(x),v()}})}}});return new Response(m)}else throw new mre(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return l.json();default:if(a===void 0)return l.text();{let u=/charset="?([^;"\s]*)"?/i.exec(a),h=u&&u[1]?u[1].toLowerCase():void 0,c=new TextDecoder(h);return l.arrayBuffer().then(d=>c.decode(d))}}}).then(l=>{pI.add(e,l);let u=Xo[e];delete Xo[e];for(let h=0,c=u.length;h<c;h++){let d=u[h];d.onLoad&&d.onLoad(l)}}).catch(l=>{let u=Xo[e];if(u===void 0)throw this.manager.itemError(e),l;delete Xo[e];for(let h=0,c=u.length;h<c;h++){let d=u[h];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Fv=class extends dr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new gt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},gre=class extends Fv{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(dr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new gt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},AS=new Oe,mI=new P,gI=new P,xD=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new J(512,512),this.map=null,this.mapPass=null,this.matrix=new Oe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new uD,this._frameExtents=new J(1,1),this._viewportCount=1,this._viewports=[new Lt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,r=this.matrix;mI.setFromMatrixPosition(e.matrixWorld),t.position.copy(mI),gI.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(gI),t.updateMatrixWorld(),AS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(AS),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(AS)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},vre=class extends xD{constructor(){super(new rn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,r=qg*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(r!==t.fov||i!==t.aspect||n!==t.far)&&(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},yre=class extends Fv{constructor(e,t,r=0,i=Math.PI/3,n=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(dr.DEFAULT_UP),this.updateMatrix(),this.target=new dr,this.distance=r,this.angle=i,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new vre}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},vI=new Oe,lm=new P,TS=new P,xre=class extends xD{constructor(){super(new rn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new J(4,2),this._viewportCount=6,this._viewports=[new Lt(2,1,1,1),new Lt(0,1,1,1),new Lt(3,1,1,1),new Lt(1,1,1,1),new Lt(3,0,1,1),new Lt(1,0,1,1)],this._cubeDirections=[new P(1,0,0),new P(-1,0,0),new P(0,0,1),new P(0,0,-1),new P(0,1,0),new P(0,-1,0)],this._cubeUps=[new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,0,1),new P(0,0,-1)]}updateMatrices(e,t=0){let r=this.camera,i=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),lm.setFromMatrixPosition(e.matrixWorld),r.position.copy(lm),TS.copy(r.position),TS.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(TS),r.updateMatrixWorld(),i.makeTranslation(-lm.x,-lm.y,-lm.z),vI.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vI)}},wre=class extends Fv{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new xre}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},bre=class extends xD{constructor(){super(new cD(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},_re=class extends Fv{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(dr.DEFAULT_UP),this.updateMatrix(),this.target=new dr,this.shadow=new bre}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Sre=class extends _t{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},q4=class extends yD{constructor(e){super(e)}load(e,t,r,i){let n=this,s=new oA(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){i?i(o):console.error(o),n.manager.itemError(e)}},r,i)}parse(e){let t={},r={};function i(c,d){if(t[d]!==void 0)return t[d];let f=c.interleavedBuffers[d],p=n(c,f.buffer),m=B0(f.type,p),g=new Pte(m,f.stride);return g.uuid=f.uuid,t[d]=g,g}function n(c,d){if(r[d]!==void 0)return r[d];let f=c.arrayBuffers[d],p=new Uint32Array(f).buffer;return r[d]=p,p}let s=e.isInstancedBufferGeometry?new Sre:new _t,a=e.data.index;if(a!==void 0){let c=B0(a.type,a.array);s.setIndex(new Mt(c,1))}let o=e.data.attributes;for(let c in o){let d=o[c],f;if(d.isInterleavedBufferAttribute){let p=i(e.data,d.data);f=new iA(p,d.itemSize,d.offset,d.normalized)}else{let p=B0(d.type,d.array),m=d.isInstancedBufferAttribute?Lte:Mt;f=new m(p,d.itemSize,d.normalized)}d.name!==void 0&&(f.name=d.name),d.usage!==void 0&&f.setUsage(d.usage),d.updateRange!==void 0&&(f.updateRange.offset=d.updateRange.offset,f.updateRange.count=d.updateRange.count),s.setAttribute(c,f)}let l=e.data.morphAttributes;if(l)for(let c in l){let d=l[c],f=[];for(let p=0,m=d.length;p<m;p++){let g=d[p],v;if(g.isInterleavedBufferAttribute){let y=i(e.data,g.data);v=new iA(y,g.itemSize,g.offset,g.normalized)}else{let y=B0(g.type,g.array);v=new Mt(y,g.itemSize,g.normalized)}g.name!==void 0&&(v.name=g.name),f.push(v)}s.morphAttributes[c]=f}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let c=0,d=u.length;c!==d;++c){let f=u[c];s.addGroup(f.start,f.count,f.materialIndex)}let h=e.data.boundingSphere;if(h!==void 0){let c=new P;h.center!==void 0&&c.fromArray(h.center),s.boundingSphere=new ys(c,h.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},Mre=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yI(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=yI();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function yI(){return(typeof performance>"u"?Date:performance).now()}var Ere=class{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,n,s;switch(t){case"quaternion":i=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let r=this.buffer,i=this.valueSize,n=e*i+i,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==i;++a)r[n+a]=r[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(r,n,0,a,i)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(r,i,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(r[o]!==r[o+t]){a.setValue(r,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let n=r,s=i;n!==s;++n)t[n]=t[i+n%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,n){if(i>=.5)for(let s=0;s!==n;++s)e[t+s]=e[r+s]}_slerp(e,t,r,i){kt.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){let s=this._workIndex*n;kt.multiplyQuaternionsFlat(e,s,e,t,e,r),kt.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,r,i,n){let s=1-i;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[r+a]*i}}_lerpAdditive(e,t,r,i,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[r+s]*i}}},wD="\\[\\]\\.:\\/",Are=new RegExp("["+wD+"]","g"),bD="[^"+wD+"]",Tre="[^"+wD.replace("\\.","")+"]",Cre=/((?:WC+[\/:])*)/.source.replace("WC",bD),Dre=/(WCOD+)?/.source.replace("WCOD",Tre),Pre=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bD),Ore=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bD),Lre=new RegExp("^"+Cre+Dre+Pre+Ore+"$"),Ire=["material","materials","bones","map"],Rre=class{constructor(e,t,r){let i=r||mr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){let r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},mr=class{constructor(e,t,r){this.path=t,this.parsedPath=r||mr.parseTrackName(t),this.node=mr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new mr.Composite(e,t,r):new mr(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Are,"")}static parseTrackName(e){let t=Lre.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let n=r.nodeName.substring(i+1);Ire.indexOf(n)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){let r=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=r(a.children);if(o)return o}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=mr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let l=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[i];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};mr.Composite=Rre;mr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};mr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};mr.prototype.GetterByBindingType=[mr.prototype._getValue_direct,mr.prototype._getValue_array,mr.prototype._getValue_arrayElement,mr.prototype._getValue_toArray];mr.prototype.SetterByBindingTypeAndVersioning=[[mr.prototype._setValue_direct,mr.prototype._setValue_direct_setNeedsUpdate,mr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mr.prototype._setValue_array,mr.prototype._setValue_array_setNeedsUpdate,mr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mr.prototype._setValue_arrayElement,mr.prototype._setValue_arrayElement_setNeedsUpdate,mr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mr.prototype._setValue_fromArray,mr.prototype._setValue_fromArray_setNeedsUpdate,mr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var kre=class{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:Qd,endingEnd:Qd};for(let l=0;l!==s;++l){let u=n[l].createInterpolant(null);a[l]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=d4,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){let i=this._clip.duration,n=e._clip.duration,s=n/i,a=i/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){let i=this._mixer,n=i.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+r,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*r;o<0||r===0?t=0:(this._startTime=null,t=r*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case mQ:for(let u=0,h=o.length;u!==h;++u)o[u].evaluate(s),l[u].accumulateAdditive(a);break;case sD:default:for(let u=0,h=o.length;u!==h;++u)o[u].evaluate(s),l[u].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let r=this._weightInterpolant;if(r!==null){let i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let r=this._timeScaleInterpolant;if(r!==null){let i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,r=this.loop,i=this.time+e,n=this._loopCount,s=r===nD;if(e===0)return n===-1?i:s&&(n&1)===1?t-i:i;if(r===h4){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=t||i<0){let a=Math.floor(i/t);i-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(s&&(n&1)===1)return t-i}return i}_setEndings(e,t,r){let i=this._interpolantSettings;r?(i.endingStart=Kd,i.endingEnd=Kd):(e?i.endingStart=this.zeroSlopeAtStart?Kd:Qd:i.endingStart=dx,t?i.endingEnd=this.zeroSlopeAtEnd?Kd:Qd:i.endingEnd=dx)}_scheduleFading(e,t,r){let i=this._mixer,n=i.time,s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=r,this}},zre=new Float32Array(1),Nre=class extends Xi{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,s=e._propertyBindings,a=e._interpolants,o=r.uuid,l=this._bindingsByRootAndName,u=l[o];u===void 0&&(u={},l[o]=u);for(let h=0;h!==n;++h){let c=i[h],d=c.name,f=u[d];if(f!==void 0)++f.referenceCount,s[h]=f;else{if(f=s[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,o,d));continue}let p=t&&t._propertyBindings[h].binding.parsedPath;f=new Ere(mr.create(r,d,p),c.ValueTypeName,c.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,o,d),s[h]=f}a[h].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let r=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,r)}let t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){let n=t[r];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){let n=t[r];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){let i=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[r]=e}_removeInactiveAction(e){let t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),e._byClipCacheIndex=null;let h=a.actionByRoot,c=(e._localRoot||this._root).uuid;delete h[c],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){let n=t[r];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackAction(e){let t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_addInactiveBinding(e,t,r){let i=this._bindingsByRootAndName,n=this._bindings,s=i[t];s===void 0&&(s={},i[t]=s),s[r]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,s=this._bindingsByRootAndName,a=s[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[i]}_lendBinding(e){let t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackBinding(e){let t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return r===void 0&&(r=new W4(new Float32Array(2),new Float32Array(2),1,zre),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){let t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n}clipAction(e,t,r){let i=t||this._root,n=i.uuid,s=typeof e=="string"?aA.findByName(i,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(r===void 0&&(s!==null?r=s.blendMode:r=sD),o!==void 0){let h=o.actionByRoot[n];if(h!==void 0&&h.blendMode===r)return h;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let u=new kre(this,s,t,r);return this._bindAction(u,l),this._addInactiveAction(u,a,n),u}existingAction(e,t){let r=t||this._root,i=r.uuid,n=typeof e=="string"?aA.findByName(r,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;let t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==r;++l)t[l]._update(i,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let u=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}}uncacheRoot(e){let t=e.uuid,r=this._actionsByClip;for(let s in r){let a=r[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let i=this._bindingsByRootAndName,n=i[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}},Pe=class{constructor(e){this.value=e}clone(){return new Pe(this.value.clone===void 0?this.value:this.value.clone())}},X4=class{constructor(e,t,r=0,i=1/0){this.ray=new pp(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new oD,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return lA(e,this,r,t),r.sort(xI),r}intersectObjects(e,t=!0,r=[]){for(let i=0,n=e.length;i<n;i++)lA(e[i],this,r,t);return r.sort(xI),r}};function xI(e,t){return e.distance-t.distance}function lA(e,t,r,i){if(e.layers.test(t.layers)&&e.raycast(t,r),i===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)lA(n[s],t,r,!0)}}var wI=class{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(bi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},bI=new J,Bre=class{constructor(e=new J(1/0,1/0),t=new J(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=bI.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return bI.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},_I=new P,ly=new P,Gs=class{constructor(e=new P,t=new P){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){_I.subVectors(e,this.start),ly.subVectors(this.end,this.start);let r=ly.dot(ly),i=ly.dot(_I)/r;return t&&(i=bi(i,0,1)),i}closestPointToPoint(e,t,r){let i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},SI=new P,Fre=class extends dr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let r=new _t,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,u=a/o*Math.PI*2;i.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new nt(i,3));let n=new dc({fog:!1,toneMapped:!1});this.cone=new Nv(r,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),SI.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(SI),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Ure=class extends Hn{constructor(e,t,r){let i=new vD(t,4,2),n=new zv({wireframe:!0,fog:!1,toneMapped:!1});super(i,n),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},MI=new P,uy=new P,EI=new P,jre=class extends dr{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new _t;i.setAttribute("position",new nt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new dc({fog:!1,toneMapped:!1});this.lightPlane=new vx(i,n),this.add(this.lightPlane),i=new _t,i.setAttribute("position",new nt([0,0,0,0,0,1],3)),this.targetLine=new vx(i,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),MI.setFromMatrixPosition(this.light.matrixWorld),uy.setFromMatrixPosition(this.light.target.matrixWorld),EI.subVectors(uy,MI),this.lightPlane.lookAt(uy),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(uy),this.targetLine.scale.z=EI.length()}},cy=new P,Wr=new gp,_x=class extends Nv{constructor(e){let t=new _t,r=new dc({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,p){o(f),o(p)}function o(f){i.push(0,0,0),n.push(0,0,0),s[f]===void 0&&(s[f]=[]),s[f].push(i.length/3-1)}t.setAttribute("position",new nt(i,3)),t.setAttribute("color",new nt(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new gt(16755200),u=new gt(16711680),h=new gt(43775),c=new gt(16777215),d=new gt(3355443);this.setColors(l,u,h,c,d)}setColors(e,t,r,i,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,r.r,r.g,r.b),s.setXYZ(33,r.r,r.g,r.b),s.setXYZ(34,r.r,r.g,r.b),s.setXYZ(35,r.r,r.g,r.b),s.setXYZ(36,r.r,r.g,r.b),s.setXYZ(37,r.r,r.g,r.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,r=1,i=1;Wr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Kr("c",t,e,Wr,0,0,-1),Kr("t",t,e,Wr,0,0,1),Kr("n1",t,e,Wr,-r,-i,-1),Kr("n2",t,e,Wr,r,-i,-1),Kr("n3",t,e,Wr,-r,i,-1),Kr("n4",t,e,Wr,r,i,-1),Kr("f1",t,e,Wr,-r,-i,1),Kr("f2",t,e,Wr,r,-i,1),Kr("f3",t,e,Wr,-r,i,1),Kr("f4",t,e,Wr,r,i,1),Kr("u1",t,e,Wr,r*.7,i*1.1,-1),Kr("u2",t,e,Wr,-r*.7,i*1.1,-1),Kr("u3",t,e,Wr,0,i*2,-1),Kr("cf1",t,e,Wr,-r,0,1),Kr("cf2",t,e,Wr,r,0,1),Kr("cf3",t,e,Wr,0,-i,1),Kr("cf4",t,e,Wr,0,i,1),Kr("cn1",t,e,Wr,-r,0,-1),Kr("cn2",t,e,Wr,r,0,-1),Kr("cn3",t,e,Wr,0,-i,-1),Kr("cn4",t,e,Wr,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Kr(e,t,r,i,n,s,a){cy.set(n,s,a).unproject(i);let o=t[e];if(o!==void 0){let l=r.getAttribute("position");for(let u=0,h=o.length;u<h;u++)l.setXYZ(o[u],cy.x,cy.y,cy.z)}}var Sx=class extends Nv{constructor(e,t=16776960){let r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new _t;n.setIndex(new Mt(r,1)),n.setAttribute("position",new nt(i,3)),super(n,new dc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Hre=class extends Nv{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new _t;i.setAttribute("position",new nt(t,3)),i.setAttribute("color",new nt(r,3));let n=new dc({vertexColors:!0,toneMapped:!1});super(i,n),this.type="AxesHelper"}setColors(e,t,r){let i=new gt,n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:fp}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=fp);var um=".",_D=Symbol("target"),$4=Symbol("unsubscribe");function uA(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function Vre(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var ro=Array.isArray;function SD(e){return typeof e=="symbol"}var Wre={after:(e,t)=>ro(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>ro(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=um),SD(t)?e+t.toString():e+t):e,initial:e=>{if(ro(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(um);return t===-1?"":e.slice(0,t)},last:e=>{if(ro(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(um);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(ro(e))for(let r of e)t(r);else if(e!==""){let r=0,i=e.indexOf(um);if(i===-1)t(e);else for(;r<e.length;)i===-1&&(i=e.length),t(e.slice(r,i)),r=i+1,i=e.indexOf(um,r)}},get(e,t){return this.walk(t,r=>{e&&(e=e[r])}),e}},Rs=Wre;function Gre(e){return typeof e=="object"&&typeof e.next=="function"}function Yre(e,t,r,i,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],i),a.value[1]=n(a.value[1],t,a.value[0],i)),a};else if(t.name==="values"){let a=r[_D].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,i)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,i)),a};return e}function AI(e,t,r){return e.isUnsubscribed||t.ignoreSymbols&&SD(r)||t.ignoreUnderscores&&r.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(r)}var qre=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),r=t.get(e);return r===void 0&&(r={},t.set(e,r)),r}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let r=this._getProperties(e),i=r[t];return i===void 0&&(i=Reflect.getOwnPropertyDescriptor(e,t),r[t]=i),i}getProxy(e,t,r,i){if(this.isUnsubscribed)return e;let n=e[i],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,r):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Rs.get(t,this.getPath(e)))}defineProperty(e,t,r){return Reflect.defineProperty(e,t,r)?(this.isUnsubscribed||(this._getProperties(e)[t]=r),!0):!1}setProperty(e,t,r,i,n){if(!this._equals(n,r)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,r,i):Reflect.set(e,t,r)}return!0}deleteProperty(e,t,r){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let i=this._getDescriptorCache().get(e);i&&(delete i[t],this._pathCache.delete(r))}return!0}return!1}isSameDescriptor(e,t,r){let i=this._getOwnPropertyDescriptor(t,r);return e!==void 0&&i!==void 0&&Object.is(e.value,i.value)&&(e.writable||!1)===(i.writable||!1)&&(e.enumerable||!1)===(i.enumerable||!1)&&(e.configurable||!1)===(i.configurable||!1)&&e.get===i.get&&e.set===i.set}isGetInvariant(e,t){let r=this._getOwnPropertyDescriptor(e,t);return r!==void 0&&r.configurable!==!0&&r.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function cA(e){return toString.call(e)==="[object Object]"}function hy(){return!0}function ud(e,t){return e.length!==t.length||e.some((r,i)=>t[i]!==r)}var Q4=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Xre=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),K4={push:hy,pop:hy,shift:hy,unshift:hy,copyWithin:ud,reverse:ud,sort:ud,splice:ud,flat:ud,fill:ud},$re=new Set([...Q4,...Xre,...Object.keys(K4)]);function dy(e,t){if(e.size!==t.size)return!0;for(let r of e)if(!t.has(r))return!0;return!1}var Z4=["keys","values","entries"],J4=new Set(["has","toString"]),ej={add:dy,clear:dy,delete:dy,forEach:dy},Qre=new Set([...J4,...Object.keys(ej),...Z4]);function fy(e,t){if(e.size!==t.size)return!0;let r;for(let[i,n]of e)if(r=t.get(i),r!==n||r===void 0&&!t.has(i))return!0;return!1}var Kre=new Set([...J4,"get"]),tj={set:fy,clear:fy,delete:fy,forEach:fy},Zre=new Set([...Kre,...Object.keys(tj),...Z4]),rc=class{constructor(e,t,r,i){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=i,this._changes=i?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return Q4.has(e)}_shallowClone(e){let t=e;if(cA(e))t={...e};else if(ro(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(r=>this._shallowClone(r)));else if(e instanceof Map){t=new Map;for(let[r,i]of e.entries())t.set(r,this._shallowClone(i))}return this._clonedCache.add(t),t}preferredThisArg(e,t,r,i){return e?(ro(i)?this._onIsChanged=K4[t]:i instanceof Set?this._onIsChanged=ej[t]:i instanceof Map&&(this._onIsChanged=tj[t]),i):r}update(e,t,r){let i=Rs.after(e,this._path);if(t!=="length"){let n=this.clone;Rs.walk(i,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:i,property:t,previous:r}),n&&n[t]&&(n[t]=r)}this._isChanged=!0}undo(e){let t;for(let r=this._changes.length-1;r!==-1;r--)t=this._changes[r],Rs.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},TI=class extends rc{static isHandledMethod(e){return $re.has(e)}},Jre=class extends rc{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},CI=class extends rc{static isHandledMethod(e){return Qre.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},DI=class extends rc{static isHandledMethod(e){return Zre.has(e)}undo(e){for(let[t,r]of this.clone.entries())e.set(t,r);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},eie=class extends rc{constructor(e,t,r,i){super(void 0,t,r,i),this._arg1=r[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},tie=class extends rc{constructor(e,t,r,i){super(void 0,t,r,i),this._weakKey=r[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Pd=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return cA(e)||ro(e)||uA(e)}static isHandledMethod(e,t){return cA(e)?rc.isHandledMethod(t):ro(e)?TI.isHandledMethod(t):e instanceof Set?CI.isHandledMethod(t):e instanceof Map?DI.isHandledMethod(t):uA(e)}get isCloning(){return this._stack.length>0}start(e,t,r){let i=rc;ro(e)?i=TI:e instanceof Date?i=Jre:e instanceof Set?i=CI:e instanceof Map?i=DI:e instanceof WeakSet?i=eie:e instanceof WeakMap&&(i=tie),this._stack.push(new i(e,t,r,this._hasOnValidate))}update(e,t,r){this._stack[this._stack.length-1].update(e,t,r)}preferredThisArg(e,t,r){let{name:i}=e,n=Pd.isHandledMethod(r,i);return this._stack[this._stack.length-1].preferredThisArg(n,i,t,r)}isChanged(e,t,r){return this._stack[this._stack.length-1].isChanged(e,t,r)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},rie={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},MD=(e,t,r={})=>{r={...rie,...r};let i=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=r,l=new qre(n),u=typeof r.onValidate=="function",h=new Pd(u),c=(y,x,w,S,_)=>!u||h.isCloning||r.onValidate(Rs.concat(l.getPath(y),x),w,S,_)===!0,d=(y,x,w,S)=>{!AI(l,r,x)&&!(a&&l.isDetached(y,e))&&f(l.getPath(y),x,w,S)},f=(y,x,w,S,_)=>{h.isCloning?h.update(y,x,S):t(Rs.concat(y,x),w,S,_)},p=y=>y&&(y[i]||y),m=(y,x,w,S)=>Vre(y)||w==="constructor"||s&&!Pd.isHandledMethod(x,w)||AI(l,r,w)||l.isGetInvariant(x,w)||a&&l.isDetached(x,e)?y:(S===void 0&&(S=l.getPath(x)),l.getProxy(y,Rs.concat(S,w),g,i)),g={get(y,x,w){if(SD(x)){if(x===i||x===_D)return y;if(x===$4&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let S=uA(y)?Reflect.get(y,x):Reflect.get(y,x,w);return m(S,y,x)},set(y,x,w,S){w=p(w);let _=y[i]||y,A=_[x];if(n(A,w)&&x in y)return!0;let M=c(y,x,w,A);return M&&l.setProperty(_,x,w,S,A)?(d(y,x,y[x],A),!0):!M},defineProperty(y,x,w){if(!l.isSameDescriptor(w,y,x)){let S=y[x];c(y,x,w.value,S)&&l.defineProperty(y,x,w,S)&&d(y,x,w.value,S)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let w=Reflect.get(y,x),S=c(y,x,void 0,w);return S&&l.deleteProperty(y,x,w)?(d(y,x,void 0,w),!0):!S},apply(y,x,w){let S=x[i]||x;if(l.isUnsubscribed)return Reflect.apply(y,S,w);if((o===!1||o!==!0&&!o.includes(y.name))&&Pd.isHandledType(S)){let _=Rs.initial(l.getPath(y)),A=Pd.isHandledMethod(S,y.name);h.start(S,_,w);let M=Reflect.apply(y,h.preferredThisArg(y,x,S),A?w.map(L=>p(L)):w),T=h.isChanged(S,n),C=h.stop();if(Pd.isHandledType(M)&&A&&(x instanceof Map&&y.name==="get"&&(_=Rs.concat(_,w[0])),M=l.getProxy(M,_,g)),T){let L={name:y.name,args:w,result:M},I=h.isCloning?Rs.initial(_):_,k=h.isCloning?Rs.last(_):"";c(Rs.get(e,I),k,S,C,L)?f(I,k,S,C,L):h.undo(S)}return(x instanceof Map||x instanceof Set)&&Gre(M)?Yre(M,y,x,_,m):M}return Reflect.apply(y,x,w)}},v=l.getProxy(e,r.pathAsArray?[]:"",g);return t=t.bind(v),u&&(r.onValidate=r.onValidate.bind(v)),v};MD.target=e=>e&&e[_D]||e;MD.unsubscribe=e=>e[$4]||e;var PI=MD,iie=typeof global=="object"&&global&&global.Object===Object&&global,rj=iie,nie=typeof self=="object"&&self&&self.Object===Object&&self,sie=rj||nie||Function("return this")(),La=sie,aie=La.Symbol,$s=aie,ij=Object.prototype,oie=ij.hasOwnProperty,lie=ij.toString,cm=$s?$s.toStringTag:void 0;function uie(e){var t=oie.call(e,cm),r=e[cm];try{e[cm]=void 0;var i=!0}catch{}var n=lie.call(e);return i&&(t?e[cm]=r:delete e[cm]),n}var cie=uie,hie=Object.prototype,die=hie.toString;function fie(e){return die.call(e)}var pie=fie,mie="[object Null]",gie="[object Undefined]",OI=$s?$s.toStringTag:void 0;function vie(e){return e==null?e===void 0?gie:mie:OI&&OI in Object(e)?cie(e):pie(e)}var Lh=vie;function yie(e){return e!=null&&typeof e=="object"}var kl=yie,xie="[object Symbol]";function wie(e){return typeof e=="symbol"||kl(e)&&Lh(e)==xie}var Zw=wie;function bie(e,t){for(var r=-1,i=e==null?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}var nj=bie,_ie=Array.isArray,wo=_ie,Sie=1/0,LI=$s?$s.prototype:void 0,II=LI?LI.toString:void 0;function sj(e){if(typeof e=="string")return e;if(wo(e))return nj(e,sj)+"";if(Zw(e))return II?II.call(e):"";var t=e+"";return t=="0"&&1/e==-Sie?"-0":t}var Mie=sj,Eie=/\s/;function Aie(e){for(var t=e.length;t--&&Eie.test(e.charAt(t)););return t}var Tie=Aie,Cie=/^\s+/;function Die(e){return e&&e.slice(0,Tie(e)+1).replace(Cie,"")}var Pie=Die;function Oie(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Da=Oie,RI=0/0,Lie=/^[-+]0x[0-9a-f]+$/i,Iie=/^0b[01]+$/i,Rie=/^0o[0-7]+$/i,kie=parseInt;function zie(e){if(typeof e=="number")return e;if(Zw(e))return RI;if(Da(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Da(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Pie(e);var r=Iie.test(e);return r||Rie.test(e)?kie(e.slice(2),r?2:8):Lie.test(e)?RI:+e}var kI=zie;function Nie(e){return e}var Bie=Nie,Fie="[object AsyncFunction]",Uie="[object Function]",jie="[object GeneratorFunction]",Hie="[object Proxy]";function Vie(e){if(!Da(e))return!1;var t=Lh(e);return t==Uie||t==jie||t==Fie||t==Hie}var aj=Vie,Wie=La["__core-js_shared__"],CS=Wie,zI=function(){var e=/[^.]+$/.exec(CS&&CS.keys&&CS.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Gie(e){return!!zI&&zI in e}var Yie=Gie,qie=Function.prototype,Xie=qie.toString;function $ie(e){if(e!=null){try{return Xie.call(e)}catch{}try{return e+""}catch{}}return""}var Ih=$ie,Qie=/[\\^$.*+?()[\]{}|]/g,Kie=/^\[object .+?Constructor\]$/,Zie=Function.prototype,Jie=Object.prototype,ene=Zie.toString,tne=Jie.hasOwnProperty,rne=RegExp("^"+ene.call(tne).replace(Qie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ine(e){if(!Da(e)||Yie(e))return!1;var t=aj(e)?rne:Kie;return t.test(Ih(e))}var nne=ine;function sne(e,t){return e==null?void 0:e[t]}var ane=sne;function one(e,t){var r=ane(e,t);return nne(r)?r:void 0}var Rh=one,lne=Rh(La,"WeakMap"),hA=lne,NI=Object.create,une=function(){function e(){}return function(t){if(!Da(t))return{};if(NI)return NI(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),cne=une;function hne(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var dne=hne;function fne(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}var pne=fne,mne=800,gne=16,vne=Date.now;function yne(e){var t=0,r=0;return function(){var i=vne(),n=gne-(i-r);if(r=i,n>0){if(++t>=mne)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var xne=yne;function wne(e){return function(){return e}}var bne=wne,_ne=function(){try{var e=Rh(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Mx=_ne,Sne=Mx?function(e,t){return Mx(e,"toString",{configurable:!0,enumerable:!1,value:bne(t),writable:!0})}:Bie,Mne=Sne,Ene=xne(Mne),Ane=Ene;function Tne(e,t){for(var r=-1,i=e==null?0:e.length;++r<i&&t(e[r],r,e)!==!1;);return e}var Cne=Tne,Dne=9007199254740991,Pne=/^(?:0|[1-9]\d*)$/;function One(e,t){var r=typeof e;return t=t??Dne,!!t&&(r=="number"||r!="symbol"&&Pne.test(e))&&e>-1&&e%1==0&&e<t}var ED=One;function Lne(e,t,r){t=="__proto__"&&Mx?Mx(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var oj=Lne;function Ine(e,t){return e===t||e!==e&&t!==t}var AD=Ine,Rne=Object.prototype,kne=Rne.hasOwnProperty;function zne(e,t,r){var i=e[t];(!(kne.call(e,t)&&AD(i,r))||r===void 0&&!(t in e))&&oj(e,t,r)}var TD=zne;function Nne(e,t,r,i){var n=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=i?i(r[o],e[o],o,r,e):void 0;l===void 0&&(l=e[o]),n?oj(r,o,l):TD(r,o,l)}return r}var Uv=Nne,BI=Math.max;function Bne(e,t,r){return t=BI(t===void 0?e.length-1:t,0),function(){for(var i=arguments,n=-1,s=BI(i.length-t,0),a=Array(s);++n<s;)a[n]=i[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=i[n];return o[t]=r(a),dne(e,this,o)}}var Fne=Bne,Une=9007199254740991;function jne(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Une}var CD=jne;function Hne(e){return e!=null&&CD(e.length)&&!aj(e)}var lj=Hne,Vne=Object.prototype;function Wne(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Vne;return e===r}var DD=Wne;function Gne(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}var Yne=Gne,qne="[object Arguments]";function Xne(e){return kl(e)&&Lh(e)==qne}var FI=Xne,uj=Object.prototype,$ne=uj.hasOwnProperty,Qne=uj.propertyIsEnumerable,Kne=FI(function(){return arguments}())?FI:function(e){return kl(e)&&$ne.call(e,"callee")&&!Qne.call(e,"callee")},PD=Kne;function Zne(){return!1}var Jne=Zne,cj=typeof exports=="object"&&exports&&!exports.nodeType&&exports,UI=cj&&typeof module=="object"&&module&&!module.nodeType&&module,ese=UI&&UI.exports===cj,jI=ese?La.Buffer:void 0,tse=jI?jI.isBuffer:void 0,rse=tse||Jne,Ex=rse,ise="[object Arguments]",nse="[object Array]",sse="[object Boolean]",ase="[object Date]",ose="[object Error]",lse="[object Function]",use="[object Map]",cse="[object Number]",hse="[object Object]",dse="[object RegExp]",fse="[object Set]",pse="[object String]",mse="[object WeakMap]",gse="[object ArrayBuffer]",vse="[object DataView]",yse="[object Float32Array]",xse="[object Float64Array]",wse="[object Int8Array]",bse="[object Int16Array]",_se="[object Int32Array]",Sse="[object Uint8Array]",Mse="[object Uint8ClampedArray]",Ese="[object Uint16Array]",Ase="[object Uint32Array]",Cr={};Cr[yse]=Cr[xse]=Cr[wse]=Cr[bse]=Cr[_se]=Cr[Sse]=Cr[Mse]=Cr[Ese]=Cr[Ase]=!0;Cr[ise]=Cr[nse]=Cr[gse]=Cr[sse]=Cr[vse]=Cr[ase]=Cr[ose]=Cr[lse]=Cr[use]=Cr[cse]=Cr[hse]=Cr[dse]=Cr[fse]=Cr[pse]=Cr[mse]=!1;function Tse(e){return kl(e)&&CD(e.length)&&!!Cr[Lh(e)]}var Cse=Tse;function Dse(e){return function(t){return e(t)}}var OD=Dse,hj=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cg=hj&&typeof module=="object"&&module&&!module.nodeType&&module,Pse=cg&&cg.exports===hj,DS=Pse&&rj.process,Ose=function(){try{var e=cg&&cg.require&&cg.require("util").types;return e||DS&&DS.binding&&DS.binding("util")}catch{}}(),Hf=Ose,HI=Hf&&Hf.isTypedArray,Lse=HI?OD(HI):Cse,dj=Lse,Ise=Object.prototype,Rse=Ise.hasOwnProperty;function kse(e,t){var r=wo(e),i=!r&&PD(e),n=!r&&!i&&Ex(e),s=!r&&!i&&!n&&dj(e),a=r||i||n||s,o=a?Yne(e.length,String):[],l=o.length;for(var u in e)(t||Rse.call(e,u))&&!(a&&(u=="length"||n&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||ED(u,l)))&&o.push(u);return o}var fj=kse;function zse(e,t){return function(r){return e(t(r))}}var pj=zse,Nse=pj(Object.keys,Object),Bse=Nse,Fse=Object.prototype,Use=Fse.hasOwnProperty;function jse(e){if(!DD(e))return Bse(e);var t=[];for(var r in Object(e))Use.call(e,r)&&r!="constructor"&&t.push(r);return t}var Hse=jse;function Vse(e){return lj(e)?fj(e):Hse(e)}var LD=Vse;function Wse(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var Gse=Wse,Yse=Object.prototype,qse=Yse.hasOwnProperty;function Xse(e){if(!Da(e))return Gse(e);var t=DD(e),r=[];for(var i in e)i=="constructor"&&(t||!qse.call(e,i))||r.push(i);return r}var $se=Xse;function Qse(e){return lj(e)?fj(e,!0):$se(e)}var ID=Qse,Kse=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Zse=/^\w*$/;function Jse(e,t){if(wo(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Zw(e)?!0:Zse.test(e)||!Kse.test(e)||t!=null&&e in Object(t)}var eae=Jse,tae=Rh(Object,"create"),Kg=tae;function rae(){this.__data__=Kg?Kg(null):{},this.size=0}var iae=rae;function nae(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var sae=nae,aae="__lodash_hash_undefined__",oae=Object.prototype,lae=oae.hasOwnProperty;function uae(e){var t=this.__data__;if(Kg){var r=t[e];return r===aae?void 0:r}return lae.call(t,e)?t[e]:void 0}var cae=uae,hae=Object.prototype,dae=hae.hasOwnProperty;function fae(e){var t=this.__data__;return Kg?t[e]!==void 0:dae.call(t,e)}var pae=fae,mae="__lodash_hash_undefined__";function gae(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Kg&&t===void 0?mae:t,this}var vae=gae;function wp(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}wp.prototype.clear=iae;wp.prototype.delete=sae;wp.prototype.get=cae;wp.prototype.has=pae;wp.prototype.set=vae;var VI=wp;function yae(){this.__data__=[],this.size=0}var xae=yae;function wae(e,t){for(var r=e.length;r--;)if(AD(e[r][0],t))return r;return-1}var Jw=wae,bae=Array.prototype,_ae=bae.splice;function Sae(e){var t=this.__data__,r=Jw(t,e);if(r<0)return!1;var i=t.length-1;return r==i?t.pop():_ae.call(t,r,1),--this.size,!0}var Mae=Sae;function Eae(e){var t=this.__data__,r=Jw(t,e);return r<0?void 0:t[r][1]}var Aae=Eae;function Tae(e){return Jw(this.__data__,e)>-1}var Cae=Tae;function Dae(e,t){var r=this.__data__,i=Jw(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}var Pae=Dae;function bp(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}bp.prototype.clear=xae;bp.prototype.delete=Mae;bp.prototype.get=Aae;bp.prototype.has=Cae;bp.prototype.set=Pae;var eb=bp,Oae=Rh(La,"Map"),Zg=Oae;function Lae(){this.size=0,this.__data__={hash:new VI,map:new(Zg||eb),string:new VI}}var Iae=Lae;function Rae(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var kae=Rae;function zae(e,t){var r=e.__data__;return kae(t)?r[typeof t=="string"?"string":"hash"]:r.map}var tb=zae;function Nae(e){var t=tb(this,e).delete(e);return this.size-=t?1:0,t}var Bae=Nae;function Fae(e){return tb(this,e).get(e)}var Uae=Fae;function jae(e){return tb(this,e).has(e)}var Hae=jae;function Vae(e,t){var r=tb(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}var Wae=Vae;function _p(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}_p.prototype.clear=Iae;_p.prototype.delete=Bae;_p.prototype.get=Uae;_p.prototype.has=Hae;_p.prototype.set=Wae;var rb=_p,Gae="Expected a function";function RD(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Gae);var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var a=e.apply(this,i);return r.cache=s.set(n,a)||s,a};return r.cache=new(RD.Cache||rb),r}RD.Cache=rb;var Yae=RD,qae=500;function Xae(e){var t=Yae(e,function(i){return r.size===qae&&r.clear(),i}),r=t.cache;return t}var $ae=Xae,Qae=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Kae=/\\(\\)?/g,Zae=$ae(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Qae,function(r,i,n,s){t.push(n?s.replace(Kae,"$1"):i||r)}),t}),Jae=Zae;function eoe(e){return e==null?"":Mie(e)}var toe=eoe;function roe(e,t){return wo(e)?e:eae(e,t)?[e]:Jae(toe(e))}var Sp=roe,ioe=1/0;function noe(e){if(typeof e=="string"||Zw(e))return e;var t=e+"";return t=="0"&&1/e==-ioe?"-0":t}var ib=noe;function soe(e,t){t=Sp(t,e);for(var r=0,i=t.length;e!=null&&r<i;)e=e[ib(t[r++])];return r&&r==i?e:void 0}var mj=soe;function aoe(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}var kD=aoe,WI=$s?$s.isConcatSpreadable:void 0;function ooe(e){return wo(e)||PD(e)||!!(WI&&e&&e[WI])}var loe=ooe;function gj(e,t,r,i,n){var s=-1,a=e.length;for(r||(r=loe),n||(n=[]);++s<a;){var o=e[s];t>0&&r(o)?t>1?gj(o,t-1,r,i,n):kD(n,o):i||(n[n.length]=o)}return n}var uoe=gj;function coe(e){var t=e==null?0:e.length;return t?uoe(e,1):[]}var hoe=coe;function doe(e){return Ane(Fne(e,void 0,hoe),e+"")}var vj=doe,foe=pj(Object.getPrototypeOf,Object),zD=foe,poe="[object Object]",moe=Function.prototype,goe=Object.prototype,yj=moe.toString,voe=goe.hasOwnProperty,yoe=yj.call(Object);function xoe(e){if(!kl(e)||Lh(e)!=poe)return!1;var t=zD(e);if(t===null)return!0;var r=voe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&yj.call(r)==yoe}var woe=xoe;function boe(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(n);++i<n;)s[i]=e[i+t];return s}var _oe=boe;function Soe(){this.__data__=new eb,this.size=0}var Moe=Soe;function Eoe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var Aoe=Eoe;function Toe(e){return this.__data__.get(e)}var Coe=Toe;function Doe(e){return this.__data__.has(e)}var Poe=Doe,Ooe=200;function Loe(e,t){var r=this.__data__;if(r instanceof eb){var i=r.__data__;if(!Zg||i.length<Ooe-1)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new rb(i)}return r.set(e,t),this.size=r.size,this}var Ioe=Loe;function Mp(e){var t=this.__data__=new eb(e);this.size=t.size}Mp.prototype.clear=Moe;Mp.prototype.delete=Aoe;Mp.prototype.get=Coe;Mp.prototype.has=Poe;Mp.prototype.set=Ioe;var _1=Mp;function Roe(e,t){return e&&Uv(t,LD(t),e)}var koe=Roe;function zoe(e,t){return e&&Uv(t,ID(t),e)}var Noe=zoe,xj=typeof exports=="object"&&exports&&!exports.nodeType&&exports,GI=xj&&typeof module=="object"&&module&&!module.nodeType&&module,Boe=GI&&GI.exports===xj,YI=Boe?La.Buffer:void 0,qI=YI?YI.allocUnsafe:void 0;function Foe(e,t){if(t)return e.slice();var r=e.length,i=qI?qI(r):new e.constructor(r);return e.copy(i),i}var Uoe=Foe;function joe(e,t){for(var r=-1,i=e==null?0:e.length,n=0,s=[];++r<i;){var a=e[r];t(a,r,e)&&(s[n++]=a)}return s}var Hoe=joe;function Voe(){return[]}var wj=Voe,Woe=Object.prototype,Goe=Woe.propertyIsEnumerable,XI=Object.getOwnPropertySymbols,Yoe=XI?function(e){return e==null?[]:(e=Object(e),Hoe(XI(e),function(t){return Goe.call(e,t)}))}:wj,ND=Yoe;function qoe(e,t){return Uv(e,ND(e),t)}var Xoe=qoe,$oe=Object.getOwnPropertySymbols,Qoe=$oe?function(e){for(var t=[];e;)kD(t,ND(e)),e=zD(e);return t}:wj,bj=Qoe;function Koe(e,t){return Uv(e,bj(e),t)}var Zoe=Koe;function Joe(e,t,r){var i=t(e);return wo(e)?i:kD(i,r(e))}var _j=Joe;function ele(e){return _j(e,LD,ND)}var dA=ele;function tle(e){return _j(e,ID,bj)}var Sj=tle,rle=Rh(La,"DataView"),fA=rle,ile=Rh(La,"Promise"),pA=ile,nle=Rh(La,"Set"),mA=nle,$I="[object Map]",sle="[object Object]",QI="[object Promise]",KI="[object Set]",ZI="[object WeakMap]",JI="[object DataView]",ale=Ih(fA),ole=Ih(Zg),lle=Ih(pA),ule=Ih(mA),cle=Ih(hA),Rc=Lh;(fA&&Rc(new fA(new ArrayBuffer(1)))!=JI||Zg&&Rc(new Zg)!=$I||pA&&Rc(pA.resolve())!=QI||mA&&Rc(new mA)!=KI||hA&&Rc(new hA)!=ZI)&&(Rc=function(e){var t=Lh(e),r=t==sle?e.constructor:void 0,i=r?Ih(r):"";if(i)switch(i){case ale:return JI;case ole:return $I;case lle:return QI;case ule:return KI;case cle:return ZI}return t});var Jg=Rc,hle=Object.prototype,dle=hle.hasOwnProperty;function fle(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&dle.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var ple=fle,mle=La.Uint8Array,Ax=mle;function gle(e){var t=new e.constructor(e.byteLength);return new Ax(t).set(new Ax(e)),t}var BD=gle;function vle(e,t){var r=t?BD(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var yle=vle,xle=/\w*$/;function wle(e){var t=new e.constructor(e.source,xle.exec(e));return t.lastIndex=e.lastIndex,t}var ble=wle,eR=$s?$s.prototype:void 0,tR=eR?eR.valueOf:void 0;function _le(e){return tR?Object(tR.call(e)):{}}var Sle=_le;function Mle(e,t){var r=t?BD(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Ele=Mle,Ale="[object Boolean]",Tle="[object Date]",Cle="[object Map]",Dle="[object Number]",Ple="[object RegExp]",Ole="[object Set]",Lle="[object String]",Ile="[object Symbol]",Rle="[object ArrayBuffer]",kle="[object DataView]",zle="[object Float32Array]",Nle="[object Float64Array]",Ble="[object Int8Array]",Fle="[object Int16Array]",Ule="[object Int32Array]",jle="[object Uint8Array]",Hle="[object Uint8ClampedArray]",Vle="[object Uint16Array]",Wle="[object Uint32Array]";function Gle(e,t,r){var i=e.constructor;switch(t){case Rle:return BD(e);case Ale:case Tle:return new i(+e);case kle:return yle(e,r);case zle:case Nle:case Ble:case Fle:case Ule:case jle:case Hle:case Vle:case Wle:return Ele(e,r);case Cle:return new i;case Dle:case Lle:return new i(e);case Ple:return ble(e);case Ole:return new i;case Ile:return Sle(e)}}var Yle=Gle;function qle(e){return typeof e.constructor=="function"&&!DD(e)?cne(zD(e)):{}}var Xle=qle,$le="[object Map]";function Qle(e){return kl(e)&&Jg(e)==$le}var Kle=Qle,rR=Hf&&Hf.isMap,Zle=rR?OD(rR):Kle,Jle=Zle,eue="[object Set]";function tue(e){return kl(e)&&Jg(e)==eue}var rue=tue,iR=Hf&&Hf.isSet,iue=iR?OD(iR):rue,nue=iue,sue=1,aue=2,oue=4,Mj="[object Arguments]",lue="[object Array]",uue="[object Boolean]",cue="[object Date]",hue="[object Error]",Ej="[object Function]",due="[object GeneratorFunction]",fue="[object Map]",pue="[object Number]",Aj="[object Object]",mue="[object RegExp]",gue="[object Set]",vue="[object String]",yue="[object Symbol]",xue="[object WeakMap]",wue="[object ArrayBuffer]",bue="[object DataView]",_ue="[object Float32Array]",Sue="[object Float64Array]",Mue="[object Int8Array]",Eue="[object Int16Array]",Aue="[object Int32Array]",Tue="[object Uint8Array]",Cue="[object Uint8ClampedArray]",Due="[object Uint16Array]",Pue="[object Uint32Array]",_r={};_r[Mj]=_r[lue]=_r[wue]=_r[bue]=_r[uue]=_r[cue]=_r[_ue]=_r[Sue]=_r[Mue]=_r[Eue]=_r[Aue]=_r[fue]=_r[pue]=_r[Aj]=_r[mue]=_r[gue]=_r[vue]=_r[yue]=_r[Tue]=_r[Cue]=_r[Due]=_r[Pue]=!0;_r[hue]=_r[Ej]=_r[xue]=!1;function S1(e,t,r,i,n,s){var a,o=t&sue,l=t&aue,u=t&oue;if(r&&(a=n?r(e,i,n,s):r(e)),a!==void 0)return a;if(!Da(e))return e;var h=wo(e);if(h){if(a=ple(e),!o)return pne(e,a)}else{var c=Jg(e),d=c==Ej||c==due;if(Ex(e))return Uoe(e,o);if(c==Aj||c==Mj||d&&!n){if(a=l||d?{}:Xle(e),!o)return l?Zoe(e,Noe(a,e)):Xoe(e,koe(a,e))}else{if(!_r[c])return n?e:{};a=Yle(e,c,o)}}s||(s=new _1);var f=s.get(e);if(f)return f;s.set(e,a),nue(e)?e.forEach(function(g){a.add(S1(g,t,r,g,e,s))}):Jle(e)&&e.forEach(function(g,v){a.set(v,S1(g,t,r,v,e,s))});var p=u?l?Sj:dA:l?ID:LD,m=h?void 0:p(e);return Cne(m||e,function(g,v){m&&(v=g,g=e[v]),TD(a,v,S1(g,t,r,v,e,s))}),a}var Tj=S1,Oue=1,Lue=4;function Iue(e){return Tj(e,Oue|Lue)}var nb=Iue,Rue="__lodash_hash_undefined__";function kue(e){return this.__data__.set(e,Rue),this}var zue=kue;function Nue(e){return this.__data__.has(e)}var Bue=Nue;function Tx(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new rb;++t<r;)this.add(e[t])}Tx.prototype.add=Tx.prototype.push=zue;Tx.prototype.has=Bue;var Fue=Tx;function Uue(e,t){for(var r=-1,i=e==null?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}var jue=Uue;function Hue(e,t){return e.has(t)}var Vue=Hue,Wue=1,Gue=2;function Yue(e,t,r,i,n,s){var a=r&Wue,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var c=-1,d=!0,f=r&Gue?new Fue:void 0;for(s.set(e,t),s.set(t,e);++c<o;){var p=e[c],m=t[c];if(i)var g=a?i(m,p,c,t,e,s):i(p,m,c,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!jue(t,function(v,y){if(!Vue(f,y)&&(p===v||n(p,v,r,i,s)))return f.push(y)})){d=!1;break}}else if(!(p===m||n(p,m,r,i,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var Cj=Yue;function que(e){var t=-1,r=Array(e.size);return e.forEach(function(i,n){r[++t]=[n,i]}),r}var Xue=que;function $ue(e){var t=-1,r=Array(e.size);return e.forEach(function(i){r[++t]=i}),r}var Que=$ue,Kue=1,Zue=2,Jue="[object Boolean]",ece="[object Date]",tce="[object Error]",rce="[object Map]",ice="[object Number]",nce="[object RegExp]",sce="[object Set]",ace="[object String]",oce="[object Symbol]",lce="[object ArrayBuffer]",uce="[object DataView]",nR=$s?$s.prototype:void 0,PS=nR?nR.valueOf:void 0;function cce(e,t,r,i,n,s,a){switch(r){case uce:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case lce:return!(e.byteLength!=t.byteLength||!s(new Ax(e),new Ax(t)));case Jue:case ece:case ice:return AD(+e,+t);case tce:return e.name==t.name&&e.message==t.message;case nce:case ace:return e==t+"";case rce:var o=Xue;case sce:var l=i&Kue;if(o||(o=Que),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;i|=Zue,a.set(e,t);var h=Cj(o(e),o(t),i,n,s,a);return a.delete(e),h;case oce:if(PS)return PS.call(e)==PS.call(t)}return!1}var hce=cce,dce=1,fce=Object.prototype,pce=fce.hasOwnProperty;function mce(e,t,r,i,n,s){var a=r&dce,o=dA(e),l=o.length,u=dA(t),h=u.length;if(l!=h&&!a)return!1;for(var c=l;c--;){var d=o[c];if(!(a?d in t:pce.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=a;++c<l;){d=o[c];var v=e[d],y=t[d];if(i)var x=a?i(y,v,d,t,e,s):i(v,y,d,e,t,s);if(!(x===void 0?v===y||n(v,y,r,i,s):x)){m=!1;break}g||(g=d=="constructor")}if(m&&!g){var w=e.constructor,S=t.constructor;w!=S&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof S=="function"&&S instanceof S)&&(m=!1)}return s.delete(e),s.delete(t),m}var gce=mce,vce=1,sR="[object Arguments]",aR="[object Array]",py="[object Object]",yce=Object.prototype,oR=yce.hasOwnProperty;function xce(e,t,r,i,n,s){var a=wo(e),o=wo(t),l=a?aR:Jg(e),u=o?aR:Jg(t);l=l==sR?py:l,u=u==sR?py:u;var h=l==py,c=u==py,d=l==u;if(d&&Ex(e)){if(!Ex(t))return!1;a=!0,h=!1}if(d&&!h)return s||(s=new _1),a||dj(e)?Cj(e,t,r,i,n,s):hce(e,t,l,r,i,n,s);if(!(r&vce)){var f=h&&oR.call(e,"__wrapped__"),p=c&&oR.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,g=p?t.value():t;return s||(s=new _1),n(m,g,r,i,s)}}return d?(s||(s=new _1),gce(e,t,r,i,n,s)):!1}var wce=xce;function Dj(e,t,r,i,n){return e===t?!0:e==null||t==null||!kl(e)&&!kl(t)?e!==e&&t!==t:wce(e,t,r,i,Dj,n)}var bce=Dj;function _ce(e,t){return e!=null&&t in Object(e)}var Sce=_ce;function Mce(e,t,r){t=Sp(t,e);for(var i=-1,n=t.length,s=!1;++i<n;){var a=ib(t[i]);if(!(s=e!=null&&r(e,a)))break;e=e[a]}return s||++i!=n?s:(n=e==null?0:e.length,!!n&&CD(n)&&ED(a,n)&&(wo(e)||PD(e)))}var Ece=Mce;function Ace(e,t){return e!=null&&Ece(e,t,Sce)}var Tce=Ace,Cce=function(){return La.Date.now()},OS=Cce,Dce="Expected a function",Pce=Math.max,Oce=Math.min;function Lce(e,t,r){var i,n,s,a,o,l,u=0,h=!1,c=!1,d=!0;if(typeof e!="function")throw new TypeError(Dce);t=kI(t)||0,Da(r)&&(h=!!r.leading,c="maxWait"in r,s=c?Pce(kI(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d);function f(_){var A=i,M=n;return i=n=void 0,u=_,a=e.apply(M,A),a}function p(_){return u=_,o=setTimeout(v,t),h?f(_):a}function m(_){var A=_-l,M=_-u,T=t-A;return c?Oce(T,s-M):T}function g(_){var A=_-l,M=_-u;return l===void 0||A>=t||A<0||c&&M>=s}function v(){var _=OS();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,d&&i?f(_):(i=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),u=0,i=l=n=o=void 0}function w(){return o===void 0?a:y(OS())}function S(){var _=OS(),A=g(_);if(i=arguments,n=this,l=_,A){if(o===void 0)return p(l);if(c)return clearTimeout(o),o=setTimeout(v,t),f(l)}return o===void 0&&(o=setTimeout(v,t)),a}return S.cancel=x,S.flush=w,S}var FD=Lce;function Ice(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Rce=Ice;function kce(e,t){return t.length<2?e:mj(e,_oe(t,0,-1))}var zce=kce;function Nce(e,t){return bce(e,t)}var UD=Nce;function Bce(e,t){return t=Sp(t,e),e=zce(e,t),e==null||delete e[ib(Rce(t))]}var Fce=Bce;function Uce(e){return woe(e)?void 0:e}var jce=Uce,Hce=1,Vce=2,Wce=4,Gce=vj(function(e,t){var r={};if(e==null)return r;var i=!1;t=nj(t,function(s){return s=Sp(s,e),i||(i=s.length>1),s}),Uv(e,Sj(e),r),i&&(r=Tj(r,Hce|Vce|Wce,jce));for(var n=t.length;n--;)Fce(r,t[n]);return r}),gA=Gce;function Yce(e,t,r,i){if(!Da(e))return e;t=Sp(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=ib(t[n]),u=r;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var h=o[l];u=i?i(h,l,o):void 0,u===void 0&&(u=Da(h)?h:ED(t[n+1])?[]:{})}TD(o,l,u),o=o[l]}return e}var qce=Yce;function Xce(e,t,r){for(var i=-1,n=t.length,s={};++i<n;){var a=t[i],o=mj(e,a);r(o,a)&&qce(s,Sp(a,e),o)}return s}var $ce=Xce;function Qce(e,t){return $ce(e,t,function(r,i){return Tce(e,i)})}var Kce=Qce,Zce=vj(function(e,t){return e==null?{}:Kce(e,t)}),Tl=Zce,Jce="Expected a function";function ehe(e,t,r){var i=!0,n=!0;if(typeof e!="function")throw new TypeError(Jce);return Da(r)&&(i="leading"in r?!!r.leading:i,n="trailing"in r?!!r.trailing:n),FD(e,t,{leading:i,maxWait:t,trailing:n})}var the=ehe;function rhe(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function Sh(e,t){return Object.setPrototypeOf(e,t),e}var ihe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),nhe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),she=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||sb&&"ontouchend"in document,ahe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,ohe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,lhe=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},uhe=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},che=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},hhe=ihe();hhe&&che();var sb=nhe(),Pj=she(),dhe=ahe(),ps=ohe(),lR=lhe(),uR=Number(uhe());function Oj(e){return Array.isArray(e)?e:[e]}function fhe(e,t){let r=0;for(;r<e.length&&r<t.length;){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1;r+=1}return r!==t.length?-1:r!==e.length?1:0}function my(e){return sb?e.metaKey:e.ctrlKey}var xt=[],Cx={},Hm={},M1={};function Lj(e){xt.includes(e)||xt.push(e)}function mf(e){delete Cx[e.pointerId];for(let t=0;t<xt.length;t++)if(xt[t].pointerId===e.pointerId){xt.splice(t,1);break}}function phe(){xt.splice(0,xt.length)}function Dx(e){if(e.pointerType!=="touch")return;let t=Cx[e.pointerId];t===void 0&&(t={x:0,y:0},Cx[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function LS(e){let t=e.pointerId===xt[0].pointerId?xt[1]:xt[0];return Cx[t.pointerId]}function Ij(e){Hm[e.key]=!0,M1[e.key]=M1[e.key]===void 0?1:M1[e.key]+1}function Rj(e){if(sb&&Hm.Meta)for(let t in Hm)Hm[t]=!1;else Hm[e.key]=!1;M1={}}function mhe(e){e.addEventListener("pointerdown",Lj,!0),e.addEventListener("pointerdown",Dx,!0),e.addEventListener("pointermove",Dx,!0),e.addEventListener("pointerup",mf,!0),e.addEventListener("pointercancel",mf,!0),e.addEventListener("pointerleave",mf,!0),window.addEventListener("keydown",Ij,!0),window.addEventListener("keyup",Rj,!0)}function ghe(e){e.removeEventListener("pointerdown",Lj,!0),e.removeEventListener("pointerdown",Dx,!0),e.removeEventListener("pointermove",Dx,!0),e.removeEventListener("pointerup",mf,!0),e.removeEventListener("pointercancel",mf,!0),e.removeEventListener("pointerleave",mf,!0),window.removeEventListener("keydown",Ij,!0),window.removeEventListener("keyup",Rj,!0)}var kj,vhe=new Promise(e=>{kj=e}),gy;function yhe(){if(gy)return gy;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@0.9.432/build",r=Iv(()=>import("./navmesh-0b92f809.js"),[],import.meta.url),[i,n]=await Promise.all([r,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=i.default,a=await s({wasmBinary:n});kj(a)}return gy=e(),gy}var zj,xhe=new Promise(e=>{zj=e}),vy;function whe(){if(vy)return vy;async function e(){let t=await Iv(()=>import("./physics-dee4de67.js"),[],import.meta.url);await t.init(),zj(t)}return vy=e(),vy}var hi=class{modifyById(e,t){let r=this;if(r[e]===void 0)throw new Error("not expected");{let i={...r,[e]:t};return Object.setPrototypeOf(i,hi.prototype),i}}add(e,t){var r;return((r=this.runOp({type:1,id:e,data:t}))==null?void 0:r.data)??this}runOp(e){let t=this;if(e.type===1){let r=t[e.id],i;r===void 0?i={type:2,id:e.id}:i={type:1,id:e.id,data:r};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,hi.prototype),{data:a,actual:e,reverse:i}}else if(e.type===2){let{id:r}=e,i=t[r];if(i===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,hi.prototype),delete n[r],{data:n,actual:e,reverse:{type:1,id:r,data:i}}}}return null}};function jD(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let r of t){let i=e[r];i&&typeof i=="object"&&jD(i)}return Object.freeze(e)}function bhe(e,t){let r=0;for(;r<e.length&&r<t.length;){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1;r+=1}return r!==t.length?-1:r!==e.length?1:0}var Nj=class extends Error{};function IS(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function Du(e,t,r){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let i=[],n=1/(r+1);for(let s=0;s<r;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;i.push(a)}return i}function HD(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function _he(){return typeof process<"u"}function Bj(e,t){for(let r of e)t(r.id,r.data)!==!0&&Bj(r.children,t)}function Fj(e,t){if(t(e.id,e.data)!==!0)for(let r of e.children)Fj(r,t)}var Xn=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Xn.prototype)}deepFreeze(){let e=0;for(;e<this.length;)jD(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let r of e.children)this.fillCaches0(r,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let r=this.parent(e);if(r===t)return!0;e=r}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let r=this.parent(e);if(r===t)return!0;e=r}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let r=this.get(e);r&&Fj(r,t)}}traverse(e){Bj(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let r=this.parent(e),i=this.childrenArray(r),n=i.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=i[n];return i=[...i],i[n]={...s,data:t},this.modifyArrayBy(r,i)}}modifyArrayBy(e,t){let r=e,i=t;for(;r!==null;){let s=i,a=r;if(r=this.parent(r),r===void 0)throw new Error;i=this.childrenArray(r);let o=i.findIndex(l=>l.id===a);if(o<0)throw new Error;i=[...i],i[o]={...i[o],children:s}}Object.setPrototypeOf(i,Xn.prototype);let n=i;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let r of t)if(this.checkDuplicatedIdRec(r))return!0;return!1}addOp(e){let{parent:t,fi:r,id:i,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:r,id:i,data:n,children:s};return o=[...o,l],o.sort((u,h)=>u.fi-h.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:i}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let r=this.parent(t);if(r===void 0)return null;let i=this.childrenArray(r),n=i.findIndex(a=>a.id===t);e.localIndex=n,i=[...i];let s=i.splice(n,1)[0];return{data:this.modifyArrayBy(r,i),actual:e,reverse:{type:7,...s,parent:r}}}}moveOp(e){let{parent:t,fi:r,id:i}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:i});if(t!==null){let c=t;for(;c!==null;){if(c===void 0)throw new Error;if(c===i)throw new Nj("cyclic tree");c=this.parent(c)}}let n=this.parent(i);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(c=>c.id===i);a=[...a];let l=a.splice(o,1)[0],u=this.modifyArrayBy(n,a);n=t,a=u.childrenArray(n);let h=l.fi;return l={...l,fi:r},a=[...a,l],a.sort((c,d)=>c.fi-d.fi),e.localIndex=a.indexOf(l),u=u.modifyArrayBy(n,a),{data:u,actual:e,reverse:{type:9,parent:s,fi:h,id:i}}}previous(e,t){if(t===null){let i=this.childrenArray(e);return i.length===0?null:i[i.length-1].id}let r=null;for(let i of this.childrenArray(e)){if(i.id===t)return r;r=i.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let r=this.childrenArray(t),i=r.findIndex(n=>n.id===e)+1;if(i<r.length)return r[i].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let r=this.childrenArray(t),i=r.findIndex(n=>n.id===e)-1;return i>=0?this.traverseSortPrevious(r[i].id):t}}getAllSorted(e){let t=[];for(let r of e){let i=this.getWithSortKey(r.id);i!==void 0&&t.push({...r,...i})}t.sort((r,i)=>bhe(r.sortKey,i.sortKey));for(let r of t)delete r.sortKey;return t}getWithSortKey(e){var t=e;let r=[],i=this.get(t),n=i;if(i!==void 0){for(;t;)r.splice(0,0,i.fi),t=this.parent(t),t!==null&&(i=this.get(t));return{...n,sortKey:r}}}insertBeforeHelper(e,t,r){return this.insertAfterHelper(e,this.previous(e,t),r)}insertAfterHelper(e,t,r){let i=this.childrenArray(e);if(t===null){if(i.length===0)return Du(0,r,r);{let n=i[0].fi;return Du(n-r,n,r)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=i.find(a=>a.fi>n.fi);if(s===void 0){let a=i[i.length-1].fi;return Du(a,a+r,r)}else return Du(n.fi,s.fi,r)}}},Px;(e=>{function t(r,i){if(i.type!==0)return null;if(Array.isArray(r)){let n=i.props,s={},a=[...r],o=!1;if(n)for(let l of Object.keys(n)){let u=parseInt(l);if(isNaN(u))throw new Error("wrong index");s[l]=a[u],a[u]=n[l],o=!0}return o?{data:a,actual:i,reverse:{type:0,props:s}}:null}else{let n=i.props,s={},a={...r},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let u=n[l];u===void 0?delete a[l]:a[l]=u,o=!0}return o?{data:a,actual:i,reverse:{type:0,props:s}}:null}}e.runOp=t})(Px||(Px={}));var At=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,At.prototype)}deepFreeze(){let e=0;for(;e<this.length;)jD(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let r=this,i=r.findIndex(s=>s.id===e);if(i<0)throw new Error("not expected");let n=r[i];return r=[...r],r[i]={...n,data:t},this.modifyArrayBy(r)}}modifyArrayBy(e){Object.setPrototypeOf(e,At.prototype);let t=e;return _he()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:r,data:i}=e,n=this,s={fi:t,id:r,data:i};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:r}}}deleteOp(e){let{id:t}=e,r=this,i=r.findIndex(s=>s.id===t);if(i===-1)return null;e.localIndex=i,r=[...r];let n=r.splice(i,1)[0];return{data:this.modifyArrayBy(r),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:r}=e,i=this;i=[...i];let n=i.findIndex(o=>o.id===r);if(n===-1)return null;let s=i[n].fi,a={...i[n],fi:t};return i[n]=a,i.sort((o,l)=>o.fi-l.fi),e.localIndex=i.indexOf(a),{data:this.modifyArrayBy(i),actual:e,reverse:{type:6,fi:s,id:r}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let r of this){if(r.id===e)return t;t=r.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let r=this;if(e===null){if(r.length===0)return Du(0,t,t);{let i=r[0].fi;return Du(i-t,i,t)}}else{let i=this.get(e);if(i===void 0)throw new Error("illegal args");let n=r.find(s=>s.fi>i.fi);if(n===void 0){let s=r[r.length-1].fi;return Du(s,s+t,t)}else return Du(i.fi,n.fi,t)}}};function Vf(e){return e&&typeof e=="object"&&e instanceof Ei}var Ei=class{unusedFunOverridesTable(e){}runOp(e){let t=[],r=this,i=0,n={};for(;i<e.path.length;){if(t.push(r),r=r===void 0?void 0:r[e.path[i]],r!==void 0&&!Vf(r))return null;i+=1}r=r?IS(r):new Ei;for(let[o,l]of Object.entries(e.props)){let u=r[o];n[o]=u,l===void 0?delete r[o]:r[o]=l}for(;i>0;){if(Object.keys(r).length===0){let o=t[i-1];o&&(r=IS(o),delete r[e.path[i-1]])}else{let o=t[i-1];if(o){let l=IS(o);l[e.path[i-1]]=r,r=l}else{let l=new Ei;l[e.path[i-1]]=r,r=l}}i-=1}let s=Object.setPrototypeOf(r,Ei.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},qu;(e=>{function t(n,s){return ev(n,s)??n}e.apply=t;function r(n,s){return WD(n,s)}e.merge=r;function i(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=fo.zoomOnce(l,o[a]),l===void 0)return s;if(!Vf(l))return;a+=1}if(l===void 0)return s;if(Vf(l))if(s.type===0){let u={...s.props};for(let h of Object.keys(l))delete u[h];return{...s,props:u}}else if(s.type===1||s.type===4||s.type===7){let u=VD([s],l);return u?(console.log(u),u):s}else return s}e.filterOp=i})(qu||(qu={}));function VD(e,t){if(t===void 0)return;let r=!1,i=e.map(n=>{let s=n.id,a=ev(n.data,t[s]);if(r=r||a!==void 0,a===void 0&&(a=n.data),n.children){let o=VD(n.children,t);return o!==void 0?r=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(r)return i}function She(e,t){if(t===void 0)return;let r=!1,i=e.map(n=>{let s=n.id,a=ev(n.data,t[s]);return r=r||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(r)return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}function ev(e,t){if(!Vf(t))return t;if(e instanceof Xn){let r=VD(e,t);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof At)return She(e,t);if(Array.isArray(e)){let r=!1,i=e.map((n,s)=>{let a=ev(n,t[s]);return r=r||a!==void 0,a===void 0&&(a=n),a});return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}else{if(e instanceof Ei)return WD(e,t);if(e&&typeof e=="object"){let r={},i=!1;for(let[n,s]of Object.entries(e)){let a=ev(s,t[n]);i=i||a!==void 0,a===void 0&&(a=s),r[n]=a}return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}}}}function WD(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!Vf(t))return t;if(!Vf(e))return qu.apply(e,t);let r=new Set;for(let n of Object.keys(e))r.add(n);for(let n of Object.keys(t))r.add(n);let i=new Ei;for(let n of r){let s=WD(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);i[n]=s}return i}function Mhe(e,t){let r={cur:[],result:[],len:0};return e=tv(e,t,r)??e,[e,r.result]}function Ox(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function Lx(e){e&&(e.len-=1)}function Ehe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function Uj(e,t,r){let i=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(i=!0,a=o,r!==null))throw new Error("not supported");let l=tv(s.data,t,Ox(r,a));Lx(r),i=i||l!==void 0,l===void 0&&(l=s.data);let u=Uj(s.children,t,r);return u!==void 0?i=!0:u=s.children,{...s,id:a,data:l,children:u}});if(i)return n}function Ahe(e,t,r){let i=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(i=!0,a=o,r!==null))throw new Error("not supported");let l=tv(s.data,t,Ox(r,a));return Lx(r),i=i||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(i)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function tv(e,t,r){if(e instanceof Xn){let i=Uj(e,t,r);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof At)return Ahe(e,t,r);if(Array.isArray(e)){let i=!1,n=e.map((s,a)=>{let o=tv(s,t,Ox(r,a));return Lx(r),i=i||o!==void 0,o===void 0&&(o=s),o});return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!HD(e)){let i={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="text"){let o=t[s];if(typeof o=="string"){if(r!==null)throw new Error("not supported");n=!0,s=o}let l=tv(a,t,Ox(r,s));Lx(r),n=n||l!==void 0,l===void 0&&(l=a),i[s]=l}else i[s]=a;return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}else if(typeof e=="string"){let i=t[e];if(i!==void 0){if(e.length!==36)throw new Error("for now you should only call this method when the key is a uuid");Ehe(r)}return i}else return}}var vA;(e=>{function t(r,i){let n=fo.zoom(i,r.path);if(typeof n=="object"){let s={};for(let a of Object.keys(r.props))s[a]=n[a];return{...r,props:s}}else return{...r,props:{}}}e.replaceProps=t})(vA||(vA={}));var ms;(e=>{function t(l,u){return{...l,path:l.path.slice(u)}}e.drop=t;function r(l,u){var h;return((h=i(l,u))==null?void 0:h.data)??l}e.applySimple=r;function i(l,u){var d,f;let h=u.path;for(var c=[];;){let p;if(l instanceof Ei&&u.type===0&&(p=l.runOp({...u,path:h.slice(c.length)}),p===null&&(p=void 0)),p===void 0&&c.length===h.length&&(l instanceof Xn||l instanceof At||l instanceof hi?p=l.runOp(u):p=Px.runOp(l,u)),p!==void 0)if(p!==null){let v=p.data;for(let y=c.length-1;y>=0;y--){let x=h[y],w=c[y];if(w instanceof Xn){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof At){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof hi){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof Ei){let S={...w,[x]:v};v=Object.setPrototypeOf(S,Ei.prototype)}else if(typeof w=="object")if(Array.isArray(w)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let S=v;v=[...w],v[x]=S}else v={...w,[x]:v};else return null}return{data:v,actual:{...p.actual,path:h},reverse:{...p.reverse,path:h}}}else return null;let m=h[c.length],g;if(l instanceof Xn){if(typeof m=="number")throw new Error("");g=(d=l.get(m))==null?void 0:d.data}else if(l instanceof At){if(typeof m=="number")throw new Error("");g=(f=l.get(m))==null?void 0:f.data}else l!==null&&(g=l[m]);if(g!==void 0)c.push(l),l=g;else return null}}e.apply=i;function n(l,u){for(let h=0;h<l.length&&h<u.length;h++)if(l[h]!==u[h])return!0;return!1}e.pathDisjoint=n;function s(l,u){if(l.length!==u.length)return!1;for(let h=0;h<l.length;h++)if(l[h]!==u[h])return!1;return!0}e.pathEq=s;function a(l,u){return n(l.path,u.path)}e.commutative=a;function o(l,u){return l.type===0&&u.type===0&&s(l.path,u.path)?Object.keys(l.props).every(h=>u.props[h]!==void 0):!1}e.subsumed=o})(ms||(ms={}));var cR;(e=>{function t(){return[]}e.empty=t;function r(u,h){let c=[];for(let d of u){let[f,...p]=d.path;f===h&&c.push({...d,path:p})}return c}e.removePrefix=r;function i(u,h){return u.map(c=>({...c,path:[h,...c.path]}))}e.addPrefix=i;function n(u,h){return[...u,...h]}e.concat=n;function s(u,h){return[...u.filter(c=>!h.some(d=>ms.subsumed(c,d))),...h]}e.compress=s;function a(u,h){return u.every(c=>h.every(d=>ms.commutative(c,d)))}e.commutative=a;function o(u,h){for(let c of h){let d=l(u,c);d!==null&&(u=d.data)}return u}e.applyAll=o;function l(u,h){var c=u;let d=[],f=[];for(let p of h)try{if(p.type===3){let m=fo.zoom(c,[...p.path,p.id]),g=ms.apply(c,{...p,type:2});if(g!==null){c=g.data;let[v,y]=Mhe(c,{[p.id]:m});c=v;for(let x of y){let w=x[x.length-1];x.splice(x.length-1,1),d.push({type:0,path:x,props:{[w]:m}}),f.push({type:0,path:x,props:{[w]:p.id}})}f.push(g.reverse),d.push(g.actual)}}else{let m=ms.apply(c,p);m!==null&&(d.push(m.actual),c=m.data,f.push(m.reverse))}}catch(m){if(m instanceof Nj)return null;throw m}return{data:c,actual:d,reverse:f.reverse()}}e.apply=l})(cR||(cR={}));var jj=Symbol(),The=Symbol(),ab=Symbol(),jv=class{reportOp(e,t,r=[]){let i=this;if(t===null)return;i._current=t.data;let n=r;for(;!(i instanceof Vj);){let s=i._path,a=i._current;if(s!==""&&n.splice(0,0,s),i=i._parent,i===null)return;i.update(s,a)}i.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let r=t[ab];r&&r(),delete this._children[e]}}}},Che=class extends jv{constructor(e,t,r){super(),this._parent=e,this._path=t,this._current=r}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,Px.runOp(this._current,e),e.path)}},Dhe=class extends jv{constructor(e,t,r){super(),this._parent=e,this._path=t,this._current=r}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,hi.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},Hj={get(e,t){if(t===ab)return()=>{e._parent=null};if(t===jj)return e._current;if(t===The)return e;let{_current:r,_children:i}=e;if(t==="push"&&Array.isArray(r))throw new Error("not supported to expand array");let n=i===void 0?void 0:i[t];if(n!==void 0)return n;let s=r[t],a=ob(e,t,s);return a!==s?(i===void 0&&(i={},e._children=i),i[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let r=e._current,i=Reflect.getOwnPropertyDescriptor(r,t);return i&&{writable:!0,configurable:!0,enumerable:i.enumerable,value:r[t]}}},Phe={...Hj,set(e,t,r){let i={type:0,props:{[t]:Bi(r)??r}};return e.deleteChildren(t),e.runOp(i),!0},deleteProperty(e,t){let r={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(r),!0}},Ohe={...Hj,set(e,t,r){return r===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:r})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},GD=class extends jv{constructor(e,t,r){super(),this._children={},this._parent=e,this._path=t,this._current=r,this[ab]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,r)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:r}=this,i=r===void 0?void 0:r[e];if(i!==void 0)return i;let n=(a=t.get(e))==null?void 0:a.data,s=ob(this,e,n);return s!==n?(r===void 0&&(r={},this._children=r),r[e]=s,s):n}add(e,t,r,i,n){this.runOp({type:7,parent:e,fi:t,id:r,data:i,children:n})}move(e,t,r){this.runOp({type:9,parent:e,fi:t,id:r})}insertAfter(e,t,r){let i=this._current.insertAfterHelper(e,t,r.length);for(let n=0;n<r.length;n++){let s=r[n];this.add(e,i[n],s.id,s.data,s.children)}}insertBefore(e,t,r){let i=this._current.insertBeforeHelper(e,t,r.length);for(let n=0;n<r.length;n++){let s=r[n];this.add(e,i[n],s.id,s.data,s.children)}}moveAfter(e,t,r){let i=this._current.insertAfterHelper(e,t,r.length);for(let n=0;n<r.length;n++){let s=r[n];this.move(e,i[n],s)}}moveBefore(e,t,r){let i=this._current.insertBeforeHelper(e,t,r.length);for(let n=0;n<r.length;n++){let s=r[n];this.move(e,i[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},YD=class extends jv{constructor(e,t,r){super(),this._children={},this._parent=e,this._path=t,this._current=r,this[ab]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let r=0;r<t;r++){let i=this._current[r].id,n=this._current[r].fi;e(this.data(this._current[r].id),i,n)}}find(e){let t=this.length;for(let r=0;r<t;r++){let i=this._current[r].id;if(e(this.data(i),i))return this.get(i)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:r}=this,i=r===void 0?void 0:r[e];if(i!==void 0)return i;let n=(a=t.get(e))==null?void 0:a.data,s=ob(this,e,n);return s!==n?(r===void 0&&(r={},this._children=r),r[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,r){this.runOp({type:4,fi:e,id:t,data:r})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let r=this._current.insertAfterHelper(e,t.length);for(let i=0;i<t.length;i++){let n=t[i];this.add(r[i],n.id,n.data)}}insertBefore(e,t){let r=this._current.insertBeforeHelper(e,t.length);for(let i=0;i<t.length;i++){let n=t[i];this.add(r[i],n.id,n.data)}}moveAfter(e,t){let r=this._current.insertAfterHelper(e,t.length);for(let i=0;i<t.length;i++){let n=t[i];this.move(r[i],n)}}moveBefore(e,t){let r=this._current.insertBeforeHelper(e,t.length);for(let i=0;i<t.length;i++){let n=t[i];this.move(r[i],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function RS(e,t,r){if(e.length>0){let i=e[e.length-1];if(i.type===0&&t.type===0&&fo.equal(i.path,r)){Object.assign(i.props,t.props);return}}e.push({...t,path:r})}var Vj=class extends jv{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,r,i){RS(this.ts,t,e),RS(this.actual,r,e),RS(this.reverse,i,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function ob(e,t,r){return r instanceof Xn?new GD(e,t,r):r instanceof At?new YD(e,t,r):r instanceof hi?new Proxy(new Dhe(e,t,r),Ohe):r!==null&&typeof r=="object"?HD(r)?r:new Proxy(new Che(e,t,r),Phe):r}function Wj(e){let t=new Vj(e);return[ob(t,"",e),t]}function Ix(e,t){let[r,i]=Wj(e);return t(r),i.result()}function Bi(e){return e instanceof GD||e instanceof YD?e._current:e!==null&&typeof e=="object"?e[jj]:e}var fo;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function r(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let u={...a};return Object.keys(l).forEach(h=>{delete u[h]}),u}else return a}e.removeOverridden=r;function i(s,a){if((s instanceof Xn||s instanceof GD)&&typeof a=="string"||(s instanceof At||s instanceof YD)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=i;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=i(s,a[o]),o+=1;return s}e.zoom=n})(fo||(fo={}));function Lhe(e,t){let r=[];if(t.length===e.length)for(var i=0;i<e.length;){if(t[i]==="*")r.push(e[i]);else if(e[i]!==t[i])return null;i+=1}else return null;return r}function js(e,t){let r=[];if(t.length<=e.length)for(var i=0;i<t.length;){if(t[i]==="*")r.push(e[i]);else if(e[i]!==t[i])return null;i+=1}else return null;return r}var Gj=class{},hR=class extends Gj{constructor(e){super(),this.id=e}},dR=class extends Gj{constructor(e){super(),this.data=e}},yA;try{yA=new TextDecoder}catch{}var Je,Xu,ue=0,Fn={},tr,Pu,ks=0,io=0,ls,Cl,Cn=[],ar,fR={useRecords:!1,mapsAsObjects:!0},Yj=class{},qj=new Yj;qj.name="MessagePack 0xC1";var Wf=!1,Rx=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Je)return Jj(()=>(wA(),this?this.unpack(e,t):Rx.prototype.unpack.call(fR,e,t)));Xu=t>-1?t:e.length,ue=0,io=0,Pu=null,ls=null,Je=e;try{ar=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw Je=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Rx){if(Fn=this,this.structures)return tr=this.structures,yy();(!tr||tr.length>0)&&(tr=[])}else Fn=fR,(!tr||tr.length>0)&&(tr=[]);return yy()}unpackMultiple(e,t){let r,i=0;try{Wf=!0;let n=e.length,s=this?this.unpack(e,n):ub.unpack(e,n);if(t){for(t(s);ue<n;)if(i=ue,t(yy())===!1)return}else{for(r=[s];ue<n;)i=ue,r.push(yy());return r}}catch(n){throw n.lastPosition=i,n.values=r,n}finally{Wf=!1,wA()}}_mergeStructures(e,t){e=e||[];for(let r=0,i=e.length;r<i;r++){let n=e[r];n&&(n.isShared=!0,r>=32&&(n.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let i=e[r],n=t[r];n&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function yy(){try{if(!Fn.trusted&&!Wf){let t=tr.sharedLength||0;t<tr.length&&(tr.length=t)}let e=Xr();if(ue==Xu)tr.restoreStructures&&pR(),tr=null,Je=null,Cl&&(Cl=null);else if(ue>Xu){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!Wf)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw tr.restoreStructures&&pR(),wA(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function pR(){for(let e in tr.restoreStructures)tr[e]=tr.restoreStructures[e];tr.restoreStructures=null}function Xr(){let e=Je[ue++];if(e<160)if(e<128){if(e<64)return e;{let t=tr[e&63]||Fn.getStructures&&Xj()[e&63];return t?(t.read||(t.read=qD(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Fn.mapsAsObjects){let t={};for(let r=0;r<e;r++)t[Qj()]=Xr();return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Xr(),Xr());return t}else{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=Xr();return t}else if(e<192){let t=e-160;if(io>=ue)return Pu.slice(ue-ks,(ue+=t)-ks);if(io==0&&Xu<140){let r=t<16?XD(t):$j(t);if(r!=null)return r}return xA(t)}else{let t;switch(e){case 192:return null;case 193:return ls?(t=Xr(),t>0?ls[1].slice(ls.position1,ls.position1+=t):ls[0].slice(ls.position0,ls.position0-=t)):qj;case 194:return!1;case 195:return!0;case 196:return kS(Je[ue++]);case 197:return t=ar.getUint16(ue),ue+=2,kS(t);case 198:return t=ar.getUint32(ue),ue+=4,kS(t);case 199:return Sc(Je[ue++]);case 200:return t=ar.getUint16(ue),ue+=2,Sc(t);case 201:return t=ar.getUint32(ue),ue+=4,Sc(t);case 202:if(t=ar.getFloat32(ue),Fn.useFloat32>2){let r=$D[(Je[ue]&127)<<1|Je[ue+1]>>7];return ue+=4,(r*t+(t>0?.5:-.5)>>0)/r}return ue+=4,t;case 203:return t=ar.getFloat64(ue),ue+=8,t;case 204:return Je[ue++];case 205:return t=ar.getUint16(ue),ue+=2,t;case 206:return t=ar.getUint32(ue),ue+=4,t;case 207:return Fn.int64AsNumber?(t=ar.getUint32(ue)*4294967296,t+=ar.getUint32(ue+4)):t=ar.getBigUint64(ue),ue+=8,t;case 208:return ar.getInt8(ue++);case 209:return t=ar.getInt16(ue),ue+=2,t;case 210:return t=ar.getInt32(ue),ue+=4,t;case 211:return Fn.int64AsNumber?(t=ar.getInt32(ue)*4294967296,t+=ar.getUint32(ue+4)):t=ar.getBigInt64(ue),ue+=8,t;case 212:if(t=Je[ue++],t==114)return xR(Je[ue++]&63);{let r=Cn[t];if(r)return r.read?(ue++,r.read(Xr())):r.noBuffer?(ue++,r()):r(Je.subarray(ue,++ue));throw new Error("Unknown extension "+t)}case 213:return t=Je[ue],t==114?(ue++,xR(Je[ue++]&63,Je[ue++])):Sc(2);case 214:return Sc(4);case 215:return Sc(8);case 216:return Sc(16);case 217:return t=Je[ue++],io>=ue?Pu.slice(ue-ks,(ue+=t)-ks):Rhe(t);case 218:return t=ar.getUint16(ue),ue+=2,io>=ue?Pu.slice(ue-ks,(ue+=t)-ks):khe(t);case 219:return t=ar.getUint32(ue),ue+=4,io>=ue?Pu.slice(ue-ks,(ue+=t)-ks):zhe(t);case 220:return t=ar.getUint16(ue),ue+=2,gR(t);case 221:return t=ar.getUint32(ue),ue+=4,gR(t);case 222:return t=ar.getUint16(ue),ue+=2,vR(t);case 223:return t=ar.getUint32(ue),ue+=4,vR(t);default:if(e>=224)return e-256;if(e===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+e)}}}var Ihe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function qD(e,t){function r(){if(r.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>Ihe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Xr);return e.highByte===0&&(e.read=mR(t,e.read)),n()}let i={};for(let n=0,s=e.length;n<s;n++){let a=e[n];i[a]=Xr()}return i}return r.count=0,e.highByte===0?mR(t,r):r}var mR=(e,t)=>function(){let r=Je[ue++];if(r===0)return t();let i=e<32?-(e+(r<<5)):e+(r<<5),n=tr[i]||Xj()[i];if(!n)throw new Error("Record id is not defined for "+i);return n.read||(n.read=qD(n,e)),n.read()};function Xj(){let e=Jj(()=>(Je=null,Fn.getStructures()));return tr=Fn._mergeStructures(e,tr)}var xA=lb,Rhe=lb,khe=lb,zhe=lb;function lb(e){let t;if(e<16&&(t=XD(e)))return t;if(e>64&&yA)return yA.decode(Je.subarray(ue,ue+=e));let r=ue+e,i=[];for(t="";ue<r;){let n=Je[ue++];if(!(n&128))i.push(n);else if((n&224)===192){let s=Je[ue++]&63;i.push((n&31)<<6|s)}else if((n&240)===224){let s=Je[ue++]&63,a=Je[ue++]&63;i.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Je[ue++]&63,a=Je[ue++]&63,o=Je[ue++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|l&1023),i.push(l)}else i.push(n);i.length>=4096&&(t+=Li.apply(String,i),i.length=0)}return i.length>0&&(t+=Li.apply(String,i)),t}function gR(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=Xr();return t}function vR(e){if(Fn.mapsAsObjects){let t={};for(let r=0;r<e;r++)t[Qj()]=Xr();return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Xr(),Xr());return t}}var Li=String.fromCharCode;function $j(e){let t=ue,r=new Array(e);for(let i=0;i<e;i++){let n=Je[ue++];if((n&128)>0){ue=t;return}r[i]=n}return Li.apply(String,r)}function XD(e){if(e<4)if(e<2){if(e===0)return"";{let t=Je[ue++];if((t&128)>1){ue-=1;return}return Li(t)}}else{let t=Je[ue++],r=Je[ue++];if((t&128)>0||(r&128)>0){ue-=2;return}if(e<3)return Li(t,r);let i=Je[ue++];if((i&128)>0){ue-=3;return}return Li(t,r,i)}else{let t=Je[ue++],r=Je[ue++],i=Je[ue++],n=Je[ue++];if((t&128)>0||(r&128)>0||(i&128)>0||(n&128)>0){ue-=4;return}if(e<6){if(e===4)return Li(t,r,i,n);{let s=Je[ue++];if((s&128)>0){ue-=5;return}return Li(t,r,i,n,s)}}else if(e<8){let s=Je[ue++],a=Je[ue++];if((s&128)>0||(a&128)>0){ue-=6;return}if(e<7)return Li(t,r,i,n,s,a);let o=Je[ue++];if((o&128)>0){ue-=7;return}return Li(t,r,i,n,s,a,o)}else{let s=Je[ue++],a=Je[ue++],o=Je[ue++],l=Je[ue++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){ue-=8;return}if(e<10){if(e===8)return Li(t,r,i,n,s,a,o,l);{let u=Je[ue++];if((u&128)>0){ue-=9;return}return Li(t,r,i,n,s,a,o,l,u)}}else if(e<12){let u=Je[ue++],h=Je[ue++];if((u&128)>0||(h&128)>0){ue-=10;return}if(e<11)return Li(t,r,i,n,s,a,o,l,u,h);let c=Je[ue++];if((c&128)>0){ue-=11;return}return Li(t,r,i,n,s,a,o,l,u,h,c)}else{let u=Je[ue++],h=Je[ue++],c=Je[ue++],d=Je[ue++];if((u&128)>0||(h&128)>0||(c&128)>0||(d&128)>0){ue-=12;return}if(e<14){if(e===12)return Li(t,r,i,n,s,a,o,l,u,h,c,d);{let f=Je[ue++];if((f&128)>0){ue-=13;return}return Li(t,r,i,n,s,a,o,l,u,h,c,d,f)}}else{let f=Je[ue++],p=Je[ue++];if((f&128)>0||(p&128)>0){ue-=14;return}if(e<15)return Li(t,r,i,n,s,a,o,l,u,h,c,d,f,p);let m=Je[ue++];if((m&128)>0){ue-=15;return}return Li(t,r,i,n,s,a,o,l,u,h,c,d,f,p,m)}}}}}function kS(e){return Fn.copyBuffers?Uint8Array.prototype.slice.call(Je,ue,ue+=e):Je.subarray(ue,ue+=e)}function Sc(e){let t=Je[ue++];if(Cn[t])return Cn[t](Je.subarray(ue,ue+=e));throw new Error("Unknown extension type "+t)}var yR=new Array(4096);function Qj(){let e=Je[ue++];if(e>=160&&e<192){if(e=e-160,io>=ue)return Pu.slice(ue-ks,(ue+=e)-ks);if(!(io==0&&Xu<180))return xA(e)}else return ue--,Xr();let t=(e<<5^(e>1?ar.getUint16(ue):e>0?Je[ue]:0))&4095,r=yR[t],i=ue,n=ue+e-3,s,a=0;if(r&&r.bytes==e){for(;i<n;){if(s=ar.getUint32(i),s!=r[a++]){i=1879048192;break}i+=4}for(n+=3;i<n;)if(s=Je[i++],s!=r[a++]){i=1879048192;break}if(i===n)return ue=i,r.string;n-=3,i=ue}for(r=[],yR[t]=r,r.bytes=e;i<n;)s=ar.getUint32(i),r.push(s),i+=4;for(n+=3;i<n;)s=Je[i++],r.push(s);let o=e<16?XD(e):$j(e);return o!=null?r.string=o:r.string=xA(e)}var xR=(e,t)=>{var r=Xr();let i=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let n=tr[e];return n&&n.isShared&&((tr.restoreStructures||(tr.restoreStructures=[]))[e]=n),tr[e]=r,r.read=qD(r,i),r.read()},Kj=typeof self=="object"?self:global;Cn[0]=()=>{};Cn[0].noBuffer=!0;Cn[101]=()=>{let e=Xr();return(Kj[e[0]]||Error)(e[1])};Cn[105]=e=>{let t=ar.getUint32(ue-4);Cl||(Cl=new Map);let r=Je[ue],i;r>=144&&r<160||r==220||r==221?i=[]:i={};let n={target:i};Cl.set(t,n);let s=Xr();return n.used?Object.assign(i,s):(n.target=s,s)};Cn[112]=e=>{let t=ar.getUint32(ue-4),r=Cl.get(t);return r.used=!0,r.target};Cn[115]=()=>new Set(Xr());var Zj=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Cn[116]=e=>{let t=e[0],r=Zj[t];if(!r)throw new Error("Could not find typed array for code "+t);return new Kj[r](Uint8Array.prototype.slice.call(e,1).buffer)};Cn[120]=()=>{let e=Xr();return new RegExp(e[0],e[1])};Cn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=ue;ue+=t-4,ls=[Xr(),Xr()],ls.position0=0,ls.position1=0;let i=ue;ue=r;try{return Xr()}finally{ue=i}};Cn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Jj(e){let t=Xu,r=ue,i=ks,n=io,s=Pu,a=Cl,o=ls,l=new Uint8Array(Je.slice(0,Xu)),u=tr,h=tr.slice(0,tr.length),c=Fn,d=Wf,f=e();return Xu=t,ue=r,ks=i,io=n,Pu=s,Cl=a,ls=o,Je=l,Wf=d,tr=u,tr.splice(0,tr.length,...h),Fn=c,ar=new DataView(Je.buffer,Je.byteOffset,Je.byteLength),f}function wA(){Je=null,Cl=null,tr=null}function Nhe(e){e.unpack?Cn[e.type]=e.unpack:Cn[e.type]=e}var $D=new Array(147);for(let e=0;e<256;e++)$D[e]=+("1e"+Math.floor(45.15-e*.30103));var ub=new Rx({useRecords:!1});ub.unpack;ub.unpackMultiple;ub.unpack;var Bhe=new Float32Array(1);new Uint8Array(Bhe.buffer,0,4);var E1;try{E1=new TextEncoder}catch{}var kx,QD,cb=typeof Buffer<"u",zS=cb?Buffer.allocUnsafeSlow:Uint8Array,e5=cb?Buffer:Uint8Array,wR=cb?4294967296:2144337920,Te,Zr,ye=0,Na,Ba=null,Fhe=/[\u0080-\uFFFF]/,hm=Symbol("record-id"),t5=class extends Rx{constructor(e){super(e),this.offset=0;let t,r,i,n,s,a=0,o=e5.prototype.utf8Write?function(_,A,M){return Te.utf8Write(_,A,M)}:E1&&E1.encodeInto?function(_,A){return E1.encodeInto(_,Te.subarray(A)).written}:!1,l=this;e||(e={});let u=e&&e.sequential,h=e.structures||e.saveStructures,c=e.maxSharedStructures;if(c==null&&(c=h?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=h?32:64),u&&!e.saveStructures&&(this.structures=[]);let f=c>32||d+c>64,p=c+64,m=c+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(_,A){if(Te||(Te=new zS(8192),Zr=new DataView(Te.buffer,0,8192),ye=0),Na=Te.length-10,Na-ye<2048?(Te=new zS(Te.length),Zr=new DataView(Te.buffer,0,Te.length),Na=Te.length-10,ye=0):ye=ye+7&2147483640,t=ye,s=l.structuredClone?new Map:null,l.bundleStrings?(Ba=["",""],Te[ye++]=214,Te[ye++]=98,Ba.position=ye-t,ye+=4):Ba=null,r=l.structures,r){r.uninitialized&&(r=l._mergeStructures(l.getStructures()));let M=r.sharedLength||0;if(M>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let T=0;T<M;T++){let C=r[T];if(!C)continue;let L,I=r.transitions;for(let k=0,z=C.length;k<z;k++){let V=C[k];L=I[V],L||(L=I[V]=Object.create(null)),I=L}I[hm]=T+64}a=M}u||(r.nextId=M+64)}i&&(i=!1),n=r||[];try{if(x(_),Ba){Zr.setUint32(Ba.position+t,ye-Ba.position-t);let M=Ba;Ba=null,x(M[0]),x(M[1])}if(l.offset=ye,s&&s.idsToInsert){ye+=s.idsToInsert.length*6,ye>Na&&S(ye),l.offset=ye;let M=jhe(Te.subarray(t,ye),s.idsToInsert);return s=null,M}return A&Hhe?(Te.start=t,Te.end=ye,Te):Te.subarray(t,ye)}finally{if(r){if(y<10&&y++,v>1e4)r.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!u){for(let M=0,T=g.length;M<T;M++)g[M][hm]=0;g=[]}if(i&&l.saveStructures){let M=r.sharedLength||c;r.length>M&&(r=r.slice(0,M));let T=Te.subarray(t,ye);return l.saveStructures(r,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(_)):(a=M,T)}}A&Vhe&&(ye=t)}};let x=_=>{ye>Na&&(Te=S(ye));var A=typeof _,M;if(A==="string"){let T=_.length;if(Ba&&T>=8&&T<4096){let I=Fhe.test(_);Ba[I?0:1]+=_,Te[ye++]=193,x(I?-T:T);return}let C;T<32?C=1:T<256?C=2:T<65536?C=3:C=5;let L=T*3;if(ye+L>Na&&(Te=S(ye+L)),T<64||!o){let I,k,z,V=ye+C;for(I=0;I<T;I++)k=_.charCodeAt(I),k<128?Te[V++]=k:k<2048?(Te[V++]=k>>6|192,Te[V++]=k&63|128):(k&64512)===55296&&((z=_.charCodeAt(I+1))&64512)===56320?(k=65536+((k&1023)<<10)+(z&1023),I++,Te[V++]=k>>18|240,Te[V++]=k>>12&63|128,Te[V++]=k>>6&63|128,Te[V++]=k&63|128):(Te[V++]=k>>12|224,Te[V++]=k>>6&63|128,Te[V++]=k&63|128);M=V-ye-C}else M=o(_,ye+C,L);M<32?Te[ye++]=160|M:M<256?(C<2&&Te.copyWithin(ye+2,ye+1,ye+1+M),Te[ye++]=217,Te[ye++]=M):M<65536?(C<3&&Te.copyWithin(ye+3,ye+2,ye+2+M),Te[ye++]=218,Te[ye++]=M>>8,Te[ye++]=M&255):(C<5&&Te.copyWithin(ye+5,ye+3,ye+3+M),Te[ye++]=219,Zr.setUint32(ye,M),ye+=4),ye+=M}else if(A==="number")if(_>>>0===_)_<64?Te[ye++]=_:_<256?(Te[ye++]=204,Te[ye++]=_):_<65536?(Te[ye++]=205,Te[ye++]=_>>8,Te[ye++]=_&255):(Te[ye++]=206,Zr.setUint32(ye,_),ye+=4);else if(_>>0===_)_>=-32?Te[ye++]=256+_:_>=-128?(Te[ye++]=208,Te[ye++]=_+256):_>=-32768?(Te[ye++]=209,Zr.setInt16(ye,_),ye+=2):(Te[ye++]=210,Zr.setInt32(ye,_),ye+=4);else{let T;if((T=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){Te[ye++]=202,Zr.setFloat32(ye,_);let C;if(T<4||(C=_*$D[(Te[ye]&127)<<1|Te[ye+1]>>7])>>0===C){ye+=4;return}else ye--}Te[ye++]=203,Zr.setFloat64(ye,_),ye+=8}else if(A==="object")if(!_)Te[ye++]=192;else{if(s){let C=s.get(_);if(C){if(!C.id){let L=s.idsToInsert||(s.idsToInsert=[]);C.id=L.push(C)}Te[ye++]=214,Te[ye++]=112,Zr.setUint32(ye,C.id),ye+=4;return}else s.set(_,{offset:ye-t})}let T=_.constructor;if(T===Object)w(_,!0);else if(T===Array){M=_.length,M<16?Te[ye++]=144|M:M<65536?(Te[ye++]=220,Te[ye++]=M>>8,Te[ye++]=M&255):(Te[ye++]=221,Zr.setUint32(ye,M),ye+=4);for(let C=0;C<M;C++)x(_[C])}else if(T===Map){M=_.size,M<16?Te[ye++]=128|M:M<65536?(Te[ye++]=222,Te[ye++]=M>>8,Te[ye++]=M&255):(Te[ye++]=223,Zr.setUint32(ye,M),ye+=4);for(let[C,L]of _)x(C),x(L)}else{for(let C=0,L=kx.length;C<L;C++){let I=QD[C];if(_ instanceof I){let k=kx[C];if(k.write){k.type&&(Te[ye++]=212,Te[ye++]=k.type,Te[ye++]=0),x(k.write.call(this,_));return}let z=Te,V=Zr,K=ye;Te=null;let q;try{q=k.pack.call(this,_,O=>(Te=z,z=null,ye+=O,ye>Na&&S(ye),{target:Te,targetView:Zr,position:ye-O}),x)}finally{z&&(Te=z,Zr=V,ye=K,Na=Te.length-10)}q&&(q.length+ye>Na&&S(q.length+ye),ye=Uhe(q,Te,ye,k.type));return}}w(_,!_.hasOwnProperty)}}else if(A==="boolean")Te[ye++]=_?195:194;else if(A==="bigint"){if(_<BigInt(1)<<BigInt(63)&&_>=-(BigInt(1)<<BigInt(63)))Te[ye++]=211,Zr.setBigInt64(ye,_);else if(_<BigInt(1)<<BigInt(64)&&_>0)Te[ye++]=207,Zr.setBigUint64(ye,_);else if(this.largeBigIntToFloat)Te[ye++]=203,Zr.setFloat64(ye,Number(_));else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ye+=8}else if(A==="undefined")this.encodeUndefinedAsNil?Te[ye++]=192:(Te[ye++]=212,Te[ye++]=0,Te[ye++]=0);else if(A==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},w=this.useRecords===!1?this.variableMapSize?_=>{let A=Object.keys(_),M=A.length;M<16?Te[ye++]=128|M:M<65536?(Te[ye++]=222,Te[ye++]=M>>8,Te[ye++]=M&255):(Te[ye++]=223,Zr.setUint32(ye,M),ye+=4);let T;for(let C=0;C<M;C++)x(T=A[C]),x(_[T])}:(_,A)=>{Te[ye++]=222;let M=ye-t;ye+=2;let T=0;for(let C in _)(A||_.hasOwnProperty(C))&&(x(C),x(_[C]),T++);Te[M+++t]=T>>8,Te[M+t]=T&255}:_=>{let A=Object.keys(_),M,T=n.transitions||(n.transitions=Object.create(null)),C=0;for(let I=0,k=A.length;I<k;I++){let z=A[I];M=T[z],M||(M=T[z]=Object.create(null),C++),T=M}let L=T[hm];if(L)L>=96&&f?(Te[ye++]=((L-=96)&31)+96,Te[ye++]=L>>5):Te[ye++]=L;else{L=n.nextId,L||(L=64),L<p&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(L=n.nextOwnId,L<m||(L=p),n.nextOwnId=L+1):(L>=m&&(L=p),n.nextId=L+1);let I=A.highByte=L>=96&&f?L-96>>5:-1;T[hm]=L,n[L-64]=A,L<p?(A.isShared=!0,n.sharedLength=L-63,i=!0,I>=0?(Te[ye++]=(L&31)+96,Te[ye++]=I):Te[ye++]=L):(I>=0?(Te[ye++]=213,Te[ye++]=114,Te[ye++]=(L&31)+96,Te[ye++]=I):(Te[ye++]=212,Te[ye++]=114,Te[ye++]=L),C&&(v+=y*C),g.length>=d&&(g.shift()[hm]=0),g.push(T),x(A))}for(let I=0,k=A.length;I<k;I++)x(_[A[I]])},S=_=>{let A;if(_>16777216){if(_-t>wR)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(wR,Math.round(Math.max((_-t)*(_>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(_-t<<2,Te.length-1)>>12)+1<<12;let M=new zS(A);return Zr=new DataView(M.buffer,0,A),Te.copy?Te.copy(M,0,t,_):M.set(Te.slice(t,_)),ye-=t,t=0,Na=M.length-10,Te=M}}useBuffer(e){Te=e,Zr=new DataView(Te.buffer,Te.byteOffset,Te.byteLength),ye=0}};QD=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Yj];kx=[{pack(e,t,r){let i=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&i>=0&&i<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,i)}else if(i>0&&i<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(i/1e3/4294967296>>0)),s.setUint32(a+4,i)}else if(isNaN(i)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(i)))}}},{pack(e,t,r){let i=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),r(i)}},{pack(e,t,r){let{target:i,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(i[n++]=212,i[n++]=101,i[n++]=0),r([e.name,e.message])}},{pack(e,t,r){let{target:i,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(i[n++]=212,i[n++]=120,i[n++]=0),r([e.source,e.flags])}},{pack(e,t){this.structuredClone?bR(e,16,t):_R(cb?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==e5&&this.structuredClone?bR(e,Zj.indexOf(r.name),t):_R(e,t)}},{pack(e,t){let{target:r,position:i}=t(1);r[i]=193}}];function bR(e,t,r,i){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=r(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=r(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=r(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function _R(e,t){let r=e.byteLength;var i,n;if(r<256){var{target:i,position:n}=t(r+2);i[n++]=196,i[n++]=r}else if(r<65536){var{target:i,position:n}=t(r+3);i[n++]=197,i[n++]=r>>8,i[n++]=r&255}else{var{target:i,position:n,targetView:s}=t(r+5);i[n++]=198,s.setUint32(n,r),n+=4}i.set(e,n)}function Uhe(e,t,r,i){let n=e.length;switch(n){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:n<256?(t[r++]=199,t[r++]=n):n<65536?(t[r++]=200,t[r++]=n>>8,t[r++]=n&255):(t[r++]=201,t[r++]=n>>24,t[r++]=n>>16&255,t[r++]=n>>8&255,t[r++]=n&255)}return t[r++]=i,t.set(e,r),r+=n,r}function jhe(e,t){let r,i=t.length*6,n=e.length-i;for(t.sort((s,a)=>s.offset>a.offset?1:-1);r=t.pop();){let s=r.offset,a=r.id;e.copyWithin(s+i,s,n),i-=6;let o=s+i;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function Ep(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");QD.unshift(e.Class),kx.unshift(e)}Nhe(e)}var r5=new t5({useRecords:!1});r5.pack;r5.pack;var Hhe=512,Vhe=1024,SR=new t5({structuredClone:!0});Ep({Class:hi.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,hi.prototype),e}});Ep({Class:At.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,At.prototype),e}});Ep({Class:Xn.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Xn.prototype),e}});Ep({Class:hR.prototype.constructor,type:4,write(e){return e.id},read(e){return new hR(e)}});Ep({Class:dR.prototype.constructor,type:5,write(e){return e.data},read(e){return new dR(e)}});Ep({Class:Ei.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Ei.prototype),e}});function Whe(e){var t=0;if(e.length===0)return t;for(let r=0;r<e.length;r++){let i=e[r];t=(t<<5)-t+i,t=t&t}return t}function bA(e){if(HD(e))return e;if(Array.isArray(e))return e.map(bA);if(typeof e=="object"&&e!==null){let t={};for(let r of Object.keys(e).sort())t[r]=bA(e[r]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var _A;(e=>{function t(n){return SR.pack(n)}e.serialize=t;function r(n){return SR.unpack(n)}e.deserialize=r;function i(n){return Whe(t(bA(n))).toString()}e.checksum=i})(_A||(_A={}));var Fa={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Create"],MouseHover:["Transition","Animation","Create","Destroy","SwitchCamera","SceneTransition"],Scroll:["Transition","Animation","Create"],Start:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition"],Conditional:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset"],MouseDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset"],MouseUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset"],MousePress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","SceneTransition","Reset"],KeyDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset"],KeyUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset"],KeyPress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","Reset"],GameControl:["Transition","Animation","Audio","Video","Create"],Collision:["Transition","Animation","Audio","Video","Create","Destroy","Reset"],Trigger:["Transition","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset"],Resize:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset"]},MR;(e=>{function t(i){return i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress"||i.type==="KeyDown"||i.type==="KeyUp"||i.type==="KeyPress"}e.is=t;function r(i){return i==="MouseDown"||i==="MouseUp"||i==="MousePress"?{type:i,mode:"Object",disabled:!1,toggle:!1,actions:new At}:{type:i,disabled:!1,key:void 0,toggle:!1,actions:new At}}e.defaultData=r})(MR||(MR={}));var zx;(e=>{function t(r){return{type:"Property",value:[r??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(zx||(zx={}));var SA;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:zx.propertyDefaultData(n),rOperand:{...zx.valueDefaultData}}}e.comparisonDefaultData=t;function r(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=r;function i(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=i})(SA||(SA={}));var ER;(e=>{function t(i){return i.type==="Conditional"}e.is=t;function r(i){return{type:"Conditional",disabled:!1,inActions:new At,outActions:new At,condition:SA.distanceDefaultData(i)}}e.defaultData=r})(ER||(ER={}));var AR;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new At,drop:new At}})(AR||(AR={}));var MA;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new At})(MA||(MA={}));var EA;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(EA||(EA={}));var TR;(e=>{function t(i){return i.type==="MouseHover"}e.is=t;function r(){return{type:"MouseHover",disabled:!1,actions:new At}}e.defaultData=r})(TR||(TR={}));var CR;(e=>{function t(i){return i.type==="Scroll"}e.is=t;function r(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new At}}e.defaultData=r})(CR||(CR={}));var DR;(e=>{function t(i){return i.type==="Start"}e.is=t;function r(){return{type:"Start",disabled:!1,actions:new At}}e.defaultData=r})(DR||(DR={}));var PR;(e=>{function t(i){return i.type==="Collision"}e.is=t;function r(){return{type:"Collision",disabled:!1,toggle:!1,target:"character",actions:new At}}e.defaultData=r})(PR||(PR={}));var OR;(e=>{function t(i){return i.type==="Trigger"}e.is=t;function r(i,n){return{type:"Trigger",disabled:!1,toggle:!1,target:"all",triggeringObjects:[],actions:new At,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:i.toArray(),radius:i.length()/2,helperVisible:!0}}e.defaultData=r})(OR||(OR={}));var AA;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function r(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=r;function i(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=i;function n(){let a={size:"mobile",operator:"<",actions:new At},o={size:"tablet",operator:"<",actions:new At},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new At},u=new At;return u.push({id:zt.generateUUID(),fi:0,data:a},{id:zt.generateUUID(),fi:1,data:o},{id:zt.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:u}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new At}}e.defaultBreakpointData=s})(AA||(AA={}));var Ap="personal camera",hg="a218fcc3-276b-49b9-b485-49037fd14f5f",Ghe=2960946,Qs=5526619,tf;(e=>{function t(i,n){return i[0]===n[0]&&i[1]===n[1]}e.isEqual=t;function r(i,n,s){return[i[0]+(n[0]-i[0])*s,i[1]+(n[1]-i[1])*s]}e.lerp=r})(tf||(tf={}));var sh;(e=>{function t(l,u){return l[0]===u[0]&&l[1]===u[1]&&l[2]===u[2]}e.isEqual=t;function r(l,u){return[l[0]+u[0],l[1]+u[1],l[2]+u[2]]}e.add=r;function i(l,u){return[l[0]-u[0],l[1]-u[1],l[2]-u[2]]}e.sub=i;function n(l,u){return[l[0]/u[0],l[1]/u[1],l[2]/u[2]]}e.div=n;function s(l,u){return[l[0]*u[0],l[1]*u[1],l[2]*u[2]]}e.mul=s;function a(l,u){return Math.hypot(l[0]-u[0],l[1]-u[1],l[2]-u[2])}e.dist=a;function o(l,u,h){return[l[0]+(u[0]-l[0])*h,l[1]+(u[1]-l[1])*h,l[2]+(u[2]-l[2])*h]}e.lerp=o})(sh||(sh={}));var Nx;(e=>{function t(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]}e.isEqual=t;function r(i,n,s){return[i[0]+(n[0]-i[0])*s,i[1]+(n[1]-i[1])*s,i[2]+(n[2]-i[2])*s,i[3]+(n[3]-i[3])*s]}e.lerp=r})(Nx||(Nx={}));var Gf;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function r(n){return n??e.identity}e.simplify=r;function i(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let u=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/u,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/u,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/u}return a}e.applyMatrix4=i})(Gf||(Gf={}));var bn;(e=>{function t(l){return typeof l=="object"&&typeof l.r=="number"&&typeof l.g=="number"&&typeof l.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:1}}e.toRgb255a1=r;function i(l){return{r:l.r,g:l.g,b:l.b}}e.clone=i;function n(l){return l=Math.floor(l),{r:(l>>16&255)/255,g:(l>>8&255)/255,b:(l&255)/255}}e.fromHex=n;function s(l){return Math.round(l.r*255)*65536+Math.round(l.g*255)*256+Math.round(l.b*255)}e.toHex=s;function a(l,u){return l.r===u.r&&l.g===u.g&&l.b===u.b}e.equals=a;function o(l,u,h){return{r:l.r+(u.r-l.r)*h,g:l.g+(u.g-l.g)*h,b:l.b+(u.b-l.b)*h}}e.lerp=o})(bn||(bn={}));var xa;(e=>{e.white={...bn.white,a:1},e.transparent={...bn.white,a:0};function t(a){return{r:a[0],g:a[1],b:a[2],a:a[3]}}e.from0to1=t;function r(a,o){return{...bn.fromHex(a),a:o}}e.fromHexAndA=r;function i(a){return{r:Math.round(a.r*255),g:Math.round(a.g*255),b:Math.round(a.b*255),a:a.a}}e.toRgb255a1=i;function n(a,o){return bn.equals(a,o)&&a.a===o.a}e.equals=n;function s(a,o,l){return{r:a.r+(o.r-a.r)*l,g:a.g+(o.g-a.g)*l,b:a.b+(o.b-a.b)*l,a:a.a+(o.a-a.a)*l}}e.lerp=s})(xa||(xa={}));var TA;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(TA||(TA={}));var LR;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(LR||(LR={}));var IR;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(IR||(IR={}));var xu;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(xu||(xu={}));var Mh;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(r){return e.all.includes(r)}e.is=t})(Mh||(Mh={}));var Yf;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(r){return r.type==="PerspectiveCamera"?r.perspective.zoom:r.orthographic.zoom}e.getZoom=t})(Yf||(Yf={}));var Ou;(e=>{function t(i,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(i[0],i[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[i[0]+i[0]*n,0,0]},grid:{count:[2,2,2],size:i.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function r(i,n){let s={...i};if(i5.forEach(a=>{Object.assign(s,{[a]:n[a]??i[a]})}),s.radial={...i.radial},n.radial){let a=i.radial,o=n.radial;n5.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...i.linear},n.linear){let a=i.linear,o=n.linear;s5.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...i.grid},n.grid){let a=i.grid,o=n.grid;a5.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...i.toObject},n.toObject){let a=i.toObject,o=n.toObject;o5.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...i.randomnessObject},n.randomnessObject){let a=i.randomnessObject,o=n.randomnessObject;l5.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=r})(Ou||(Ou={}));var CA;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function r(i,n){let s=[];i.count!==void 0&&s.push({type:0,path:n,props:{count:i.count}});for(let a of t){let o=i[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=r})(CA||(CA={}));var i5=["count"],n5=["radius","start","end","position","scale","rotation"],s5=["position","scale","rotation"],a5=["count","size"],o5=["count","position","scale","rotation"],l5=["strength","scale","rotation","position","movement","seed","freqScale"],DA;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(r){return e.all.includes(r)}e.is=t})(DA||(DA={}));var PA;(e=>{function t(i){return r(i)}e.defaultData=t;function r(i){if(i==="PointLight")return{type:i,color:xa.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(i==="SpotLight")return{type:i,color:xa.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(i==="DirectionalLight")return{type:i,color:xa.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(PA||(PA={}));var qf;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(qf||(qf={}));var OA;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(r,i){return r.castShadow===i.castShadow&&r.receiveShadow===i.receiveShadow}e.equals=t})(OA||(OA={}));var LA;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(r,i){return r.flatShading===i.flatShading&&r.side===i.side&&r.wireframe===i.wireframe}e.equals=t})(LA||(LA={}));var IA;(e=>e.defaultData={...LA.defaultData,...OA.defaultData})(IA||(IA={}));var Bx;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(Bx||(Bx={}));var RR;(e=>{function t(r){return r==="texture"||r==="video"||r==="color"||r==="depth"||r==="normal"||r==="gradient"||r==="noise"||r==="fresnel"||r==="rainbow"||r==="toon"||r==="outline"||r==="transmission"||r==="matcap"||r==="displace"||r==="pattern"||r==="light"}e.is=t})(RR||(RR={}));function Yhe(e){return e.type!=="displace"}var kR;(e=>{function t(r){return r==="phong"||r==="toon"||r==="lambert"||r==="physical"}e.is=t})(kR||(kR={}));var u5=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],qhe=["wrapping","image","video","name"],Nn;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let u=s.texture;u&&Object.assign(u,o)}}e.patch=t;function r(s,a){return s==="light"&&a?i(a):n(s)}e.defaultData=r;function i(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:Bx.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...a,type:"color",color:bn.fromHex(Qs)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...bn.fromHex(6710886),a:1},colorB:{...bn.fromHex(6710886),a:1},colorC:{...bn.fromHex(16777215),a:1},colorD:{...bn.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:xa.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:xa.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:xa.fromHexAndA(0,1),contourColor:xa.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...bn.fromHex(0),a:1},colorB:{...bn.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Nn||(Nn={}));var an;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function r(u){let h="";return u.layers.forEach(c=>{Object.entries(c.data).forEach(([d,f])=>{h+=`${d}${f}`,Array.isArray(f)?f.forEach(p=>h+=`${p}`):typeof f=="object"?Object.values(f).forEach(p=>{typeof p=="number"?h+=`${p.toFixed(4)}`:h+=`${p}`}):h+=`${f}`})}),h}e.getHash=r;function i(){return{layers:new At}}e.defaultEmptyData=i;function n(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=n;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",c="layer2"){let d=new At;return d.push({fi:0,data:Nn.defaultData("light",u),id:h}),d.push({fi:1,data:Nn.defaultData("color"),id:c}),{layers:d}}e.defaultTwoLayerData=a;function o(u,h="phong",c="layer1",d="layer2"){let f=Nn.defaultData("texture");Object.assign(f.texture,{image:u});let p=new At;return p.push({fi:0,data:f,id:c}),p.push({fi:1,data:Nn.defaultData("light",h),id:d}),{layers:p}}e.defaultTwoLayerTextureData=o;function l(u,h="phong",c="layer1",d="layer2"){let f=Nn.defaultData("video");Object.assign(f.texture,{video:u});let p=new At;return p.push({fi:0,data:f,id:c}),p.push({fi:1,data:Nn.defaultData("light",h),id:d}),{layers:p}}e.defaultTwoLayerVideoTextureData=l})(an||(an={}));var Fx;(e=>{function t(){return{points:new At,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(Fx||(Fx={}));var Ux;(e=>{function t(){return{points:new At,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(Ux||(Ux={}));var c5={type:"Ellipse",width:100,height:100,spikes:16,angle:360,innerRadius:0},RA;(e=>{function t(r,i){let n={...r};return d5.forEach(s=>{Object.assign(n,{[s]:i[s]??r[s]})}),n}e.merge=t})(RA||(RA={}));var h5={shape:c5,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},d5=["depth","offset","angle","twist","startScale","endScale"],jx;(e=>{function t(i){return i==="PolygonGeometry"||i==="RectangleGeometry"||i==="StarGeometry"||i==="TriangleGeometry"||i==="EllipseGeometry"}e.is2DParametricMesh=t;function r(i){return i==="PolygonGeometry"||i==="PolygonGeometry"||i==="RectangleGeometry"||i==="StarGeometry"||i==="TriangleGeometry"||i==="EllipseGeometry"||i==="PathGeometry"||i==="VectorGeometry"||i==="ConeGeometry"||i==="CubeGeometry"||i==="CylinderGeometry"||i==="DodecahedronGeometry"||i==="HelixGeometry"||i==="IcosahedronGeometry"||i==="LatheGeometry"||i==="PyramidGeometry"||i==="SphereGeometry"||i==="PlaneGeometry"||i==="BackdropGeometry"||i==="TorusGeometry"||i==="TorusKnotGeometry"||i==="BooleanGeometry"||i==="TextGeometry"}e.isParametricMesh=r})(jx||(jx={}));var kA;(e=>{function t(r,i){let n={...r};return Object.assign(n,i),n.type==="PathGeometry"&&"extrusion"in i&&i.extrusion&&(n.extrusion={...r.extrusion},Object.assign(n.extrusion,RA.merge(n.extrusion,i.extrusion))),n}e.merge=t})(kA||(kA={}));var gf;(e=>{function t(r){if(r==="RectangleGeometry")return{width:320,height:320,type:r,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(r==="PathGeometry")return{type:r,width:1,height:1,depth:1,path:Ux.defaultData(),extrusion:h5};if(r==="VectorGeometry")return{width:1,height:1,type:r,subdivisions:12,shape:Fx.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(r==="BooleanGeometry")return{type:r,operation:2,width:0,height:0,depth:0,phongAngle:35};if(r==="TextGeometry")return{type:r,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if(r==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI};throw new Error("not implemented")}e.defaultData=t})(gf||(gf={}));var zR=["width","height","depth"],zA;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:bn.white,near:.1,far:2e3})(zA||(zA={}));var Hx;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focalLength:2,focusDistance:2,bokehScale:2},noise:{...t,blendFunction:16}}})(Hx||(Hx={}));var NA;(e=>e.defaultData={softShadowQuality:"low"})(NA||(NA={}));var BA;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(BA||(BA={}));var FA;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(FA||(FA={}));var Xf;(e=>e.defaultData={usePhysics:!1,gravity:-10})(Xf||(Xf={}));var UA;(e=>e.defaultData={playCamera:Ap,gameControlObject:null})(UA||(UA={}));var jA;(e=>e.defaultData={backgroundColor:xa.fromHexAndA(Ghe,1),postprocessing:Hx.defaultData,fog:zA.defaultData,globalPhysics:Xf.defaultData,ambient:BA.defaultData,ao:FA.defaultData,shadow:NA.defaultData,publish:UA.defaultData})(jA||(jA={}));var NR;(e=>{function t(i){return i==="Component"||i==="Instance"}e.isComponentRelated=t;function r(i){return i==="Empty"||i==="Instance"}e.isEmptyOrComponent=r})(NR||(NR={}));var $f;(e=>{e.identity={...TA.identity,hiddenMatrix:Gf.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function r(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=r;function i(n,s){return rhe({position:sh.isEqual(n.position,s.position)?void 0:s.position,rotation:sh.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:sh.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:Gf.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=i})($f||($f={}));var Tn;(e=>e.defaultData={states:new At,events:new At,visible:!0,raycastLock:!1,physics:qf.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...$f.identity,cloner:null})(Tn||(Tn={}));var BR;(e=>e.defaultData={type:"Empty",...Tn.defaultData})(BR||(BR={}));var FR;(e=>e.defaultData={type:"Component",...Tn.defaultData})(FR||(FR={}));var vf;(e=>e.defaultData={type:"Mesh",...Tn.defaultData,...IA.defaultData})(vf||(vf={}));var rv;(e=>e.defaultData={...Tn.defaultData,...$f.identity,position:[0,0,Yf.DefaultTargetOffset],...Yf.defaultData})(rv||(rv={}));var HA;(e=>{function t(r){return{...Tn.defaultData,...PA.defaultData(r)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(HA||(HA={}));var Vx;(e=>{function t(i,n,s=0){for(;s<n.length;){let a=i?i[n[s]]:void 0;if(n.length===s+1)return a;if(a)i=a.descendants,s+=1;else return}}e.resolveWithDes=t;function r(i,n,s=0){let a=t(i,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=r})(Vx||(Vx={}));var Lu;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(i,n){return{...Tn.defaultData,...n,component:i,overrides:new Ei,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function r(i){let n=$f.fromObject(i.data);return t(i.id,n)}e.fromComponentData=r})(Lu||(Lu={}));var Qf;(e=>e.defaultData={type:"Page",...Tn.defaultData,physics:{...qf.defaultData,fusedBody:!1},...jA.defaultData,camera:rv.defaultData})(Qf||(Qf={}));var VA;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Gf.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:qf.defaultData,states:new At,events:new At,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...Yf.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Tn.defaultData,...vf.defaultData,geometry:gf.defaultData("RectangleGeometry"),material:an.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Tn.defaultData,...vf.defaultData,geometry:gf.defaultData("BooleanGeometry"),material:an.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Tn.defaultData,...vf.defaultData,geometry:gf.defaultData("TextGeometry"),material:an.defaultTwoLayerData("phong","layer1","layer2")}))(VA||(VA={}));var Xc;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Ei}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Ei})))):Mh.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function r(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=Ix(o.material,l=>{if(typeof l!="string")for(let[u,h]of Object.entries(a.material.layers)){let c=l.layers.data(u);c&&Nn.patch(c,h)}}).data),o.materials&&a.materials&&(o.materials=Ix(o.materials,l=>{var u,h;for(let c=0;c<o.materials.length;c++){let d=a.materials[c];if(typeof d!="string")for(let[f,p]of Object.entries(d.layers)){let m=(h=(u=l[c])==null?void 0:u.layers)==null?void 0:h.data(f);m&&Nn.patch(m,p)}}}).data),o}function i(s,a){let o,l=[],u={orthographic:0,perspective:0,geometry:0};function h(c,d){for(let[f,p]of Object.entries(d.layers)){let{texture:m,...g}=p;if(m!==void 0&&Object.keys(m).length>0){let v={path:[...c,"layers",f,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...c,"layers",f],props:g,type:0};l.push(v)}}}for(let[c,d]of Object.entries(a))if(c!=="name")if(c==="cloner")l.push(...CA.toOps(d,["cloner"]));else if(c==="pathSnapping")l.push({path:[c],props:{slide:d.slide,offset:d.offset},type:0});else if(c==="material")h(["material"],d);else if(c==="materials")for(let[f,p]of Object.entries(d))h(["materials",f],p);else if(u[c]===0){if(c==="geometry"&&d.extrusion!==void 0){let f={path:[c,"extrusion"],props:d.extrusion,type:0};l.push(f),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let f={path:[c],props:d,type:0};l.push(f)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[c]=d;return l}e.toOps=i;function n(s,a){var l,u,h,c,d,f;if(a===void 0)return s;let o={...s};if(Object.assign(o,$f.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((u=o.pathSnapping)==null?void 0:u.slide)??0,offset:((h=a.pathSnapping)==null?void 0:h.offset)??((c=o.pathSnapping)==null?void 0:c.offset)??0})}),Mh.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let p=a;((d=p.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=p.orthographic.zoom),((f=p.perspective)==null?void 0:f.zoom)!==void 0&&(o.perspective.zoom=p.perspective.zoom),p.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=p.isUpVectorFlipped),p.targetOffset!==void 0&&(o.targetOffset=p.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:kA.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=r(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Ou.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Ou.merge(o.cloner,a.cloner)});else if(DA.is(s.type)){let p=a;p.intensity!==void 0&&(o.intensity=p.intensity),p.color!==void 0&&(typeof p.color=="string"?o.color=p.color:o.color=bn.clone(p.color))}return o}e.patch=n})(Xc||(Xc={}));var Wx;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(Wx||(Wx={}));var ah;(e=>e.defaultData={orbitControls:Wx.defaultData,playPage:hg,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,r)=>{let i=0,n=0;return r<5?n=-30:r<10&&(n=30),r===0||r===10||r===5?i=30:(r===4||r===11||r===9)&&(i=-30),[120,[i,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1})(ah||(ah={}));var WA;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(WA||(WA={}));var GA;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(GA||(GA={}));var yf;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...WA.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:GA.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(yf||(yf={}));var iv;(e=>{function t(i){return i.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function r(i,n,s){i.traverseFrom(n,(a,o)=>{if(o.type==="Instance"){let l=i.data(o.component);l&&s(a,o,l.events)}else s(a,o,o.events)})}e.traverseModuleInstances=r})(iv||(iv={}));var YA;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222";function t(n={withLight:!0,withSquare:!0}){let s=[],a=VA.defaultMeshObject;n.withLight===!0&&s.push({fi:-1,data:HA.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),n.withSquare===!0&&s.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:a,children:[]});let o=new Xn;return o.push({fi:1,id:hg,data:{...Qf.defaultData,name:"Scene 1"},children:s}),o}e.defaultData={objects:t(),publish:ah.defaultData,styles:yf.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new Xn,publish:ah.defaultData,styles:yf.defaultData()}},e.emptyDataWithPage=function(n){return{objects:t(n),publish:ah.defaultData,styles:yf.defaultData()}};function r(n){return{...e.defaultData,objects:Sh(n,Xn.prototype)}}e.withObjs=r;function i(n,s){return r([{id:n,data:s,children:[],fi:0}])}e.withObj=i})(YA||(YA={}));var Gx;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(Gx||(Gx={}));var qA;(e=>{function t(){let n={};return n["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Sh(n,hi.prototype)}e.defaultColors=t;function r(n){let s={};return n!=null&&n.withAITexture&&(s["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...Gx.emptyImage,name:"AI generated image"}),Sh(s,hi.prototype)}e.defaultImages=r;function i(){return{materials:new hi,images:new hi,videos:new hi,colors:new hi,audios:new hi,fonts:new hi}}e.emptyData=i})(qA||(qA={}));var XA;(e=>e.list=["idle","move","jump","run"])(XA||(XA={}));var Yx;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new At,move:new At,jump:new At,run:new At},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:xa.fromHexAndA(3728051,1)}}))(Yx||(Yx={}));function UR(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let r=t.colorA,i=t.colorB,n=[[r.r,r.g,r.b,r.a],[i.r,i.g,i.b,i.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Tl(Bi(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let r={...Bi(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,r)}})}function _u(e,t){Object.values(e.shared.materials).forEach(r=>t(r))}function Su(e,t){e.scene.objects.traverse((r,i)=>{"materials"in i?i.materials.forEach((n,s)=>{n===void 0&&(i.materials[s]=an.defaultData(),n=i.materials[s]),typeof n!="string"&&t(n)}):"material"in i?typeof i.material!="string"&&(i.material===void 0&&(i.material=an.defaultData()),t(i.material)):i.type==="Mesh"&&(i.material===void 0&&(i.material=an.defaultData()),t(i.material)),"overrides"in i&&Object.values(i.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&t(n.material)})})}function Xhe(e){Object.assign(e.scene.publish,{orbitControls:{...Wx.defaultData,...Bi(e.scene.publish.orbitControls)}})}function $he(e){Object.assign(e.scene.publish.settings,{video:{...ah.defaultData.settings.video,...Bi(e.scene.publish.settings.video)}})}function Qhe(e){function t(r){if(r.layers){for(let i of Object.values(r.layers))if(i){for(let[n,s]of Object.entries(i))if((u5.includes(n)||typeof s=="boolean")&&delete i[n],n==="texture")for(let[a,o]of Object.entries(s))(qhe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((r,i)=>{i.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function Khe(e){e.scene.publish.withBackground=!0}function Zhe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function Jhe(e){e.scene.objects.traverse((t,r)=>{let i=r.cloner;i&&(i.radial.scale=i.radial.scale.map(n=>n+1),i.linear.scale=i.linear.scale.map(n=>n+1))})}function ede(e){e.scene.objects.traverse((t,r)=>{let i=r.geometry;i&&(i.type==="DodecahedronGeometry"||i.type==="IcosahedronGeometry")&&(i.detail=Math.round(i.detail))})}function tde(e){e.scene.objects.traverse((t,r)=>{let i=e.scene.objects.unproxy().parent(t);if(i){let n=Bi(e.scene.objects.data(i));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&r.type==="Mesh"&&(r.visible=Bi(r).booleanExclude!==!0)}})}function rde(e){e.scene.objects.traverse((t,r)=>{if(r.type==="Mesh"){let i=r;r.geometry.type==="NonParametricGeometry"?i.material!==void 0&&delete i.material:i.materials!==void 0&&delete i.materials}})}function ide(e){function t(i){Object.setPrototypeOf(i,Ei.prototype),i.texture&&Object.setPrototypeOf(i.texture,Ei.prototype)}function r(i){Object.setPrototypeOf(i,Ei.prototype);for(let n in i)t(i[n])}e.scene.objects.traverse((i,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=Bi(a.material).layers;r(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],u=Bi(l).layers;r(u),l.layers=u}})})}function jR(e){e.layers===void 0&&Object.assign(e,an.defaultTwoLayerData("lambert"))}function NS(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let r=[...t.colors];r.push(t.colors[9]);let i=[...t.steps];i.push(t.steps[9]);let n={...Bi(t),colors:r,steps:i};Object.assign(t,n)}})}function nde(e){e.scene.objects.traverse((t,r)=>{r.type==="Mesh"&&(r.geometry.type==="BooleanGeometry"||r.geometry.type==="SubdivGeometry")&&(r.geometry.phongAngle=35)})}function HR(e){e.scene.objects.traverse((t,r)=>{"materials"in r?r.materials.forEach(i=>{typeof i!="string"&&NS(i)}):"material"in r&&typeof r.material!="string"&&NS(r.material)}),Object.values(e.shared.materials).forEach(t=>NS(t))}function sde(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,r)=>{(r.type==="DirectionalLight"||r.type==="SpotLight")&&(r.shadowResolution=1024,r.shadowRadius=1,r.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function ade(e){e.shared.audios=Sh({},hi.prototype)}function ode(e){e.shared.videos=Sh({},hi.prototype)}function lde(e){let t=e.shared.materials;Object.entries(t).forEach(([r,i])=>{if(!i.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[r]:n})}})}function ude(e){Object.entries(Bi(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Bi(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function cde(e){e.scene.publish.settings.web.preload=!1}function VR(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function WR(e){e.layers&&e.layers.forEach(t=>{Yhe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function hde(e){e.shared.fonts=Sh({},hi.prototype)}function dde(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function fde(e){let t=[];e.scene.objects.traverse((r,i)=>{let n=i;if(n.type==="TextFrame"){let s=an.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=dde(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...Tn.defaultData,...vf.defaultData,flatShading:!1,wireframe:!1,geometry:{...gf.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Bi(n.states),events:Bi(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},u=Bi(e.scene.objects).parent(r);e.scene.objects.insertAfter(u??null,r,[{id:r+"new",data:l,children:[]}]),t.push(r)}}),t.forEach(r=>{e.scene.objects.delete(r)})}function pde(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((r,i)=>{i.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new At,move:new At,jump:new At}});else{let s=new At;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:zt.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let u={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},h={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(h,Tl(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(h,{control1:{...a.control1},control2:{...a.control2}});let c={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...c,...h},f={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new At({fi:0,id:zt.generateUUID(),data:u},{fi:1,id:zt.generateUUID(),data:d})};s.push({fi:l,id:o,data:f})}),delete n.targets)}})})}function mde(e){e.scene.objects.traverse((t,r)=>{function i(n,s){var l;let a=new At,o=[];if(r.events.forEach((u,h,c)=>{if(u.type==="Audio"&&u.trigger===s){let d;o.push(h),u.interaction==="play"?d={...Tl(u,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in u?u.after:void 0,toggle:"after"in u?u.toggle:void 0,type:"Audio"}:(u.interaction==="pause"||u.interaction==="stop")&&(d={...Tl(u,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:c,id:h,data:d})}}),o.forEach(u=>r.events.delete(u)),a.length){let u=(l=r.events.find(h=>h.type===n))==null?void 0:l.data;u?"actions"in u&&u.actions.insertBefore(null,a):r.events.insertBefore(null,[{id:zt.generateUUID(),data:{type:n,actions:a}}])}}i("Start","start"),i("MouseDown","mouseDown"),i("MouseUp","mouseUp"),i("KeyDown","keyDown"),i("KeyUp","keyUp")})}function GR(e){var r;let t=(r=e.layers.find(i=>i.type==="light"))==null?void 0:r.data;if((t==null?void 0:t.category)==="basic"){let i=Nn.defaultData("light","phong"),n=t;Object.assign(n,i),n.visible=!1}}function YR(e){_u(e,GR),Su(e,GR)}function gde(e){e.scene.objects.traverse((t,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(r.geometry.scaleBaked||(r.geometry.scaleBaked=[1,1,1]))})}function vde(e){e.scene.objects.traverse((t,r)=>{(r.type==="Empty"||r.type==="Mesh")&&r.cloner&&!r.cloner.randomnessObject&&!r.cloner.toObject&&!r.cloner.randomness&&(r.cloner={...r.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function yde(e){e.scene.objects.traverse((t,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&!("material"in r)&&!("materials"in r)&&(r.material=an.defaultTwoLayerData("phong"))})}function xde(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,r)=>{(r.type==="OrthographicCamera"||r.type==="PerspectiveCamera")&&(r.orthographic.autoZoom===void 0&&(r.orthographic.autoZoom=!1),r.orthographic.autoZoomFrustumSize===void 0&&(r.orthographic.autoZoomFrustumSize=790))})}function wde(e){e.scene.objects.traverse((t,r)=>{r.pathSnapping===void 0&&(r.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),r.pathSnapping.offset===void 0&&(r.pathSnapping.offset=0)})}function bde(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function _de(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function Sde(e){e.scene.objects.traverse((t,r)=>{r.events.forEach(i=>{i.type==="GameControl"&&(i.resetYPosition=Math.abs(i.resetYPosition-r.position[1]))})})}function Mde(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((r,i)=>{t&&i.physics===null?i.collision=!1:i.collision="visibility"})}function Ede(e){e.scene.objects.traverse((t,r)=>{r.events.forEach(i=>{i.type==="GameControl"&&(i.navmesh=Yx.defaultDataThirdPerson.navmesh)})})}function Ade(e){e.scene.styles||(e.scene.styles=yf.defaultData())}function qR(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function Tde(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Su(e,qR),_u(e,qR)}function Cde(e){e.scene.objects.traverse((t,r)=>{r.events.forEach(i=>{i.type==="GameControl"&&Object.assign(i.gameActions,{run:new At})})})}function Dde(e){e.scene.objects.traverse((t,r)=>{r.events.forEach(i=>{i.type==="GameControl"&&(i.keyAssignments=[...i.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}function XR(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function Pde(e,t){if(t<1&&(Su(e,UR),_u(e,UR),e.schema=1),t<2&&(Xhe(e),e.schema=2),t<3&&(Qhe(e),e.schema=3),t<4&&(Khe(e),e.schema=4),t<5&&(Zhe(e),e.schema=5),t<6&&(Jhe(e),e.schema=6),t<7&&(ede(e),e.schema=7),t<8&&(e.schema=8),t<9&&(HR(e),e.schema=9),t<10&&(nde(e),e.schema=10),t<11&&(sde(e),e.schema=11),t<12&&(HR(e),e.schema=12),t<13&&(ade(e),e.schema=13),t<14&&(lde(e),e.schema=14),t<15&&(ude(e),e.schema=15),t<16&&(cde(e),e.schema=16),t<17&&(Su(e,VR),_u(e,VR),e.schema=17),t<18&&(Su(e,jR),_u(e,jR),e.schema=18),t<19&&($he(e),e.schema=19),t<20&&(hde(e),fde(e),e.schema=20),t<21&&(pde(e),mde(e),e.schema=21),t<22&&(YR(e),e.schema=22),t<23&&(gde(e),e.schema=23),t<24&&(vde(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(ode(e),t<25&&(e.schema=25)),t<26&&(tde(e),e.schema=26),t<27&&(rde(e),e.schema=27),t<28&&(YR(e),e.schema=28),t<29&&(ide(e),e.schema=29),t<30&&(yde(e),e.schema=30),t<31&&(xde(e),e.schema=31),t<33&&(wde(e),e.schema=33),t<34&&(bde(e),e.schema=34),t<35&&(_de(e),e.schema=35),t<36&&(Sde(e),e.schema=36),t<37&&(Mde(e),e.schema=37),t<38&&(Su(e,WR),_u(e,WR),e.schema=38),t<39&&(Ede(e),e.schema=39),t<40&&(Ade(e),e.schema=40),t<41&&(Tde(e),e.schema=41),t<42&&(Cde(e),e.schema=42),t<43&&(Dde(e),e.schema=43),t<99){Su(e,XR),_u(e,XR),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=Ap);let r=Bi(e.scene.objects),i=e.scene.objects;e.scene.publish.playPage=hg,i.insertBefore(null,null,[{id:hg,data:{...Qf.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Tl(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Tl(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...Xf.defaultData,...Tl(e.scene.environment,"usePhysics","gravity")},camera:Bi(e.scene.ownerCamera)??Qf.defaultData.camera,name:"Scene"},children:[]}]);for(let a of r)a.id!==YA.TRASH_CAN_ID&&i.move(hg,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,qf.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function $R(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function Ode(e){e.scene.objects.traverse((t,r)=>{let i=r.geometry;i&&i.type==="PathGeometry"&&(i.extrusion.capType="flat",i.extrusion.bevel=50,i.extrusion.bevelSides=6,i.extrusion.shape.type==="Custom"&&(i.extrusion.shape.shapeQuality="low"))})}var QR=102;function Lde(e){let t=e.schema??0;t!==QR&&(console.warn("updating from ",t,"to ",QR),Pde(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=ah.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Su(e,$R),_u(e,$R),e.schema=101),t<102&&(Ode(e),e.schema=102))}function $c(e,t=!1){let r=e[0].index!==null,i=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new _t,u=0;for(let h=0;h<e.length;++h){let c=e[h],d=0;if(r!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let f in c.attributes){if(!i.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(c.attributes[f]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let f in c.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(c.morphAttributes[f])}if(t){let f;if(r)f=c.index.count;else if(c.attributes.position!==void 0)f=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(u,f,h),u+=f}}if(r){let h=0,c=[];for(let d=0;d<e.length;++d){let f=e[d].index;for(let p=0;p<f.count;++p)c.push(f.getX(p)+h);h+=e[d].attributes.position.count}l.setIndex(c)}for(let h in s){let c=KR(s[h]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,c)}for(let h in a){let c=a[h][0].length;if(c===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let d=0;d<c;++d){let f=[];for(let m=0;m<a[h].length;++m)f.push(a[h][m][d]);let p=KR(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(p)}}return l}function KR(e){let t,r,i,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(r===void 0&&(r=l.itemSize),r!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=l.normalized),i!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new Mt(s,r,i)}var Ide=Math.pow(2,-24),xy=class{constructor(){}};function no(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function ZR(e){let t=-1,r=-1/0;for(let i=0;i<3;i++){let n=e[i+3]-e[i];n>r&&(r=n,t=i)}return t}function JR(e,t){t.set(e)}function ek(e,t,r){let i,n;for(let s=0;s<3;s++){let a=s+3;i=e[s],n=t[s],r[s]=i<n?i:n,i=e[a],n=t[a],r[a]=i>n?i:n}}function wy(e,t,r){for(let i=0;i<3;i++){let n=t[e+2*i],s=t[e+2*i+1],a=n-s,o=n+s;a<r[i]&&(r[i]=a),o>r[i+3]&&(r[i+3]=o)}}function dm(e){let t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return 2*(t*r+r*i+i*t)}function Rde(e,t){if(!e.index){let r=e.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;r>65535?n=new Uint32Array(new i(4*r)):n=new Uint16Array(new i(2*r)),e.setIndex(new Mt(n,1));for(let s=0;s<r;s++)n[s]=s}}function kde(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],r=new Set;for(let n of e.groups)r.add(n.start),r.add(n.start+n.count);let i=Array.from(r.values()).sort((n,s)=>n-s);for(let n=0;n<i.length-1;n++){let s=i[n],a=i[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function BS(e,t,r,i,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,h=-1/0,c=1/0,d=1/0,f=1/0,p=-1/0,m=-1/0,g=-1/0,v=n!==null;for(let y=t*6,x=(t+r)*6;y<x;y+=6){let w=e[y+0],S=e[y+1],_=w-S,A=w+S;_<s&&(s=_),A>l&&(l=A),v&&w<c&&(c=w),v&&w>p&&(p=w);let M=e[y+2],T=e[y+3],C=M-T,L=M+T;C<a&&(a=C),L>u&&(u=L),v&&M<d&&(d=M),v&&M>m&&(m=M);let I=e[y+4],k=e[y+5],z=I-k,V=I+k;z<o&&(o=z),V>h&&(h=V),v&&I<f&&(f=I),v&&I>g&&(g=I)}i[0]=s,i[1]=a,i[2]=o,i[3]=l,i[4]=u,i[5]=h,v&&(n[0]=c,n[1]=d,n[2]=f,n[3]=p,n[4]=m,n[5]=g)}function zde(e,t,r,i){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,u=-1/0;for(let h=t*6,c=(t+r)*6;h<c;h+=6){let d=e[h+0];d<n&&(n=d),d>o&&(o=d);let f=e[h+2];f<s&&(s=f),f>l&&(l=f);let p=e[h+4];p<a&&(a=p),p>u&&(u=p)}i[0]=n,i[1]=s,i[2]=a,i[3]=o,i[4]=l,i[5]=u}function Nde(e,t,r,i,n){let s=r,a=r+i-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let u=0;u<3;u++){let h=e[s*3+u];e[s*3+u]=e[a*3+u],e[a*3+u]=h;let c=t[s*6+u*2+0];t[s*6+u*2+0]=t[a*6+u*2+0],t[a*6+u*2+0]=c;let d=t[s*6+u*2+1];t[s*6+u*2+1]=t[a*6+u*2+1],t[a*6+u*2+1]=d}s++,a--}else return s}}var il=32,Bde=(e,t)=>e.candidate-t.candidate,au=new Array(il).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),by=new Float32Array(6);function Fde(e,t,r,i,n,s){let a=-1,o=0;if(s===0)a=ZR(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=ZR(e),a!==-1&&(o=Ude(r,i,n,a));else if(s===2){let l=dm(e),u=1.25*n,h=i*6,c=(i+n)*6;for(let d=0;d<3;d++){let f=t[d],p=(t[d+3]-f)/il;if(n<il/4){let m=[...au];m.length=n;let g=0;for(let y=h;y<c;y+=6,g++){let x=m[g];x.candidate=r[y+2*d],x.count=0;let{bounds:w,leftCacheBounds:S,rightCacheBounds:_}=x;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0,S[A]=1/0,S[A+3]=-1/0,w[A]=1/0,w[A+3]=-1/0;wy(y,r,w)}m.sort(Bde);let v=n;for(let y=0;y<v;y++){let x=m[y];for(;y+1<v&&m[y+1].candidate===x.candidate;)m.splice(y+1,1),v--}for(let y=h;y<c;y+=6){let x=r[y+2*d];for(let w=0;w<v;w++){let S=m[w];x>=S.candidate?wy(y,r,S.rightCacheBounds):(wy(y,r,S.leftCacheBounds),S.count++)}}for(let y=0;y<v;y++){let x=m[y],w=x.count,S=n-x.count,_=x.leftCacheBounds,A=x.rightCacheBounds,M=0;w!==0&&(M=dm(_)/l);let T=0;S!==0&&(T=dm(A)/l);let C=1+1.25*(M*w+T*S);C<u&&(a=d,u=C,o=x.candidate)}}else{for(let v=0;v<il;v++){let y=au[v];y.count=0,y.candidate=f+p+v*p;let x=y.bounds;for(let w=0;w<3;w++)x[w]=1/0,x[w+3]=-1/0}for(let v=h;v<c;v+=6){let y=~~((r[v+2*d]-f)/p);y>=il&&(y=il-1);let x=au[y];x.count++,wy(v,r,x.bounds)}let m=au[il-1];JR(m.bounds,m.rightCacheBounds);for(let v=il-2;v>=0;v--){let y=au[v],x=au[v+1];ek(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<il-1;v++){let y=au[v],x=y.count,w=y.bounds,S=au[v+1].rightCacheBounds;x!==0&&(g===0?JR(w,by):ek(w,by,by)),g+=x;let _=0,A=0;g!==0&&(_=dm(by)/l);let M=n-g;M!==0&&(A=dm(S)/l);let T=1+1.25*(_*g+A*M);T<u&&(a=d,u=T,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function Ude(e,t,r,i){let n=0;for(let s=t,a=t+r;s<a;s++)n+=e[s*6+i*2];return n/r}function jde(e,t){let r=e.attributes.position,i=e.index.array,n=i.length/3,s=new Float32Array(n*6),a=r.normalized,o=r.array,l=r.offset||0,u=3;r.isInterleavedBufferAttribute&&(u=r.data.stride);let h=["getX","getY","getZ"];for(let c=0;c<n;c++){let d=c*3,f=c*6,p,m,g;a?(p=i[d+0],m=i[d+1],g=i[d+2]):(p=i[d+0]*u+l,m=i[d+1]*u+l,g=i[d+2]*u+l);for(let v=0;v<3;v++){let y,x,w;a?(y=r[h[v]](p),x=r[h[v]](m),w=r[h[v]](g)):(y=o[p+v],x=o[m+v],w=o[g+v]);let S=y;x<S&&(S=x),w<S&&(S=w);let _=y;x>_&&(_=x),w>_&&(_=w);let A=(_-S)/2,M=v*2;s[f+M+0]=S+A,s[f+M+1]=A+(Math.abs(S)+A)*Ide,S<t[v]&&(t[v]=S),_>t[v+3]&&(t[v+3]=_)}}return s}function Hde(e,t){function r(v){d&&d(v/f)}function i(v,y,x,w=null,S=0){if(!p&&S>=l&&(p=!0,u&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),x<=h||S>=l)return r(y+x),v.offset=y,v.count=x,v;let _=Fde(v.boundingData,w,a,y,x,c);if(_.axis===-1)return r(y+x),v.offset=y,v.count=x,v;let A=Nde(o,a,y,x,_);if(A===y||A===y+x)r(y+x),v.offset=y,v.count=x;else{v.splitAxis=_.axis;let M=new xy,T=y,C=A-y;v.left=M,M.boundingData=new Float32Array(6),BS(a,T,C,M.boundingData,s),i(M,T,C,s,S+1);let L=new xy,I=A,k=x-C;v.right=L,L.boundingData=new Float32Array(6),BS(a,I,k,L.boundingData,s),i(L,I,k,s,S+1)}return v}Rde(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=jde(e,n),o=e.index.array,l=t.maxDepth,u=t.verbose,h=t.maxLeafTris,c=t.strategy,d=t.onProgress,f=e.index.count/3,p=!1,m=[],g=kde(e);if(g.length===1){let v=g[0],y=new xy;y.boundingData=n,zde(a,v.offset,v.count,s),i(y,v.offset,v.count,s),m.push(y)}else for(let v of g){let y=new xy;y.boundingData=new Float32Array(6),BS(a,v.offset,v.count,y.boundingData,s),i(y,v.offset,v.count,s),m.push(y)}return m}function Vde(e,t){let r=Hde(e,t),i,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<r.length;h++){let c=r[h],d=l(c),f=new o(32*d);i=new Float32Array(f),n=new Uint32Array(f),s=new Uint16Array(f),u(0,c),a.push(f)}return a;function l(h){return h.count?1:1+l(h.left)+l(h.right)}function u(h,c){let d=h/4,f=h/2,p=!!c.count,m=c.boundingData;for(let g=0;g<6;g++)i[d+g]=m[g];if(p){let g=c.offset,v=c.count;return n[d+6]=g,s[f+14]=v,s[f+15]=65535,h+32}else{let g=c.left,v=c.right,y=c.splitAxis,x;if(x=u(h+32,g),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=x/4,x=u(x,v),n[d+7]=y,x}}}var zl=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,r){let i=1/0,n=-1/0;for(let s=0,a=t.length;s<a;s++){let o=t[s][r];i=o<i?o:i,n=o>n?o:n}this.min=i,this.max=n}setFromPoints(t,r){let i=1/0,n=-1/0;for(let s=0,a=r.length;s<a;s++){let o=r[s],l=t.dot(o);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}};zl.prototype.setFromBox=function(){let e=new P;return function(t,r){let i=r.min,n=r.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){e.x=i.x*o+n.x*(1-o),e.y=i.y*l+n.y*(1-l),e.z=i.z*u+n.z*(1-u);let h=t.dot(e);s=Math.min(h,s),a=Math.max(h,a)}this.min=s,this.max=a}}();var Wde=function(){let e=new P,t=new P,r=new P;return function(i,n,s){let a=i.start,o=e,l=n.start,u=t;r.subVectors(a,l),e.subVectors(i.end,i.start),t.subVectors(n.end,n.start);let h=r.dot(u),c=u.dot(o),d=u.dot(u),f=r.dot(o),p=o.dot(o)*d-c*c,m,g;p!==0?m=(h*c-f*d)/p:m=0,g=(h+m*c)/d,s.x=m,s.y=g}}(),KD=function(){let e=new J,t=new P,r=new P;return function(i,n,s,a){Wde(i,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){i.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),i.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?i.at(0,s):i.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let u;o<0?u=i.start:u=i.end;let h;l<0?h=n.start:h=n.end;let c=t,d=r;if(i.closestPointToPoint(h,!0,t),n.closestPointToPoint(u,!0,r),c.distanceToSquared(h)<=d.distanceToSquared(u)){s.copy(c),a.copy(h);return}else{s.copy(u),a.copy(d);return}}}}(),Gde=function(){let e=new P,t=new P,r=new us,i=new Gs;return function(n,s){let{radius:a,center:o}=n,{a:l,b:u,c:h}=s;if(i.start=l,i.end=u,i.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(i.start=l,i.end=h,i.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(i.start=u,i.end=h,i.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let c=s.getPlane(r);if(Math.abs(c.distanceToPoint(o))<=a){let d=c.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),Yde=1e-15;function cd(e){return Math.abs(e)<Yde}var Nl=class extends nn{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new P),this.satBounds=new Array(4).fill().map(()=>new zl),this.points=[this.a,this.b,this.c],this.sphere=new ys,this.plane=new us,this.needsUpdate=!0}intersectsSphere(e){return Gde(e,this)}update(){let e=this.a,t=this.b,r=this.c,i=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,i);let l=n[1],u=s[1];l.subVectors(e,t),u.setFromPoints(l,i);let h=n[2],c=s[2];h.subVectors(t,r),c.setFromPoints(h,i);let d=n[3],f=s[3];d.subVectors(r,e),f.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Nl.prototype.closestPointToSegment=function(){let e=new P,t=new P,r=new Gs;return function(i,n=null,s=null){let{start:a,end:o}=i,l=this.points,u,h=1/0;for(let c=0;c<3;c++){let d=(c+1)%3;r.start.copy(l[c]),r.end.copy(l[d]),KD(r,i,e,t),u=e.distanceToSquared(t),u<h&&(h=u,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),u=a.distanceToSquared(e),u<h&&(h=u,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),u=o.distanceToSquared(e),u<h&&(h=u,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(h)}}();Nl.prototype.intersectsTriangle=function(){let e=new Nl,t=new Array(3),r=new Array(3),i=new zl,n=new zl,s=new P,a=new P,o=new P,l=new P,u=new Gs,h=new Gs,c=new Gs;return function(d,f=null,p=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;r[0]=d.a,r[1]=d.b,r[2]=d.c;for(let S=0;S<4;S++){let _=v[S],A=y[S];if(i.setFromPoints(A,r),_.isSeparated(i))return!1}let x=d.satBounds,w=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let S=0;S<4;S++){let _=x[S],A=w[S];if(i.setFromPoints(A,t),_.isSeparated(i))return!1}for(let S=0;S<4;S++){let _=y[S];for(let A=0;A<4;A++){let M=w[A];if(s.crossVectors(_,M),i.setFromPoints(s,t),n.setFromPoints(s,r),i.isSeparated(n))return!1}}return f&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{let v=this.points,y=!1,x=0;for(let k=0;k<3;k++){let z=v[k],V=v[(k+1)%3];u.start.copy(z),u.end.copy(V),u.delta(a);let K=y?h.start:h.end,q=cd(g.distanceToPoint(z));if(cd(g.normal.dot(a))&&q){h.copy(u),x=2;break}if((g.intersectLine(u,K)||q)&&!cd(K.distanceTo(V))){if(x++,y)break;y=!0}}if(x===1&&d.containsPoint(h.end))return f&&(f.start.copy(h.end),f.end.copy(h.end)),!0;if(x!==2)return!1;let w=d.points,S=!1,_=0;for(let k=0;k<3;k++){let z=w[k],V=w[(k+1)%3];u.start.copy(z),u.end.copy(V),u.delta(o);let K=S?c.start:c.end,q=cd(m.distanceToPoint(z));if(cd(m.normal.dot(o))&&q){c.copy(u),_=2;break}if((m.intersectLine(u,K)||q)&&!cd(K.distanceTo(V))){if(_++,S)break;S=!0}}if(_===1&&this.containsPoint(c.end))return f&&(f.start.copy(c.end),f.end.copy(c.end)),!0;if(_!==2)return!1;if(h.delta(a),c.delta(o),a.dot(o)<0){let k=c.start;c.start=c.end,c.end=k}let A=h.start.dot(a),M=h.end.dot(a),T=c.start.dot(a),C=c.end.dot(a),L=M<T,I=A<C;return A!==C&&T!==M&&L===I?!1:(f&&(l.subVectors(h.start,c.start),l.dot(a)>0?f.start.copy(h.start):f.start.copy(c.start),l.subVectors(h.end,c.end),l.dot(a)<0?f.end.copy(h.end):f.end.copy(c.end)),!0)}}}();Nl.prototype.distanceToPoint=function(){let e=new P;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Nl.prototype.distanceToTriangle=function(){let e=new P,t=new P,r=["a","b","c"],i=new Gs,n=new Gs;return function(s,a=null,o=null){let l=a||o?i:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let u=1/0;for(let h=0;h<3;h++){let c,d=r[h],f=s[d];this.closestPointToPoint(f,e),c=f.distanceToSquared(e),c<u&&(u=c,a&&a.copy(e),o&&o.copy(f));let p=this[d];s.closestPointToPoint(p,e),c=p.distanceToSquared(e),c<u&&(u=c,a&&a.copy(p),o&&o.copy(e))}for(let h=0;h<3;h++){let c=r[h],d=r[(h+1)%3];i.set(this[c],this[d]);for(let f=0;f<3;f++){let p=r[f],m=r[(f+1)%3];n.set(s[p],s[m]),KD(i,n,e,t);let g=e.distanceToSquared(t);g<u&&(u=g,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(u)}}();var bo=class{constructor(e,t,r){this.isOrientedBox=!0,this.min=new P,this.max=new P,this.matrix=new Oe,this.invMatrix=new Oe,this.points=new Array(8).fill().map(()=>new P),this.satAxes=new Array(3).fill().map(()=>new P),this.satBounds=new Array(3).fill().map(()=>new zl),this.alignedSatBounds=new Array(3).fill().map(()=>new zl),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};bo.prototype.update=function(){return function(){let e=this.matrix,t=this.min,r=this.max,i=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){let c=1*l|2*u|4*h,d=i[c];d.x=l?r.x:t.x,d.y=u?r.y:t.y,d.z=h?r.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=i[0];for(let l=0;l<3;l++){let u=s[l],h=n[l],c=1<<l,d=i[c];u.subVectors(a,d),h.setFromPoints(u,i)}let o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();bo.prototype.intersectsBox=function(){let e=new zl;return function(t){this.needsUpdate&&this.update();let r=t.min,i=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=r.x,e.max=i.x,a[0].isSeparated(e)||(e.min=r.y,e.max=i.y,a[1].isSeparated(e))||(e.min=r.z,e.max=i.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],u=n[o];if(e.setFromBox(l,t),u.isSeparated(e))return!1}return!0}}();bo.prototype.intersectsTriangle=function(){let e=new Nl,t=new Array(3),r=new zl,i=new zl,n=new P;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let c=0;c<3;c++){let d=a[c],f=o[c];if(r.setFromPoints(f,t),d.isSeparated(r))return!1}let l=s.satBounds,u=s.satAxes,h=this.points;for(let c=0;c<3;c++){let d=l[c],f=u[c];if(r.setFromPoints(f,h),d.isSeparated(r))return!1}for(let c=0;c<3;c++){let d=o[c];for(let f=0;f<4;f++){let p=u[f];if(n.crossVectors(d,p),r.setFromPoints(n,t),i.setFromPoints(n,h),r.isSeparated(i))return!1}}return!0}}();bo.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();bo.prototype.distanceToPoint=function(){let e=new P;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();bo.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Gs),r=new Array(12).fill().map(()=>new Gs),i=new P,n=new P;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,i),s.closestPointToPoint(i,n),o&&o.copy(i),l&&l.copy(n)),0;let u=a*a,h=s.min,c=s.max,d=this.points,f=1/0;for(let m=0;m<8;m++){let g=d[m];n.copy(g).clamp(h,c);let v=g.distanceToSquared(n);if(v<f&&(f=v,o&&o.copy(g),l&&l.copy(n),v<u))return Math.sqrt(v)}let p=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,x=(m+2)%3,w=g<<y|v<<x,S=1<<m|g<<y|v<<x,_=d[w],A=d[S];t[p].set(_,A);let M=e[m],T=e[y],C=e[x],L=r[p],I=L.start,k=L.end;I[M]=h[M],I[T]=g?h[T]:c[T],I[C]=v?h[C]:c[T],k[M]=c[M],k[T]=g?h[T]:c[T],k[C]=v?h[C]:c[T],p++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){n.x=m?c.x:h.x,n.y=g?c.y:h.y,n.z=v?c.z:h.z,this.closestPointToPoint(n,i);let y=n.distanceToSquared(i);if(y<f&&(f=y,o&&o.copy(i),l&&l.copy(n),y<u))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=t[m];for(let v=0;v<12;v++){let y=r[v];KD(g,y,i,n);let x=i.distanceToSquared(n);if(x<f&&(f=x,o&&o.copy(i),l&&l.copy(n),x<u))return Math.sqrt(x)}}return Math.sqrt(f)}}();var hd=new P,dd=new P,fd=new P,_y=new J,Sy=new J,My=new J,tk=new P,rk=new P,ik=new P,Ey=new P;function qde(e,t,r,i,n,s){let a;return s===ki?a=e.intersectTriangle(i,r,t,!0,n):a=e.intersectTriangle(t,r,i,s!==ds,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function Xde(e,t,r,i,n,s,a,o,l){hd.fromBufferAttribute(t,s),dd.fromBufferAttribute(t,a),fd.fromBufferAttribute(t,o);let u=qde(e,hd,dd,fd,Ey,l);if(u){i&&(_y.fromBufferAttribute(i,s),Sy.fromBufferAttribute(i,a),My.fromBufferAttribute(i,o),u.uv=nn.getInterpolation(Ey,hd,dd,fd,_y,Sy,My,new J)),n&&(_y.fromBufferAttribute(n,s),Sy.fromBufferAttribute(n,a),My.fromBufferAttribute(n,o),u.uv1=nn.getInterpolation(Ey,hd,dd,fd,_y,Sy,My,new J)),r&&(tk.fromBufferAttribute(r,s),rk.fromBufferAttribute(r,a),ik.fromBufferAttribute(r,o),u.normal=nn.getInterpolation(Ey,hd,dd,fd,tk,rk,ik,new P),u.normal.dot(e.direction)>0&&u.normal.multiplyScalar(-1));let h={a:s,b:a,c:o,normal:new P,materialIndex:0};nn.getNormal(hd,dd,fd,h.normal),u.face=h,u.faceIndex=s}return u}function f5(e,t,r,i,n){let s=i*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:u,normal:h,uv:c,uv1:d}=e.attributes,f=Xde(r,u,h,c,d,a,o,l,t);return f?(f.faceIndex=i,n&&n.push(f),f):null}function $de(e,t,r,i,n,s){for(let a=i,o=i+n;a<o;a++)f5(e,t,r,a,s)}function Qde(e,t,r,i,n){let s=1/0,a=null;for(let o=i,l=i+n;o<l;o++){let u=f5(e,t,r,o);u&&u.distance<s&&(a=u,s=u.distance)}return a}function Ja(e,t,r,i){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,u=t+2;r&&(o=r.getX(t),l=r.getX(t+1),u=r.getX(t+2)),n.x=i.getX(o),n.y=i.getY(o),n.z=i.getZ(o),s.x=i.getX(l),s.y=i.getY(l),s.z=i.getZ(l),a.x=i.getX(u),a.y=i.getY(u),a.z=i.getZ(u)}function nk(e,t,r,i,n,s,a){let o=r.index,l=r.attributes.position;for(let u=e,h=t+e;u<h;u++)if(Ja(a,u*3,o,l),a.needsUpdate=!0,i(a,u,n,s))return!0;return!1}var p5=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Mu(e,t){return t[e+15]===65535}function xf(e,t){return t[e+6]}function nv(e,t){return t[e+14]}function sv(e){return e+8}function av(e,t){return t[e+6]}function Kde(e,t){return t[e+7]}var rf=new ai,qx=new P,Zde=["x","y","z"];function $A(e,t,r,i,n){let s=e*2,a=Tp,o=$u,l=Qu;if(Mu(s,o)){let u=xf(e,l),h=nv(s,o);$de(t,r,i,u,h,n)}else{let u=sv(e);Xx(u,a,i,qx)&&$A(u,t,r,i,n);let h=av(e,l);Xx(h,a,i,qx)&&$A(h,t,r,i,n)}}function QA(e,t,r,i){let n=e*2,s=Tp,a=$u,o=Qu;if(Mu(n,a)){let l=xf(e,o),u=nv(n,a);return Qde(t,r,i,l,u)}else{let l=Kde(e,o),u=Zde[l],h=i.direction[u]>=0,c,d;h?(c=sv(e),d=av(e,o)):(c=av(e,o),d=sv(e));let f=Xx(c,s,i,qx)?QA(c,t,r,i):null;if(f){let m=f.point[u];if(h?m<=s[d+l]:m>=s[d+l+3])return f}let p=Xx(d,s,i,qx)?QA(d,t,r,i):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}var Jde=function(){let e,t,r=[],i=new p5(()=>new ai);return function(...s){e=i.getPrimitive(),t=i.getPrimitive(),r.push(e,t);let a=n(...s);i.releasePrimitive(e),i.releasePrimitive(t),r.pop(),r.pop();let o=r.length;return o>0&&(t=r[o-1],e=r[o-2]),a};function n(s,a,o,l,u=null,h=0,c=0){function d(y){let x=y*2,w=$u,S=Qu;for(;!Mu(x,w);)y=sv(y),x=y*2;return xf(y,S)}function f(y){let x=y*2,w=$u,S=Qu;for(;!Mu(x,w);)y=av(y,S),x=y*2;return xf(y,S)+nv(x,w)}let p=s*2,m=Tp,g=$u,v=Qu;if(Mu(p,g)){let y=xf(s,v),x=nv(p,g);return no(s,m,e),l(y,x,!1,c,h+s,e)}else{let y=sv(s),x=av(s,v),w=y,S=x,_,A,M,T;if(u&&(M=e,T=t,no(w,m,M),no(S,m,T),_=u(M),A=u(T),A<_)){w=x,S=y;let K=_;_=A,A=K,M=T}M||(M=e,no(w,m,M));let C=Mu(w*2,g),L=o(M,C,_,c+1,h+w),I;if(L===2){let K=d(w),q=f(w)-K;I=l(K,q,!0,c+1,h+w,M)}else I=L&&n(w,a,o,l,u,h,c+1);if(I)return!0;T=t,no(S,m,T);let k=Mu(S*2,g),z=o(T,k,A,c+1,h+S),V;if(z===2){let K=d(S),q=f(S)-K;V=l(K,q,!0,c+1,h+S,T)}else V=z&&n(S,a,o,l,u,h,c+1);return!!V}}}(),efe=function(){let e=new Nl,t=new Nl,r=new Oe,i=new bo,n=new bo;return function s(a,o,l,u,h=null){let c=a*2,d=Tp,f=$u,p=Qu;if(h===null&&(l.boundingBox||l.computeBoundingBox(),i.set(l.boundingBox.min,l.boundingBox.max,u),h=i),Mu(c,f)){let m=o,g=m.index,v=m.attributes.position,y=l.index,x=l.attributes.position,w=xf(a,p),S=nv(c,f);if(r.copy(u).invert(),l.boundsTree)return no(a,d,n),n.matrix.copy(r),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:_=>n.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(u),_.b.applyMatrix4(u),_.c.applyMatrix4(u),_.needsUpdate=!0;for(let A=w*3,M=(S+w)*3;A<M;A+=3)if(Ja(t,A,g,v),t.needsUpdate=!0,_.intersectsTriangle(t))return!0;return!1}});for(let _=w*3,A=S+w*3;_<A;_+=3){Ja(e,_,g,v),e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let M=0,T=y.count;M<T;M+=3)if(Ja(t,M,y,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let m=a+8,g=p[a+6];return no(m,d,rf),!!(h.intersectsBox(rf)&&s(m,o,l,u,h)||(no(g,d,rf),h.intersectsBox(rf)&&s(g,o,l,u,h)))}}}();function Xx(e,t,r,i){return no(e,t,rf),r.intersectBox(rf,i)}var KA=[],A1,Tp,$u,Qu;function Vm(e){A1&&KA.push(A1),A1=e,Tp=new Float32Array(e),$u=new Uint16Array(e),Qu=new Uint32Array(e)}function Ay(){A1=null,Tp=null,$u=null,Qu=null,KA.length&&Vm(KA.pop())}var FS=Symbol("skip tree generation"),US=new ai,jS=new ai,pd=new Oe,Mc=new bo,fm=new bo,pm=new P,Ty=new P,tfe=new P,rfe=new P,ife=new P,sk=new ai,Ua=new p5(()=>new Nl),dg=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),dg.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let r=e.geometry,i=e._roots,n=r.getIndex(),s;return t.cloneBuffers?s={roots:i.map(a=>a.slice()),index:n.array.slice()}:s={roots:i,index:n.array},s}static deserialize(e,t,r={}){if(typeof r=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),dg.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});r={setIndex:!0,...r};let{index:i,roots:n}=e,s=new dg(t,{...r,[FS]:!0});if(s._roots=n,r.setIndex){let a=t.getIndex();if(a===null){let o=new Mt(e.index,1,!1);t.setIndex(o)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[FS]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[FS]||(this._roots=Vde(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new ai))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,r=t.index.array,i=t.attributes.position,n,s,a,o,l=0,u=this._roots;for(let c=0,d=u.length;c<d;c++)n=u[c],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),h(0,l),l+=n.byteLength;function h(c,d,f=!1){let p=c*2;if(a[p+15]===65535){let m=s[c+6],g=a[p+14],v=1/0,y=1/0,x=1/0,w=-1/0,S=-1/0,_=-1/0;for(let A=3*m,M=3*(m+g);A<M;A++){let T=r[A],C=i.getX(T),L=i.getY(T),I=i.getZ(T);C<v&&(v=C),C>w&&(w=C),L<y&&(y=L),L>S&&(S=L),I<x&&(x=I),I>_&&(_=I)}return o[c+0]!==v||o[c+1]!==y||o[c+2]!==x||o[c+3]!==w||o[c+4]!==S||o[c+5]!==_?(o[c+0]=v,o[c+1]=y,o[c+2]=x,o[c+3]=w,o[c+4]=S,o[c+5]=_,!0):!1}else{let m=c+8,g=s[c+6],v=m+d,y=g+d,x=f,w=!1,S=!1;e?x||(w=e.has(v),S=e.has(y),x=!w&&!S):(w=!0,S=!0);let _=x||w,A=x||S,M=!1;_&&(M=h(m,d,x));let T=!1;A&&(T=h(g,d,x));let C=M||T;if(C)for(let L=0;L<3;L++){let I=m+L,k=g+L,z=o[I],V=o[I+3],K=o[k],q=o[k+3];o[c+L]=z<K?z:K,o[c+L+3]=V>q?V:q}return C}}}traverse(e,t=0){let r=this._roots[t],i=new Uint32Array(r),n=new Uint16Array(r);s(0);function s(a,o=0){let l=a*2,u=n[l+15]===65535;if(u){let h=i[a+6],c=n[l+14];e(o,u,new Float32Array(r,a*4,6),h,c)}else{let h=a+8,c=i[a+6],d=i[a+7];e(o,u,new Float32Array(r,a*4,6),d)||(s(h,o+1),s(c,o+1))}}}raycast(e,t=Ca){let r=this._roots,i=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=i.groups,l=s?t.side:t;for(let u=0,h=r.length;u<h;u++){let c=a?t[o[u].materialIndex].side:l,d=n.length;if(Vm(r[u]),$A(0,i,c,e,n),Ay(),a){let f=o[u].materialIndex;for(let p=d,m=n.length;p<m;p++)n[p].face.materialIndex=f}}return n}raycastFirst(e,t=Ca){let r=this._roots,i=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=i.groups,l=n?t.side:t;for(let u=0,h=r.length;u<h;u++){let c=s?t[o[u].materialIndex].side:l;Vm(r[u]);let d=QA(0,i,c,e);Ay(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[u].materialIndex))}return a}intersectsGeometry(e,t){let r=this.geometry,i=!1;for(let n of this._roots)if(Vm(n),i=efe(0,r,e,t),Ay(),i)break;return i}shapecast(e,t,r){let i=this.geometry;if(e instanceof Function){if(t){let c=t;t=(d,f,p,m)=>{let g=f*3;return c(d,g,g+1,g+2,p,m)}}e={boundsTraverseOrder:r,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=Ua.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let c=o;o=(d,f,p,m,g)=>c(d,f,p,m,g)?!0:nk(d,f,i,l,p,m,n)}else o||(l?o=(c,d,f,p)=>nk(c,d,i,l,f,p,n):o=(c,d,f)=>f);let u=!1,h=0;for(let c of this._roots){if(Vm(c),u=Jde(0,i,a,o,s,h),Ay(),u)break;h+=c.byteLength}return Ua.releasePrimitive(n),u}bvhcast(e,t,r){let{intersectsRanges:i,intersectsTriangles:n}=r,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;pd.copy(t).invert();let u=Ua.getPrimitive(),h=Ua.getPrimitive();if(n){let d=function(f,p,m,g,v,y,x,w){for(let S=m,_=m+g;S<_;S++){Ja(h,S*3,o,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let A=f,M=f+p;A<M;A++)if(Ja(u,A*3,s,a),u.needsUpdate=!0,n(u,h,A,S,v,y,x,w))return!0}return!1};if(i){let f=i;i=function(p,m,g,v,y,x,w,S){return f(p,m,g,v,y,x,w,S)?!0:d(p,m,g,v,y,x,w,S)}}else i=d}e.getBoundingBox(jS),jS.applyMatrix4(t);let c=this.shapecast({intersectsBounds:d=>jS.intersectsBox(d),intersectsRange:(d,f,p,m,g,v)=>(US.copy(v),US.applyMatrix4(pd),e.shapecast({intersectsBounds:y=>US.intersectsBox(y),intersectsRange:(y,x,w,S,_)=>i(d,f,y,x,m,g,S,_)}))});return Ua.releasePrimitive(u),Ua.releasePrimitive(h),c}intersectsBox(e,t){return Mc.set(e.min,e.max,t),Mc.needsUpdate=!0,this.shapecast({intersectsBounds:r=>Mc.intersectsBox(r),intersectsTriangle:r=>Mc.intersectsTriangle(r)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},i={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),Mc.set(e.boundingBox.min,e.boundingBox.max,t),Mc.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,u=e.attributes.position,h=e.index,c=Ua.getPrimitive(),d=Ua.getPrimitive(),f=Ty,p=tfe,m=null,g=null;i&&(m=rfe,g=ife);let v=1/0,y=null,x=null;return pd.copy(t).invert(),fm.matrix.copy(pd),this.shapecast({boundsTraverseOrder:w=>Mc.distanceToBox(w),intersectsBounds:(w,S,_)=>_<v&&_<s?(S&&(fm.min.copy(w.min),fm.max.copy(w.max),fm.needsUpdate=!0),!0):!1,intersectsRange:(w,S)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:_=>fm.distanceToBox(_),intersectsBounds:(_,A,M)=>M<v&&M<s,intersectsRange:(_,A)=>{for(let M=_*3,T=(_+A)*3;M<T;M+=3){Ja(d,M,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=w*3,L=(w+S)*3;C<L;C+=3){Ja(c,C,l,o),c.needsUpdate=!0;let I=c.distanceToTriangle(d,f,m);if(I<v&&(p.copy(f),g&&g.copy(m),v=I,y=C/3,x=M/3),I<n)return!0}}}});{let _=h?h.count:u.count;for(let A=0,M=_;A<M;A+=3){Ja(d,A,h,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let T=w*3,C=(w+S)*3;T<C;T+=3){Ja(c,T,l,o),c.needsUpdate=!0;let L=c.distanceToTriangle(d,f,m);if(L<v&&(p.copy(f),g&&g.copy(m),v=L,y=T/3,x=A/3),L<n)return!0}}}}}),Ua.releasePrimitive(c),Ua.releasePrimitive(d),v===1/0?null:(r.point?r.point.copy(p):r.point=p.clone(),r.distance=v,r.faceIndex=y,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(pd),p.applyMatrix4(pd),i.distance=p.sub(i.point).length(),i.faceIndex=x),r)}closestPointToPoint(e,t={},r=0,i=1/0){let n=r*r,s=i*i,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:u=>(pm.copy(e).clamp(u.min,u.max),pm.distanceToSquared(e)),intersectsBounds:(u,h,c)=>c<a&&c<s,intersectsTriangle:(u,h)=>{u.closestPointToPoint(e,pm);let c=e.distanceToSquared(pm);return c<a&&(Ty.copy(pm),a=c,o=h),c<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(Ty):t.point=Ty.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{no(0,new Float32Array(t),sk),e.union(sk)}),e}},mm=dp(w$()),nfe=.5*(Math.sqrt(3)-1),gm=(3-Math.sqrt(3))/6,sfe=1/3,ja=1/6,fg=e=>Math.floor(e)|0,ak=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),HS=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function VS(e=Math.random){let t=m5(e),r=new Float64Array(t).map(n=>ak[n%12*2]),i=new Float64Array(t).map(n=>ak[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,u=(n+s)*nfe,h=fg(n+u),c=fg(s+u),d=(h+c)*gm,f=h-d,p=c-d,m=n-f,g=s-p,v,y;m>g?(v=1,y=0):(v=0,y=1);let x=m-v+gm,w=g-y+gm,S=m-1+2*gm,_=g-1+2*gm,A=h&255,M=c&255,T=.5-m*m-g*g;if(T>=0){let I=A+t[M],k=r[I],z=i[I];T*=T,a=T*T*(k*m+z*g)}let C=.5-x*x-w*w;if(C>=0){let I=A+v+t[M+y],k=r[I],z=i[I];C*=C,o=C*C*(k*x+z*w)}let L=.5-S*S-_*_;if(L>=0){let I=A+1+t[M+1],k=r[I],z=i[I];L*=L,l=L*L*(k*S+z*_)}return 70*(a+o+l)}}function afe(e=Math.random){let t=m5(e),r=new Float64Array(t).map(s=>HS[s%12*3]),i=new Float64Array(t).map(s=>HS[s%12*3+1]),n=new Float64Array(t).map(s=>HS[s%12*3+2]);return function(s,a,o){let l,u,h,c,d=(s+a+o)*sfe,f=fg(s+d),p=fg(a+d),m=fg(o+d),g=(f+p+m)*ja,v=f-g,y=p-g,x=m-g,w=s-v,S=a-y,_=o-x,A,M,T,C,L,I;w>=S?S>=_?(A=1,M=0,T=0,C=1,L=1,I=0):w>=_?(A=1,M=0,T=0,C=1,L=0,I=1):(A=0,M=0,T=1,C=1,L=0,I=1):S<_?(A=0,M=0,T=1,C=0,L=1,I=1):w<_?(A=0,M=1,T=0,C=0,L=1,I=1):(A=0,M=1,T=0,C=1,L=1,I=0);let k=w-A+ja,z=S-M+ja,V=_-T+ja,K=w-C+2*ja,q=S-L+2*ja,O=_-I+2*ja,W=w-1+3*ja,N=S-1+3*ja,B=_-1+3*ja,j=f&255,Q=p&255,H=m&255,G=.6-w*w-S*S-_*_;if(G<0)l=0;else{let ae=j+t[Q+t[H]];G*=G,l=G*G*(r[ae]*w+i[ae]*S+n[ae]*_)}let $=.6-k*k-z*z-V*V;if($<0)u=0;else{let ae=j+A+t[Q+M+t[H+T]];$*=$,u=$*$*(r[ae]*k+i[ae]*z+n[ae]*V)}let se=.6-K*K-q*q-O*O;if(se<0)h=0;else{let ae=j+C+t[Q+L+t[H+I]];se*=se,h=se*se*(r[ae]*K+i[ae]*q+n[ae]*O)}let re=.6-W*W-N*N-B*B;if(re<0)c=0;else{let ae=j+1+t[Q+1+t[H+1]];re*=re,c=re*re*(r[ae]*W+i[ae]*N+n[ae]*B)}return 32*(l+u+h+c)}}function m5(e){let t=new Uint8Array(512);for(let r=0;r<512/2;r++)t[r]=r;for(let r=0;r<512/2-1;r++){let i=r+~~(e()*(256-r)),n=t[r];t[r]=t[i],t[i]=n}for(let r=256;r<512;r++)t[r]=t[r-256];return t}var la=new nn,ofe=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let n=1;la.a.fromBufferAttribute(e,i),la.b.fromBufferAttribute(e,i+1),la.c.fromBufferAttribute(e,i+2),n*=la.getArea(),t[i/3]=n}this.distribution=new Float32Array(e.count/3);let r=0;for(let i=0;i<t.length;i++)r+=t[i],this.distribution[i]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let r=this.distribution[this.distribution.length-1],i=this.binarySearch(this.randomFunction()*r);return this.sampleFace(i,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,r=0,i=t.length-1,n=-1;for(;r<=i;){let s=Math.ceil((r+i)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?i=s-1:r=s+1}return n}sampleFace(e,t,r){let i=this.randomFunction(),n=this.randomFunction();return i+n>1&&(i=1-i,n=1-n),la.a.fromBufferAttribute(this.positionAttribute,e*3),la.b.fromBufferAttribute(this.positionAttribute,e*3+1),la.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(la.a,i).addScaledVector(la.b,n).addScaledVector(la.c,1-(i+n)),la.getNormal(r),this}},lfe=dp(n4()),ufe=new Oe,cfe=new Oe,hfe=new Oe,ov;(e=>{function t(r){return r&&r.__isSPEObject}e.is=t})(ov||(ov={}));var ZD=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new Oe,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Oe,this.matrixWorldRigid=new Oe,this.shearScale=new Oe,this.shearScaleInv=new Oe}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof dr&&(t=t.uuid);let r=this;for(;r.parent;){if(r.parent.uuid===t)return!0;r=r.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let r of this.children)r.updateMatrixWorld(t)}updateWorldMatrix(t,r){let i=this.parent;if(t&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),r)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,r=0){for(let i of this.children)ov.is(i)&&i.traverseObject(t,r+1)}traverseObject(t,r=0){if(t(this,r)!==!0)for(let i of this.children)ov.is(i)&&i.traverseObject(t,r+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,r=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:i,v:n,q:s}=(0,lfe.SVD)(r),a=ufe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),o=cfe.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=hfe.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(u=>Math.abs(s[0]-u)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,r){this.updateWorldMatrix(!0,!1);let i=new Oe().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),i.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof Oe?t.hiddenMatrix.premultiply(i):t.applyMatrix4(i),t.updateWorldMatrix(!1,!1),this.add(t),r!==void 0&&(this.children.pop(),this.children.splice(r,0,t)),this}copy(t,r=!1){return super.copy(t,r),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,r,i,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},dfe=class extends ZD(dr){},ffe=e=>e.type==="Mesh",sn=class extends dfe{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let r=this.children[e];(r==null?void 0:r.object)!==t&&(r&&this.remove(r),r=new sn(t),this.add(r),this.children.splice(e,0,this.children.pop()),r.matrixWorldNeedsUpdate=!0,r.matrixAutoUpdate=!1,r.matrix=t.matrix,r.hiddenMatrix=t.hiddenMatrix),r.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return ffe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Uc=new P,jc=new P,wf=new Oe,g5=[new P(-1,1,1),new P(-1,-1,1),new P(1,-1,1),new P(1,1,1),new P(-1,1,-1),new P(-1,-1,-1),new P(1,-1,-1),new P(1,1,-1)],pfe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],mfe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],ok=(e,t,r)=>{e.updateEntityBoxSize(Uc,jc),wf.copy(t).multiply(e.matrixWorld),jc.x===0&&jc.y===0&&jc.z===0?r.push(new P(Uc.x,Uc.y,Uc.z).applyMatrix4(wf)):g5.forEach(i=>{r.push(i.clone().multiply(jc).add(Uc).applyMatrix4(wf))})},lk=class extends ai{constructor(){super(...arguments),this.matrix=new Oe,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let r=new Oe().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,r,t)}expandByObjectSize(e,t,r=!1){let i=[];return r===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){i.push(new P);return}ok(n,t,i)}}):ok(e,t,i),this.setFromPoints(i)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(wf.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(jc).multiplyScalar(.5),this.getCenter(Uc),wf.copy(this.matrix).setPosition(Uc),this.vertices=g5.map(e=>e.clone().multiply(jc).applyMatrix4(wf))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=pfe.map(([e,t])=>new Gs(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new P))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=mfe.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Iu={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},gfe=class extends L4{constructor(){super()}getPoints(e=12){let t=[],r,i=this.getCurveLengths(),n=i[i.length-1]/i.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?i[s]:i[s]-i[s-1],u=Math.ceil(e*l/n),h=o.getPoints(u);for(let c=0;c<h.length;c++){let d=h[c];r&&r.equals(d)||(t.push(d),r=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},ZA=.001;function JA(e,t,r){return t.clone().sub(e).cross(t.clone().sub(r)).length()<=ZA}function WS(e,t){let r=new P(...e.position),i=new P(...e.controlNext.position),n=new P(...t.controlPrevious.position),s=new P(...t.position);return JA(r,i,s)&&JA(r,n,s)}function v5(e){let t=e.points.map(h=>new P(...h.data.position)),r=[e.points[0]],i=new P(...r[0].data.position);for(let h=0;h<e.points.length-1;h++)JA(i,t[h],t[h+1])||(r.push(e.points[h]),i=t[h]);r.push(e.points[e.points.length-1]);let n=e.isClosed,s=r.length-(n?0:1),a=r.length,o=[];for(let h=0;h<a;h++){let c=r[h].data,d=new P(...c.position),f=new P(...c.controlPrevious.position),p=new P(...c.controlNext.position),m={position:d,baseRoundness:c.roundness,controlPrevious:f,controlNext:p};if(c.roundness===0||!e.isClosed&&(h===0||h===a-1)){o[h]={...m,removedLength:0};continue}let g=n&&h==0?a-1:h-1,v=n&&h==a-1?0:h+1,y=r[g].data,x=r[v].data,w=new P(...y.position),S=new P(...x.position),_=w.clone().sub(d).normalize(),A=S.clone().sub(d).normalize();Object.assign(m,{prevDir:_,nextDir:A});let M=WS(y,c),T=WS(c,x);if(!M||!T)o[h]={...m,removedLength:0};else{let C=_.clone().add(A).normalize(),L=C.clone().cross(_).length()/_.dot(C);o[h]={...m,tan:L,removedLength:c.roundness/L}}}for(let h=0;h<s;h++){let c=h,d=n&&h===a-1?0:h+1,f=o[c],p=o[d];if(f.removedLength!==0||p.removedLength!==0){let m=f.position.distanceTo(p.position);f.removedLength=Math.min(f.removedLength,m/2),p.removedLength=Math.min(p.removedLength,m/2)}}let l=[];for(let h=0;h<s;h++){let c=h,d=n&&h===a-1?0:h+1,f=o[c],p=o[d],m=null;if(!WS(r[c].data,r[d].data))f.position.distanceTo(p.position)>ZA&&(m=new b1(f.position,f.controlNext,p.controlPrevious,p.position));else{let g=f.position.clone(),v=p.position.clone();(f.removedLength!==0||p.removedLength!==0)&&(f.nextDir&&g.add(f.nextDir.clone().setLength(f.removedLength)),p.prevDir&&v.add(p.prevDir.clone().setLength(p.removedLength))),g.distanceTo(v)>ZA&&(m=new b1(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}l[2*h+1]=m}for(let h=0;h<a;h++){let c=o[h];if(c.removedLength===0){l[2*h]=null;continue}let d=c.position,f=c.prevDir.clone().multiplyScalar(c.removedLength).add(d),p=c.nextDir.clone().multiplyScalar(c.removedLength).add(d),m=c.tan*c.removedLength,g=c.prevDir.clone().add(c.nextDir).normalize(),v=f.clone().lerp(p,.5),y=f.distanceTo(p)/2,x=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),w=g.clone().multiplyScalar(-m).add(x),S=d.distanceTo(w)/d.distanceTo(v),_=c.prevDir.clone().multiplyScalar(S*d.distanceTo(f)).add(d),A=_.clone().lerp(w,2),M=f.clone().lerp(_,4/3),T=p.clone().lerp(A,4/3);l[2*h]=new b1(f,M,T,p)}let u=new gfe;return l.forEach(h=>{h&&u.add(h)}),u}var $t;(e=>{function t(r){return r&&r.__isEntity}e.is=t})($t||($t={}));var fl=e=>$t.is(e),vfe={type:"completeState",isfromEntity:!0},JD=e=>class extends ZD(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new lk,this._recursiveBBox=new lk,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let r=this.children[t];if($t.is(r))return r}entityChildrenCount(){let t=this.children.length;for(;t--;)if($t.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let r=t.parent;if($t.is(r))t=r;else return}return t}forInstancesRec(t){this.instances.forEach(r=>{r.disposed||t(r),r.forInstancesRec(t)})}super_Entity(t,r){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=r,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,r,i=!1){if(!(this.data.states.length===0&&!i)){for(let n of this.data.states)Xc.toOps(this.data,n.data).forEach(s=>{let a=vA.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,r)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=Xc.patch(this.data,n),Xc.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,r)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,r){t.setScalar(0),r.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{fl(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let r;return this.traverseEntity(i=>{i.uuid===t&&(r=i)}),r}traverseSortNextHelper(){let t=this.parent;if(t){let r=t.children,i=r.indexOf(this)+1;if($t.is(r[i]))return r[i];if($t.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&$t.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let r=this;for(;t>0&&r!==null;)r=r.parent,t-=1;return r}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let r=this.parent;for(;r;){if(t===r)return!0;r=r.parent}return!1}countToAccestor(t){let r=0,i=this;for(;i!==t;){if(i===null)return-1;i=i.parent,r+=1}return r}forEachEntity(t){for(let r of this.children)fl(r)&&t(r)}traverseEntityAncestors(t){this.traverseAncestors(r=>{$t.is(r)&&t(r)})}traverseConcreteEntity(t,r=0){if(t(this,r)!==!0)for(let i of this.children)fl(i)&&i.isConcreteEntity&&i.traverseEntity(t,r+1)}traverseEntity(t,r=0){if(t(this,r)!==!0)for(let i of this.children)fl(i)&&i.traverseEntity(t,r+1)}traverseVisibleEntity(t){t(this);for(let r of this.children)fl(r)&&r.visible&&r.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}copy(t,r=!1){return super.copy(t,r),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>fl(t))}isAncestorOf(t){if(this.uuid===t)return!1;let r=!1;return this.traverseEntity(i=>{i.uuid===t&&(r=!0)}),r}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let r={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return gA(r,t)}updateTransformState(t){let r=!1;return t.position&&(this.position.fromArray(t.position),r=!0),t.rotation&&(this.rotation.fromArray(t.rotation),r=!0),t.scale&&(r=!0,this.scale.fromArray(t.scale)),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??Gf.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)$t.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{$t.is(t)&&t.disposeRecursively()})}toState(t=[]){let r={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return gA(r,t)}updateByObjUpdateOp(t,r){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},r,!1)}updateByOp(t,r,i,n){let s=this.data;this.data=r;let a=t,o=js(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let u={...t.props};if(delete u.name,Object.values(t.props).some(h=>h===void 0)){let h=this.data;if(h!==void 0){let c=fo.zoom(h,t.path.slice(2));if(c)for(let d in t.props)t.props[d]===void 0&&d in c&&(u[d]=c[d])}}a={...t,props:u,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:h,...c}=l;l=c}if(t.props.material!==void 0&&"material"in l){let{material:h,...c}=l;l=c}let u=fo.removeOverridden(t.path,t.props,l);a={...t,props:u}}}if(this.updateByPatchedOpBase(a,Xc.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i),js(t.path,["overrides"])){let l=[],u=[...t.path];for(l.push(u[1]),u.splice(0,2);u.length>0&&u[0]==="descendants";)l.push(u[1]),u.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let h of Object.keys(t.props)){l[l.length-1]=h;let c=i.scene.findInstance([this.uuid,...l]);c&&(c.overrideData=t.props[h],c.updateState(qu.apply(c.component.data,c.overrideData),i))}}else{let h=i.scene.findInstance([this.uuid,...l]);if(h){let c=fo.zoom(h.component.data,u);if(t={...t,path:u},t.type===0){let d=t.props;if(c)for(let[f,p]of Object.entries(t.props))p===void 0&&(d===t.props&&(d={...t.props}),d[f]=c[f]);t={...t,props:d}}h.overrideData=Vx.resolve(r.overrides,l),h.updateByOp(t,ms.applySimple(h.data,t),i,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let u;for(let h of Lu.rootOverrideProps)h in t.props&&(u===void 0&&(u={}),u[h]=t.props[h]);u&&(l={...t,props:u})}else for(let u of Lu.rootOverrideProps)if(js(t.path,[u])){l=t;break}l!==void 0&&this.instances.forEach(u=>{if(u.isInstanceRoot){let h=qu.filterOp(u.overrideData,l);h&&u.updateByOp(h,ms.applySimple(u.data,h),i,!0)}}),this.instances.forEach(u=>{if(!u.isInstanceRoot){let h=qu.filterOp(u.overrideData,t);if(h){let c;s===u.data&&t===h?c=r:c=ms.applySimple(u.data,h),u.updateByOp(h,c,i,!0)}}})}}updateByPatchedOpBase(t,r,i){if(this.dataPatched=r,t.path.length===0&&t.type===0)t.props.type!==void 0&&!Mh.is(t.props.type)&&Iu.changeEntityProptotype(this,r,i);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){Iu.changeEntityProptotype(this,r,i);for(let n of this.children)$t.is(n)&&n.updateVisible()}this.updateByPatchedOp(t,r,i)}updateByPatchedOp(t,r,i){if(t.path.length===0&&t.type===0&&this.updateState(t.props,i),js(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(r.pathSnapping),js(t.path,["cloner"])!==null){let n=ms.drop(t,1);n.path.length===0&&n.type===0&&n.props.disabled===!0?this.setFromClonerState(null,i):this.cloner?this.cloner.updateState(r.cloner,i.scene):(this.setFromClonerState(r.cloner,i),this.expandCloner(i.scene)),this.updateVisible()}}updatePathSnapping(t){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var p,m,g,v,y;let r=((p=this._updatedPathSnapping)==null?void 0:p.pathId)??this.dataPatched.pathSnapping.pathId,i=((m=this._updatedPathSnapping)==null?void 0:m.slide)??this.dataPatched.pathSnapping.slide??0,n=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset,s=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(r===null)return;let a=t.find(r);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=v5(o.geometry.path),u=(i+n)%1;i+n===1&&u===0&&(u=1);let h=l.getPointAt(u),c=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new Oe;a.updateMatrixWorld();let d=new Oe().multiplyMatrices(c.clone().invert(),a.matrixWorld);h.applyMatrix4(d);let f={position:h.toArray(),rotation:o.rotation};if(s==="tangential"){let x=new Oe().extractRotation(a.matrixWorld),w=l.getTangentAt(u).applyMatrix4(x).add(h),S=new Oe().lookAt(h,w,new P(0,1,0)),_=new Ri().setFromRotationMatrix(S);f={...f,rotation:[_.x,_.y,_.z]}}this.updateTransformState(f),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(vfe)})}updateVisible(){var t;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((t=this.dataPatched.cloner)==null?void 0:t.hideBase)!==!0)}updateState_Entity(t,r){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),r&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,r),this.updateVisible()),this.updateTransformState(t)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Iu.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,r){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new Iu.Cloner(this,t),r.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,r.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}},y5=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters),i=r.width/2,n=r.radiusTop??i,s=r.radiusBottom??i;return n===s?(n=i,s=i):n>s?(n=i,s=s*i/n):(n=n*i/s,s=i),{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:n,radiusBottom:s})}}static build(e){let{width:t,depth:r,height:i,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:u,radiusBottom:h,cornerRadius:c,cornerSegments:d,hollow:f}=e.parameters,p;return c||f?p=new x5(u,h,i,n,s,a,o,l*Math.PI/180,c,c,d,f):p=new mD(u,h,i,n,s,a,o,l*Math.PI/180),p.scale(1,1,r/t),Object.assign(p,{userData:{...e,type:"CylinderGeometry"}})}};function ou(e,t,r){r.x=e.x*t.x,r.y=e.y,r.z=e.x*t.y}function uk(e){return new J(e.y,-e.x)}var x5=class extends _t{constructor(e,t,r,i,n,s,a,o,l,u,h,c,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,r=r||1,i=Math.floor(i)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,u=0);let f=[],p=[],m=[],g=[],v=0,y=r/2,x=new P,w=new P;d&&e==0&&(e=l),d&&t==0&&(t=u);let S=new J(e,y),_=new J(t,-y),A=null,M=null,T=null,C=null,L=S.clone().sub(_),I=0,k=0,z=0;c>0&&(I=Math.min(e,t)*(1-c),k=e-I,z=t-I);let V=S.clone();V.x-=I;let K=Math.PI-L.angle(),q=L.angle(),O=Math.tan(q/2),W=Math.tan(K/2),N=O+W,B=c?N:W,j=c?N:O;if(l=Math.min(l,(e-k)/B,L.length()/N),u=Math.min(u,(t-z)/j,L.length()/N),l>0){let re=l/O;A=S.clone().sub(new J(re,l)),c&&(T=A.clone(),T.x-=I-N*l),S.sub(L.clone().setLength(re))}if(u>0){let re=u/W;M=_.clone().sub(new J(re,-u)),_.add(L.clone().setLength(re)),c&&(C=M.clone(),C.x-=I-N*u,V.sub(L.clone().setLength(re)))}L=S.clone().sub(_);let Q=L.length()<.5,H=[];for(let re=0;re<=i;re++){let ae=[],ce=re/i,me=ce*o+a,be=new J(Math.sin(me),Math.cos(me));C&&M?(G(ae,ce,be,K,u,C,-1,!0),G(ae,ce,be,q,u,M,-1,!1)):M?($(ae,be,M.x,0,-1),G(ae,ce,be,q,u,M,-1,!1)):s||$(ae,be,t,z,-1);let Ae=uk(L).normalize();if(ou(Ae,be,x),!Q)for(let $e=0;$e<=n;$e++){let Le=$e/n,Qe=L.clone().multiplyScalar(Le).add(_);ou(Qe,be,w),p.push(w.x,w.y,w.z),m.push(x.x,x.y,x.z),g.push(ce,.5+w.y/r),ae.push(v++)}if(T&&A?(G(ae,ce,be,K,l,A,1,!1),G(ae,ce,be,q,l,T,1,!0)):A?(G(ae,ce,be,K,l,A,1,!1),$(ae,be,A.x,0,1)):s||$(ae,be,e,k,1),c&&!Q){let $e=uk(L).multiplyScalar(-1).normalize();ou($e,be,x);for(let Le=0;Le<=n;Le++){let Qe=Le/n,Xe=L.clone().multiplyScalar(-Qe).add(V);ou(Xe,be,w),p.push(w.x,w.y,w.z),m.push(x.x,x.y,x.z),g.push(ce,.5+w.y/r),ae.push(v++)}}c&&!s&&ae.push(ae[0]),H.push(ae)}for(let re=0;re<H.length-1;re++)for(let ae=0;ae<H[0].length-1;ae++){if(s&&c&&ae==n)continue;let ce=H[re][ae],me=H[re+1][ae],be=H[re+1][ae+1],Ae=H[re][ae+1],$e=p[be*3+0],Le=p[be*3+2];f.push(ce,me,Ae),($e!=0||Le!=0)&&f.push(me,be,Ae)}o<Math.PI*2&&(se(-1,H[0],a),se(1,H[H.length-1],a+o)),this.setIndex(f),this.setAttribute("position",new nt(p,3)),this.setAttribute("normal",new nt(m,3)),this.setAttribute("uv",new nt(g,2));function G(re,ae,ce,me,be,Ae,$e,Le){for(let Qe=0;Qe<h+1;Qe++){let Xe=Qe/h,Re=$e<0?Xe:1-Xe;Le&&(Re-=1),Re*=me;let Ie=new J(Math.sin(Re),Math.cos(Re)*$e),Ge=Ie.clone().multiplyScalar(be).add(Ae);ou(Ge,ce,w),p.push(w.x,w.y,w.z),ou(Ie,ce,x),m.push(x.x,x.y,x.z),g.push(ae,.5+w.y/r),re.push(v++)}}function $(re,ae,ce,me,be){let Ae=new P,$e=new J,Le=[ce,me];be<0&&Le.reverse();for(let Qe of Le)$e.set(Qe,y*be),ou($e,ae,Ae),p.push(Ae.x,Ae.y,Ae.z),m.push(0,be,0),g.push(.5,.5),re.push(v++)}function se(re,ae,ce){let me=new J(Math.sin(ce),Math.cos(ce)),be=new J(-Math.cos(ce),Math.sin(ce)),Ae=new P,$e=re<0?(Xe,Re,Ie)=>f.push(Xe,Re,Ie):(Xe,Re,Ie)=>f.push(Xe,Ie,Re),Le=new J((e+t+k+z)/4,0);ou(Le,me,Ae),p.push(Ae.x,Ae.y,Ae.z),m.push(be.x,0,be.y),g.push(.5,.5);let Qe=v++;for(let Xe of ae){let Re=p.slice(Xe*3,Xe*3+3);p.push(...Re),m.push(be.x,0,be.y);let Ie=g.slice(Xe*2,Xe*2+2);g.push(...Ie),v++}for(let Xe=Qe+1;Xe<v-1;Xe++)$e(Qe,Xe,Xe+1);$e(Qe,v-1,Qe+1)}}},yfe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,depth:r,height:i,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:u,cornerRadiusBottom:h,cornerSegments:c}=e.parameters,d;return u>0||h>0||l<360?d=new x5(0,t/2,i,n,s,a,o,l*Math.PI/180,u,h,c,0,!0):d=new R4(t/2,i,n,s,a),d.scale(1,1,r/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},xfe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:i,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,u;return o==0?u=new xo(t,r,i,n,s,a):u=new wfe(t,r,i,n,s,a,o,l),Object.assign(u,{userData:{...e,type:"CubeGeometry"}})}},GS=Math.PI/2,wfe=class extends _t{constructor(e=1,t=1,r=1,i=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry";let l=this;i=Math.floor(i),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,r/2);let u=[],h=[],c=[],d=[],f=0,p=0;m("z","y","x",-1,-1,r,t,e,s,n,0),m("z","y","x",1,-1,r,t,-e,s,n,1),m("x","z","y",1,1,e,r,t,i,s,2),m("x","z","y",1,-1,e,r,-t,i,s,3),m("x","y","z",1,-1,e,t,r,i,n,4),m("x","y","z",-1,-1,e,t,-r,i,n,5),a>0&&(g("z","y","x",-1,-1,1,r,t,e,s,0),g("z","y","x",1,-1,-1,r,t,e,s,1),g("z","y","x",-1,1,-1,r,t,e,s,1),g("z","y","x",1,1,1,r,t,e,s,0),g("x","y","z",-1,-1,-1,e,t,r,i,0),g("x","y","z",1,-1,1,e,t,r,i,1),g("x","y","z",-1,1,1,e,t,r,i,0),g("x","y","z",1,1,-1,e,t,r,i,1),g("y","x","z",-1,-1,1,t,e,r,n,0),g("y","x","z",1,-1,-1,t,e,r,n,1),g("y","x","z",1,1,1,t,e,r,n,1),g("y","x","z",-1,1,-1,t,e,r,n,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(u),this.setAttribute("position",new nt(h,3)),this.setAttribute("normal",new nt(c,3)),this.setAttribute("uv",new nt(d,2));function m(y,x,w,S,_,A,M,T,C,L,I){let k=(A-2*a)/C,z=(M-2*a)/L,V=A/2-a,K=M/2-a,q=T/2,O=C+1,W=L+1,N=0,B=0,j=new P;for(let Q=0;Q<W;Q++){let H=Q*z-K;for(let G=0;G<O;G++){let $=G*k-V;j[y]=$*S,j[x]=H*_,j[w]=q,h.push(j.x,j.y,j.z),j[y]=0,j[x]=0,j[w]=T>0?1:-1,c.push(j.x,j.y,j.z),d.push(G/C),d.push(1-Q/L),N+=1}}for(let Q=0;Q<L;Q++)for(let H=0;H<C;H++){let G=f+H+O*Q,$=f+H+O*(Q+1),se=f+(H+1)+O*(Q+1),re=f+(H+1)+O*Q;u.push(G,$,re),u.push($,se,re),B+=6}l.addGroup(p,B,I),p+=B,f+=N}function g(y,x,w,S,_,A,M,T,C,L,I){let k=(M-2*a)/L,z=M/2-a,V=T/2-a,K=C/2,q=L+1,O=0,W=0,N=new P,B=new P;for(let j=0;j<o+1;j++){let Q=j/o*GS,H=Math.sin(Q)*a,G=(1-Math.cos(Q))*a,$=Math.sin(Q),se=Math.cos(Q);N[x]=(V+H)*_,N[w]=(K-G)*A,B[y]=0,B[x]=$*Math.sign(N[x]),B[w]=se*Math.sign(N[w]);for(let re=0;re<q;re++){let ae=re*k-z;N[y]=ae*S,h.push(N.x,N.y,N.z),c.push(B.x,B.y,B.z),d.push(re/L),d.push(0),O+=1}}for(let j=0;j<o;j++)for(let Q=0;Q<L;Q++){let H=f+Q+q*j,G=f+Q+q*(j+1),$=f+(Q+1)+q*(j+1),se=f+(Q+1)+q*j;u.push(H,G,se),u.push(G,$,se),W+=6}l.addGroup(p,W,I),p+=W,f+=O}function v(y,x,w){let S=new P,_=new P(e/2,t/2,r/2);_.subScalar(a);let A=[],M=y*x*w>0?(C,L,I)=>u.push(C,L,I):(C,L,I)=>u.push(C,I,L);for(let C=0;C<=o;C++){let L=[],I=GS*(1-C/o),k=Math.cos(I),z=Math.sin(I),V=0;for(let K=0;K<=C;K++){let q=Math.cos(V),O=Math.sin(V);S.x=k*q,S.y=z,S.z=k*O;let W=_.clone().addScaledVector(S,a);h.push(y*W.x,x*W.y,w*W.z),c.push(y*S.x,x*S.y,w*S.z),d.push(0,0),L.push(f++),V+=GS/C}A.push(L)}let T=A.length-1;for(let C=0;C<T;C++){let L=A[C],I=A[C+1],k=L.length-1;M(L[0],I[1],I[0]);for(let z=1;z<=k;z++)M(L[z-1],L[z],I[z]),M(L[z],I[z+1],I[z])}}}},e2=class extends _t{constructor(e=[],t=[],r="",i=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];u(),h(),this.setAttribute("position",new nt(a,3)),this.setAttribute("normal",new nt(l,3)),this.setAttribute("uv",new nt(o,2));return;function u(){var q;n=Math.min(1-1e-5,n),n==0&&(s=0);let c={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[r],d=new P,f=d.clone(),p=new nn,m=n*i,g=i-m,v=s+1,y=new P,x=(O,W)=>y.subVectors(O,W).normalize(),w=(O,W)=>Array(O).fill(void 0).map(W),S=w(e.length/3,(O,W)=>new P().fromArray(e,W*3).setLength(i)),_=[],A=1e6;for(let O=0;O<S.length;O++){let W=S[O],N=[],B,j,Q,H=1e10,G=-1;for(;(G=t.indexOf(O,G+1))!=-1;){let ae=G-G%3;B=t[ae+(G+1)%3],j=t[ae+(G+2)%3],Q=W.distanceToSquared(S[B]),H=Math.min(H,Q),N.push([B,j,Q])}H+=1e-6;let $=[],se=0,re=N.length;for(let ae=0;ae<re;ae++){[B,j,Q]=N[se];let ce=((q=_[B])==null?void 0:q.includes(O))==!0;Q<=H&&$.push(B+ +ce*A),se=N.findIndex(me=>me[0]==j)}_.push($)}let M=[];{let O=0,W=0,N,B,j=c==3;for(let Q=0;Q<=s;Q++){N=Q*(Q+1)/2,B=(Q+1)*(Q+2)/2;for(let H=0;H<s-Q;H++)[O,W]=[N+H+Q+2,B+H+Q+3],M.push(N,B,...j?[W,N]:[O,B],W,O),[N,B]=[O,W];M.push(N,B,N+s+2)}}let T=d.clone(),C=d.clone(),L=d.clone(),I=d.clone(),k=d.clone(),z=[],V=w(S.length,()=>w(c,()=>d.clone()));for(let O=0;O<S.length;O++){d.copy(S[O]).normalize(),T.copy(d).multiplyScalar(g);let W=_[O];for(let $=0;$<W.length;$++){let se=W[$],re=W[($+1)%c];p.setFromPointsAndIndices(S,O,se%A,re%A),p.b.sub(p.a).setLength(1e10).add(p.a),p.c.sub(p.a).setLength(1e10).add(p.a),p.closestPointToPoint(T,V[O][$])}let N=[],B=[],j=[],Q=new P;s==0&&[...V[O]].reduce(($,se)=>$.add(se),Q).multiplyScalar(1/c);for(let $=0;$<c;$++){let se=[],re=($-1+c)%c,ae=V[O][re],ce=V[O][$];d.copy(ae).sub(T),f.copy(ce).sub(T);let me=T.angleTo(d),be=d.angleTo(f),Ae=Math.cos(me)*m;s==0?C.copy(Q):C.copy(T).setLength(g+Ae),B.push(Ae);let $e=[C,ae,ce];for(let Le=0;Le<2;Le++){let Qe=$e[Le],Xe=$e[Le+1];I.subVectors(Qe,T),k.subVectors(Xe,T),L.crossVectors(I,k).normalize();for(let Re=0;Re<v;Re++){let Ie=[me,be][Le]*Re/v;d.copy(I).applyAxisAngle(L,Ie).add(T),N.push(d.clone()),Le&&(x(d,T),se.push([Re==0?Qe:d.clone(),y.clone()]))}Le&&(x(Xe,T),se.push([Xe,y.clone()]))}j.push(se)}z.push(j);let H=2*v,G=2;for(let $=0;$<c;$++){let se=H*$,re=H*(($+1)%c),ae=[N[se]];for(let me=1;me<v;me++){I=N[se+me],k=N[re+me],ae.push(I);for(let be=1,Ae=me-G+1;be<=Ae;be++)d.lerpVectors(I,k,be/(Ae+1)),d.sub(T).setLength(B[$]).add(T),ae.push(d.clone());ae.push(k)}for(let me=0;me<v;me++)ae.push(N[me+v+se]);ae.push(N[re+v]);let ce=M.map(me=>ae[me]);a.push(...ce.map(me=>[me.x,me.y,me.z]).flat()),l.push(...ce.map(me=>(x(me,T),[y.x,y.y,y.z])).flat())}}let K=[];for(let O=0;O<_.length;O++)for(let W=0;W<c;W++){let N=_[O][W];if(N<A){let B=_[N].findIndex(H=>H%A==O),j=z[O][W],Q=z[N][B];for(let H=0;H<v;H++){let G=j[H],$=Q[v-H],se=j[H+1],re=Q[v-(H+1)];[G,$,se,se,$,re].forEach(ae=>{a.push(ae[0].x,ae[0].y,ae[0].z),l.push(ae[1].x,ae[1].y,ae[1].z)})}K.push(j[0][0],Q[v][0],j[v][0],Q[0][0])}}for(;K.length;){let O,W,N,B;[O,W]=K.splice(0,2);let j=[O];for(;O!=W;)j.push(W),N=K.indexOf(W),B=N%2,W=K.splice(N-B,2)[1-B];y.subVectors(j[0],j[1]).cross(d.subVectors(j[0],j[2])).normalize();let Q=y.dot(j[0])<0;Q&&y.negate();for(let H=1;H<=j.length-2;H++)[j[H+ +Q],j[H+1-+Q],j[0]].forEach(G=>{a.push(G.x,G.y,G.z),l.push(y.x,y.y,y.z)})}}function h(){let c=new P;for(let _=0;_<a.length;_+=3){c.x=a[_+0],c.y=a[_+1],c.z=a[_+2];let A=w(c)/2/Math.PI+.5,M=S(c)/Math.PI+.5;o.push(A,1-M)}let d=new P,f=new P,p=new P,m=new P,g=new J,v=new J,y=new J,x=(_,A,M,T)=>{T<0&&_.x===1&&(o[A]=_.x-1),M.x===0&&M.z===0&&(o[A]=T/2/Math.PI+.5)};for(let _=0,A=0;_<a.length;_+=9,A+=6){d.set(a[_+0],a[_+1],a[_+2]),f.set(a[_+3],a[_+4],a[_+5]),p.set(a[_+6],a[_+7],a[_+8]),g.set(o[A+0],o[A+1]),v.set(o[A+2],o[A+3]),y.set(o[A+4],o[A+5]),m.copy(d).add(f).add(p).divideScalar(3);let M=w(m);x(g,A+0,d,M),x(v,A+2,f,M),x(y,A+4,p,M)}for(let _=0;_<o.length;_+=6){let A=o[_+0],M=o[_+2],T=o[_+4],C=Math.max(A,M,T),L=Math.min(A,M,T);C>.9&&L<.1&&(A<.2&&(o[_+0]+=1),M<.2&&(o[_+2]+=1),T<.2&&(o[_+4]+=1))}function w(_){return Math.atan2(_.z,-_.x)}function S(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}}static fromJSON(e){return new e2(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},bfe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:i,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new w5(t*.5,s,a):new k4(t*.5,n);return o.scale(1,r/t,i/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},w5=class extends e2{constructor(e=1,t=.2,r=4){let i=(1+Math.sqrt(5))/2,n=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,r),this.type=o}static fromJSON(e){return new w5(e.radius,e.corner,e.cornerSides)}},vm=1e-12,t2=class{constructor(e){this.position=new J,this.startPosition=new J,this.uuid=zt.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new t2(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},eT=class extends t2{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new eT(this.parent).copy(this)}},bf=class extends t2{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new eT(this),new eT(this))}static create(e,t){let r=new bf(e,new J(...t.position));return r.controls[0].position.set(...t.controlPrevious.position),r.controls[1].position.set(...t.controlNext.position),r.roundness=t.roundness,r.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,r}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let r=0,i=this.controls.length;r<i;r++){let n=this.controls[r];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new bf(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var r,i;let e=(r=this.curveBefore)==null?void 0:r.getTangentAt(1),t=(i=this.curveAfter)==null?void 0:i.getTangentAt(0);return[e,t]}computeNormals(e=new J,t=new J){let[r,i]=this.computeTangents();return r&&i&&(ck(r,e),ck(i,t)),[e,t]}computeTangent(e=new J){let[t,r]=this.computeTangents();return t&&r&&e.copy(t).add(r).normalize(),e}computeNormal(e=new J){let[t,r]=this.computeNormals();return e.copy(t).add(r).normalize(),e}};function ck(e,t=new J){let r=e.length();return t.set(-e.y/r,e.x/r)}var r2=e=>e,Cp=new J,hb=new J,_fe=new J,Sfe=new J,Mfe=new J,Efe=new J,b5=new P,_5=new P;function Afe(e){let t=new J;t.addVectors(e.v0,Cp.subVectors(e.v1,e.v0).multiplyScalar(2/3));let r=new J;return r.addVectors(e.v2,hb.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new ya(e.v0,t,r,e.v2)}function Wm(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}function Tfe(e,t,r=Number.EPSILON){return e.distanceTo(t)<r}function Cfe(e,t,r=Number.EPSILON){return e.distanceTo(t)<r}function S5(e,t,r){let i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)),s=Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2));return Math.acos((n*n+i*i-s*s)/(2*n*i))}function Dfe(e,t,r){return dk(e,t)&&dk(t,r)&&tT(e.position,t.position,r.position)}function tT(e,t,r){return Cp.copy(t).sub(e).cross(hb.copy(r).sub(e))===0}function Pfe(e,t,r,i,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(r,2)-Math.pow(s/2,2))*(e.y-t.y)/s,u=Math.sqrt(Math.pow(r,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return i.set(o+l,a+u),n.set(o-l,a-u),[i,n]}function Ofe(e,t,r){let i=e.distanceTo(r),n=t.distanceTo(r);return i<n?t:e}function Lfe(e,t,r,i,n,s){let a=t.x-e.x,o=t.y-e.y,l=r.x-e.x,u=r.y-e.y,h=Math.sqrt((a+l)*(a+l)+(o+u)*(o+u)),c;return S5(t,e,r)>Math.PI&&(h*=-1),Wm(u,o)?c=(o+u)*(i/h-.5)*8/3/(a-l):c=(a+l)*(i/h-.5)*8/3/(u-o),n.set(t.x-c*o,t.y+c*a),s.set(r.x+c*u,r.y-c*l),[n,s]}function hk(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function dk(e,t){return tT(e.position,e.controls[1].position,t.position)&&tT(e.position,t.controls[0].position,t.position)}function Ife(e,t,r,i,n=.5){let s=Cp.subVectors(t,e).multiplyScalar(n).add(e),a=hb.subVectors(r,t).multiplyScalar(n).add(t),o=_fe.subVectors(i,r).multiplyScalar(n).add(r),l=s,u=Sfe.subVectors(a,s).multiplyScalar(n).add(s),h=Mfe.subVectors(o,a).multiplyScalar(n).add(a),c=o,d=Efe.subVectors(h,u).multiplyScalar(n).add(u);return[e.x,e.y,l.x,l.y,u.x,u.y,d.x,d.y,h.x,h.y,c.x,c.y,i.x,i.y]}function Rfe(e,t,r=12,i=!0){let n=_5.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=r2(t[o]),u=Cp,h=oh(l,r);for(let c=0;c<=h;c++)if(l instanceof ya||l instanceof tc||l instanceof Aa){if(l.getPoint(c/h,u),n.set(u.x,u.y,0),s!==void 0&&Cfe(s,n))continue;s===void 0&&(s=b5),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return i&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function kfe(e,t,r,i=12,n=!0){let s=_5.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(r[l]===!1)continue;let u,h=r2(t[l]),c=Cp,d=oh(h,i);o.push(d);for(let f=0;f<=d;f++)if(h instanceof ya||h instanceof tc||h instanceof Aa){if(h.getPoint(f/d,c),s.set(c.x,c.y,0),u==null?void 0:u.equals(s))continue;u===void 0?u=b5:(e.setXYZ(a,u.x,u.y,u.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),u.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function fk(e,t=12,r=!1){let i=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(r&&a.roundedCurveCorner!==void 0){let l=oh(a.roundedCurveCorner,t)*.5;n>0&&(i[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=oh(a.curveAfter,t)),i.push(o)}return e.length>0&&r&&e[0].roundedCurveCorner!==void 0&&(i[e.length-1]+=oh(e[0].roundedCurveCorner,t)*.5),i}function oh(e,t=12){return e&&e instanceof $w?t*2:e&&(e instanceof Aa||e instanceof O4)?1:e&&e instanceof pD?t*e.points.length:t}function zfe(e,t,r=12,i=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=r2(t[a]),l=oh(o,r),u=Cp;for(let h=0;h<=l;h++)if(o instanceof ya||o instanceof tc||o instanceof Aa){if(o.getPoint(h/l,u),n!==void 0&&Tfe(n,u,vm))continue;n===void 0&&(n=hb),n.copy(u),e.push(u.x,u.y),s++}}return Wm(e[0],e[e.length-2],vm)&&Wm(e[1],e[e.length-1],vm)&&(e.pop(),e.pop()),i&&s>1&&!(Wm(e[s-1],e[1],vm)&&Wm(e[s-2],e[0],vm))&&(e.push(e[0],e[1]),s++),e}var YS=new J,Nfe=new J,Bfe=new J,Ffe=new J,Ufe=new J,jfe=new J,$r=class extends xx{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new us(new P(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=zt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,r){let i=new $r;return i.isClosed=e.isClosed,i.points=e.points.map(n=>bf.create(n.id,n.data)),typeof e.roundness=="number"&&(i.roundness=e.roundness),i.shapeHoles=e.shapeHoles.map(n=>$r.createFromState(n)),t!==void 0&&r!==void 0&&i.applySize(t,r),i.update(),i}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,r=this.points.length;t<r;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,r=this.points.findIndex(i=>i.uuid===e);if(r<0){let i=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)i+=o;else return l+i}}return r}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let r=0,i=this.shapeHoles.length;r<i;r++){let n=this.shapeHoles[r],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let r=0,i=this.shapeHoles.length;r<i;r++){let n=this.shapeHoles[r],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let r=YS.set(e,t);for(let i=0,n=this.points.length;i<n;i++){let s=this.points[i];s.position.multiply(r),s.controls[0].position.multiply(r),s.controls[1].position.multiply(r)}for(let i=0,n=this.shapeHoles.length;i<n;i++)this.shapeHoles[i].applyScale(e,t);this._update()}createPoint(e,t=0,r=zt.generateUUID()){let i;e instanceof J?i=e:i=new J(e,t);let n=new bf(r,i);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,r=this.points.length;t<r;t++){let i=this.points[t];if(i.uuid===e)return i}for(let t=0,r=this.shapeHoles.length;t<r;t++){let i=this.shapeHoles[t].getPointByUuid(e);if(i)return i}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(r=>r.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,r=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let i=r?this.roundedCurveDivisions:this.curveDivisions;return Rfe(e,r?this.roundedCurves:this.curves,t,this.autoClose),i.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=fk(this.points,e,!1),this.roundedCurveDivisions=fk(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,r=12){return kfe(e,this.curves,t,r,this.autoClose).reduce((i,n)=>i+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),zfe(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let r=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let i=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=oh(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=i.reduce((a,o)=>a+o,0));for(let a=0,o=i.length;a<o;a++){let l=i[a];if(s<r+l)return[a,(s-r+1)/l];r+=l}return[0,1]}getCurveT(e,t,r){let i=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(hk(i,n)){let l=i.position.distanceTo(n.position);return i.position.distanceTo(YS.set(r.x,r.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){hk(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let r=this.curves[this.curves.length-1];e.curveBefore=r,t.curveAfter=r;let i=r.clone();e.roundedCurveBefore=i,t.roundedCurveAfter=i,e.roundedCurveCorner=void 0,this.roundedCurves.push(i)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,r=this.points.length;t<r;t++){let i=this.points[t];if(t===0)this.moveTo(i.position.x,i.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(i,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],r=this.points[this.points.length-1];this._applyCurveForPoint(t,r)}if(this.points.length>2){let t=0;for(let r=0,i=this.points.length;r<i;r++){let n=this.points[r],s=this.points[r-1]??this.points[this.points.length-1],a=this.points[r+1]??this.points[0],o=n.roundness,l=s&&a&&Dfe(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let u=n.curveBefore,h=n.curveAfter;if(u===void 0||h===void 0)continue;let c=n.roundedCurveBefore,d=n.roundedCurveAfter,f=u.getLength(),p=h.getLength(),m=Math.min(o,f*.499),g=Math.min(o,p*.499),v=Math.min(m,g),y=1-v/f,x=v/p,w=u.getPointAt(y,YS),S=h.getPointAt(x,Nfe);this._subSplitCurve(u,c,y,w,void 0),this._subSplitCurve(h,d,x,void 0,S);let _;if(this.useCubicForRoundedCorners){let A=S5(w,n.position,S)/2,M=Math.tan(A)*w.distanceTo(n.position),[T,C]=Pfe(w,S,M,Bfe,Ffe),L=Ofe(T,C,n.position),[I,k]=Lfe(L,w,S,M,Ufe,jfe);_=new ya(w.clone(),I.clone(),k.clone(),S.clone())}else _=new tc(w.clone(),n.position.clone(),S.clone());n.roundedCurveCorner=_,this.roundedCurves.splice(r+t,0,_),t++}}}}_subSplitCurve(e,t,r,i,n){if(e instanceof Aa)i!==void 0&&t.v2.copy(i),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(r,0),l=Ife(s.v0,s.v1,s.v2,s.v3,o);return i!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new $r(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var r;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let i=0;i<t;i++){let n=i*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],u=e.points[n+4],h=e.points[n+5],c=e.points[n+6],d=new bf(zt.generateUUID(),new J(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(u,h),d.roundness=c,this.points.push(d)}return this.shapeHoles=(r=e.shapeHoles)!=null&&r.length?e.shapeHoles.map(i=>{let n=new $r;return n.fromJSON(i),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(i,n)=>{n instanceof ya&&n.v3.equals(i.position)&&i.controls[0].position.copy(n.v2)},r=i=>{let n=[],s,a;for(s=0,a=i.length;s<a;s++)i[s]instanceof tc&&(i[s]=Afe(i[s]));for(s=0,a=i.length;s<a;s++){let u=i[s],h=s>0?i[s-1]:null,c;u instanceof ya?(c=this.createPoint(u.v0),c.controls[1].position.copy(u.v1)):u instanceof Aa&&(c=this.createPoint(u.v1)),c!==void 0&&(h!==null&&t(c,h),n.push(c))}let o=i[i.length-1],l=!1;return o instanceof ya?o.v3.equals(n[0].position)&&(n[0].controls[0].position.copy(o.v2),l=!0):o instanceof Aa&&o.v2.equals(n[0].position)&&(l=!0),this.isClosed=l,n};return this.points=r(e.curves),e instanceof xx&&(this.shapeHoles=e.holes.map(i=>{let n=new $r;return n.fromShape(i),n})),this.update(),this}updatePoint(e,t){let r=this.getPointByUuid(e);r&&(t.position!==void 0&&r.position.fromArray(t.position),t.roundness!==void 0&&(r.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(r.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var i;let r=(i=this.getPointByUuid(e))==null?void 0:i.controls[0];r&&(t.position&&r.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var i;let r=(i=this.getPointByUuid(e))==null?void 0:i.controls[1];r&&(t.position&&r.position.fromArray(t.position),this.needsUpdate=!0)}},rT=Math.PI*2;function qS({x:e,y:t},r,i,n,s){return{x:e*r+n,y:t*i+s}}function Hfe(e,t){let r=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:i-n*r,y:n+i*r},{x:s+a*r,y:a-s*r},{x:s,y:a}]}function pk(e,t,r,i){let n=e*i-t*r<0?-1:1,s=Math.min(1,Math.max(-1,e*r+t*i));return n*Math.acos(s)}function Vfe(e,t,r,i,n,s,a,o,l,u){let h=Math.pow(n,2),c=Math.pow(s,2),d=Math.pow(a,2),f=Math.pow(o,2),p=h*c-h*f-c*d;p<0&&(p=0),p/=h*f+c*d,p=Math.sqrt(p)*(l===u?-1:1);let m=p*n/s*o,g=p*-s/n*a,v=m+(e+r)/2,y=g+(t+i)/2,x=(a-m)/n,w=(o-g)/s,S=(-a-m)/n,_=(-o-g)/s,A=pk(1,0,x,w),M=pk(x,w,S,_);return!u&&M>0&&(M-=rT),u&&M<0&&(M+=rT),{centerx:v,centery:y,ang1:A,ang2:M}}function Wfe({px:e,py:t,cx:r,cy:i,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let u=(e-r)/2,h=(t-i)/2;if(u===0&&h===0)return[];n=Math.abs(n),s=Math.abs(s);let c=Math.pow(u,2)/Math.pow(n,2)+Math.pow(h,2)/Math.pow(s,2);c>1&&(n*=Math.sqrt(c),s*=Math.sqrt(c));let d=Vfe(e,t,r,i,n,s,u,h,a,o),{ang1:f,ang2:p}=d,{centerx:m,centery:g}=d,v=Math.abs(p)/(rT/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);p/=y;for(let x=0;x<y;x++)l.push(Hfe(f,p)),f+=p;return l.map(x=>{let{x:w,y:S}=qS(x[0],n,s,m,g),{x:_,y:A}=qS(x[1],n,s,m,g),{x:M,y:T}=qS(x[2],n,s,m,g);return{x1:w,y1:S,x2:_,y2:A,x:M,y:T}})}var ur;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(ur||(ur={}));var fi;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(fi||(fi={}));function wt(e,t){if(!e)throw t||"Assertion Failed!"}var ht=function(){function e(){}return e.vertEq=function(t,r){return t.s===r.s&&t.t===r.t},e.vertLeq=function(t,r){return t.s<r.s||t.s===r.s&&t.t<=r.t},e.transLeq=function(t,r){return t.t<r.t||t.t===r.t&&t.s<=r.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,r){return Math.abs(t.s-r.s)+Math.abs(t.t-r.t)},e.edgeEval=function(t,r,i){wt(e.vertLeq(t,r)&&e.vertLeq(r,i));var n=r.s-t.s,s=i.s-r.s;return n+s>0?n<s?r.t-t.t+(t.t-i.t)*(n/(n+s)):r.t-i.t+(i.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,r,i){wt(e.vertLeq(t,r)&&e.vertLeq(r,i));var n=r.s-t.s,s=i.s-r.s;return n+s>0?(r.t-i.t)*n+(r.t-t.t)*s:0},e.transEval=function(t,r,i){wt(e.transLeq(t,r)&&e.transLeq(r,i));var n=r.t-t.t,s=i.t-r.t;return n+s>0?n<s?r.s-t.s+(t.s-i.s)*(n/(n+s)):r.s-i.s+(i.s-t.s)*(s/(n+s)):0},e.transSign=function(t,r,i){wt(e.transLeq(t,r)&&e.transLeq(r,i));var n=r.t-t.t,s=i.t-r.t;return n+s>0?(r.s-i.s)*n+(r.s-t.s)*s:0},e.vertCCW=function(t,r,i){return t.s*(r.t-i.t)+r.s*(i.t-t.t)+i.s*(t.t-r.t)>=0},e.interpolate=function(t,r,i,n){return t=t<0?0:t,i=i<0?0:i,t<=i?i===0?(r+n)/2:r+(n-r)*(t/(t+i)):n+(r-n)*(i/(t+i))},e.intersect=function(t,r,i,n,s){var a,o,l;e.vertLeq(t,r)||(l=t,t=r,r=l),e.vertLeq(i,n)||(l=i,i=n,n=l),e.vertLeq(t,i)||(l=t,t=i,i=l,l=r,r=n,n=l),e.vertLeq(i,r)?e.vertLeq(r,n)?(a=e.edgeEval(t,i,r),o=e.edgeEval(i,r,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,i.s,o,r.s)):(a=e.edgeSign(t,i,r),o=-e.edgeSign(t,n,r),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,i.s,o,n.s)):s.s=(i.s+r.s)/2,e.transLeq(t,r)||(l=t,t=r,r=l),e.transLeq(i,n)||(l=i,i=n,n=l),e.transLeq(t,i)||(l=t,t=i,i=l,l=r,r=n,n=l),e.transLeq(i,r)?e.transLeq(r,n)?(a=e.transEval(t,i,r),o=e.transEval(i,r,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,i.t,o,r.t)):(a=e.transSign(t,i,r),o=-e.transSign(t,n,r),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,i.t,o,n.t)):s.t=(i.t+r.t)/2},e}(),ym=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),Cy=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Od=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),mk=function(){function e(){var t=new Od,r=new ym,i=new Cy(0),n=new Cy(1);t.next=t.prev=t,t.anEdge=null,r.next=r.prev=r,i.next=i,i.Sym=n,n.next=n,n.Sym=i,this.vHead=t,this.fHead=r,this.eHead=i,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var r=new Cy(0),i=new Cy(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return i.next=n,n.Sym.next=r,r.next=t,t.Sym.next=i,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r},e.prototype.splice_=function(t,r){var i=t.Onext,n=r.Onext;i.Sym.Lnext=r,n.Sym.Lnext=t,t.Onext=n,r.Onext=i},e.prototype.makeVertex_=function(t,r,i){var n=t;wt(n,"Vertex can't be null!");var s=i.prev;n.prev=s,s.next=n,n.next=i,i.prev=n,n.anEdge=r;var a=r;do a.Org=n,a=a.Onext;while(a!==r)},e.prototype.makeFace_=function(t,r,i){var n=t;wt(n,"Face can't be null");var s=i.prev;n.prev=s,s.next=n,n.next=i,i.prev=n,n.anEdge=r,n.trail=null,n.marked=!1,n.inside=i.inside;var a=r;do a.Lface=n,a=a.Lnext;while(a!==r)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var r=t.next,i=t.Sym.next;r.Sym.next=i,i.Sym.next=r},e.prototype.killVertex_=function(t,r){var i=t.anEdge,n=i;do n.Org=r,n=n.Onext;while(n!==i);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,r){var i=t.anEdge,n=i;do n.Lface=r,n=n.Lnext;while(n!==i);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new Od,r=new Od,i=new ym,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(r,n.Sym,this.vHead),this.makeFace_(i,n,this.fHead),n},e.prototype.splice=function(t,r){var i=!1,n=!1;if(t!==r){if(r.Org!==t.Org&&(n=!0,this.killVertex_(r.Org,t.Org)),r.Lface!==t.Lface&&(i=!0,this.killFace_(r.Lface,t.Lface)),this.splice_(r,t),!n){var s=new Od;this.makeVertex_(s,r,t.Org),t.Org.anEdge=t}if(!i){var a=new ym;this.makeFace_(a,r,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var r=t.Sym,i=!1;if(t.Lface!==t.Rface&&(i=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!i){var n=new ym;this.makeFace_(n,t,t.Lface)}r.Onext===r?(this.killVertex_(r.Org,null),this.killFace_(r.Lface,null)):(t.Lface.anEdge=r.Oprev,r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var r=this.makeEdge_(t),i=r.Sym;this.splice_(r,t.Lnext),r.Org=t.Dst;var n=new Od;return this.makeVertex_(n,i,r.Org),r.Lface=i.Lface=t.Lface,r},e.prototype.splitEdge=function(t){var r=this.addEdgeVertex(t),i=r.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,i),t.Dst=i.Org,i.Dst.anEdge=i.Sym,i.Rface=t.Rface,i.winding=t.winding,i.Sym.winding=t.Sym.winding,i.idx=t.idx,i.Sym.idx=t.Sym.idx,i},e.prototype.connect=function(t,r){var i=!1,n=this.makeEdge_(t),s=n.Sym;if(r.Lface!==t.Lface&&(i=!0,this.killFace_(r.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,r),n.Org=t.Dst,s.Org=r.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!i){var a=new ym;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var r=t.anEdge,i,n,s,a,o;n=r.Lnext;do i=n,n=i.Lnext,i.Lface=null,i.Rface===null&&(i.Onext===i?this.killVertex_(i.Org,null):(i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),s=i.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(i));while(i!=r);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var r=t.anEdge,i=0;do i++,r=r.Lnext;while(r!==t.anEdge);return i},e.prototype.mergeConvexFaces=function(t){var r,i,n,s,a,o,l;for(r=this.fHead.next;r!==this.fHead;r=r.next)if(r.inside)for(i=r.anEdge,a=i.Org;n=i.Lnext,s=i.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(r),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&ht.vertCCW(i.Lprev.Org,i.Org,s.Lnext.Lnext.Org)&&ht.vertCCW(s.Lprev.Org,s.Org,i.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),i=null,s=null)),!(i&&i.Lnext.Org===a);)i=n;return!0},e.prototype.check=function(){var t=this.fHead,r=this.vHead,i=this.eHead,n,s,a,o,l,u;for(s=t,s=t;(n=s.next)!==t;s=n){wt(n.prev===s),l=n.anEdge;do wt(l.Sym!==l),wt(l.Sym.Sym===l),wt(l.Lnext.Onext.Sym===l),wt(l.Onext.Sym.Lnext===l),wt(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(wt(n.prev===s&&n.anEdge===null),o=r,o=r;(a=o.next)!==r;o=a){wt(a.prev===o),l=a.anEdge;do wt(l.Sym!==l),wt(l.Sym.Sym===l),wt(l.Lnext.Onext.Sym===l),wt(l.Onext.Sym.Lnext===l),wt(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(wt(a.prev===o&&a.anEdge===null),u=i,u=i;(l=u.next)!==i;u=l)wt(l.Sym.next===u.Sym),wt(l.Sym!==l),wt(l.Sym.Sym===l),wt(l.Org!==null),wt(l.Dst!==null),wt(l.Lnext.Onext.Sym===l),wt(l.Onext.Sym.Lnext===l);wt(l.Sym.next===u.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),gk=function(){function e(){this.handle=null}return e}(),vk=function(){function e(){this.key=null,this.node=0}return e}(),Gfe=function(){function e(t,r){this.leq=r,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var i=0;i<t+1;i++)this.nodes[i]=new gk,this.handles[i]=new vk;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var r=this.nodes,i=this.handles,n,s,a;for(n=r[t].handle;;){if(a=t<<1,a<this.size&&this.leq(i[r[a+1].handle].key,i[r[a].handle].key)&&++a,wt(a<=this.max),s=r[a].handle,a>this.size||this.leq(i[n].key,i[s].key)){r[t].handle=n,i[n].node=t;break}r[t].handle=s,i[s].node=t,t=a}},e.prototype.floatUp_=function(t){var r=this.nodes,i=this.handles,n,s,a;for(n=r[t].handle;;){if(a=t>>1,s=r[a].handle,a===0||this.leq(i[s].key,i[n].key)){r[t].handle=n,i[n].node=t;break}r[t].handle=s,i[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var r,i;if(r=++this.size,r*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new gk;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new vk}return this.freeList===0?i=r:(i=this.freeList,this.freeList=this.handles[i].node),this.nodes[r].handle=i,this.handles[i].node=r,this.handles[i].key=t,this.initialized&&this.floatUp_(r),i},e.prototype.extractMin=function(){var t=this.nodes,r=this.handles,i=t[1].handle,n=r[i].key;return this.size>0&&(t[1].handle=t[this.size].handle,r[t[1].handle].node=1,r[i].key=null,r[i].node=this.freeList,this.freeList=i,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var r=this.nodes,i=this.handles,n;wt(t>=1&&t<=this.max&&i[t].key!==null),n=i[t].node,r[n].handle=r[this.size].handle,i[r[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(i[r[n>>1].handle].key,i[r[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),i[t].key=null,i[t].node=this.freeList,this.freeList=t},e}(),XS=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),yk=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),Yfe=function(){function e(t,r){this.frame=t,this.leq=r,this.head=new yk,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var r=this.head;do r=r.next;while(r.key!==null&&!this.leq(this.frame,t,r.key));return r},e.prototype.insertBefore=function(t,r){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,r));var i=new yk;return i.key=r,i.next=t.next,t.next.prev=i,i.prev=t,t.next=i,i},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),qfe=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,r){t.winding+=r.winding,t.Sym.winding+=r.Sym.winding},e.edgeLeq=function(t,r,i){var n=t.event,s=r.eUp,a=i.eUp;if(s.Dst===n)return a.Dst===n?ht.vertLeq(s.Org,a.Org)?ht.edgeSign(a.Dst,s.Org,a.Org)<=0:ht.edgeSign(s.Dst,a.Org,s.Org)>=0:ht.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return ht.edgeSign(s.Dst,n,s.Org)>=0;var o=ht.edgeEval(s.Dst,n,s.Org),l=ht.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,r){r.fixUpperEdge&&wt(r.eUp.winding===0),r.eUp.activeRegion=null,t.dict.delete(r.nodeUp)},e.fixUpperEdge=function(t,r,i){wt(r.fixUpperEdge),t.mesh.delete(r.eUp),r.fixUpperEdge=!1,r.eUp=i,i.activeRegion=r},e.topLeftRegion=function(t,r){var i=r.eUp.Org,n;do r=e.regionAbove(r);while(r.eUp.Org===i);if(r.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(r).eUp.Sym,r.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,r,n),r=e.regionAbove(r)}return r},e.topRightRegion=function(t){var r=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===r);return t},e.addRegionBelow=function(t,r,i){var n=new XS;return n.eUp=i,n.nodeUp=t.dict.insertBefore(r.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,i.activeRegion=n,n},e.isWindingInside=function(t,r){switch(t.windingRule){case ur.ODD:return(r&1)!==0;case ur.NONZERO:return r!==0;case ur.POSITIVE:return r>0;case ur.NEGATIVE:return r<0;case ur.ABS_GEQ_TWO:return r>=2||r<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,r){r.windingNumber=e.regionAbove(r).windingNumber+r.eUp.winding,r.inside=e.isWindingInside(t,r.windingNumber)},e.finishRegion=function(t,r){var i=r.eUp,n=i.Lface;n.inside=r.inside,n.anEdge=i,e.deleteRegion(t,r)},e.finishLeftRegions=function(t,r,i){for(var n,s=null,a=r,o=r.eUp;a!==i;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,r,i,n,s,a){var o,l,u,h,c=!0;u=i;do wt(ht.vertLeq(u.Org,u.Dst)),e.addRegionBelow(t,r,u.Sym),u=u.Onext;while(u!==n);for(s===null&&(s=e.regionBelow(r).eUp.Rprev),l=r,h=s;o=e.regionBelow(l),u=o.eUp.Sym,u.Org===h.Org;)u.Onext!==h&&(t.mesh.splice(u.Oprev,u),t.mesh.splice(h.Oprev,u)),o.windingNumber=l.windingNumber-u.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!c&&e.checkForRightSplice(t,l)&&(e.addWinding(u,h),e.deleteRegion(t,l),t.mesh.delete(h)),c=!1,l=o,h=u;l.dirty=!0,wt(l.windingNumber-u.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,r,i){t.mesh.splice(r,i)},e.vertexWeights=function(t,r,i){var n=ht.vertL1dist(r,t),s=ht.vertL1dist(i,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*r.coords[0]+o*i.coords[0],t.coords[1]+=a*r.coords[1]+o*i.coords[1],t.coords[2]+=a*r.coords[2]+o*i.coords[2]},e.getIntersectData=function(t,r,i,n,s,a){r.coords[0]=r.coords[1]=r.coords[2]=0,r.idx=-1,e.vertexWeights(r,i,n),e.vertexWeights(r,s,a)},e.checkForRightSplice=function(t,r){var i=e.regionBelow(r),n=r.eUp,s=i.eUp;if(ht.vertLeq(n.Org,s.Org)){if(ht.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;ht.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),r.dirty=i.dirty=!0)}else{if(ht.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(r).dirty=r.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,r){var i=e.regionBelow(r),n=r.eUp,s=i.eUp,a;if(wt(!ht.vertEq(n.Dst,s.Dst)),ht.vertLeq(n.Dst,s.Dst)){if(ht.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(r).dirty=r.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=r.inside}else{if(ht.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;r.dirty=i.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=r.inside}return!0},e.checkForIntersect=function(t,r){var i=e.regionBelow(r),n=r.eUp,s=i.eUp,a=n.Org,o=s.Org,l=n.Dst,u=s.Dst,h,c,d=new Od,f,p;if(wt(!ht.vertEq(u,l)),wt(ht.edgeSign(l,t.event,a)<=0),wt(ht.edgeSign(u,t.event,o)>=0),wt(a!==t.event&&o!==t.event),wt(!r.fixUpperEdge&&!i.fixUpperEdge),a===o||(h=Math.min(a.t,l.t),c=Math.max(o.t,u.t),h>c))return!1;if(ht.vertLeq(a,o)){if(ht.edgeSign(u,a,o)>0)return!1}else if(ht.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),ht.intersect(l,a,u,o,d),wt(Math.min(a.t,l.t)<=d.t),wt(d.t<=Math.max(o.t,u.t)),wt(Math.min(u.s,l.s)<=d.s),wt(d.s<=Math.max(o.s,a.s)),ht.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),f=ht.vertLeq(a,o)?a:o,ht.vertLeq(f,d)&&(d.s=f.s,d.t=f.t),ht.vertEq(d,a)||ht.vertEq(d,o)?(e.checkForRightSplice(t,r),!1):!ht.vertEq(l,t.event)&&ht.edgeSign(l,t.event,d)>=0||!ht.vertEq(u,t.event)&&ht.edgeSign(u,t.event,d)<=0?u===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),r=e.topLeftRegion(t,r),n=e.regionBelow(r).eUp,e.finishLeftRegions(t,e.regionBelow(r),i),e.addRightEdges(t,r,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),i=r,r=e.topRightRegion(r),p=e.regionBelow(r).eUp.Rprev,i.eUp=s.Oprev,s=e.finishLeftRegions(t,i,null),e.addRightEdges(t,r,s.Onext,n.Rprev,p,!0),!0):(ht.edgeSign(l,t.event,d)>=0&&(e.regionAbove(r).dirty=r.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),ht.edgeSign(u,t.event,d)<=0&&(r.dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,u),e.regionAbove(r).dirty=r.dirty=i.dirty=!0,!1)},e.walkDirtyRegions=function(t,r){for(var i=e.regionBelow(r),n,s;;){for(;i.dirty;)r=i,i=e.regionBelow(i);if(!r.dirty&&(i=r,r=e.regionAbove(r),r===null||!r.dirty))return;if(r.dirty=!1,n=r.eUp,s=i.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,r)&&(i.fixUpperEdge?(e.deleteRegion(t,i),t.mesh.delete(s),i=e.regionBelow(r),s=i.eUp):r.fixUpperEdge&&(e.deleteRegion(t,r),t.mesh.delete(n),r=e.regionAbove(i),n=r.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!r.fixUpperEdge&&!i.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,r))return}else e.checkForRightSplice(t,r);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,r),t.mesh.delete(n),r=e.regionAbove(i))}},e.connectRightVertex=function(t,r,i){var n,s=i.Onext,a=e.regionBelow(r),o=r.eUp,l=a.eUp,u=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,r),ht.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),r=e.topLeftRegion(t,r),s=e.regionBelow(r).eUp,e.finishLeftRegions(t,e.regionBelow(r),a),u=!0),ht.vertEq(l.Org,t.event)&&(t.mesh.splice(i,l.Oprev),i=e.finishLeftRegions(t,a,null),u=!0),u){e.addRightEdges(t,r,i.Onext,s,s,!0);return}ht.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(i.Lprev,n),e.addRightEdges(t,r,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,r)},e.connectLeftDegenerate=function(t,r,i){var n,s,a,o,l;if(n=r.eUp,ht.vertEq(n.Org,i)){wt(!1),e.spliceMergeVertices(t,n,i.anEdge);return}if(!ht.vertEq(n.Dst,i)){t.mesh.splitEdge(n.Sym),r.fixUpperEdge&&(t.mesh.delete(n.Onext),r.fixUpperEdge=!1),t.mesh.splice(i.anEdge,n),e.sweepEvent(t,i);return}wt(!1),r=e.topRightRegion(r),l=e.regionBelow(r),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(wt(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(i.anEdge,a),ht.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,r,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,r){var i,n,s,a,o,l,u=new XS;if(u.eUp=r.anEdge.Sym,i=t.dict.search(u).key,n=e.regionBelow(i),!!n){if(a=i.eUp,o=n.eUp,ht.edgeSign(a.Dst,r,a.Org)===0){e.connectLeftDegenerate(t,i,r);return}if(s=ht.vertLeq(o.Dst,a.Dst)?i:n,i.inside||s.fixUpperEdge){if(s===i)l=t.mesh.connect(r.anEdge.Sym,a.Lnext);else{var h=t.mesh.connect(o.Dnext,r.anEdge);l=h.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,i,l)),e.sweepEvent(t,r)}else e.addRightEdges(t,i,r.anEdge,r.anEdge,null,!0)}},e.sweepEvent=function(t,r){t.event=r,e.debugEvent(t);for(var i=r.anEdge;i.activeRegion===null;)if(i=i.Onext,i===r.anEdge){e.connectLeftVertex(t,r);return}var n=e.topLeftRegion(t,i.activeRegion);wt(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,r,i,n){var s=new XS,a=t.mesh.makeEdge();a.Org.s=i,a.Org.t=n,a.Dst.s=r,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new Yfe(t,e.edgeLeq);var r=t.bmax[0]-t.bmin[0],i=t.bmax[1]-t.bmin[1],n=t.bmin[0]-r,s=t.bmax[0]+r,a=t.bmin[1]-i,o=t.bmax[1]+i;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var r,i=0;(r=t.dict.min().key)!==null;)r.sentinel||(wt(r.fixUpperEdge),wt(++i===1)),wt(r.windingNumber===0),e.deleteRegion(t,r)},e.removeDegenerateEdges=function(t){var r,i,n,s=t.mesh.eHead;for(r=s.next;r!==s;r=i)i=r.next,n=r.Lnext,ht.vertEq(r.Org,r.Dst)&&r.Lnext.Lnext!==r&&(e.spliceMergeVertices(t,n,r),t.mesh.delete(r),r=n,n=r.Lnext),n.Lnext===r&&(n!==r&&((n===i||n===i.Sym)&&(i=i.next),t.mesh.delete(n)),(r===i||r===i.Sym)&&(i=i.next),t.mesh.delete(r))},e.initPriorityQ=function(t){var r,i,n,s=0;for(n=t.mesh.vHead,i=n.next;i!==n;i=i.next)s++;for(s+=8,r=t.pq=new Gfe(s,ht.vertLeq),n=t.mesh.vHead,i=n.next;i!==n;i=i.next)i.pqHandle=r.insert(i);return i!==n?!1:(r.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,r){var i,n,s;for(i=r.fHead.next;i!==r.fHead;i=n)n=i.next,s=i.anEdge,wt(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,r){r===void 0&&(r=!0);var i,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(i=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!ht.vertEq(n,i));)n=t.pq.extractMin(),e.spliceMergeVertices(t,i.anEdge,n.anEdge);e.sweepEvent(t,i)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(r&&t.mesh.check(),!0):!1},e}(),Xfe=function(){function e(){this.mesh=new mk,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=ur.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},e.prototype.normalize_=function(t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!r)throw"Zero-size vector!";r=Math.sqrt(r),t[0]/=r,t[1]/=r,t[2]/=r},e.prototype.longAxis_=function(t){var r=0;return Math.abs(t[1])>Math.abs(t[0])&&(r=1),Math.abs(t[2])>Math.abs(t[r])&&(r=2),r},e.prototype.computeNormal_=function(t){var r,i,n,s,a,o,l=[0,0,0],u=[0,0,0],h=[0,0,0],c=[0,0,0],d=[0,0,0],f=[null,null,null],p=[null,null,null],m=this.mesh.vHead;r=m.next;for(var g=0;g<3;++g)s=r.coords[g],u[g]=s,p[g]=r,l[g]=s,f[g]=r;for(r=m.next;r!==m;r=r.next)for(var v=0;v<3;++v)s=r.coords[v],s<u[v]&&(u[v]=s,p[v]=r),s>l[v]&&(l[v]=s,f[v]=r);var y=0;if(l[1]-u[1]>l[0]-u[0]&&(y=1),l[2]-u[2]>l[y]-u[y]&&(y=2),u[y]>=l[y]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,i=p[y],n=f[y],h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],r=m.next;r!==m;r=r.next)c[0]=r.coords[0]-n.coords[0],c[1]=r.coords[1]-n.coords[1],c[2]=r.coords[2]-n.coords[2],d[0]=h[1]*c[2]-h[2]*c[1],d[1]=h[2]*c[0]-h[0]*c[2],d[2]=h[0]*c[1]-h[1]*c[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(h)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,r,i=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(r=i.next;r!==i;r=r.next)r.t=-r.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,r=[0,0,0],i,n,s=!1;r[0]=this.normal[0],r[1]=this.normal[1],r[2]=this.normal[2],!r[0]&&!r[1]&&!r[2]&&(this.computeNormal_(r),s=!0),i=this.sUnit,n=this.tUnit;var a=this.longAxis_(r);i[a]=0,i[(a+1)%3]=1,i[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=r[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,i),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,u=t.next;u!==t;u=u.next)l?(this.bmin[0]=this.bmax[0]=u.s,this.bmin[1]=this.bmax[1]=u.t,l=!1):(u.s<this.bmin[0]&&(this.bmin[0]=u.s),u.s>this.bmax[0]&&(this.bmax[0]=u.s),u.t<this.bmin[1]&&(this.bmin[1]=u.t),u.t>this.bmax[1]&&(this.bmax[1]=u.t))},e.prototype.addWinding_=function(t,r){t.winding+=r.winding,t.Sym.winding+=r.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,r){var i,n;if(i=r.anEdge,!(i.Lnext!==i&&i.Lnext.Lnext!==i))throw"Mono region invalid";for(;ht.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;ht.vertLeq(i.Org,i.Dst);i=i.Lnext);n=i.Lprev;for(var s=void 0;i.Lnext!==n;)if(ht.vertLeq(i.Dst,n.Org)){for(;n.Lnext!==i&&(ht.edgeGoesLeft(n.Lnext)||ht.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==i&&(ht.edgeGoesRight(i.Lprev)||ht.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0);)s=t.connect(i,i.Lprev),i=s.Sym;i=i.Lnext}if(n.Lnext===i)throw"Mono region invalid";for(;n.Lnext.Lnext!==i;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)if(r=i.next,i.inside&&!this.tessellateMonoRegion_(t,i))return!1;return!0},e.prototype.discardExterior_=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside||t.zapFace(i)},e.prototype.setWindingNumber_=function(t,r,i){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?r:-r:i?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,r,i,n){var s,a=0,o=0,l;i>3&&t.mergeConvexFaces(i);for(var u=t.vHead.next;u!==t.vHead;u=u.next)u.n=-1;for(var h=t.fHead.next;h!==t.fHead;h=h.next)if(h.n=-1,!!h.inside){s=h.anEdge,l=0;do{var u=s.Org;u.n===-1&&(u.n=o,o++),l++,s=s.Lnext}while(s!==h.anEdge);if(l>i)throw"Face vertex greater that support polygon";h.n=a,++a}this.elementCount=a,r===fi.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*i,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var u=t.vHead.next;u!==t.vHead;u=u.next)if(u.n!==-1){var c=u.n*n;this.vertices[c+0]=u.coords[0],this.vertices[c+1]=u.coords[1],n>2&&(this.vertices[c+2]=u.coords[2]),this.vertexIndices[u.n]=u.idx}for(var d=0,h=t.fHead.next;h!==t.fHead;h=h.next)if(h.inside){s=h.anEdge,l=0;do{var u=s.Org;this.elements[d++]=u.n,l++,s=s.Lnext}while(s!==h.anEdge);for(var f=l;f<i;++f)this.elements[d++]=-1;if(r===fi.CONNECTED_POLYGONS){s=h.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==h.anEdge);for(var p=l;p<i;++p)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,r){var i,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=i=o.anEdge;do this.vertexCount++,i=i.Lnext;while(i!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*r,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,u=0,h=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=i=o.anEdge;do this.vertices[l++]=i.Org.coords[0],this.vertices[l++]=i.Org.coords[1],r>2&&(this.vertices[l++]=i.Org.coords[2]),this.vertexIndices[u++]=this.vertexIdCallback?this.vertexIdCallback(i):i.Org.idx,a++,i=i.Lnext;while(i!==n);this.elements[h++]=s,this.elements[h++]=a,s+=a}},e.prototype.addContour=function(t,r){this.mesh===null&&(this.mesh=new mk),t<2&&(t=2),t>3&&(t=3);for(var i=null,n=0;n<r.length;n+=t)i===null?(i=this.mesh.makeEdge(),this.mesh.splice(i,i.Sym)):(this.mesh.splitEdge(i),i=i.Lnext),i.Org.coords[0]=r[n+0],i.Org.coords[1]=r[n+1],t>2?i.Org.coords[2]=r[n+2]:i.Org.coords[2]=0,i.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(i),i.winding=1,i.Sym.winding=-1},e.prototype.tesselate=function(t,r,i,n,s,a){if(t===void 0&&(t=ur.ODD),r===void 0&&(r=fi.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),qfe.computeInterior(this,a);var o=this.mesh;return r===fi.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),r===fi.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,r,i,n),!0},e}();function Ru(e){var t=e.windingRule,r=t===void 0?ur.ODD:t,i=e.elementType,n=i===void 0?fi.POLYGONS:i,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,u=e.normal,h=u===void 0?[0,0,1]:u,c=e.contours,d=c===void 0?[]:c,f=e.strict,p=f===void 0?!0:f,m=e.debug,g=m===void 0?!1:m;if(!d&&p)throw new Error("Contours can't be empty");if(d){var v=new Xfe;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(r,n,a,l,h,p),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}ur.ODD;ur.NONZERO;ur.POSITIVE;ur.NEGATIVE;ur.ABS_GEQ_TWO;fi.POLYGONS;fi.CONNECTED_POLYGONS;fi.BOUNDARY_CONTOURS;var iT=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let r=e*iT.eSize;this.buffer=new ArrayBuffer(r);let i=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*i,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*i,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*i,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} → ${e}`);let r=e*iT.eSize,i=new ArrayBuffer(r),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(i,s*n,3*e);s+=3*e;let o=new Float32Array(i,s*n,3*e);s+=3*e;let l=new Float32Array(i,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=i,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let i=this.capacity;for(;t>i;)i*=2;this.realloc(i)}let r=this.size;return this.size=t,r}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},M5=iT;M5.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var $fe=dp(_$()),i2={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},E5={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},A5={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},$S=(e,t)=>([r,i])=>(i<r&&(i+=t),(e>=r?e:e+t)<=i),n2=class extends _t{constructor(e,t,r=0,i=12,n=3,s=ur.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=i,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],i),l=this._shape.shapeHoles.map(T=>{let C=T.extractShapePointsToFlatArray([],i),L=[];for(let I=C.length-1;I>=1;I-=2){let k=C[I-1],z=C[I-0];L.push(k,z)}return L}),u=[],h=[];for(let T=0;T<o.length;T+=2)h.push([o[T],o[T+1]]);u.push(h);for(let T=0;T<l.length;T++){let C=l[T],L=[];for(let I=0;I<C.length;I+=2)L.push([C[I],C[I+1]]);u.push(L)}let c=u[0].length?(0,$fe.default)(u).distance:r;r<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(r,c,t/2),this._bevelSegments=Math.floor(n));let d;try{d=Ru({windingRule:s,elementType:fi.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=i2}let f;try{f=Ru({windingRule:ur.ODD,elementType:fi.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{f=E5}if(!d)throw new Error("error generating geometry");let p=d.elementCount;if(f){d.elementCount+=f.elementCount;for(let T=0;T<f.elements.length;T++){let C=f.elements[T],L=T%2===0?d.vertexCount:0;d.elements.push(C+L)}for(let T=0;T<f.vertexIndices.length;T++){let C=f.vertexIndices[T],L=d.vertexCount;d.vertexIndices.push(C+L)}for(let T=0;T<f.vertices.length;T++){let C=f.vertices[T];d.vertices.push(C)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let T=0,C=d.vertexCount;T<C;T++){let L=T*2,I=d.vertices[L+0],k=d.vertices[L+1];I<m&&(m=I),I>g&&(g=I),k<v&&(v=k),k>y&&(y=k)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new M5(this._computeBufferEstimatedSize(d));let x=[],w=[];for(let T=d.elementCount-1;T>=0;T--){let C=T>=p,L=T*2,I=d.elements[L+0],k=d.elements[L+1],z=I+k,V={start:I,count:k,normals:[],continuous:[],concave:[]},K=I,q=z-1,O=I+1,W=this._shape.roundedCurves.length;do{let H=K-I,G=d.vertices[q*2+0],$=d.vertices[q*2+1],se=d.vertices[K*2+0],re=d.vertices[K*2+1],ae=d.vertices[O*2+0],ce=d.vertices[O*2+1],me=se-G,be=re-$,Ae=Math.sqrt(me*me+be*be);me/=Ae,be/=Ae;let $e=se-ae,Le=re-ce,Qe=Math.sqrt($e*$e+Le*Le);$e/=Qe,Le/=Qe,V.normals[H*2+0]=-Le,V.normals[H*2+1]=$e,V.concave[H]=me*Le-be*$e>0;let Xe=d.vertexIndices[K];if(Array.isArray(Xe))V.continuous[H]=!1;else{let[Re,Ie]=this._shape.getCurveIndexFromVertexId(Xe-1,!0);if(Ie>0&&Ie<1)V.continuous[H]=!0;else{let Ge=Ie===1?Re+1:Re-1;Ge=(Ge+W)%W;let He=Ie===1?0:1,Y=this._shape.roundedCurves[Re].getTangent(Ie),U=this._shape.roundedCurves[Ge].getTangent(He);V.continuous[H]=Y.dot(U)>.95}}C&&(V.normals[H*2+0]*=-1,V.normals[H*2+1]*=-1),[q,K,O]=[K,O,O+1],O>=z&&(O-=k)}while(O!==I+1);let N=[];N.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(I*2,z*2),vertexCount:k,vertexIndices:new Array(k).fill(!0).map((H,G)=>[G,G]),elements:[0,k],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(I*2,z*2)});let B=0;for(let H=1;H<=this._bevelSegments;H++){let G=H/this._bevelSegments*Math.PI/2,$=(1-Math.cos(G))*this._bevel,se=[],re=[],ae=0;for(let me=0;me<k;me++){let be=me*2,Ae=(me-1+k)%k*2,$e=d.vertices[V.start*2+be+0],Le=d.vertices[V.start*2+be+1],Qe=-V.normals[Ae+0]*$,Xe=-V.normals[Ae+1]*$,Re=-V.normals[be+0]*$,Ie=-V.normals[be+1]*$;if(V.concave[me]||!V.concave[me]&&C){let Ge=Math.atan2(Xe,Qe),He=Math.atan2(Ie,Re);He>Ge&&(He-=Math.PI*2);let Y=He-Ge;if(V.continuous[me]||C){let U=Ge+Y/2,he=Math.cos(U)*$,Ee=Math.sin(U)*$;se[2*ae+0]=$e+he*(C?-1:1),se[2*ae+1]=Le+Ee*(C?-1:1),re[ae]=me,ae++}else{let U=Math.max(1,Math.floor(i/4*Math.abs(Y)/Math.PI));for(let he=0;he<=U;he++){let Ee=Ge+Y*(he/U),Ce=Math.cos(Ee)*$,ke=Math.sin(Ee)*$;se[2*ae+0]=$e+Ce,se[2*ae+1]=Le+ke,re[ae]=me,ae++}}}else se[2*ae+0]=$e+Qe,se[2*ae+1]=Le+Xe,re[ae]=me,ae++,se[2*ae+0]=$e,se[2*ae+1]=Le,re[ae]=me,ae++,se[2*ae+0]=$e+Re,se[2*ae+1]=Le+Ie,re[ae]=me,ae++}let ce=Ru({windingRule:ur.POSITIVE,elementType:fi.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[se],edgeCreateCallback:me=>{let be=me.Org.idx,Ae=re[be],$e=re[(be+1)%re.length];me.idx=[Ae,$e],me.Sym.idx=[$e,Ae]},vertexIdCallback:me=>{let be=me.Lprev.idx;return[be?be[1]:0,me.idx?me.idx[0]:0]}});if(!ce)throw console.log("Error"),new Error(`error generating bevel geometry for ${H}'th loop`);if(!ce.vertexCount){let me=(H-1)/this._bevelSegments*Math.PI/2;B=(1-Math.sin(me))*this._bevel;break}for(let me=0;me<ce.vertexIndices.length;me++){let[be,Ae]=ce.vertexIndices[me];if(be===Ae)continue;let $e=Ae;Ae<be&&($e+=k);for(let Le=be;Le<$e;Le++){let Qe=Le%k,Xe=(Le+1)%k;if(!V.continuous[Qe]||!V.continuous[Xe]){ce.vertexIndices[me]=[be,Qe],ce.vertexIndices.splice(me+1,0,[Xe,Ae]),ce.vertices.splice((me+1)*2,0,ce.vertices[me*2],ce.vertices[me*2+1]);break}}}N.push({bevelI:H,angle:G,size:$,boundary:ce,reverseMap:re,insetPoints:se})}let j=(H,G,$)=>{let se=0,re=H.boundary.vertexIndices.length;for(;se<re&&$(H.boundary.vertexIndices[G]);)G=(G+1)%re,se++;return se},Q=x.length;for(let H=1;H<N.length;H++){let G=N[H-1],$=N[H],se=G.boundary.vertexIndices.length,re=$.boundary.vertexIndices.length;if(!se||!re)break;let ae=V.concave.length,ce=0,me=$S(ce,k);for(;!G.boundary.vertexIndices.filter(me).length||!$.boundary.vertexIndices.filter(me).length;)ce++,me=$S(ce,k);let be=G.boundary.vertexIndices.findIndex(me),Ae=$.boundary.vertexIndices.findIndex(me);do be=(be+1)%se;while(me(G.boundary.vertexIndices[be]));do Ae=(Ae+1)%re;while(me($.boundary.vertexIndices[Ae]));ce=(ce+1)%k;let $e=ce,Le=0,Qe=this._buildBevelVert(V,G,(be-1+se)%se,void 0,Le),Xe=this._buildBevelVert(V,$,(Ae-1+re)%re,void 0,Le),Re=Qe,Ie=Xe,Ge,He,Y=!1;do{Le=(ce||ae)/ae,me=$S(ce,k);let U=j(G,be,me),he=j($,Ae,me),Ee=Y;if(Y=!1,U&&!he){for(let Ce=0;Ce<U;Ce++)Ge=this._buildBevelVert(V,G,(be+Ce)%se,Ce/(U-1),Le),x.push(Re.topN,Ge.topP,Ie.topN),a===!1&&x.push(Ge.bottomP,Re.bottomN,Ie.bottomN),Re=Ge;Y=!0}else if(!U&&he)for(let Ce=0;Ce<he;Ce++)He=this._buildBevelVert(V,$,(Ae+Ce)%re,Ce/(he-1),Le),x.push(Ie.topN,Re.topP,He.topP),a===!1&&x.push(Re.bottomP,Ie.bottomN,He.bottomP),Ie=He;else if(U&&he)if(Ge=this._buildBevelVert(V,G,be,0,Le),He=this._buildBevelVert(V,$,Ae,0,Le),Ee?(x.push(Re.topN,He.topP,Ie.topN),x.push(Re.topN,Ge.topP,He.topP),a===!1&&(x.push(He.bottomP,Re.bottomN,Ie.bottomN),x.push(He.bottomP,Ge.bottomP,Re.bottomN))):(x.push(Ie.topN,Re.topN,Ge.topP),x.push(Ie.topN,Ge.topP,He.topP),a===!1&&(x.push(Ge.bottomP,Re.bottomN,Ie.bottomN),x.push(Ge.bottomP,Ie.bottomN,He.bottomP))),Re=Ge,Ie=He,U===he)for(let Ce=1;Ce<U;Ce++)Ge=this._buildBevelVert(V,G,(be+Ce)%se,Ce/(U-1),Le),He=this._buildBevelVert(V,$,(Ae+Ce)%re,Ce/(he-1),Le),x.push(Re.topN,Ge.topP,Ie.topN),x.push(Ie.topN,Ge.topP,He.topP),a===!1&&(x.push(Ge.bottomP,Re.bottomN,Ie.bottomN),x.push(Ge.bottomP,Ie.bottomN,He.bottomP)),Re=Ge,Ie=He;else if(U>he){let Ce=U/he,ke=0;for(let Ye=1;Ye<U;Ye++)Ge=this._buildBevelVert(V,G,(be+Ye)%se,Ye/(U-1),Le),x.push(Re.topN,Ge.topP,Ie.topN),a===!1&&x.push(Ge.bottomP,Re.bottomN,Ie.bottomN),Re=Ge,Ye>(ke+1)*Ce&&(ke++,He=this._buildBevelVert(V,$,(Ae+ke)%re,ke/(he-1),Le),x.push(Ie.topN,Ge.topP,He.topP),a===!1&&x.push(Ge.bottomP,Ie.bottomN,He.bottomP),Ie=He)}else{let Ce=he/U,ke=0;for(let Ye=1;Ye<he;Ye++)He=this._buildBevelVert(V,$,(Ae+Ye)%re,Ye/(he-1),Le),x.push(Ie.topN,Ge.topP,He.topP),a===!1&&x.push(Ge.bottomP,Ie.bottomN,He.bottomP),Ie=He,Ye>(ke+1)*Ce&&(ke++,Ge=this._buildBevelVert(V,G,(be+ke)%se,ke/(U-1),Le),x.push(Re.topN,Ge.topP,Ie.topN),a===!1&&x.push(Ge.bottomP,Re.bottomN,Ie.bottomN),Re=Ge)}be=(be+U)%se,Ae=(Ae+he)%re,ce=(ce+1)%ae}while(ce!==$e)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(N,V,x),C){let H=[];for(let G=x.length-1;G>=Q+2;G-=3){let $=x[G-2],se=x[G-1],re=x[G-0];H.push(re,se,$)}x.splice(Q,x.length-Q,...H)}if(C){let H=[];for(let G=N[N.length-1].boundary.vertices.length-1;G>=1;G-=2){let $=N[N.length-1].boundary.vertices[G-1],se=N[N.length-1].boundary.vertices[G-0];H.push($,se)}w.push(H)}if(!C){let H=N[N.length-1],G;try{G=Ru({windingRule:N.length>1?ur.POSITIVE:ur.ODD,elementType:fi.POLYGONS,vertexSize:2,strict:!0,contours:[H.insetPoints,...w]})}catch{G=A5}if(!G)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<c&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let $=0;$<G.elementCount*3;$+=3){let se=this._buildSurfaceVert(G,G.elements[$+0],B),re=this._buildSurfaceVert(G,G.elements[$+1],B),ae=this._buildSurfaceVert(G,G.elements[$+2],B);x.push(se.top,re.top,ae.top),a===!1&&x.push(ae.bottom,re.bottom,se.bottom)}}this.vertexCache={}}this._buffer.shrink();let S=new Mt(Uint32Array.from(x),1),_=new Mt(this._buffer.positions,3),A=new Mt(this._buffer.normals,3),M=new Mt(this._buffer.uvs,2);_.needsUpdate=!0,A.needsUpdate=!0,M.needsUpdate=!0,S.needsUpdate=!0,this.setAttribute("position",_),this.setAttribute("normal",A),this.setAttribute("uv",M),this.setIndex(S)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,r){let i=e[0];for(let n=0,s=i.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,i,n),o=this._buildBevelVert(t,i,(n+1)%s);r.push(o.topP,a.topN,a.bottomN),r.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,r){let i=t.toString();if(i in this.vertexCache)return this.vertexCache[i];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),u=l*3,h=l*2,c={top:l+0,bottom:l+1};return this._buffer.positions[u+0]=n,this._buffer.positions[u+1]=s,this._buffer.positions[u+2]=this.forPathBevel?this._bevel:this._depth-r,this._buffer.normals[u+0]=0,this._buffer.normals[u+1]=0,this._buffer.normals[u+2]=1,this._buffer.uvs[h+0]=a,this._buffer.uvs[h+1]=o,this.forPathBevel===!1&&(this._buffer.positions[u+3]=n,this._buffer.positions[u+4]=s,this._buffer.positions[u+5]=r,this._buffer.normals[u+3]=0,this._buffer.normals[u+4]=0,this._buffer.normals[u+5]=-1,this._buffer.uvs[h+2]=a,this._buffer.uvs[h+3]=o),this.vertexCache[i]=c,c}_buildBevelVert(e,t,r,i=1,n){let s=`${t.bevelI}:${r}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[r],l,u,h,c;a!==o?(u=a,l=o,c=!1,h=e.continuous[u]&&e.continuous[l]):(l=a,u=(l-1+e.count)%e.count,c=e.concave[l]&&t.bevelI>0,h=e.continuous[l]||c);let d=Math.cos(t.angle),f=Math.sin(t.angle),p=r*2,m=l*2,g=u*2,v=t.boundary.vertices[p+0],y=t.boundary.vertices[p+1],x=(1-f)*this._bevel,w=(v-this._minX)/this._width,S=(y-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(w=n),S=1);let _=e.normals[m+0],A=e.normals[m+1],M=e.normals[g+0],T=e.normals[g+1];if(c){let z=M-_,V=T-A;_=_+z*(1-i),A=A+V*(1-i);let K=Math.sqrt(_*_+A*A);_/=K,A/=K}let C=this.forPathBevel?this._buffer.get(h?1:2):this._buffer.get(h?2:4),L=C*3,I=C*2,k={i:r,fi:l,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:n};return this._buffer.positions[L+0]=v,this._buffer.positions[L+1]=y,this._buffer.positions[L+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[L+0]=_*d,this._buffer.normals[L+1]=A*d,this._buffer.normals[L+2]=f,this._buffer.uvs[I+0]=w,this._buffer.uvs[I+1]=S,this.forPathBevel===!1&&(this._buffer.positions[L+3]=v,this._buffer.positions[L+4]=y,this._buffer.positions[L+5]=x,this._buffer.normals[L+3]=_*d,this._buffer.normals[L+4]=A*d,this._buffer.normals[L+5]=-f,this._buffer.uvs[I+2]=S,this._buffer.uvs[I+3]=w),h||(this.forPathBevel?(C+=1,L+=3,I+=2):(C+=2,L+=6,I+=4),k.topP=C+0,k.bottomP=C+1,this._buffer.positions[L+0]=v,this._buffer.positions[L+1]=y,this._buffer.positions[L+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[L+0]=M*d,this._buffer.normals[L+1]=T*d,this._buffer.normals[L+2]=f,this._buffer.uvs[I+0]=w,this._buffer.uvs[I+1]=S,this.forPathBevel===!1&&(this._buffer.positions[L+3]=v,this._buffer.positions[L+4]=y,this._buffer.positions[L+5]=x,this._buffer.normals[L+3]=M*d,this._buffer.normals[L+4]=T*d,this._buffer.normals[L+5]=-f,this._buffer.uvs[I+2]=S,this._buffer.uvs[I+3]=w)),this.vertexCache[s]=k,k}clone(){let e=new n2(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=nb(this.userData),e}},T5=class extends _t{constructor(e,t=12,r={}){super(),this.type="ShapeGeometry",this.windingRule=ur.ODD,this.elementType=fi.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:ur.ODD,elementType:fi.POLYGONS,polySize:3,vertexSize:2,strict:!0},r);let i=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,u;for(let d=0,f=i.length/2;d<f;d++){let p=d*2,m=i[p+0],g=i[p+1];if(l!==void 0&&m!==l&&(a=!1),u!==void 0&&g!==u&&(o=!1),l=m,u=g,!a&&!o)break}if(!a&&!o)try{s=Ru({contours:[i,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=i2}let h=(s==null?void 0:s.vertexCount)??1,c=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Mt(new Float32Array(h*3),3),this._normalAttribute=new Mt(new Float32Array(h*3),3),this._uvAttribute=new Mt(new Float32Array(h*2),2),this._indexAttribute=new Mt(new Uint32Array(c*3),1),s){let d=1/0,f=-1/0,p=1/0,m=-1/0;for(let y=0,x=h;y<x;y++){let w=y*2,S=s.vertices[w+0],_=s.vertices[w+1];S<d&&(d=S),S>f&&(f=S),_<p&&(p=_),_>m&&(m=_)}let g=f-d,v=m-p;for(let y=0,x=h;y<x;y++){let w=y*2,S=s.vertices[w+0],_=s.vertices[w+1],A=(S-d)/g,M=(_-p)/v;this._positionAttribute.setXYZ(y,S,_,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,A,M)}for(let y=0,x=c;y<x;y++){let w=y*3,S=s.elements[w+0],_=s.elements[w+1],A=s.elements[w+2];this._indexAttribute.setX(w+0,S),this._indexAttribute.setX(w+1,_),this._indexAttribute.setX(w+2,A)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new T5(this._shape,this._curveSegments);return e.userData=nb(this.userData),e}},C5=class extends n2{constructor(e,t,r=0,i=12,n=3,s=ur.ODD){super(e,t,r,i,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,r){let i=e[0];for(let n=0,s=i.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,i,n),o=this._buildBevelVert(t,i,(n+1)%s);r.push(o.topP,a.topN,a.bottomN),r.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new C5(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=nb(this.userData),e}},kh=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var u,h;let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:ur.ODD},e.parameters),i=Math.abs(r.width),n=Math.abs(r.height??r.width),s=Math.abs(r.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??r.roundness;a!==void 0&&(a instanceof $r?(a.width!==i||a.height!==n)&&a.applySize(i,n):a=new $r(i,n).fromJSON(a),((u=e.parameters)==null?void 0:u.roundness)!==void 0&&((h=e.parameters)==null?void 0:h.roundness)>0&&a.update());let l=a??new $r(i,n);return{parameters:Object.assign(r,{width:i,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:r,extrudeBevelSegments:i,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new T5(e.shape,n,{windingRule:a}):o=new C5(e.shape,t,r,n,i,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},D5=Math.PI*2,s2=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r,spikes:i,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,u=e.shape,h=t*.5,c=r*.5,d=Qfe(u,h,c,n*Math.PI/180,i,s);u.isClosed=!0,u.update();let f=kh.create({shape:u,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(f,{userData:{...e,type:"EllipseGeometry"}})}};function Qfe(e,t,r,i,n,s){if(i>=D5)return n>30||n%4===0?(Zfe(e,t,r,s),Math.round(n/4)):xk(e,i,n,t,r,s);i=Math.max(i,.001);let a={x:0,y:r},o=i+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*r},u=Wfe({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:r,largeArcFlag:i>Math.PI,sweepFlag:!0});return n>30||n%u.length===0?Kfe(e,a.x,a.y,u,n,t,r,s):xk(e,i,n,t,r,s)}function Kfe(e,t,r,i,n,s,a,o){let l=Math.round(n/i.length);e.addPoint(_f(t,r));for(let u=0,h=i.length;u<h;u++){let c=i[u],d=e.points[u],f=_f(c.x,c.y);d.controls[1].position.set(c.x1,c.y1),f.controls[0].position.set(c.x2,c.y2),e.addPoint(f)}return o>0?P5(e,s,a,o):e.addPoint(_f(0,0)),l}function xk(e,t,r,i,n,s){let a=-t/r;for(let o=0;o<=r;o++){let l=a*o,u=Math.sin(l)*i,h=Math.cos(l)*n;e.addPoint(_f(u,h))}return t<D5?s>0?P5(e,i,n,s):e.addPoint(_f(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&O5(e,i,n,s)),1}function Zfe(e,t,r,i=0,n=0,s=0){let a=.5522847498,o=t*a,l=r*a;e.addPoint(Dy(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(Dy(n,s+r,n-o,s+r,n+o,s+r)),e.addPoint(Dy(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(Dy(n,s-r,n+o,s-r,n-o,s-r)),i>0&&O5(e,t,r,i)}function _f(e,t){return new bf(zt.generateUUID(),new J(e,t))}function Dy(e,t,r,i,n,s){let a=_f(e,t);return a.controls[0].position.set(r,i),a.controls[1].position.set(n,s),a}function P5(e,t,r,i){L5(e,t,r,i).forEach(n=>e.addPoint(n))}function O5(e,t,r,i){let n=L5(e,t,r,i),s=new $r;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function L5(e,t,r,i){let n=i*t/100,s=n*(Math.abs(r)/Math.abs(t)),a=new J(n/t,s/r),o=e.points.map(l=>{let u=l.clone();return u.uuid=zt.generateUUID(),u}).reverse();return o.forEach(l=>{l.position.multiply(a);let u=l.controls[0].position.clone().multiply(a),h=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(h),l.controls[1].position.copy(u)}),o}var Jfe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),i=Math.abs(r.width),n=Math.abs(r.height??i),s=Math.abs(r.depth??i),a=Math.abs(Math.min(i,s))/2;return{parameters:Object.assign(r,{width:i,height:n,depth:s,radius:a,segments:Math.round(r.segments),pathSegments:Math.round(r.pathSegments),cornerSegments:Math.round(r.cornerSegments)})}}static build(e){let{width:t,height:r,depth:i,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:u,cornerRadius:h,cornerSegments:c}=e.parameters,d=new I5(!1,t,r,i,n,s,a,o,l,u,h,c);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},QS=new pf([0,0,0],1),I5=class extends _t{constructor(e=!0,t=1,r=1,i=1,n=1,s=1,a=1,o=1,l=1,u=1,h=1,c=1){if(super(),s===0)return;let d=e&&s===1;d&&(c=0),h>100&&(h=100),h===0&&(c=0);let f=()=>new P,p=new P,m=f(),g=f(),v=f(),y,x,w,S,_,A,M,T,C=f(),L=f(),I=f(),k=f(),z=f(),V=f(),K=f(),q=f(),O=r-2*o+.001,W=O/s,N=Math.ceil(a*s),B=N+1,j=O/N,Q=-O/2,H=u+1,G=2*Math.PI/u,$=Math.PI/2/c,se=.01,re=Math.min((1-h/100)*o,o-se),ae=o-re,ce=0,me=2,be=c*me+me,Ae=H*be/me,$e=Ae+H*B,Le=H*(B+be),[Qe,Xe,Re]=[3,3,2].map(xe=>Array(Le*xe).fill(0)),Ie=[],Ge=n-o;function He(xe,et){let ot=Math.PI/2;A=et*j,T=2*Math.PI*(A%W)/W+ot,A+=Q,M=Math.sin(T)*Ge,_=Math.cos(T)*Ge,e?xe.set(_,M,A):xe.set(_,A,M)}He(p,-1e-10),He(m,0),C.copy(p),He(p,1);let Y=p.distanceTo(m),U=d?0:ae+re,he=Y*N+2*U,Ee=re,Ce=he-U;for(let xe=0;xe<=N;xe++){He(g,xe),q.subVectors(g,C).normalize(),C.copy(g),V.copy(g).setComponent(+e+1,0).normalize(),K.crossVectors(q,V).normalize();let et=xe===0,ot=xe===N,ut=et?3*Math.PI/2:$,ne=et?Ee:Ce,oe=et?H:$e,ve=et?0:Le-H,ze=q.clone().multiplyScalar(et?-ae:ae).add(g),rt=q.clone().multiplyScalar(et?-1:1).normalize();for(let Z=0;Z<H;Z++){let ie=Z*G;if(L.addVectors(p.copy(V).multiplyScalar(o*Math.cos(ie)),m.copy(K).multiplyScalar(o*Math.sin(ie))),I.copy(L).normalize(),et||ot){d||(ce=ve+Z,[0,1,2].forEach(de=>{Qe[ce*3+de]=ze.getComponent(de),Xe[ce*3+de]=rt.getComponent(de)}),Re[ce*2]=+ot,Re[ce*2+1]=Z/u),m.copy(I).multiplyScalar(re),v.addVectors(g,m);for(let de=0;de<c;de++){let _e=de*$+ut;k.addVectors(p.copy(q).multiplyScalar(ae*Math.sin(_e)),m.copy(I).multiplyScalar(ae*Math.cos(_e))),z.copy(k).normalize(),m.addVectors(v,k),k.normalize(),ce=oe+de*H+Z,[0,1,2].forEach(ct=>{Qe[ce*3+ct]=m.getComponent(ct),Xe[ce*3+ct]=z.getComponent(ct)});let Ve=+et+Math.sin(_e);Re[ce*2]=(ne+ae*Ve)/he,Re[ce*2+1]=Z/u}}m.addVectors(g,L),ce=Ae+xe*H+Z,[0,1,2].forEach(de=>{Qe[ce*3+de]=m.getComponent(de),Xe[ce*3+de]=I.getComponent(de)}),Re[ce*2]=(U+xe*Y)/he,Re[ce*2+1]=Z/u}}let ke=B+2*c+me,[Ye,De]=[+d,ke-1];for(let xe=Ye;xe<=De-1;xe++){let et=d&&xe===De-1;for(let ot=0;ot<H-1;ot++)y=xe*H+ot,x=y+1,w=(et?ot:y)+H,S=(et?ot+1:x)+H,xe===0?Ie.push(x,S,w):xe===ke-2?Ie.push(y,x,w):Ie.push(y,x,w,x,S,w)}this.setIndex(Ie),this.setAttribute("position",new nt(Qe,3)),this.setAttribute("normal",new nt(Xe,3)),this.setAttribute("uv",new nt(Re,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),r=e.radialSegments+1,i=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,u=t,h=u===t;for(let c=0;c<e.radialSegments;c++)n=u*r+c,s=n+1,a=(h?c:n)+r,o=(h?c+1:s)+r,i[l++]=n,i[l++]=s,i[l++]=a,i[l++]=s,i[l++]=o,i[l++]=a;return i.length=l,QS.array=i,QS.count=i.length,QS}},epe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:i,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new R5(t*.5,s,a):new U4(t*.5,n);return o.scale(1,r/t,i/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},R5=class extends e2{constructor(e=1,t=.2,r=4){let i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,r),this.type=a}static fromJSON(e){return new R5(e.radius,e.corner,e.cornerSides)}},tpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i;(((i=e.parameters)==null?void 0:i.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{points:t,segments:r,verticalSegments:i}=e.parameters,n=new xx;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new I4(n.extractPoints(i).shape,r);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},Ha=new Oe,KS=new dr,Py=new P,$x=class extends Xi{constructor(){super(),this.uuid=zt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new zi().getNormalMatrix(e);for(let r=0,i=this.vertices.length;r<i;r++)this.vertices[r].applyMatrix4(e);for(let r=0,i=this.faces.length;r<i;r++){let n=this.faces[r];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Ha.makeRotationX(e),this.applyMatrix4(Ha),this}rotateY(e){return Ha.makeRotationY(e),this.applyMatrix4(Ha),this}rotateZ(e){return Ha.makeRotationZ(e),this.applyMatrix4(Ha),this}translate(e,t,r){return Ha.makeTranslation(e,t,r),this.applyMatrix4(Ha),this}scale(e,t,r){return Ha.makeScale(e,t,r),this.applyMatrix4(Ha),this}lookAt(e){return KS.lookAt(e),KS.updateMatrix(),this.applyMatrix4(KS.matrix),this}fromBufferGeometry(e){let t=this,r=e.index!==null?e.index:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=i.position,s=i.normal,a=i.color,o=i.uv,l=i.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let c=0;c<n.count;c++)t.vertices.push(new P().fromBufferAttribute(n,c)),a!==void 0&&t.colors.push(new gt().fromBufferAttribute(a,c));function u(c,d,f,p){let m=a===void 0?[]:[t.colors[c].clone(),t.colors[d].clone(),t.colors[f].clone()],g=s===void 0?[]:[new P().fromBufferAttribute(s,c),new P().fromBufferAttribute(s,d),new P().fromBufferAttribute(s,f)],v=new nT(c,d,f,g,m,p);t.faces.push(v),o!==void 0&&t.faceVertexUvs[0].push([new J().fromBufferAttribute(o,c),new J().fromBufferAttribute(o,d),new J().fromBufferAttribute(o,f)]),l!==void 0&&t.faceVertexUvs[1].push([new J().fromBufferAttribute(l,c),new J().fromBufferAttribute(l,d),new J().fromBufferAttribute(l,f)])}let h=e.groups;if(h.length>0)for(let c=0;c<h.length;c++){let d=h[c],f=d.start,p=d.count;for(let m=f,g=f+p;m<g;m+=3)r!==void 0?u(r.getX(m),r.getX(m+1),r.getX(m+2),d.materialIndex):u(m,m+1,m+2,d.materialIndex)}else if(r!==void 0)for(let c=0;c<r.count;c+=3)u(r.getX(c),r.getX(c+1),r.getX(c+2));else for(let c=0;c<n.count;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Py).negate(),this.translate(Py.x,Py.y,Py.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,r=t===0?1:1/t,i=new Oe;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(i),this}computeFaceNormals(){let e=new P,t=new P;for(let r=0,i=this.faces.length;r<i;r++){let n=this.faces[r],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let r=0,i=this.vertices.length;r<i;r++)t[r]=new P;if(e){let r=new P,i=new P;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],u=this.vertices[a.c];r.subVectors(u,l),i.subVectors(o,l),r.cross(i),t[a.a].add(r),t[a.b].add(r),t[a.c].add(r)}}else{this.computeFaceNormals();for(let r=0,i=this.faces.length;r<i;r++){let n=this.faces[r];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let r=0,i=this.vertices.length;r<i;r++)t[r].normalize();for(let r=0,i=this.faces.length;r<i;r++){let n=this.faces[r],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let r=this.faces[e],i=r.vertexNormals;i.length===3?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,r=this.faces.length;t<r;t++){let i=this.faces[t];i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(let n=0,s=i.vertexNormals.length;n<s;n++)i.__originalVertexNormals[n]?i.__originalVertexNormals[n].copy(i.vertexNormals[n]):i.__originalVertexNormals[n]=i.vertexNormals[n].clone()}let e=new $x;e.faces=this.faces;for(let t=0,r=this.morphTargets.length;t<r;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new P,u={a:new P,b:new P,c:new P};n.push(l),s.push(u)}}let i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=i.faceNormals[n],l=i.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,r=this.faces.length;t<r;t++){let i=this.faces[t];i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ai),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ys),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,r=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let i,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,u=this.colors,h=e.colors;t!==void 0&&(i=new zi().getNormalMatrix(t));for(let c=0,d=a.length;c<d;c++){let f=a[c].clone();t!==void 0&&f.applyMatrix4(t),s.push(f)}for(let c=0,d=h.length;c<d;c++)u.push(h[c].clone());for(let c=0,d=l.length;c<d;c++){let f=l[c],p,m,g=f.vertexNormals,v=f.vertexColors,y=new nT(f.a+n,f.b+n,f.c+n);y.normal.copy(f.normal),i!==void 0&&y.normal.applyMatrix3(i).normalize();for(let x=0,w=g.length;x<w;x++)p=g[x].clone(),i!==void 0&&p.applyMatrix3(i).normalize(),y.vertexNormals.push(p);y.color.copy(f.color);for(let x=0,w=v.length;x<w;x++)m=v[x],y.vertexColors.push(m.clone());y.materialIndex=f.materialIndex+r,o.push(y)}for(let c=0,d=e.faceVertexUvs.length;c<d;c++){let f=e.faceVertexUvs[c];this.faceVertexUvs[c]===void 0&&(this.faceVertexUvs[c]=[]);for(let p=0,m=f.length;p<m;p++){let g=f[p],v=[];for(let y=0,x=g.length;y<x;y++)v.push(g[y].clone());this.faceVertexUvs[c].push(v)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},r=[],i=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let u=this.vertices[o],h=Math.round(u.x*n)+"_"+Math.round(u.y*n)+"_"+Math.round(u.z*n);t[h]===void 0?(t[h]=o,r.push(this.vertices[o]),i[o]=r.length-1):i[o]=i[t[h]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let u=this.faces[o];u.a=i[u.a],u.b=i[u.b],u.c=i[u.c];let h=[u.a,u.b,u.c];for(let c=0;c<3;c++)if(h[c]===h[(c+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let u=0,h=this.faceVertexUvs.length;u<h;u++)this.faceVertexUvs[u].splice(l,1)}let a=this.vertices.length-r.length;return this.vertices=r,a}setFromPoints(e){this.vertices=[];for(let t=0,r=e.length;t<r;t++){let i=e[t];this.vertices.push(new P(i.x,i.y,i.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function r(o,l){return o.materialIndex-l.materialIndex}e.sort(r);let i=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;i&&i.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(i[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let f=this.parameters;for(let p in f)f[p]!==void 0&&(e[p]=f[p]);return e}let t=[];for(let f=0;f<this.vertices.length;f++){let p=this.vertices[f];t.push(p.x,p.y,p.z)}let r=[],i=[],n={},s=[],a={},o=[],l={};for(let f=0;f<this.faces.length;f++){let p=this.faces[f],m=!0,g=!1,v=this.faceVertexUvs[0][f]!==void 0,y=p.normal.length()>0,x=p.vertexNormals.length>0,w=p.color.r!==1||p.color.g!==1||p.color.b!==1,S=p.vertexColors.length>0,_=0;if(_=u(_,0,0),_=u(_,1,m),_=u(_,2,g),_=u(_,3,v),_=u(_,4,y),_=u(_,5,x),_=u(_,6,w),_=u(_,7,S),r.push(_),r.push(p.a,p.b,p.c),r.push(p.materialIndex),v){let A=this.faceVertexUvs[0][f];r.push(d(A[0]),d(A[1]),d(A[2]))}if(y&&r.push(h(p.normal)),x){let A=p.vertexNormals;r.push(h(A[0]),h(A[1]),h(A[2]))}if(w&&r.push(c(p.color)),S){let A=p.vertexColors;r.push(c(A[0]),c(A[1]),c(A[2]))}}function u(f,p,m){return m?f|1<<p:f&~(1<<p)}function h(f){let p=f.x.toString()+f.y.toString()+f.z.toString();return n[p]!==void 0||(n[p]=i.length/3,i.push(f.x,f.y,f.z)),n[p]}function c(f){let p=f.r.toString()+f.g.toString()+f.b.toString();return a[p]!==void 0||(a[p]=s.length,s.push(f.getHex())),a[p]}function d(f){let p=f.x.toString()+f.y.toString();return l[p]!==void 0||(l[p]=o.length/2,o.push(f.x,f.y)),l[p]}return e.data={},e.data.vertices=t,e.data.normals=i,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=r,e}clone(){return new $x().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let c=0,d=t.length;c<d;c++)this.vertices.push(t[c].clone());let r=e.colors;for(let c=0,d=r.length;c<d;c++)this.colors.push(r[c].clone());let i=e.faces;for(let c=0,d=i.length;c<d;c++)this.faces.push(i[c].clone());for(let c=0,d=e.faceVertexUvs.length;c<d;c++){let f=e.faceVertexUvs[c];this.faceVertexUvs[c]===void 0&&(this.faceVertexUvs[c]=[]);for(let p=0,m=f.length;p<m;p++){let g=f[p],v=[];for(let y=0,x=g.length;y<x;y++){let w=g[y];v.push(w.clone())}this.faceVertexUvs[c].push(v)}}let n=e.morphTargets;for(let c=0,d=n.length;c<d;c++){let f={};if(f.name=n[c].name,n[c].vertices!==void 0){f.vertices=[];for(let p=0,m=n[c].vertices.length;p<m;p++)f.vertices.push(n[c].vertices[p].clone())}if(n[c].normals!==void 0){f.normals=[];for(let p=0,m=n[c].normals.length;p<m;p++)f.normals.push(n[c].normals[p].clone())}this.morphTargets.push(f)}let s=e.morphNormals;for(let c=0,d=s.length;c<d;c++){let f={};if(s[c].vertexNormals!==void 0){f.vertexNormals=[];for(let p=0,m=s[c].vertexNormals.length;p<m;p++){let g=s[c].vertexNormals[p],v={};v.a=g.a.clone(),v.b=g.b.clone(),v.c=g.c.clone(),f.vertexNormals.push(v)}}if(s[c].faceNormals!==void 0){f.faceNormals=[];for(let p=0,m=s[c].faceNormals.length;p<m;p++)f.faceNormals.push(s[c].faceNormals[p].clone())}this.morphNormals.push(f)}let a=e.skinWeights;for(let c=0,d=a.length;c<d;c++)this.skinWeights.push(a[c].clone());let o=e.skinIndices;for(let c=0,d=o.length;c<d;c++)this.skinIndices.push(o[c].clone());let l=e.lineDistances;for(let c=0,d=l.length;c<d;c++)this.lineDistances.push(l[c]);let u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());let h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new rpe().fromGeometry(this),t=new _t,r=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",Oy.call(new Mt(r,3),e.vertices)),e.normals.length>0){let i=new Float32Array(e.normals.length*3);t.setAttribute("normal",Oy.call(new Mt(i,3),e.normals))}if(e.colors.length>0){let i=new Float32Array(e.colors.length*3);t.setAttribute("color",wk.call(new Mt(i,3),e.colors))}if(e.uvs.length>0){let i=new Float32Array(e.uvs.length*2);t.setAttribute("uv",bk.call(new Mt(i,2),e.uvs))}if(e.uvs2.length>0){let i=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",bk.call(new Mt(i,2),e.uvs2))}t.groups=e.groups;for(let i in e.morphTargets){let n=[],s=e.morphTargets[i];for(let a=0,o=s.length;a<o;a++){let l=s[a],u=new nt(l.data.length*3,3);u.name=l.name,n.push(Oy.call(u,l.data))}t.morphAttributes[i]=n}if(e.skinIndices.length>0){let i=new nt(e.skinIndices.length*4,4);t.setAttribute("skinIndex",_k.call(i,e.skinIndices))}if(e.skinWeights.length>0){let i=new nt(e.skinWeights.length*4,4);t.setAttribute("skinWeight",_k.call(i,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new _t,r=e.geometry;if(e.isPoints||e.isLine){let i=new nt(r.vertices.length*3,3),n=new nt(r.colors.length*3,3);if(t.setAttribute("position",Oy.call(i,r.vertices)),t.setAttribute("color",wk.call(n,r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){let s=new nt(r.lineDistances.length,1);t.setAttribute("lineDistance",ipe.call(s,r.lineDistances))}r.boundingSphere!==null&&(t.boundingSphere=r.boundingSphere.clone()),r.boundingBox!==null&&(t.boundingBox=r.boundingBox.clone())}else e.isMesh&&(t=r.toBufferGeometry());return t}};$x.prototype.isGeometry=!0;var rpe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],r,i,n,s=e.faces;for(i=0;i<s.length;i++){let a=s[i];a.materialIndex!==n&&(n=a.materialIndex,r!==void 0&&(r.count=i*3-r.start,t.push(r)),r={start:i*3,materialIndex:n})}r!==void 0&&(r.count=i*3-r.start,t.push(r)),this.groups=t}fromGeometry(e){let t=e.faces,r=e.vertices,i=e.faceVertexUvs,n=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:a[g].name,data:[]};this.morphTargets.position=l}let u=e.morphNormals,h=u.length,c;if(h>0){c=[];for(let g=0;g<h;g++)c[g]={name:u[g].name,data:[]};this.morphTargets.normal=c}let d=e.skinIndices,f=e.skinWeights,p=d.length===r.length,m=f.length===r.length;r.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let v=t[g];this.vertices.push(r[v.a],r[v.b],r[v.c]);let y=v.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let w=v.normal;this.normals.push(w,w,w)}let x=v.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let w=v.color;this.colors.push(w,w,w)}if(n===!0){let w=i[0][g];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new J,new J,new J))}if(s===!0){let w=i[1][g];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new J,new J,new J))}for(let w=0;w<o;w++){let S=a[w].vertices;l[w].data.push(S[v.a],S[v.b],S[v.c])}for(let w=0;w<h;w++){let S=u[w].vertexNormals[g];c[w].data.push(S.a,S.b,S.c)}p&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),m&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},nT=class{constructor(e,t,r,i,n,s=0){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new P,this.vertexNormals=Array.isArray(i)?i:[],this.color=n&&n.isColor?n:new gt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function ipe(e){return this.array.set(e),this}function wk(e){let t=this.array,r=0;for(let i=0,n=e.length;i<n;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new gt),t[r++]=s.r,t[r++]=s.g,t[r++]=s.b}return this}function bk(e){let t=this.array,r=0;for(let i=0,n=e.length;i<n;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new J),t[r++]=s.x,t[r++]=s.y}return this}function Oy(e){let t=this.array,r=0;for(let i=0,n=e.length;i<n;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new P),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z}return this}function _k(e){let t=this.array,r=0;for(let i=0,n=e.length;i<n;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new Lt),t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=s.w}return this}var npe=["a","b","c"];function spe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function ZS(e,t,r){let i=Math.min(e,t),n=Math.max(e,t),s=i+"_"+n;return r.get(s)}function JS(e,t,r,i,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,u;if(i.has(l))u=i.get(l);else{let h=r[a],c=r[o];u={a:h,b:c,newEdge:null,faces:[]},i.set(l,u)}u.faces.push(n),s[e].edges.push(u),s[t].edges.push(u)}function ape(e,t,r,i){let n,s,a;for(n=0,s=e.length;n<s;n++)r[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],JS(a.a,a.b,e,i,a,r),JS(a.b,a.c,e,i,a,r),JS(a.c,a.a,e,i,a,r)}function Ly(e,t,r,i,n){e.push(new nT(t,r,i,void 0,void 0,n))}function md(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function Iy(e,t,r,i){e.push([t.clone(),r.clone(),i.clone()])}var ope=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof _t?e=new $x().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new P,r,i,n,s,a,o=e.vertices,l=e.faces,u=e.faceVertexUvs[0],h=u!==void 0&&u.length>0,c=[],d=new Map;ape(o,l,c,d);let f=[],p,m,g,v,y,x,w;for(let se of Array.from(d.keys())){for(m=d.get(se),g=new P,y=3/8,x=1/8,w=m.faces.length,w!=2&&(y=.5,x=0,w!=1),g.addVectors(m.a,m.b).multiplyScalar(y),t.set(0,0,0),s=0;s<w;s++){for(v=m.faces[s],a=0;a<3&&(p=o[spe(v,npe[a])],!(p!==m.a&&p!==m.b));a++);p&&t.add(p)}t.multiplyScalar(x),g.add(t),m.newEdge=f.length,f.push(g)}let S,_,A,M,T,C,L,I=[];for(i=0,n=o.length;i<n;i++){for(C=o[i],T=c[i].edges,r=T.length,r==3?S=3/16:r>3&&(S=3/(8*r)),_=1-r*Number(S),A=S,r<=2&&(r==2?(_=3/4,A=1/8):r==1||r==0),L=C.clone().multiplyScalar(_),t.set(0,0,0),s=0;s<r;s++)M=T[s],p=M.a!==C?M.a:M.b,t.add(p);t.multiplyScalar(Number(A)),L.add(t),I.push(L)}let k=I.concat(f),z=I.length,V,K,q,O=[],W=[],N,B,j,Q,H=new J,G=new J,$=new J;for(i=0,n=l.length;i<n;i++)v=l[i],V=Number(ZS(v.a,v.b,d).newEdge)+z,K=Number(ZS(v.b,v.c,d).newEdge)+z,q=Number(ZS(v.c,v.a,d).newEdge)+z,Ly(O,V,K,q,v.materialIndex),Ly(O,v.a,V,q,v.materialIndex),Ly(O,v.b,K,V,v.materialIndex),Ly(O,v.c,q,K,v.materialIndex),h&&(N=u[i],B=N[0],j=N[1],Q=N[2],H.set(md(B.x,j.x),md(B.y,j.y)),G.set(md(j.x,Q.x),md(j.y,Q.y)),$.set(md(B.x,Q.x),md(B.y,Q.y)),Iy(W,H,G,$),Iy(W,B,H,$),Iy(W,j,G,H),Iy(W,Q,$,G));e.vertices=k,e.faces=O,h&&(e.faceVertexUvs[0]=W)}},vi=new P,lpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=e.geometry??(t==null?void 0:t.geometry)??new _t().copy(new xo(100,100,100)),i;t===void 0?(r.computeBoundingBox(),r.boundingBox.getSize(vi),i={width:vi.x,height:vi.y,depth:vi.z,subdivisions:0}):i=t.parameters;let n={...i,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:r}}static build(e){let{width:t,height:r,depth:i,subdivisions:n}=e.parameters,s=e.geometry??new _t().copy(new xo(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(vi)):vi.set(a.width,a.height,a.depth),(t!==vi.x||r!==vi.y||i!==vi.z)&&s.scale(vi.x===0?1:t/vi.x,vi.y===0?1:r/vi.y,vi.z===0?1:i/vi.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new ope(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,r){new q4(r).load(e,i=>{let n=this.normalizeInputs({geometry:i});i.boundingBox.getSize(vi);let s=100/vi.x;Object.assign(n.parameters,{width:100,height:vi.y*s,depth:vi.z*s}),t(this.build(n))})}},k5=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r,spikes:i,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,u=t*.5,h=r*.5,c=0,d=0,f=2*Math.PI/i;for(let m=0;m<i;m++){let g=f*m,v=c+Math.sin(g)*u,y=d+Math.cos(g)*h;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let m=0,g=l.points.length;m<g;m++)l.points[m].roundness=n;l.roundness=n,l.update();let p=kh.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(p,{userData:{...e,type:"PolygonGeometry"}})}},upe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:i,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,u=new hpe(t*.5,r,n,s,a,o,l);return u.scale(1,1,i/t),Object.assign(u,{userData:{...e,type:"PyramidGeometry"}})}};function xm(e,t,r){r.x=e.x*t.x,r.y=e.y,r.z=e.x*t.y}function eM(e,t,r,i,n,s){let a=t.clone().sub(e),o=r.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),i===n){let u=a.add(o).normalize();s.copy(e).addScaledVector(u,i/Math.sin(l/2))}else{let u=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(u)),s.addScaledVector(o,i/Math.sin(u))}}function cpe(e,t,r){let i=e.clone().sub(t),n=r.clone().sub(t);return i.projectOnVector(n),i.add(t)}var hpe=class extends _t{constructor(e=.5,t=1,r=4,i=1,n=!1,s=0,a=4){super(),r=Math.floor(Math.max(3,r)),i=Math.floor(i),a=Math.floor(a);let o=[],l=[],u=[],h=[],c=0,d=t/2,f=Math.PI/r,p=e*Math.cos(Math.PI/r),m=2*Math.PI/r,g=(r-2)*Math.PI/r,v=Math.PI-g,y=new P(0,-d,0),x=new P(0,d,0),w=new J(e,-d),S=new J(p,-d),_=new J(0,x.y).sub(S),A=new J(0,x.y).sub(w),M=new J(_.y,-_.x).normalize(),T=new J(A.y,-A.x).normalize(),C=e*Math.cos(Math.PI/r)*Math.tan((Math.PI-_.angle())/2)-1e-8;s=Math.min(s,C);let L;{let q=new P(M.x,M.y,0),O=new P(Math.cos(m)*q.x,q.y,Math.sin(m)*q.x);L=q.angleTo(O)}let I=s/Math.tan((Math.PI-_.angle())/2),k=s/Math.tan((Math.PI-L)/2),z=new P;if(!n){l.push(y.x,y.y,y.z),u.push(0,-1,0),h.push(0,0);let q=c++,O=[],W=w.clone(),N=I/Math.cos(Math.PI/r);W.x-=N;for(let B=0;B<r;B++){let j=B/r*Math.PI*2+f,Q=new J(Math.sin(j),Math.cos(j));xm(W,Q,z),l.push(z.x,z.y,z.z),u.push(0,-1,0),h.push(0,0),O.push(c++)}for(let B=0;B<O.length;B++)o.push(O[B],q,O[(B+1)%O.length])}{let q=new P,O=new P,W=new P,N=new P,B=new P,j=new P;for(let Q=0;Q<r;Q++){let H=Q/r*Math.PI*2+f,G=(Q+.5)/r*Math.PI*2+f,$=(Q+1)/r*Math.PI*2+f,se=new J(Math.sin(H),Math.cos(H)),re=new J(Math.sin(G),Math.cos(G)),ae=new J(Math.sin($),Math.cos($));xm(w,se,O),xm(w,ae,W),xm(M,re,q),eM(x,O,W,k,k,N),l.push(N.x,N.y,N.z),eM(O,x,W,k,I,B),l.push(B.x,B.y,B.z),eM(W,O,x,I,k,j),l.push(j.x,j.y,j.z),u.push(q.x,q.y,q.z),u.push(q.x,q.y,q.z),u.push(q.x,q.y,q.z),h.push(0,0),h.push(0,0),h.push(0,0);let ce=c++,me=c++,be=c++;if(o.push(ce,me,be),s>0){{let Le=O.clone().add(W).multiplyScalar(.5),Qe=x.clone().sub(Le).normalize(),Xe=y.clone().sub(Le).normalize().add(Qe).normalize().multiplyScalar(-1),Re=j.clone().sub(B);V(Le,Re,Xe,_.angle())}let Ae,$e;{let Le=new P;xm(T,ae,Le);let Qe=j.clone().add(N).multiplyScalar(.5);Qe=cpe(Qe,W,x);let Xe=j.clone().sub(N);[Ae,$e]=V(Qe,Xe,Le,L,N.y)}{let Le=Ae,Qe=Le.clone().setY(0).normalize(),Xe=new P(0,-1,0),Re=Qe.clone().cross(Xe);K(Le,Qe,Xe,Re)}{let Le=_.angle(),Qe=Math.PI-Le,Xe=x.clone();Xe.y-=s/Math.sin(Le-Math.PI/2);let Re=new P,Ie=[];for(let He=0;He<a;He++){let Y=[],U=Math.PI/2-Qe*He/a,he=Math.cos(U),Ee=Math.sin(U),Ce=G;for(let ke=0;ke<=He;ke++){let Ye=Math.cos(Ce),De=Math.sin(Ce);q.x=he*De,q.y=Ee,q.z=he*Ye,Re.copy(Xe).addScaledVector(q,s),l.push(Re.x,Re.y,Re.z),u.push(q.x,q.y,q.z),h.push(0,0),Y.push(c++),Ce+=Math.PI*2/He/r}Ie.push(Y)}$e.reverse(),Ie.push($e);let Ge=Ie.length-1;for(let He=0;He<Ge;He++){let Y=Ie[He],U=Ie[He+1],he=Y.length-1;o.push(U[1],Y[0],U[0]);for(let Ee=1;Ee<=he;Ee++)o.push(Y[Ee],Y[Ee-1],U[Ee]),o.push(U[Ee+1],Y[Ee],U[Ee])}}}}}this.setIndex(o),this.setAttribute("position",new nt(l,3)),this.setAttribute("normal",new nt(u,3)),this.setAttribute("uv",new nt(h,2));function V(q,O,W,N,B){let j=-N/2,Q=(Math.PI-N)/2,H=O.clone().normalize().cross(W);q.addScaledVector(W,-s/Math.sin(Q));let G=new P,$=new P,se=1,re=c,ae=[];for(let ce=0;ce<=a;ce++){let me=j+ce/a*N;$.set(0,0,0),$.addScaledVector(H,Math.sin(me)),$.addScaledVector(W,Math.cos(me));for(let be=0;be<=se;be++){let Ae=be/se-.5;if(G.copy(q),G.addScaledVector(O,Ae),G.addScaledVector($,s),B!=null){let $e=Math.max(0,G.y-B);G.addScaledVector(O,-$e/O.y)}l.push(G.x,G.y,G.z),u.push($.x,$.y,$.z),h.push(0,0),be===0&&ae.push(c),c++}}for(let ce=0;ce<a;ce++)for(let me=0;me<se;me++){let be=re+me+(se+1)*ce,Ae=be+(se+1),$e=Ae+1,Le=be+1;o.push(be,Ae,Le),o.push(Ae,$e,Le)}return[q.clone().addScaledVector(O,.5),ae]}function K(q,O,W,N){let B=Math.PI/2,j=A.angle()-B,Q=[],H=new P,G=new P;for(let se=0;se<=a;se++){let re=[],ae=se/a;for(let ce=0;ce<=se;ce++){let me=((se?ce/se:0)-.5)*v,be=Math.cos(me),Ae=Math.sin(me),$e=Math.atan(Math.tan(j)*be),Le=(B+$e)*ae,Qe=Math.cos(Le),Xe=Math.sin(Le);H.set(0,0,0),H.addScaledVector(O,Xe*be),H.addScaledVector(W,Qe),H.addScaledVector(N,Xe*Ae),G.copy(q).addScaledVector(H,s),l.push(G.x,G.y,G.z),u.push(H.x,H.y,H.z),h.push(0,0),re.push(c++)}Q.push(re)}let $=Q.length-1;for(let se=0;se<$;se++){let re=Q[se],ae=Q[se+1],ce=re.length-1;o.push(re[0],ae[1],ae[0]);for(let me=1;me<=ce;me++)o.push(re[me-1],re[me],ae[me]),o.push(re[me],ae[me+1],ae[me])}}}},z5=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),i=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)}),ui:i}}static build(e){let t=e.shape,{width:r,height:i,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,u={x:r*.5,y:i*.5},h={x:-u.x,y:-u.y},c={x:u.x,y:u.y};function d(w,S,_){return S>r&&_>i?Math.min(w*r/S,w*i/_):S>r?w*r/S:_>i?w*i/_:w}let f=[];f[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),f[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),f[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),f[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let p=h.x,m=c.x,g=c.y,v=h.y;t.addPoint(t.createPoint(p,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(p,v)),t.isClosed=!0;let y=!0;for(let w=0,S=t.points.length;w<S;w++)t.points[w].roundness=f[w],w>0&&f[w]!==f[w-1]&&(y=!1);y&&(t.roundness=f[0]),t.useCubicForRoundedCorners=s!==1,t.update();let x=kh.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...e,type:"RectangleGeometry"}})}},dpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t=100,height:r=t,depth:i=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:u}=e.parameters,h=new vD(.5*t,n,s,a,o,l,u);return h.scale(1,r/t,i/t),Object.assign(h,{userData:{...e,type:"SphereGeometry"}})}},fpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:0})}}static build(e){let{width:t=100,height:r=t,widthSegments:i=8,heightSegments:n=8}=e.parameters,s=new qw(t,r,i,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},ppe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:t,height:r,depth:i,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new mpe(t,r,i,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},mpe=class extends _t{constructor(e=1,t=1,r=1,i=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],u=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),i=Math.min(180-u,i),i*=Math.PI/180;let h=[],c=Math.PI/2,d=(se=0,re=0,ae=0)=>new P(se,re,ae),f=d(),p=d(),[m,g,v]=[t/2,e/2,r/2],y=-g,x=+g,[w,S,_]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],A=(se,re=!1)=>Math.sin(se-Math.PI/(1+ +re)),M=(se,re=!1)=>Math.cos(se-Math.PI/(1+ +re));_.y=Math.sin(i)*t-m;let T=Math.cos(i)*t-v,C=w.z-u;i<=c?(_.z=Math.min(T,C),_.z==C&&(_.y-=(T-C)/Math.tan(c-i))):S.z=Math.min(S.z-T-v,w.z-u),f.subVectors(w,S),p.subVectors(_,S);let L=Math.min(f.length(),p.length())*n/100,I=L*Math.tan(i/2),k=L/Math.cos(i/2),z=f.clone().normalize().add(p.normalize()).setLength(k).add(S);f.set(0,A(i,!0),M(i,!0)),h.push([_,f.clone()]);let V=(Math.PI-i)/s;for(let se=0;se<=s;se++){let re=c+i+se*V;f.set(0,Math.sin(re)*I,Math.cos(re)*I),f.add(z),p.set(0,A(re),M(re)),h.push([f.clone(),p.clone()])}h.push([w,d(0,1,0)]);let K=Math.sin(V/2)*I*2,q=h.length-1,O=h[0][0].distanceTo(h[1][0]),W=h[q-1][0].distanceTo(h[q][0]),N=O+K*s+W;h[0].push(1);for(let se=0;se<=s;se++)h[se+1].push(1-(O+se*K)/N);h[q].push(0);let[B,j,Q]=h[0],H,G,$;for(let se=1;se<h.length;se++)[H,G,$]=h[se],a.push(y,B.y,B.z,y,H.y,H.z,x,B.y,B.z,x,B.y,B.z,y,H.y,H.z,x,H.y,H.z),o.push(0,j.y,j.z,0,G.y,G.z,0,j.y,j.z,0,j.y,j.z,0,G.y,G.z,0,G.y,G.z),l.push(0,Q,0,$,1,Q,1,Q,0,$,1,$),[B,j,Q]=[H,G,$];this.setAttribute("position",new nt(a,3)),this.setAttribute("normal",new nt(o,3)),this.setAttribute("uv",new nt(l,2))}},N5=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r,innerRadiusPercent:i,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:u}=e.parameters,h=e.shape,c=t*.5,d=r*.5,f=0,p=0,m=a*Math.PI/360/n,g=Math.PI/2*3*-1,v=c*i/100,y=d*i/100;if(n===3&&i===50){m=2*Math.PI/n;for(let w=0;w<n;w++){let S=m*w,_=f+Math.sin(S)*c,A=p+Math.cos(S)*d;h.addPoint(h.createPoint(_,A))}}else for(let w=0;w<n;w++){let S=f+Math.cos(g)*c,_=p+Math.sin(g)*d;h.addPoint(h.createPoint(S,_)),g+=m,S=f+Math.cos(g)*v,_=p+Math.sin(g)*y,h.addPoint(h.createPoint(S,_)),g+=m}h.isClosed=!0;for(let w=0,S=h.points.length;w<S;w++)h.points[w].roundness=s;h.roundness=s,h.update();let x=kh.create({shape:h,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:u}});return Object.assign(x,{userData:{...e,type:"StarGeometry"}})}},gpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t,height:r}=e.parameters,i=new qw(t,r);return Object.assign(i,{userData:{...e,type:"TextFrameGeometry"}})}},vpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:Math.PI*2,cornerRadius:30,cornerSegments:8},e.parameters),i=Math.abs(r.width),n=Math.abs(r.height??r.width),s=Math.round(Math.abs(r.depth??r.width*.25));return{parameters:Object.assign(r,{width:i,height:n,depth:s})}}static build(e){let{width:t,height:r,depth:i,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,u=ype(t,r,i,t*.5,a,s,0,0,n,o,l);return u.scale(1,r/t,1),Object.assign(u,{userData:{...e,type:"TorusGeometry"}})}};function ype(e,t,r,i,n,s,a,o,l,u,h){return[t,r]=[r,t],a=t/2,n/=2*Math.PI,n==1&&(u=0),new I5(!0,e,t,r,i,n,s,a,o,l,u,h)}var xpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),tube:r.tube??r.width*.125})}}static build(e){let{width:t,tube:r,tubularSegments:i,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==r&&(o-=r);let l=new j4(o,r,i,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},wpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof $r?e.shape:new $r,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width*(r.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(r.depth??0)})}}static build(e){let{width:t=100,height:r,cornerRadius:i,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,u=t*.5,h=r*.5;o?(l.addPoint(l.createPoint(-u,h)),l.addPoint(l.createPoint(u,-h)),l.addPoint(l.createPoint(-u,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(u,-h)),l.addPoint(l.createPoint(-u,-h))),l.isClosed=!0;for(let d=0,f=l.points.length;d<f;d++)l.points[d].roundness=i;l.roundness=i,l.update();let c=kh.create({shape:l,parameters:{roundness:i,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(c,{userData:{...e,type:"TriangleGeometry"}})}};function bpe(e,t){let r=2*Math.PI;return(e%r+r)%r===(t%r+r)%r}var _pe=new Oe,Spe=new Oe;function Mpe(e,t,r){let i=[new P,new P,new P],n=[new P,new P,new P];return e.extractBasis(i[0],i[1],i[2]),t.extractBasis(n[0],n[1],n[2]),i.forEach((s,a)=>{let o=n[a],l=zt.lerp(s.length(),o.length(),r);s.lerp(o,r).setLength(l)}),new Oe().makeBasis(i[0],i[1],i[2])}var Epe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let r=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),i=Math.abs(r.width),n=Math.abs(r.height??r.width),s=Math.abs(r.depth??0),a=(t==null?void 0:t.shapeData)??s2.create({parameters:c5}).userData.shape;return{path:e.path??Ux.defaultData(),parameters:Object.assign(r,{width:i,height:n,depth:s,extrusion:{...h5,...r.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new Ape(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new _t,{userData:{...e,type:"PathGeometry"}})}},Ape=class extends _t{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!bpe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:r,offset:i}=this.inputs.parameters.extrusion,n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(i*n),a=this.inputs.path.isClosed?Math.ceil((r+i)*n):Math.ceil(Math.min(1,r+i)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],u=[];for(let q=0;q<o;q++){let O=this.inputs.path.isClosed?(q+s)%e.length:Math.min(q+s,e.length-1);l.push(e[O].clone()),u.push(t[O].clone())}let h=(q,O,W)=>{l[q]=l[q].clone().lerp(l[O],W),u[q]=Mpe(u[q],u[O],W)},c=0,d=i*n%1;(!this.inputs.path.isClosed||r<=1)&&(d||i===0)&&(c=d,h(0,1,c));let f=0,p=(i+r)*n%1;if((this.inputs.path.isClosed&&r<=1||!this.inputs.path.isClosed&&i+r<1)&&p&&(f=p,h(l.length-1,l.length-2,1-f)),r===0){let q=l.length-1;l[q].copy(l[0]),u[q].copy(u[0])}this._applyPathModifiers(u,c,f);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(y=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:x,infos:w,vertices:S}=this._computeShapePoints(y),_=0,A;v==="round"&&(A=new n2(this.inputs.shapeData,2*m,m,y,g,void 0,!0),_=A.getAttribute("position").count);let M=0,T=0;w.sort((q,O)=>q.start-O.start),w.forEach(q=>{q.verticesStart=M,q.verticesCount=q.continuous.reduce((O,W,N)=>O+(N===0||!W?2:1),0),T+=q.verticesCount,M=T});let C=T*o,L,I=0;if(this._isOpenEnded()&&v==="flat"){try{L=Ru({windingRule:ur.ODD,elementType:fi.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{L=A5}I=L.vertexCount}let k=C+2*I+_*2,z=C+2*I,V={positions:new Float32Array(k*3),normals:new Float32Array(k*3),uvs:new Float32Array(k*2)},K=[];if(w.forEach(q=>{this._extrudeRegion(q,S,u,l,V,K,this._isGeometryClosed()&&!this._isOpenEnded())}),L&&(this._closeEnd(L,C,K,V,u[0],l[0],!1),this._closeEnd(L,C+I,K,V,u[u.length-1],l[l.length-1],!0)),A){V.positions.set(A.getAttribute("position").array,z*3),V.normals.set(A.getAttribute("normal").array,z*3),V.uvs.set(A.getAttribute("uv").array,z*2);let q=K.length;K.push(...A.getIndex().array.map(N=>N+z)),z+=_,V.positions.set(A.getAttribute("position").array,z*3),V.normals.set(A.getAttribute("normal").array,z*3),V.uvs.set(A.getAttribute("uv").array,z*2);let O=K.length;K.push(...A.getIndex().array.map(N=>N+z)),this.setAttribute("position",new Mt(V.positions,3)),this.setAttribute("normal",new Mt(V.normals,3)),this.setAttribute("uv",new Mt(V.uvs,2)),this.setIndex(K);let W=_pe;W.copy(u[u.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(W,z,k),W.copy(u[0]).setPosition(l[0]).multiply(Spe.makeScale(1,1,-1)),this.applyMatrix4OnRange(W,z-_,z),this.reverseIndicesOnRange(q,O)}else this.setAttribute("position",new Mt(V.positions,3)),this.setAttribute("normal",new Mt(V.normals,3)),this.setAttribute("uv",new Mt(V.uvs,2)),this.setIndex(K)}_extractPathPoints(){let e=v5(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(r=>{t[t.length-1].distanceToSquared(r)>.001&&t.push(r)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],r=e.length,i=this.inputs.path.isClosed,n=new P,s=new P,a=new P,o=new P,l=new P(0,1,0);for(let p=0;p<r;p++){let m=e[p],g;p===0?g=i?e[e.length-2]:m.clone().multiplyScalar(2).sub(e[1]):g=e[p-1];let v;p===r-1?v=i?e[1]:m.clone().multiplyScalar(2).sub(e[p-1]):v=e[p+1];let y=m.clone().sub(g).normalize(),x=v.clone().sub(m).normalize(),w=y.clone().add(x).normalize();a.copy(w),p===0&&(w.equals(l)||w.clone().negate().equals(l))&&l.set(0,0,1);let S=l.clone().cross(w).normalize(),_=w.clone().cross(S).normalize();l.copy(_),o.copy(S),p===0&&(n.copy(_),s.copy(w));let A=new Oe().makeBasis(S,_,w);t.push(A)}let u=i?s:a,h=i?n:new P(0,1,0),c=u.clone().cross(o).normalize(),d=Math.acos(h.dot(c));if(isNaN(d))return t;let f=h.clone().cross(c);u.dot(f)>0&&(d*=-1);for(let p=1;p<t.length;p++){let m=new Oe().makeRotationZ(d*p/t.length);t[p].multiply(m)}return t}_applyPathModifiers(e,t,r){let i=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new Oe,u=new Oe;return e.forEach((h,c)=>{let d=c===0?0:c===i-1?1:(c-t)/(i-(r===0?0:1)-(t+(1-r)));l.makeRotationZ(zt.lerp(n,n+s,d));let f=zt.lerp(a,o,d);u.makeScale(f,f,f),h.multiply(l).multiply(u)}),e}_computeShapePoints(e=12,t=ur.ODD){let r=this.inputs.shapeData,i=r.extractShapePointsToFlatArray([],e),n=r.shapeHoles.map(u=>{let h=u.extractShapePointsToFlatArray([],e),c=[];for(let d=h.length-1;d>=1;d-=2){let f=h[d-1],p=h[d-0];c.push(f,p)}return c}),s;try{s=Ru({windingRule:t,elementType:fi.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[i]})}catch{s=i2}let a;try{a=Ru({windingRule:ur.ODD,elementType:fi.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=E5}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let u=0;u<a.elements.length;u++){let h=a.elements[u],c=u%2===0?s.vertexCount:0;s.elements.push(h+c)}for(let u=0;u<a.vertexIndices.length;u++){let h=a.vertexIndices[u],c=s.vertexCount;s.vertexIndices.push(h+c)}for(let u=0;u<a.vertices.length;u++){let h=a.vertices[u];s.vertices.push(h)}}for(let u=0,h=s.vertexCount;u<h;u++){let c=u*2;s.vertices[c+0],s.vertices[c+1]}let l=[];for(let u=s.elementCount-1;u>=0;u--){let h=u>=o,c=u*2,d=s.elements[c+0],f=s.elements[c+1],p=d+f,m={start:d,count:f,normals:[],isHole:h,continuous:[],verticesStart:0,verticesCount:0};l.push(m);let g=d,v=p-1,y=d+1,x=r.roundedCurves.length;do{let w=g-d;s.vertices[v*2+0],s.vertices[v*2+1];let S=s.vertices[g*2+0],_=s.vertices[g*2+1],A=s.vertices[y*2+0],M=s.vertices[y*2+1],T=S-A,C=_-M,L=Math.sqrt(T*T+C*C);T/=L,C/=L,m.normals[w*2+0]=-C,m.normals[w*2+1]=T;let I=s.vertexIndices[g];if(Array.isArray(I))m.continuous[w]=!1;else{let[k,z]=r.getCurveIndexFromVertexId(I-1,!0);if(z>0&&z<1)m.continuous[w]=!0;else{let V=z===1?k+1:k-1;V=(V+x)%x;let K=z===1?0:1,q=r.roundedCurves[k].getTangent(z),O=r.roundedCurves[V].getTangent(K);m.continuous[w]=q.dot(O)>.95}}h&&(m.normals[w*2+0]*=-1,m.normals[w*2+1]*=-1),[v,g,y]=[g,y,y+1],y>=p&&(y-=f)}while(y!==d+1)}return{regions:[i,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,r,i,n){let s=t*2,a=t*3;e.positions[a+0]=r.x,e.positions[a+1]=r.y,e.positions[a+2]=r.z,e.normals[a+0]=i.x,e.normals[a+1]=i.y,e.normals[a+2]=i.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,r,i,n,s,a){let o=new P,l=new P,u=new P,h=new P,c=new J;r.forEach((f,p)=>{let m=i[p],g=e.verticesStart*r.length+e.verticesCount*p;for(let v=0;v<e.count;v++){let y=(e.start+v)*2;if(o.set(t[y+0],t[y+1],0),u.copy(o).applyMatrix4(f).add(m),e.continuous[v])h.set(e.normals[v*2+0],e.normals[v*2+1],0);else{let x=v===0?(e.start+e.count-1)*2:y-2;l.set(t[x+0],t[x+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(f).normalize(),c.set(v===0?1:v/e.count,p/(r.length-1)),this._insertVertex(n,g,u,h,c),g++,!e.continuous[v]||v===0){if(v===0)h.set(e.normals[v*2+0],e.normals[v*2+1],0),c.set(0,p/(r.length-1));else{let x=v===e.count-1?e.start*2:y+2;l.set(t[x+0],t[x+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(f).normalize(),this._insertVertex(n,g,u,h,c),g++}}});let d=r.length-1;for(let f=0;f<d;f++){let p=e.verticesStart*r.length+e.verticesCount*f,m=e.verticesStart*r.length+e.verticesCount*(f+1),g=0;for(let v=0;v<e.count;v++){(!e.continuous[v]||v===0)&&g++;let y=v===e.count-1?0:g+1,x=p+g,w=p+y,S=m+y,_=m+g;e.isHole?s.push(x,S,w,x,_,S):s.push(x,w,S,x,S,_),g++}}}_closeEnd(e,t,r,i,n,s,a){let o=e.vertexCount,l=new P(0,0,a?-1:1).applyMatrix4(n),u=new P,h=new J;for(let d=0;d<o;d++){let f=2*d;u.set(e.vertices[f+0],e.vertices[f+1],0).applyMatrix4(n).add(s),this._insertVertex(i,t+d,u,l,h)}let c=e.elements;for(let d=0;d<e.elementCount;d++){let f=3*d,p=c[f+0]+t,m=c[f+(a?1:2)]+t,g=c[f+(a?2:1)]+t;r.push(p,m,g)}}applyMatrix4OnRange(e,t,r){let i=e.elements,n=new zi().getNormalMatrix(e).elements,s,a,o,l,u=this.attributes.position,h=this.attributes.normal;if(!u||!h)return;let c=u.array,d=h.array,f=u.itemSize;for(let p=t*f,m=r*f;p<m;p+=f){if(p===t)debugger;s=c[p+0],a=c[p+1],o=c[p+2],l=1/(i[3]*s+i[7]*a+i[11]*o+i[15]),c[p+0]=(i[0]*s+i[4]*a+i[8]*o+i[12])*l,c[p+1]=(i[1]*s+i[5]*a+i[9]*o+i[13])*l,c[p+2]=(i[2]*s+i[6]*a+i[10]*o+i[14])*l,s=d[p+0],a=d[p+1],o=d[p+2],d[p+0]=n[0]*s+n[3]*a+n[6]*o,d[p+1]=n[1]*s+n[4]*a+n[7]*o,d[p+2]=n[2]*s+n[5]*a+n[8]*o}u.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let r=this.index;if(r){for(let i=e;i<t;i+=3){let n=r.getX(i),s=r.getX(i+1),a=r.getX(i+2);r.setXYZ(i,a,s,n)}r.needsUpdate=!0}}};function B5(){let e=new _t;return e.setAttribute("position",new Mt(new Float32Array([]),3)),e.setIndex(new Mt(new Uint16Array([]),1)),e}var Tpe=B5().attributes,Cpe=12,Dpe=1,F5=class extends _t{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,Tpe),this.userData={parameters:e,type:"TextGeometry"};let r=t.getFont(e.font);r!=null&&r.isLoaded?(this.font=r,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let r=t.getFont(e);r&&(this.font=r,await r.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:r,height:i,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,u=l===2?o.toUpperCase():l===3?o.toLowerCase():o,h=Ppe(e,t,u),{shapes:c,charWidths:d,charCoords:f}=t.generateShapes(h,e),p=r*.5,m=i*.5,g=c.map(x=>new $r().fromShape(x));this.vectorShapes=g;let v=g.map(x=>kh.create({shape:x,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?ur.NONZERO:ur.ODD,subdivisions:this.isLowResolution&&n>0?Dpe:Cpe}})),y=v.length?$c(v):B5();y.translate(-p,m,0),this.dispose(),this.wrappedText=h,this.charCoords=f,this.charWidths=d,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach(([x,w])=>{this.setAttribute(x,w)}),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=Sh(new _t,F5.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,r])=>{this.setAttribute(t,r)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};function Ppe(e,t,r){r=r??e.text;let i=[""],n="";for(let s of r)n+=s,s===" "||s===`
`?(i[i.length-1]+=n,n="",s===`
`&&i.push("")):t.getTextWidth(i[i.length-1]+n,e)>e.width&&(i[i.length-1].length&&i.push(""),t.getTextWidth(i[i.length-1]+n,e)>e.width&&(n.length===1?(i[i.length-1]+=n,n=""):(i[i.length-1]+=n.slice(0,-1),n=n[n.length-1],i.push(""))));return i[i.length-1]+=n,i}var U5,a2=new Promise(e=>{U5=e}),Sk=!1,Ry;function Ope(){if(Sk)return;if(Ry)return Ry;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@0.9.432/build",r=Iv(()=>import("./process-10f79362.js"),[],import.meta.url),[i,n]=await Promise.all([r,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=i.default,a=await s({wasmBinary:n});U5(a),Sk=!0}return Ry=e(),Ry}function Qx(e,t,r){let i={parameters:e,type:e.type};if(e.type==="PathGeometry")i.path=e.path;else if(e.type==="VectorGeometry"){let s=$r.createFromState(e.shape,e.width,e.height);i.shape=s}else if(e.type==="NonParametricGeometry")e.data.groups&&e.data.groups.forEach(s=>s.materialIndex=Math.max(s.materialIndex??0,0)),i.geometry=new q4().parse(e);else{if(e.type==="SubdivGeometry")return new _n(e,r);if(e.type==="TextGeometry")return new F5(e,t)}let n;try{n=Ck(i)}catch(s){console.error(s)}if(!n){let s=$r.createFromState(Fx.defaultData(),100,100);i.shape=s,n=Ck(i)}return n}var Lpe=new Oe;function sT(e,t,r,i){let n=e.position.array,s=e.normal.array,a=Lpe.makeScale(t,r,i).invert().elements,o,l,u;for(var h=0,c=n.length;h<c;h+=3)n[h]*=t,n[h+1]*=r,n[h+2]*=i,o=s[h],l=s[h+1],u=s[h+2],s[h]=a[0]*o+a[4]*l+a[8]*u,s[h+1]=a[1]*o+a[5]*l+a[9]*u,s[h+2]=a[2]*o+a[6]*l+a[10]*u;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var ky=new ai,gd=new P,pt;a2.then(e=>{pt=e});var Mk=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Ek=new Uint32Array([0,1,2,3]),Ak=new Uint8Array([4]),_n=class extends _t{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let r=this.data.scaleBaked,i=sh.div(t,r);this.subdividedGeometry&&sT(this.subdividedGeometry.attributes,...i),this.originalGeometry&&sT(this.originalGeometry.attributes,...i),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*i[0],height:n.height*i[1],depth:n.depth*i[2]},this.originalGeometry.boundingSphere.center.multiply(gd.fromArray(i));let s=gd.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,r;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:r}=_n.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new xo(100,100,100),r=0}this.subdivPointer=r,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let i=this.subdividedGeometry??this.originalGeometry;Object.assign(this,i),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(_n.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new ys,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,r=e.boundingSphere.center;ky.setFromBufferAttribute(t),ky.getCenter(r),e.boundingSphere.radius=r.distanceTo(ky.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),ky.getSize(gd);let i={width:gd.x,height:gd.y,depth:gd.z};return this.userData.parameters=i,i}static build(e,t,r,i){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;r===!1&&(o=-1),t&&(pt.free_bvh(t),pt.free_subdivision_surface(t));try{n=_n.allocate(e,i)}catch(l){console.error(l,e),n=_n.allocate({positionWASM:Mk,indexWASM:Ek,verticesPerFaceWASM:Ak},i)}if(pt.set_destination_refinement_level(n,0),s=_n.buildLevel(n,!0,o),e.subdivisions>0)try{pt.set_destination_refinement_level(n,e.subdivisions),a=_n.buildLevel(n,!1,o)}catch{try{pt.set_destination_refinement_level(n,e.subdivisions-1),a=_n.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,r){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let i=e.shape!==void 0||e.path!==void 0?t.geometry:Qx(e,r,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=i.getClosedTorusIndicesForBooleanOrSubdiv():n=i.getIndex();let s,a,o,l;({positions:s,triIndices:l}=db(i.getAttribute("position"),n));let u;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let h=e.radialSegments*e.heightSegments*3*2,c=h+e.radialSegments*3;u=[h,c]}return{indices:a,verticesPerFace:o}=j5(s,l,i,u),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var x;let r,i,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(r=e.positionWASM,i=e.indexWASM,n=e.verticesPerFaceWASM):(r=Mk,i=Ek,n=Ak);let o=r.length,l=i.length,u=n.length,h=r.length+s.length+a.length,c=i.length+n.length,d=h*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,f=h*Float32Array.BYTES_PER_ELEMENT,p=pt._malloc(d),m=new Float32Array(pt.HEAPF32.buffer,p,h),g=new Uint32Array(pt.HEAPU32.buffer,p+f,c);m.set(r,0),m.set(s,r.length),m.set(a,r.length+s.length),g.set(i,0),g.set(n,i.length);let v;(x=e==null?void 0:e.scaleBaked)!=null&&x.some(w=>w!==1)&&(v=new Oe().makeScale(...e.scaleBaked)),t&&(v?v.premultiply(t):v=t);let y=v?pt.alloc_subdivision_surface2(p,o,p+f,l,p+f+i.length*Uint32Array.BYTES_PER_ELEMENT,u,v.elements):pt.alloc_subdivision_surface(p,o,p+f,l,p+f+i.length*Uint32Array.BYTES_PER_ELEMENT,u);return pt._free(p),y}static buildLevel(e,t,r,i,n){let s=n?pt.get_mesh_data2(e,t?pt.Level.CONTROL:pt.Level.REFINED,r,n.elements):pt.get_mesh_data(e,t?pt.Level.CONTROL:pt.Level.REFINED,r),a=8,o=pt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,4+4),u=0,h=pt.HEAPU32[o[u]>>2],c=pt.HEAPF32.subarray(h>>2,(h>>2)+l[u]);u++;let d=pt.HEAPU32[o[u]>>2],f=pt.HEAPF32.subarray(d>>2,(d>>2)+l[u]);u++;let p=pt.HEAPU32[o[u]>>2],m=pt.HEAPU32.subarray(p>>2,(p>>2)+l[u]);u++;let g=pt.HEAPU32[o[u]>>2],v=pt.HEAPU32.subarray(g>>2,(g>>2)+l[u]);if(u++,i===void 0){let y=new _t;if(y.setIndex(new pf(v,1)),y.setAttribute("position",new nt(c,3)),y.setAttribute("normal",new nt(f,3)),t){y.setAttribute("faceMap",new pf(m,1));let x=new Float32Array(f.length/3*4).fill(0);y.setAttribute("color",new Mt(x,4))}return pt.free_mesh_data(s),y.userData.type="SubdivGeometry",y}i.getAttribute("position").copyArray(c),i.getAttribute("normal").copyArray(f),i.attributes.position.needsUpdate=!0,i.attributes.normal.needsUpdate=!0,pt.free_mesh_data(s)}static freeSubdivPointer(e){pt.free_bvh(e),pt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,r){let i=pt.get_wireframe_data_for_base_level(e),n=4,s=pt.HEAPU32.subarray(i>>2,(i>>2)+n),a=s.subarray(2,2+2),o=0,l=pt.HEAPU32[s[o]>>2],u=pt.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let h=pt.HEAPU32[s[o]>>2],c=pt.HEAPU32.subarray(h>>2,(h>>2)+a[o]);if(t===void 0){let d=new _t;d.setAttribute("position",new nt(u,3));let f=new Float32Array(u.length);for(let p=0,m=u.length;p<m;)f[p++]=r.r,f[p++]=r.g,f[p++]=r.b;return d.setAttribute("color",new Mt(f,3)),d.setIndex(new pf(c,1)),pt.free_wireframe_data_for_base_level(i),d}t.getAttribute("position").copyArray(u),t.attributes.position.needsUpdate=!0,pt.free_wireframe_data_for_base_level(i)}static updateCollabMesh(e,t,r){let i=t===0;i||pt.set_destination_refinement_level(e,t);let n=r?pt.get_topological_data2(e,i?pt.Level.CONTROL:pt.Level.REFINED,r.elements):pt.get_topological_data(e,i?pt.Level.CONTROL:pt.Level.REFINED),s=6,a=pt.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,3+3),l=0,u=pt.HEAPU32[a[l]>>2],h=new Float32Array(pt.HEAPF32.subarray(u>>2,(u>>2)+o[l]));l++;let c=pt.HEAPU32[a[l]>>2],d=new Uint32Array(pt.HEAPU32.subarray(c>>2,(c>>2)+o[l]));l++;let f=pt.HEAPU32[a[l]>>2],p=new Uint8Array(pt.HEAPU32.subarray(f>>2,(f>>2)+o[l]));return pt.free_topological_data(n),{positions:h,indices:d,verticesPerFace:p}}},Tk=["getX","getY","getZ"];function db(e,t){let r={},i=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let u=0;u<i;u++){let h=t?t.getX(u):u,c="";for(let d=0;d<3;d++)c+=`${~~(e[Tk[d]](h)*o)},`;if(c in r)s.push(r[c]);else{for(let d=0;d<3;d++)a.push(e[Tk[d]](h));r[c]=n,s.push(n),n++}}let l=[];for(let u=0;u<s.length;u+=3)s[u]===s[u+1]||s[u]===s[u+2]||s[u+1]===s[u+2]||l.push(s[u],s[u+1],s[u+2]);return{positions:a,triIndices:l}}var zy=new P,tM=new P,rM=new P,iM=new P;function j5(e,t,r,i){let n=[],s=[];if(r.userData.shape!==void 0&&r.userData.parameters.depth===0&&r.userData.shape.shapeHoles.length===0){let l=r.userData.shape.extractShapePointsToFlatArray([]),u=r.userData.parameters.spikes;if(r.userData.type==="EllipseGeometry"&&u<=24&&u%4===0&&r.userData.parameters.angle>=360){let d=l.length/2/u;l=l.filter((f,p)=>Math.floor(p/2)%d===0)}let h=0;for(let d=0;d<l.length;d+=2)h+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let c=0;if(h<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(c++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(c++);return s.push(c),{indices:n,verticesPerFace:s}}let a=new Float32Array([r.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(r.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){zy.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),tM.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),rM.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),iM.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),tM.sub(zy).normalize(),rM.sub(zy).normalize(),iM.sub(zy).normalize();let l=tM.cross(rM).dot(iM);Math.abs(l)>.005||i&&i.some((u,h)=>h%2===1?!1:o>=i[h]&&o<i[h+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(r.useNgonForTopBottomFaceDuringBake){let l=[],u=[],h=0;for(let c=0,d=0;c<e.length;c+=3,d++)e[c+2]===0&&(l.push(d),h++),e[c+2]===a&&u.push(d);if(r.userData.parameters.extrudeBevelSize===0){let c=u[0];u[0]=u[1],u[1]=c}l.reverse(),n.push(...l,...u),s.push(h,h)}return{indices:n,verticesPerFace:s}}var ol={};y$(ol,{calcBoolean:()=>Npe,calcBooleanTopological:()=>zpe,freeMeshSet:()=>jpe,getMeshSet:()=>Bpe,hasOpenEdges:()=>Fpe,transformMeshSet:()=>Upe});var H5,Ipe=new Promise(e=>{H5=e}),Ny;function Rpe(){if(Ny)return Ny;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@0.9.432/build",r=Iv(()=>import("./boolean-613a7c9c.js"),[],import.meta.url),[i,n]=await Promise.all([r,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=i.default,a=await s({wasmBinary:n});H5(a)}return Ny=e(),Ny}var Vt,Sf;Ipe.then(e=>Vt=e);function kpe(e,t,r){let i,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=db(e.getAttribute("position"),n),o;if(t&&r){let{indices:l,verticesPerFace:u}=j5(s,a,e);o=u.length,i=[];for(let h=0,c=0;h<o;h++){i.push(u[h]);for(let d=0;d<u[h];d++)i.push(l[c++])}}else{let l=a.length;i=Array(l+l/3),o=0;for(let u=0,h=0;h<i.length;)i[h++]=3,o++,i[h++]=a[u++],i[h++]=a[u++],i[h++]=a[u++]}return{positions:s,faceIndices:i,nFaces:o}}function V5(e){let t=e.length,r=t*Uint32Array.BYTES_PER_ELEMENT,i=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?r:i,s=Vt._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(Vt.HEAPU32.buffer,s,t):new Float32Array(Vt.HEAPF32.buffer,s,t)).set(e,0),s}function W5(e){switch(e){case 0:return Vt.OP.UNION;case 1:return Vt.OP.INTERSECTION;case 2:return Vt.OP.A_MINUS_B;case 3:return Vt.OP.B_MINUS_A;case 4:return Vt.OP.SYMMETRIC_DIFFERENCE;case 5:return Vt.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function zpe(e,t){Sf===void 0&&(Sf=Vt.init_csg());let r=V5(e),i=Vt.csg_calc_topological(Sf,r,e.length,W5(t));Vt._free(r);let n=6,s=Vt.HEAPU32.subarray(i>>2,(i>>2)+n),a=s.subarray(3,3+3),o=0,l=Vt.HEAPU32[s[o]>>2],u=new Float32Array(Vt.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let h=Vt.HEAPU32[s[o]>>2],c=new Uint32Array(Vt.HEAPU32.subarray(h>>2,(h>>2)+a[o]));o++;let d=Vt.HEAPU32[s[o]>>2],f=new Uint8Array(Vt.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Vt.free_mesh_data(i),{positions:u,indices:c,verticesPerFace:f}}function Npe(e,t,r,i){Sf===void 0&&(Sf=Vt.init_csg());let n=V5(e),s=Vt.csg_calc(Sf,n,e.length,i,W5(t));Vt._free(n);let a=5,o=Vt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,2+3),u=0,h=Vt.HEAPU32[o[u]>>2],c=Vt.HEAPF32.subarray(h>>2,(h>>2)+l[u]);u++;let d=Vt.HEAPU32[o[u]>>2],f=Vt.HEAPF32.subarray(d>>2,(d>>2)+l[u]);u++;let p=l[u];r.setAttribute("position",new nt(c,3)),r.setAttribute("normal",new nt(f,3));let m=Vt.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return r.boundingSphere===null&&(r.boundingSphere=new ys),r.boundingSphere.center.set(m[0],m[1],m[2]),r.boundingSphere.radius=(m[3]**2+m[4]**2+m[5]**2)**.5,r.userData.parameters={width:m[3]*2,height:m[4]*2,depth:m[5]*2},Vt.free_mesh_data(s),p}function Bpe(e,t,r){if(Vt===void 0)return-1;let i,n,s;if(t&&e.userData.positions!==void 0){let m=e.userData;s=m.verticesPerFace.length,i=m.positions,n=Array(m.verticesPerFace.reduce((g,v)=>g+v,0)+s);for(let g=0,v=0,y=0;g<m.verticesPerFace.length;g++){n[y++]=m.verticesPerFace[g];for(let x=0;x<m.verticesPerFace[g];x++)n[y++]=m.indices[v++]}}else({positions:i,faceIndices:n,nFaces:s}=kpe(e,t,r));let a=i.length,o=n.length,l=i.length,u=n.length,h=l*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,c=l*Float32Array.BYTES_PER_ELEMENT,d=Vt._malloc(h),f=new Float32Array(Vt.HEAPF32.buffer,d,l),p=new Uint32Array(Vt.HEAPU32.buffer,d+c,u);return f.set(i,0),p.set(n,0),Vt.get_csg_mesh(d,a,d+c,o,s)}function Fpe(e){return Vt.has_open_edges(e)}function Upe(e,t){Vt.transform_csg_mesh(e,t.elements)}function jpe(e){Vt.free_csg_mesh(e)}var Hpe={ConeGeometry:yfe,CubeGeometry:xfe,CylinderGeometry:y5,DodecahedronGeometry:bfe,EllipseGeometry:s2,HelixGeometry:Jfe,IcosahedronGeometry:epe,LatheGeometry:tpe,NonParametricGeometry:lpe,PolygonGeometry:k5,PyramidGeometry:upe,RectangleGeometry:z5,SphereGeometry:dpe,PlaneGeometry:fpe,BackdropGeometry:ppe,StarGeometry:N5,TextFrameGeometry:gpe,TorusGeometry:vpe,TorusKnotGeometry:xpe,TriangleGeometry:wpe,PathGeometry:Epe,VectorGeometry:kh},Ck=e=>Hpe[e.type].create(e);function wm(e){return e!==null&&"booleanOp"in e}var G5=class extends JD(Hn){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Oe}updateVisible(){super.updateVisible(),this.visible=!wm(this.parent)&&this.visible,wm(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(ol.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),wm(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof G5&&(e.freeBooleanPointer(),wm(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e){let t=super.updateTransformState(e);return t&&wm(this.parent)&&this.invalidateDownstreamBooleanData(!0),t}},By=new ai;function o2(e,t=0,r=e.count,i,n){let s=1/0,a=1/0,o=1/0,l=-1/0,u=-1/0,h=-1/0;for(let c=t;c<r;c++){let d=e.getX(c),f=e.getY(c),p=e.getZ(c);d<s&&(s=d),f<a&&(a=f),p<o&&(o=p),d>l&&(l=d),f>u&&(u=f),p>h&&(h=p)}By.min.set(s,a,o),By.max.set(l,u,h),By.getCenter(i),By.getSize(n).multiplyScalar(.5)}var Vpe=new _t,Wpe=new zv,es=class extends G5{constructor(e,t){super(Vpe,Wpe),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let r=this.geometry.getAttribute("position");r!==void 0?o2(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):super.updateEntityBoxSize(e,t)}},Dk=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},fc=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=zt.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,r){return r=r??{},this.analyze(e,r),this.flow(e,t,r)}flow(e,t,r){r=r??{},e.addFlow(r.slot,r.cache,r.context);let i={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),i}build(e,t,r){t=t??this.getType(e,t);let i=e.getNodeData(r??this);return e.analyzing&&this.appendDepsNode(e,i,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,r)}updateFrame(e){}generateReadonly(e,t,r,i,n,s){return""}generate(e,t,r,i,n){return""}parse(e,t,r,i){}appendDepsNode(e,t,r){t.deps=(t.deps||0)+1;let i=e.getTypeLength(r);(i>(t.outputMax||0)||this.getType(e,r))&&(t.outputMax=i,t.output=r)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}getHash(){let e="{",t,r;for(t in this)r=this[t],r instanceof fc&&(e+='"'+t+'":'+r.getHash()+",");if(this.hashProperties)for(let i=0;i<this.hashProperties.length;i++)t=this.hashProperties[i],r=this[t],e+='"'+t+'":"'+String(r)+'",';return e+='"id":"'+this.uuid+'"}',e}},Gpe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,r){r=r!==void 0?r:!0,this.keywords[e]={callback:t,cache:r}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Un=new Gpe,fr=class extends fc{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,r,i){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=zt.generateUUID()),r=e.getUUID(r??this.getUUID(),!n);let s=e.getNodeData(r),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,r)):super.build(e,t,r);if(n)return s.name=s.name||super.build(e,t,r),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,r);r=this.getUUID(!1);let o=this.getTemp(e,r);if(o)return e.format(o,a,t);{o=super.generate(e,t,r,s.output,i);let l=this.generate(e,a,r);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,r)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let r=e.getVars()[t];return r?r.name:void 0}generate(e,t,r,i,n){return this.getShared(e,t)||console.error("TempNode is not shared"),r=r??this.uuid,e.getTempVar(r,i??this.getType(e),n,this.getLabel()).name}},is=class extends fr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,r,i,n,s){r=e.getUUID(r??this.getUUID()),i=i??this.getType(e);let a=e.getNodeData(r);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,r,i,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(i,this,n,s,this.getLabel())),e.format(a.vertex.name,i,t)):(a.fragment||(a.fragment=e.createFragmentUniform(i,this,n,s,this.getLabel())),e.format(a.fragment.name,i,t))}},Gi=class extends is{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof J?e:new J(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,r,i,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",i,t)}},Ls=class extends is{constructor(t=0,r,i){super("v3"),this.nodeType="Vector3",this.value=t instanceof P?t:new P(t,r,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,r,i,n,s,a){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,r)}},$n=class extends gt{constructor(e,t,r,i){super(e,t,r),this.isColorA=!0,this.a=i}setRGBA(e,t,r,i){super.setRGB(e,t,r),this.a=i}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,t="srgb"){let r;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(r=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let i,n=r[1],s=r[2];switch(n){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(i[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(i[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},ll=class extends is{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof $n?e:new $n(e.r,e.g,e.b,e.a)}generateReadonly(e,t,r,i,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",i,t)}},Ype=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Pk=/[a-z_0-9]+/gi,We=class extends fr{constructor(e,t,r,i,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,r,i)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,r,i,n){let s,a=0,o=this.src;if(this.includes)for(let u=0;u<this.includes.length;u++)e.include(this.includes[u],this);for(let u in this.extensions)e.extensions[u]=!0;let l=[];for(;s=Pk.exec(this.src);)l.push(s);for(let u=0;u<l.length;u++){let h=l[u],c=h[0],d=this.isMethod?!this.getInputByName(c):!0,f=c;if(this.keywords[c]||this.useKeywords&&d&&Un.containsKeyword(c)){let p=this.keywords[c];if(!p){let m=Un.getKeywordData(c);m.cache&&(p=e.keywords[c]),p=p||Un.getKeyword(c,e),m.cache&&(e.keywords[c]=p)}f=p.build(e)}c!==f&&o[h.index+a-1]!=="."&&(o=o.substring(0,h.index+a)+f+o.substring(h.index+c.length+a),a+=f.length-c.length),this.getIncludeByName(f)===void 0&&Un.contains(f)&&e.include(Un.get(f))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,r,i){if(this.src=e||"",this.includes=t??[],this.extensions=r??{},this.keywords=i??{},this.isMethod){let n=Ype.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(Pk);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let u=s[a++];this.inputs.push({name:u,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},qpe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,Y5=class extends fr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||Y5.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,r,i,n){this.src=e||"";let s,a,o="",l=qpe.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,r,i,n){return e.format(this.name,this.getType(e),t)}},lr=Y5;lr.PI="PI",lr.PI2="PI2",lr.RECIPROCAL_PI="RECIPROCAL_PI",lr.RECIPROCAL_PI2="RECIPROCAL_PI2",lr.LOG2="LOG2",lr.EPSILON="EPSILON";var Xpe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),$pe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),q5=class extends fr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,r,i,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=Xpe.exec(e);if(t){let r=t[2],i;for(;i=$pe.exec(r);)this.inputs.push({type:i[1],name:i[2]});this.name=t[1]}else this.name="";this.type=this.name}},l2=class extends fr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let r=this.index>0?this.index+1:"",i=e.isShader("vertex")?"uv"+r:"vUv"+r;return e.format(i,this.getType(e),t)}};Un.addKeyword("uv",function(){return new l2});Un.addKeyword("uv2",function(){return new l2(1)});var Ld=class extends fr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Ld.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case yo:return["Linear"];case Ot:return["sRGB"];default:return[]}}generate(e,t){var a;let r=this.input.build(e,"v4"),i=this.getType(e),n=Ld.Nodes[this.method],s=e.include(n);if(s===Ld.LINEAR_TO_LINEAR)return e.format(r,i,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+r+", "+o+" )",i,t)}else return e.format(s+"( "+r+" )",i,t)}fromEncoding(e){let t=Ld.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Ld.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},lo=Ld;lo.Nodes={LinearToLinear:new We(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new We(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new We(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},lo.LINEAR_TO_LINEAR="LinearToLinear",lo.SRGB_TO_LINEAR="sRGBToLinear",lo.LINEAR_TO_SRGB="LinearTosRGB";var Mr=class extends We{constructor(e="",t,r,i,n){super(e,n,i,r,t),this.nodeType="Expression"}},ml=class extends is{constructor(e=new Mi,t,r,i){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new l2,this.bias=r,this.project=i!==void 0?i:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let r=this.getTexture(e,t),i=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+r+", "+i+", "+n+" )":a=s+"( "+r+", "+i+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new lo(new Mr("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Ze=class extends is{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,r,i,n,s){return e.format(this.value+(this.value%1?"":".0"),i,t)}},Ok=class extends fr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,r,i,n){i=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let u=s.inputs[l],h=this.inputs[l]||this.inputs[u.name];o.push(h.build(e,e.getTypeByFormat(u.type)))}a+=o.join(", ")+" )"}return e.format(a,i,t)}},X5=class extends fr{constructor(e,t,r=X5.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=r}getType(e){let t=this.a.getType(e),r=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(r)>e.getTypeLength(t)?r:t}generate(e,t){let r=this.getType(e);this.type=r;let i=this.a.build(e,r),n=this.b.build(e,r);return e.format("( "+i+" "+this.op+" "+n+" )",r,t)}},kn=X5;kn.ADD="+",kn.SUB="-",kn.MUL="*",kn.DIV="/";var or=class extends fr{constructor(e,t=or.ABS,r,i){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:i=t,typeof r!="string"?this.c=r:i=r,this.method=i,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case or.MIX:case or.CLAMP:case or.REFRACT:case or.SMOOTHSTEP:case or.FACEFORWARD:return 3;case or.MIN:case or.MAX:case or.MOD:case or.STEP:case or.REFLECT:case or.DISTANCE:case or.DOT:case or.CROSS:case or.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),r=this.b?e.getTypeLength(this.b.getType(e)):0,i=this.c?e.getTypeLength(this.c.getType(e)):0;return t>r&&t>i?this.a.getType(e):r>i?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case or.LENGTH:case or.DISTANCE:case or.DOT:return"f";case or.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let r,i,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),u=this.getType(e);switch(this.type=u,this.method){case or.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case or.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case or.CROSS:r=this.a.build(e,"v3"),i=this.b.build(e,"v3");break;case or.STEP:r=this.a.build(e,s===1?"f":l),i=this.b.build(e,l);break;case or.MIN:case or.MAX:case or.MOD:r=this.a.build(e,l),i=this.b.build(e,a===1?"f":l);break;case or.REFRACT:r=this.a.build(e,l),i=this.b.build(e,l),n=this.c.build(e,"f");break;case or.MIX:r=this.a.build(e,l),i=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:r=this.a.build(e,l),this.b&&(i=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let h=[];h.push(r),i&&h.push(i),n&&h.push(n);let c=this.getNumInputs(e);if(h.length!==c)throw Error(`Arguments not match used in "${this.method}". Require ${c}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",u,t)}},Ct=or;Ct.RAD="radians",Ct.DEG="degrees",Ct.EXP="exp",Ct.EXP2="exp2",Ct.LOG="log",Ct.LOG2="log2",Ct.SQRT="sqrt",Ct.INV_SQRT="inversesqrt",Ct.FLOOR="floor",Ct.CEIL="ceil",Ct.NORMALIZE="normalize",Ct.FRACT="fract",Ct.SATURATE="saturate",Ct.SIN="sin",Ct.COS="cos",Ct.TAN="tan",Ct.ASIN="asin",Ct.ACOS="acos",Ct.ARCTAN="atan",Ct.ABS="abs",Ct.SIGN="sign",Ct.LENGTH="length",Ct.NEGATE="negate",Ct.INVERT="invert",Ct.MIN="min",Ct.MAX="max",Ct.MOD="mod",Ct.STEP="step",Ct.REFLECT="reflect",Ct.DISTANCE="distance",Ct.DOT="dot",Ct.CROSS="cross",Ct.POW="pow",Ct.MIX="mix",Ct.CLAMP="clamp",Ct.REFRACT="refract",Ct.SMOOTHSTEP="smoothstep",Ct.FACEFORWARD="faceforward";var Gm=class extends fr{constructor(e,t,r){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=r}bilinearCubeUV(e,t,r,i){let n=new Ok(Gm.Nodes.bilinearCubeUV,[t,r,i]);this.colorSpaceTL=this.colorSpaceTL??new lo(new Mr("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new lo(new Mr("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new lo(new Mr("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new lo(new Mr("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new Mr(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new Mr(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new Mr(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new Mr(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new Mr("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let r=this.uv,i=this.bias||e.context.roughness,n=new Ok(Gm.Nodes.roughnessToMip,[i]),s=new Ct(n,Gm.Nodes.m0,Gm.Nodes.cubeUV_maxMipLevel,Ct.CLAMP),a=new Ct(s,Ct.FLOOR),o=new Ct(s,Ct.FRACT),l=this.bilinearCubeUV(e,this.value,r,a),u=this.bilinearCubeUV(e,this.value,r,new kn(a,new Ze(1).setReadonly(!0),kn.ADD)),h=new Ct(l,u,o,Ct.MIX);return e.format(h.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},aT=Gm;aT.Nodes=function(){let e=new q5(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new lr("float cubeUV_maxMipLevel 8.0",!0),r=new lr("float cubeUV_minMipLevel 4.0",!0),i=new lr("float cubeUV_maxTileSize 256.0",!0),n=new lr("float cubeUV_minTileSize 16.0",!0),s=new We(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new We(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new We(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,r,i,n]);o.useKeywords=!1;let l=new lr("float r0 1.0",!0),u=new lr("float v0 0.339",!0),h=new lr("float m0 -2.0",!0),c=new lr("float r1 0.8",!0),d=new lr("float v1 0.276",!0),f=new lr("float m1 -1.0",!0),p=new lr("float r4 0.4",!0),m=new lr("float v4 0.046",!0),g=new lr("float m4 2.0",!0),v=new lr("float r5 0.305",!0),y=new lr("float v5 0.016",!0),x=new lr("float m5 3.0",!0),w=new lr("float r6 0.21",!0),S=new lr("float v6 0.0038",!0),_=new lr("float m6 4.0",!0),A=[l,u,h,c,d,f,p,m,g,v,y,x,w,S,_],M=new We(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:o,roughnessToMip:M,m0:h,cubeUV_maxMipLevel:t}}();var Id=class extends fr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Id.VIEW}getShared(){return this.scope===Id.WORLD}build(e,t,r,i){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,r,i):super.build(e,t,r)}generate(e,t,r,i,n){let s;switch(this.scope){case Id.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Id.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case Id.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},Vn=Id;Vn.LOCAL="local",Vn.WORLD="world",Vn.VIEW="view",Vn.NORMAL="normal";Un.addKeyword("viewNormal",function(){return new Vn(Vn.VIEW)});Un.addKeyword("localNormal",function(){return new Vn(Vn.NORMAL)});Un.addKeyword("worldNormal",function(){return new Vn(Vn.WORLD)});var nl=class extends fr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??nl.LOCAL}getType(){switch(this.scope){case nl.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case nl.LOCAL:case nl.WORLD:return!1}return!0}generate(e,t,r,i,n){let s;switch(this.scope){case nl.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case nl.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case nl.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case nl.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},wa=nl;wa.LOCAL="local",wa.WORLD="world",wa.VIEW="view",wa.PROJECTION="projection";Un.addKeyword("position",function(){return new wa});Un.addKeyword("worldPosition",function(){return new wa(wa.WORLD)});Un.addKeyword("viewPosition",function(){return new wa(wa.VIEW)});var $a=class extends fr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??$a.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case $a.SPHERE:return"v2"}return this.type}generate(e,t){let r=this.getUnique(e);if(e.isShader("fragment")){let i;switch(this.scope){case $a.VECTOR:{let n=new Vn(Vn.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new wa(wa.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,u=`reflect( -normalize( ${o} ), ${a} )`;l&&(u=`normalize( mix( ${u}, ${a}, ${l} * ${l} ) )`);let h=`inverseTransformDirection( ${u}, viewMatrix )`;r?(e.addNodeCode(`vec3 reflectVec = ${h};`),i="reflectVec"):i=h;break}case $a.CUBE:{let n=new $a($a.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";r?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),i="reflectCubeVec"):i=s;break}case $a.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new $a($a.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";r?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),i="reflectSphereVec"):i=n;break}}return e.format(i,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},Mf=$a;Mf.CUBE="cube",Mf.SPHERE="sphere",Mf.VECTOR="vector";var Qpe=class extends fr{constructor(e=new ml,t,r){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new aT(this.value,t??new Mf(Mf.VECTOR),r),this.irradianceNode=new aT(this.value,new Vn(Vn.WORLD),new Ze(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},Kpe=class extends is{constructor(e=new lD,t,r){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new Mf,this.bias=r}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let r=this.getTexture(e,t),i=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+r+", "+i+", "+n+" )":s="texCube( "+r+", "+i+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new lo(new Mr("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},Zpe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,Jpe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,eme=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,tme=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,Lk=["x","y","z","w"],rme=["float","vec2","vec3","vec4"],ime={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},nme={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},sme=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,r){return t.deps.length-r.deps.length}return function(t,r){let i=this.getIncludes(t,r);if(!i)return"";let n="";i=i.sort(e);for(let s=0;s<i.length;s++)i[s].src&&(n+=i[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(Zpe),this.addFragmentParsCode(Jpe),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let r=0;r<this.requires.uv.length;r++)if(this.requires.uv[r]){let i=r>0?r+1:"";this.addVaryCode("varying vec2 vUv"+i+";"),r>0&&this.addVertexParsCode("attribute vec2 uv"+i+";"),this.addVertexFinalCode("vUv"+i+" = uv"+i+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(eme),this.addFragmentFinalCode(tme)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,r){return this.addSlot(e).addCache(t).addContext(r)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,r,i="varying",n="V",s=""){let a=this.getVars(i),o=a[e];if(!o){let l=a.length;o={name:r||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,r,i){return this.getVar(e,t,r,this.shader,"T",i)}getAttribute(e,t){if(!this.attributes[e]){let r=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let r="";for(let i=0,n=e.length;i<n;++i){let s=e[i],a=s.type,o=s.name,l=s.size,u=this.getFormatByType(a);if(u===void 0)throw new Error("Node pars "+u+" not found.");u.includes("[]")?r+=t+" "+u.substring(0,u.length-2)+" "+o+`[${l}];
`:r+=t+" "+u+" "+o+`;
`}return r}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof fc?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,r,i,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Dk({type:t,size:r.size,name:i||"nodeUA"+o+(s?"_"+s:""),node:r,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new Dk({type:t,name:i||"nodeU"+o+(s?"_"+s:""),node:r,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,r,i,n){return this.createUniform("vertex",e,t,r,i,n)}createFragmentUniform(e,t,r,i,n){return this.createUniform("fragment",e,t,r,i,n)}include(e,t,r){var s;let i;if(e=typeof e=="string"?Un.get(e):e,this.context.include===!1)return e.name;e instanceof We?i=this.includes.functions:e instanceof lr?i=this.includes.consts:e instanceof q5&&(i=this.includes.structs);let n=i[this.shader]=i[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof We&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return r&&(a.src=r),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return rme[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let r=e[t];if(r!=null&&r.isNode)return r}}resolve(...e){for(let t=0;t<arguments.length;t++){let r=e[t];if(r!==void 0){if(r.isNode)return r;if(r.isTexture)switch(r.mapping){case xh:case wh:return new Kpe(r);case Rv:return new Qpe(new ml(r));default:return new ml(r)}else{if(r.isVector2)return new Gi(r);if(r.isVector3)return new Ls(r);if(r.isVector4)return new ll(r)}}}}format(e,t,r){switch(this.colorToVector(r+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return ime[e]||e}getFormatByType(e){return nme[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Lk[e]}getIndexByElement(e){return Lk.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=yo,t===yo&&this.context.gamma&&(t=Ot),t}},Qr=class extends is{constructor(e=0,t,r,i){super("c"),this.nodeType="Color",this.value=e instanceof $n?e:new $n(e||0,t,r,i)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,r,i,n,s){r=e.getUUID(r??this.getUUID()),i=i??this.getType(e);let a=e.getNodeData(r),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,r,i,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(i,this,n,s,this.getLabel())),e.format(a.vertex.name,i,t)):(a.fragment||(a.fragment=e.createFragmentUniform(i,this,n,s,this.getLabel())),e.format(a.fragment.name,i,t))}generateReadonly(e,t,r,i,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",i,t)}},gr=class extends is{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,r,i,n,s){return e.format(this.value.toString(),i,t)}},Mn=class extends is{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,r,i){return e.format(this.value?"true":"false",i,t)}},kc=class extends is{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},u2=class extends is{},ame=class extends u2{constructor(e){super("v3"),this.image=e,this._value=new P}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},oT=class extends u2{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},$5=class extends is{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new zi}generateReadonly(e,t,r,i,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",i,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},_o=class extends is{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new Oe}generateReadonly(t,r,i,n,s,a){return t.format("mat4("+this.value.elements.join(", ")+")",n,r)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function Ik(e,t,r){e.setUvTransform(r[0],r[1],t[0],t[1],0,0,0)}var ome=class extends $5{constructor(e,t){super(new zi),this.repeat=e,this.offset=t,Ik(this.value,e,t)}updateMatrix(){Ik(this.value,this.repeat,this.offset)}},zc=class extends is{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof Lt?new Array(e).fill(t):new Array(e).fill(new Lt(0))}},Rk=class extends fr{constructor(e,t,r,i){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=r,this.mode=i}generate(e,t){if(e.isShader("fragment")){let r=[];return r.push(this.a.build(e,"c")),r.push(this.b.build(e,"c")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),e.format("spe_blend("+r.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Q5=class extends fr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let r=e.include(Q5.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.color.build(e,"v3")),i.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},lT=Q5;lT.Nodes=function(){return{customColor:new We(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var K5=class extends fr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let r=e.include(K5.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.cnormal.build(e,"v3")),i.push("normal"),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Z5=K5;Z5.Nodes=function(){return{customNormal:new We(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var Ym=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u,h,c){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=r,this.projection=i,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=c,this.alpha=u,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let r=`g${this.uuid.toString().replace(/-/g,"")}`,i;switch(this.projection.value){case 3:i=e.include(Ym.Nodes.cylindrical);break;case 2:i=e.include(Ym.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new We(`
		vec3 ${r}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);i=e.include(o);break;case 4:i=e.include(Ym.Nodes.triplanar);break;default:i=e.include(Ym.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${r}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",u=`${r}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(u,"vec3"),n.push(a),n.push(o),n.push(l),n.push(u)}else{let s=`${r}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(i+"("+n.join(",")+")",this.getType(e),t)}},c2=Ym;c2.Nodes=function(){let e=new We(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new We(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),r=new We(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),i=new We(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:r,triplanar:i}}();var qm=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u,h,c){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=r,this.far=i,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=u,this.isMask=c,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let r=`g${this.uuid.toString().replace(/-/g,"")}`,i=new We(`vec3 ${r}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${r}_MAX_COLORS], float steps[${r}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${r}_IS_VECTOR
                   #ifdef ${r}_LINEAR
                       #ifdef ${r}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${r}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${r}_SMOOTH
				for ( int i = 1; i < ${r}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${r}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[qm.Nodes.vectorLinearWorldSpaceDepth,qm.Nodes.vectorLinearObjectSpaceDepth,qm.Nodes.vectorSphericalObjectSpaceDepth,qm.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${r}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${r}_SMOOTH`),this.isVector.value>.5&&e.define(`${r}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${r}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${r}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(i),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},J5=qm;J5.Nodes=function(){let e=new We(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new We(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),r=new We(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),i=new We(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:r,vectorSphericalObjectSpaceDepth:i}}();var lme=class extends fr{constructor(e,t,r,i,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=r,this.intensity=i,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let r=new We(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),i=e.include(r),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},eH=class extends fr{constructor(e,t,r,i,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=r,this.steps=i,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(eH.Nodes.gradient),i=[];return i.push(this.gradientType.build(e,"i")),i.push(this.smooth.build(e,"b")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.offset.build(e,"v2")),i.push(this.morph.build(e,"v2")),i.push(this.angle.build(e,"f")),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},tH=eH;tH.Nodes=function(){return{gradient:new We(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var rH=class extends fr{constructor(e,t,r,i){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=i,this.alpha=t,this.mode=r,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let r=e.include(rH.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let i=[];return i.push(this.texture.generate(e,"t")),i.push("normal"),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},iH=rH;iH.Nodes=function(){return{matcap:new We(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var h2=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(h2||{}),Bn=function(){let e=new We(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new We(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new lr("float F3 0.3333333"),t.keywords.G3=new lr("float G3 0.1666667");let r=new We(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),i=new We("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),n=new We("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s=new We(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[i,n]),a=new We("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new We("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[a]),l=new We(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[o]),u=new We(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);u.keywords.NUM_OCTAVES=new lr("int NUM_OCTAVES 5");let h=new We("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),c=new We(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[i,n,h]),d=new We(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),f=new We(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),p=new We(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new We(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new We(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),v=new We(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),y=new We(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[d,f,p,m,g,v]);return{simplex:t,simplexFractal:r,simplexAshima:s,fbm:u,perlin:c,voronoi:y}}(),nH=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u,h,c,d,f,p,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=r,this.fA=i,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=u,this.noiseType=c,this.voronoiStyle=f,this.highCut=p,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,r,i,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=Object.values(h2)[this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new We(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Bn.simplex,Bn.simplexFractal,Bn.simplexAshima,Bn.fbm,Bn.perlin,Bn.voronoi]),l=e.include(o),u=[];return u.push(this.scale.build(e,"f")),u.push(this.size.build(e,"v3")),u.push(this.move.build(e,"f")),u.push(this.fA.build(e,"v2")),u.push(this.fB.build(e,"v2")),u.push(this.distortion.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.colorC.build(e,"v4")),u.push(this.colorD.build(e,"v4")),u.push(this.voronoiStyle.build(e,"i")),u.push(this.highCut.build(e,"f")),u.push(this.lowCut.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.seed.build(e,"f")),u.push(this.quality.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}};nH.numOctaves=5;var sH=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u,h,c,d,f,p,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=r,this.contourWidth=i,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=u,this.compensation=h,this.resolution=c,this.normalMap=d,this.depthMap=f,this.pixelRatio=p,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let r=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${r}_offset`),this.firstTime){let i=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(i,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${r}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${r}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${r}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${r}_offset = normalize(${r}_clipNormal.xy) / ${n} * (${i} / 2.0) * ${r}_clipPosition.w * 2.0 * ${a};
                    ${r}_clipPosition.xy += ${r}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${r}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(sH.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(i+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},aH=sH;aH.Nodes=function(){let e=new We(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new We(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var sl=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u,h,c,d,f,p,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=r,this.blending=i,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=u,this.smoothness=h,this.zigzag=c,this.rotation=d,this.vertical=f,this.horizontal=p,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let r;switch(this.style.value){case 0:r="circle";break;case 1:r="ring";break;case 2:r="polygon";break;case 3:r="xcross";break;case 4:r="diamond";break;case 5:r="checkerboard";break;case 6:r="line";break;case 7:r="wave";break;default:r="circle";break}let i=`g${this.uuid.toString().replace(/-/g,"")}`,n=new We(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new We(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let h=this.style.value===2?`${r}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,c=this.style.value===2?`${r}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${r}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${h};
				float d1 = ${c};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let h=this.style.value===2?`${r}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,c="";this.axis.value===0?c=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?c=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,c=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${c}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${h};
				`}let o=new We(`vec3 ${i}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,sl.DrawFunctions.circle,sl.DrawFunctions.ring,sl.DrawFunctions.polygon,sl.DrawFunctions.cross,sl.DrawFunctions.diamond,sl.DrawFunctions.checkerboard,sl.DrawFunctions.line,sl.DrawFunctions.wave]),l=e.include(o),u=[];return u.push("normal"),u.push(this.blending.build(e,"f")),u.push(this.style.build(e,"i")),u.push(this.offset.build(e,"v2")),u.push(this.colorA.build(e,"v4")),u.push(this.colorB.build(e,"v4")),u.push(this.frequency.build(e,"v2")),u.push(this.size.build(e,"f")),u.push(this.variation.build(e,"f")),u.push(this.smoothness.build(e,"f")),u.push(this.zigzag.build(e,"f")),u.push(this.rotation.build(e,"f")),u.push(this.vertical.build(e,"v2")),u.push(this.horizontal.build(e,"v2")),u.push(this.sides.build(e,"i")),u.push(this.isMask.build(e,"b")),u.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),u.push(this.alpha.build(e,"f")),u.push(this.calpha),e.format(l+"("+u.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},oH=sl;oH.DrawFunctions=function(){let e=new We(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new We(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),r=new We(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),i=new We(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new We(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new We(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new We(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new We(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new We(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),u=new We(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:r,ring:i,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:u}}();var lH=class extends fr{constructor(e,t,r,i,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=r,this.noiseStrength=i,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(lH.Nodes.rainbow),i=[];return i.push(this.filmThickness.build(e,"f")),i.push(this.movement.build(e,"f")),i.push(this.wavelengths.build(e,"v3")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.offset.build(e,"v3")),i.push(this.isMask.build(e,"b")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},uH=lH;uH.Nodes=function(){let e=new We(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[Bn.simplex]);return{rainbow:new We(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[e])}}();var cH=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=r,this.source=i,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let r=e.include(cH.Nodes.toon),i=[];return i.push(this.positioning.build(e,"i")),i.push(this.colors.build(e,"v4[]")),i.push(this.steps.build(e,"f[]")),i.push(this.source.build(e,"v3")),i.push(this.isWorldSpace.build(e,"b")),i.push(this.noiseStrength.build(e,"f")),i.push(this.noiseScale.build(e,"f")),i.push(this.shadowColor.build(e,"v4")),i.push(this.offset.build(e,"v3")),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},hH=cH;hH.Nodes=function(){let e=new We(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new We(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),r=new We(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),i=new We(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new We(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[i]);return{toon:new We(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Bn.simplex,e,r,n])}}();var ume=function(){return{textureBicubic:new We(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function cme(e,t){return e>=t?new J(t/e,1):new J(1,e/t)}var dH=class extends fr{constructor(e,t,r,i,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=r,this.transmissionSamplerSize=i,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,mt.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let r=e.include(dH.Nodes.transmission),i=[];return i.push(this.thickness.build(e,"f")),i.push(this.ior.build(e,"f")),i.push(this.roughness.build(e,"f")),i.push(this.transmissionSamplerSize.build(e,"v2")),i.push(this.transmissionSamplerMap.getTexture(e,"t")),i.push(this.transmissionDepthMap.getTexture(e,"t")),i.push(this.aspectRatio.build(e,"v2")),i.push("normal"),i.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),i.push(this.alpha.build(e,"f")),i.push(this.calpha),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},fH=dH;fH.Nodes=function(){let e=new We(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new We(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),r=new We(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),i=new We(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[ume.textureBicubic,r,e]),n=new We(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[i,t]);return{transmission:new We(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var uT=(e=>(e.NOISE="noise",e.MAP="map",e))(uT||{}),pH=class extends fr{constructor(e,t,r,i,n,s,a,o,l,u,h){super("v3"),this.displacementTypeIndex=new gr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(uT)[this.displacementTypeIndex.value]==="map"&&(this.mat=new $5(this.movementOrTexture.value.matrix)),this.cropOrOffset=r,this.scale=u,this.noiseFunctionIndex=h,this.voronoiStyle=i,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let r,i=[];switch(i.push("displaced_position"),i.push("displaced_normal"),Object.values(uT)[this.displacementTypeIndex.value]){case"map":{r=e.include(pH.Nodes.map),i.push(this.movementOrTexture.getTexture(e,"t")),i.push("uv"),i.push(this.cropOrOffset.build(e,"f")),this.mat&&i.push(this.mat.build(e,"mat3"));break}case"noise":{let n=Object.values(h2)[this.noiseFunctionIndex.value],s=new We(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new We(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[Bn.simplex,Bn.simplexFractal,Bn.simplexAshima,Bn.fbm,Bn.perlin,Bn.voronoi]),l=new We(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);r=e.include(l),i.push(this.scale.build(e,"f")),i.push(this.cropOrOffset.build(e,"v3")),i.push(this.movementOrTexture.build(e,"f")),i.push(this.voronoiStyle.build(e,"i")),i.push(this.smoothness.build(e,"f")),i.push(this.seed.build(e,"f")),i.push(this.highCut.build(e,"f")),i.push(this.lowCut.build(e,"f")),i.push(this.quality.build(e,"i"));break}}return i.push(this.intensity.build(e,"f")),i.push("displaced_normal"),e.format(r+"("+i.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mH=pH;mH.Nodes=function(){let e=new We(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new We(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new We(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var mt={normalRenderTarget:new ml,normalRenderTargetDepth:new ml,transmissionRenderTarget:new ml,aspectRatio:new Gi,transmissionSize:new Gi(2048,2048),transmissionRenderTargetDepth:new ml,aoRenderTarget:new ml,aoEnabled:new Mn,pixelRatioNode:new Ze(1),resolution:new Gi,penumbraSize:new kc(5,.5),frameIndex:new gr(0),transmissionLod:new gr(2)};for(let e of Object.values(mt))e.isRenderGlobal=!0;var gH=class extends fc{constructor(){super("basic"),this.nodeType="Basic",this.color=new Qr(Qs),this.shadingAlpha=new Ze(1),this.shadingBlend=new gr(0),this.previousModelViewMatrix=new _o,this.previouseProjectionMatrix=new _o}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({resolution:mt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(mp.merge([je.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];r&&i.push(r.code,r.result?"displaced_position = "+r.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{this.color===void 0&&(this.color=new Qr(Qs)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let r=this.color.flow(e,"c",{slot:"color"}),i=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=i!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",r.code];i&&a.push(i.code,"#ifdef ALPHATEST"," if ( "+i.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${r.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${r.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),i?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${i.result} * ${o} );`):a.push("gl_FragColor = vec4("+r.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},hme=class extends fc{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Qr(Qs),this.emissive=new Qr(0),this.emissiveIntensity=new Ze(1),this.previousModelViewMatrix=new _o,this.previouseProjectionMatrix=new _o,this.shadingAlpha=new Ze(1),this.shadingBlend=new gr(0),this.occlusion=new Mn(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({resolution:mt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(mp.merge([je.fog,je.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];r&&i.push(r.code,r.result?"displaced_position = "+r.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),i.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:mt.penumbraSize}),e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({aoMap:mt.aoRenderTarget}),e.mergeUniform({aoEnabled:mt.aoEnabled}),this.color===void 0&&(this.color=new Qr(Qs)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),i=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];c.push(r.code,"vec3 diffuseColor = "+r.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),u&&c.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),i&&c.push(i.code,"reflectedLight.directDiffuse += "+i.result+" * "+n.result+";"),c.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&c.push(`gl_FragColor.a *= ${h.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},Kf=function(){let e=new We(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new We(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),dme=class extends fc{constructor(){super("phong"),this.nodeType="Phong",this.color=new Qr(Qs),this.specular=new Qr(1118481),this.shininess=new Ze(30),this.previousModelViewMatrix=new _o,this.previouseProjectionMatrix=new _o,this.shadingAlpha=new Ze(1),this.shadingBlend=new gr(0),this.occlusion=new Mn(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({resolution:mt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(mp.merge([je.fog,je.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];r&&i.push(r.code,r.result?"displaced_position = "+r.result+";":""),i.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:mt.penumbraSize}),e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({aoMap:mt.aoRenderTarget}),e.mergeUniform({aoEnabled:mt.aoEnabled}),this.color===void 0&&(this.color=new Qr(Qs)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(Kf.dHdxy),e.include(Kf.perturbNormalArb);let f=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,c.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${g}
					`)}c.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),u&&c.push(u.code,"#ifdef ALPHATEST","if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),u?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result});`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&c.push(`gl_FragColor.a *= ${h.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=c.join(`
`)}return t}},fme=class extends fc{constructor(){super("standard"),this.nodeType="Standard",this.color=new Qr(Qs),this.roughness=new Ze(.3),this.metalness=new Ze(0),this.reflectivity=new Ze(.5),this.previousModelViewMatrix=new _o,this.previouseProjectionMatrix=new _o,this.shadingAlpha=new Ze(1),this.shadingBlend=new gr(0),this.occlusion=new Mn(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({resolution:mt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(mp.merge([je.fog,je.lights])),je.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];r&&i.push(r.code,r.result?"displaced_position = "+r.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:mt.penumbraSize}),e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({aoMap:mt.aoRenderTarget}),e.mergeUniform({aoEnabled:mt.aoEnabled});let r={gamma:!0};this.color===void 0&&(this.color=new Qr(Qs)),this.color.analyze(e,{slot:"color",context:r}),this.roughness.analyze(e),this.metalness.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:r}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),u=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=h!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let f=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(Kf.dHdxy),e.include(Kf.perturbNormalArb);let m=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${m.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${m.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${m.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${y}
					`)}if(f.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let m=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),v="";this.roughnessMap.projection.value===4?v=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${m.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${m.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${m.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:v=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${m.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${v}
				`)}else f.push(s.code,"	float roughnessFactor = "+s.result+";");h&&f.push(h.code,"#ifdef ALPHATEST","	if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let p="1.0";this.mask&&(this.mask.analyze(e),p=`luminance(${this.mask.flow(e,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${p}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),u&&f.push(u.code,`outgoingLight = spe_blend(outgoingLight, ${u.result}, 1.0, SPE_BLENDING_NORMAL);`),h?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&f.push(`gl_FragColor.a *= ${c.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=f.join(`
`)}return t}},pme=class extends fc{constructor(){super("toon"),this.nodeType="Toon",this.color=new Qr(Qs),this.specular=new Qr(1118481),this.shininess=new Ze(30),this.previousModelViewMatrix=new _o,this.previouseProjectionMatrix=new _o,this.shadingAlpha=new Ze(1),this.shadingBlend=new gr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({resolution:mt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(mp.merge([je.fog,je.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let i=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];r&&i.push(r.code,r.result?"displaced_position = "+r.result+";":""),i.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=i.join(`
`)}else{e.mergeUniform({penumbraSize:mt.penumbraSize}),e.mergeUniform({frameIndex:mt.frameIndex}),e.mergeUniform({aoMap:mt.aoRenderTarget}),e.mergeUniform({aoEnabled:mt.aoEnabled}),this.color===void 0&&(this.color=new Qr(Qs)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),i=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(Kf.dHdxy),e.include(Kf.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),p=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${p});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${p});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${p});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${p});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${m}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",i.code,"	vec3 specular = "+i.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let c="1.0";this.mask&&(this.mask.analyze(e),c=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${c} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${c}, ${a.result} );
				}
				`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},mme=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),r=this.cache.get(e);return r===void 0?(r={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,r)):(r.time=t,r.prev.next=r.next,r.next.prev=r.prev),r.prev=this.tail.prev,r.next=this.tail,this.tail.prev.next=r,this.tail.prev=r,this.scheduleCleanup(),r.data}},gme=class extends mme{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},nM;function vme(e){return typeof e=="string"?e:(nM||(nM=new gme),nM.load(e))}var yme=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},xme=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},vH=class extends yme{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isVideo=e.type==="video",this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;let i=[1e3,1001,1002];for(let n of i){let s=this[n];s&&(s.image=this.img,s.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var r=new FileReader;r.readAsDataURL(new Blob([e],{type:"video/mp4"}));let i;await new Promise(n=>{r.onloadend=s=>{var a;i=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=i}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=vme(e),this.img.onload=t}getTexture(e){let t=this[e];if(t)return t;{let r;return this.isVideo?r=new Ite(this.img,void 0,e,e):r=new Mi(this.img,void 0,e,e),this.loaded&&(r.needsUpdate=!0),this[e]=r,r}}disposeTextures(){var e,t,r;(e=this[1e3])==null||e.dispose(),this[1e3]=void 0,(t=this[1001])==null||t.dispose(),this[1001]=void 0,(r=this[1002])==null||r.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Qc=class extends vH{};function En(e,t){return t.color(e)}function wme(e,t){switch(e.type){case"fresnel":return Sme(e,t);case"gradient":return Mme(e);case"depth":return Eme(e);case"normal":return Ame(e);case"noise":return Tme(e,t);case"rainbow":return Cme(e);case"toon":return Dme(e,t);case"outline":return Pme(e,t);case"transmission":return Ome(e);case"color":return _me(e,t);case"pattern":return Lme(e,t)}}function bme(e){return{type:e.type}}function Ia(e){let{alpha:t,mode:r,isMask:i}=e;return{...bme(e),alpha:t,mode:r,isMask:i}}function _me(e,t){return{...Ia(e),color:En(e.color,t)}}function Sme(e,t){let{bias:r,scale:i,intensity:n,factor:s,color:a,isMask:o}=e;return{...Ia(e),color:En(a,t),bias:r,scale:i,intensity:n,factor:s}}function Mme(e){let{gradientType:t,smooth:r,colors:i,steps:n,angle:s,offset:a,morph:o}=e;return{...Ia(e),gradientType:t,smooth:r,colors:i.map(l=>new Lt(l[0],l[1],l[2],l[3])),num:i.length,steps:n,offset:new J(...a),morph:new J(...o),angle:s}}function Eme(e){let{gradientType:t,near:r,far:i,isVector:n,isWorldSpace:s,origin:a,direction:o,colors:l,steps:u,smooth:h}=e;return{...Ia(e),gradientType:t,near:r,far:i,isVector:n,isWorldSpace:s,origin:new P(...a),direction:o?new P(...o):new P(1,0,0),colors:l.map(c=>c!==void 0?new Lt(c[0],c[1],c[2],c[3]):new Lt(0,0,0,0)),steps:u.slice(0,l.length),smooth:h}}function Ame(e){let{cnormal:t}=e;return{...Ia(e),cnormal:new P(t[0],t[1],t[2])}}function Tme(e,t){return{...Ia(e),scale:e.scale,move:e.move,fA:new J(...e.fA),fB:new J(...e.fB),size:new P(...e.size),distortion:new J(...e.distortion),colorA:En(e.colorA,t),colorB:En(e.colorB,t),colorC:En(e.colorC,t),colorD:En(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function Cme(e){return{...Ia(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new P(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new P(...e.offset)}}function Dme(e,t){return{...Ia(e),positioning:e.positioning,colors:e.colors.map(r=>new Lt(r[0],r[1],r[2],r[3])),num:e.colors.length,steps:e.steps,source:new P(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:En(e.shadowColor,t),offset:new P(...e.offset)}}function Pme(e,t){return{...Ia(e),outlineColor:En(e.outlineColor,t),contourColor:En(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new P(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function Ome(e,t){return{...Ia(e),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function Lme(e,t){return{...Ia(e),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new J(...e.offset),colorA:En(e.colorA,t),colorB:En(e.colorB,t),frequency:new J(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new J(...e.vertical),horizontal:new J(...e.horizontal),sides:e.sides}}var Kx=class extends $n{},yH={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},xH={depth:["colors"]};function Ime(e,t,r){var s,a;if(t==="isMask")return!0;let i=yH[e.type],n=xH[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==r.length)return!0}}return i!==void 0?i.includes(t):!1}function wH(e,t,r){let i=r.uniforms[`f${r.id}_texture`];if(!i)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=i;l.image instanceof Qc||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=i;l.image instanceof Qc||l.image.deref(),l.image=o}if("wrapping"in s){let a=i;a.wrap=s.wrapping}if("repeat"in s||"offset"in s){let a="mat",o=r.uniforms[`f${r.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),o.updateMatrix()}return n}function Rme(e,t,r,i){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(_H(s,r,i)){s==="visible"&&r.type==="light"&&(n=!0);continue}r.visible=i.visible;let o=r.uniforms[`f${r.id}_${s}`];if(o&&!(o instanceof u2))switch(n=n||Ime(r,s,a),o.constructor){case Qr:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof Kx?o.value=new $n(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case ll:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof Kx?o.value=new $n(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Gi:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Ls:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case ml:{wH(a,t,r);break}case zc:{o.value=a.map(l=>new Lt(...l));break}default:{o.value=a;break}}}return n}var lh=class{constructor(e,t,r,i){this.id=e,this.uuid=t,this.data=r,this.uniforms={};for(let n in i)this.uniforms[`f${this.id}_${n}`]=i[n];for(let n in r)_H(n,this,r)}get type(){return this.data.type}static create(e,t,r,i){if(r.type==="light")return ul.createLigherLayer(e,t,r,i);if(r.type==="texture"||r.type==="video"){let n=r.type==="texture"?i.image(r.texture.image):i.video(r.texture.video),s=new oT(n,r.texture.wrapping),a=new ame(n),o=new ome(r.texture.repeat,r.texture.offset),l=new Ze(r.crop?1:0),u=new gr(r.projection??0),h=new gr(["x","y","z"].indexOf(r.axis)??0),c=new gr(r.side??0),d=new Gi(r.size?new J(r.size[0],r.size[1]):new J(100,100)),f=new Ze(r.blending??0),p=new Ze(r.alpha??1),m=new gr(r.mode??0),g=new Mn(r.isMask??!1),v=new c2(s,a,l,u,h,c,d,f,o,p,m,g),y=new Mr(v.calpha,"f");return new Gr(e,t,r,{texture:s,textureSize:a,crop:l,projection:u,axis:h,side:c,size:d,blending:f,mat:o,alpha:p,mode:m,isMask:g},v,m,y,g)}else if(r.type==="matcap"){let n=i.image(r.texture.image),s=new oT(n,r.texture.wrapping),a=new Ze(r.alpha??1),o=new gr(r.mode??0),l=new Mn(r.isMask??!1),u=new iH(s,a,o,l),h=new Mr(u.calpha,"f");return new Gr(e,t,r,{texture:s,alpha:a,mode:o,isMask:l},u,o,h,l)}else if(r.type==="displace")if(r.displacementType==="noise"){let n=new Ls(new P(...r.offset)),s=new Ze(r.scale??10),a=new Ze(r.intensity??8),o=new Ze(r.movement??1),l=new gr(r.noiseType??0),u=new gr(r.voronoiStyle??0),h=new Ze(r.smoothness??.5),c=new Ze(r.seed??0),d=new Ze(r.highCut??1),f=new Ze(r.lowCut??0),p=new gr(r.quality??1),m=new mH(a,o,n,u,h,c,d,f,p,s,l);return new bH(e,t,r,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:u,smoothness:h,seed:c,highCut:d,lowCut:f,quality:p},m)}else throw new Error;else return Nme(e,t,r,i)}updateByOp(e,t,r){let i=e;if(i.path[0]===void 0){if(i.type===0)return"type"in i.props||"category"in i.props||"visible"in i.props?(r.scene.markNeedsUpdateRendererDirty(),!0):Rme(i.props,r.shared,this,t)}else if(i.path[0]==="texture")return"texture"in t||"video"in t?wH(i.props,r.shared,this):!0;return!1}dispose(){if(kme(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Qc||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let r=`f${this.id}_${e}`;this.hasValueByKey(r)&&t!==void 0&&(this.uniforms[r].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let r=this.getName(t);r&&e.push(r)}return e}},Gr=class extends lh{constructor(e,t,r,i,n,s,a,o){super(e,t,r,i),this.params=i,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},bH=class extends lh{constructor(e,t,r,i,n){super(e,t,r,i),this.position=n}},ul=class extends lh{constructor(e,t,r,i,n){super(e,t,r,n),this.node=i}static createLigherLayer(e,t,r,i){let n,s=new Ze(r.alpha),a=new gr(r.mode),o=new Ze(r.bumpMapIntensity),l=new Ze(r.alphaOverride),u;if(!r.visible)n=new gH,u={};else if(r.category==="lambert"){n=new hme;let h=new Qr(i.color(r.emissive)??0),c=new Mn(r.occlusion??!0);u={emissive:h,occlusion:c},n.emissive=h,n.occlusion=c}else if(r.category==="toon"){n=new pme;let h=new Ze(r.shininess??30),c=new Qr(i.color(r.specular)??1118481);u={shininess:h,specular:c},n.shininess=h,n.specular=c}else if(r.category==="physical"){n=new fme;let h=new Ze(r.roughness??.3),c=new Ze(r.metalness??0),d=new Ze(r.reflectivity??.5),f=new Mn(r.occlusion??!0);u={roughness:h,metalness:c,reflectivity:d,occlusion:f},n.roughness=h,n.metalness=c,n.reflectivity=d,n.occlusion=f}else{n=new dme;let h=new Ze(r.shininess??30),c=new Qr(r.specular!==void 0?i.color(r.specular)??1118481:1118481),d=new Mn(r.occlusion??!0);u={shininess:h,specular:c,occlusion:d},n.shininess=h,n.specular=c,n.occlusion=d}return n.alpha=new Ze(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,u.alpha=n.shadingAlpha,u.mode=n.shadingBlend,u.bumpMapIntensity=n.bumpMapIntensity,u.alphaOverride=n.alphaOverride,new ul(e,t,r,n,u)}get category(){return this.node.category}};function kme(e){let t=e instanceof lh?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Cs(e){return{alpha:new Ze(e.alpha??1),mode:new gr(e.mode??0),isMask:new Mn(e.isMask??!1)}}function zme(e,t,r,i){switch(e.type){case"color":{let n=new Qr(i.color??Qs),s=Cs(i),a=new lT(n,s.alpha),o=new Mr(a.calpha,"f");return new Gr(t,r,e,{color:n,...s},a,s.mode,o,s.isMask)}case"fresnel":{let n=new Qr(i.color??16777215),s=new Ze(i.bias??.1),a=new Ze(i.scale??1),o=new Ze(i.intensity??2),l=new Ze(i.factor??1),u=Cs(i),h=new lme(n,s,a,o,l,u.alpha,u.mode,u.isMask),c=new Mr(h.calpha,"f");return new Gr(t,r,e,{color:n,bias:s,scale:a,intensity:o,factor:l,...u},h,u.mode,c,u.isMask)}case"rainbow":{let n=new Ze(i.filmThickness??30),s=new Ze(i.movement??0),a=new Ls(i.wavelengths??new P(0,0,0)),o=new Ze(i.noiseStrength??0),l=new Ze(i.noiseScale??1),u=new Ls(i.offset??new P(0,0,0)),h=Cs(i),c=new uH(n,s,a,o,l,u,h.alpha,h.isMask),d=new Mr(c.calpha,"f");return new Gr(t,r,e,{filmThickness:n,movement:s,wavelengths:a,noiseStrength:o,noiseScale:l,offset:u,...h},c,h.mode,d,h.isMask)}case"transmission":{let n=new Ze(i.thickness??10),s=new Ze(i.ior??1.5),a=new Ze(i.roughness??.5),o=mt.transmissionSize,l=mt.transmissionRenderTarget,u=mt.transmissionRenderTargetDepth,h=window.innerWidth,c=window.innerHeight,d=h>=c?new Gi(c/h,1):new Gi(1,h/c),f=Cs(i),p=new fH(n,s,a,o,l,u,d,f.alpha),m=new Mr(p.calpha,"f");return new Gr(t,r,e,{thickness:n,ior:s,roughness:a,aspectRatio:d,...f},p,f.mode,m,f.isMask)}case"toon":{let n=new gr(i.positioning??0),s;i.colors?s=new zc(i.colors.length,i.colors):(s=new zc(10,new Lt(0,0,0,1)),s.value[1]=new Lt(1,1,1,1));let a;i.steps?a=new kc(i.steps.length,i.steps):(a=new kc(10,1),a.value[0]=0);let o=new Ls(i.source??new P(0,0,0)),l=new Mn(i.isWorldSpace??!0),u=new Ze(i.noiseStrength??0),h=new Ze(i.noiseScale??1),c=new ll(i.shadowColor),d=new Ls(i.offset??new P(0,0,0)),f=Cs(i),p=new hH(n,s,a,o,l,u,h,c,d,f.alpha),m=new Mr(p.calpha,"f");return new Gr(t,r,e,{positioning:n,colors:s,steps:a,source:o,isWorldSpace:l,noiseStrength:u,noiseScale:h,shadowColor:c,offset:d,...f},p,f.mode,m,f.isMask)}case"outline":{let n=new Qr(i.outlineColor??16777215),s=new Qr(i.contourColor??16777215),a=new Ze(i.outlineWidth??.1),o=new Ze(i.contourWidth??.1),l=new Ze(i.outlineThreshold??.1),u=new Ze(i.contourThreshold??.1),h=new Ze(i.outlineSmoothing??.1),c=new Ze(i.contourFrequency??.1),d=new Ls(i.contourDirection??new P(0,1,0)),f=new Mn(i.positionalLines??!1),p=new Mn(i.compensation??!0),m=mt.normalRenderTarget,g=mt.normalRenderTargetDepth,v=mt.pixelRatioNode,y=mt.resolution,x=Cs(i),w=new aH(n,s,a,o,l,u,h,c,d,f,p,y,m,g,v,x.alpha),S=new Mr(w.calpha,"f");return new Gr(t,r,e,{outlineColor:n,contourColor:s,outlineWidth:a,contourWidth:o,outlineThreshold:l,contourThreshold:u,outlineSmoothing:h,contourFrequency:c,contourDirection:d,positionalLines:f,compensation:p,...x},w,x.mode,S,x.isMask)}case"depth":{let n=new gr(i.gradientType??0),s=new Mn(i.smooth??!1),a=new Ze(i.near??50),o=new Ze(i.far??200),l=new Ze(i.isVector??1),u=new Ze(i.isWorldSpace??0),h=new Ls(i.origin??new P),c=new Ls(i.direction??new P),d;i.colors?d=new zc(i.colors.length,i.colors):(d=new zc(2,new Lt(0,0,0,1)),d.value[1]=new Lt(1,1,1,1));let f;i.steps?f=new kc(i.steps.length,i.steps):(f=new kc(2,1),f.value[0]=0);let p=Cs(i),m=new J5(n,s,a,o,l,u,h,c,d,f,p.alpha,p.isMask),g=new Mr(m.calpha,"f");return new Gr(t,r,e,{gradientType:n,smooth:s,near:a,far:o,isVector:l,isWorldSpace:u,origin:h,direction:c,colors:d,steps:f,...p},m,p.mode,g,p.isMask)}case"noise":{let n=new Ze(i.scale??1),s=new Ls(i.size??new P(100,100,100)),a=new Ze(i.move??1),o=new Gi(i.fA??new J(1.7,9.2)),l=new Gi(i.fB??new J(8.3,2.8)),u=new Gi(i.distortion??new J(1,1)),h=new ll(i.colorA),c=new ll(i.colorB),d=new ll(i.colorC),f=new ll(i.colorD),p=new gr(i.noiseType??0),m=new gr(i.voronoiStyle??0),g=new Ze(i.highCut??1),v=new Ze(i.lowCut??0),y=new Ze(i.smoothness??.5),x=new Ze(i.seed??.5),w=new gr(i.quality??1),S=Cs(i),_=new nH(n,s,a,o,l,u,h,c,d,f,S.alpha,p,S.isMask,m,g,v,y,x,w),A=new Mr(_.calpha,"f");return new Gr(t,r,e,{scale:n,size:s,move:a,fA:o,fB:l,distortion:u,colorA:h,colorB:c,colorC:d,colorD:f,noiseType:p,...S,voronoiStyle:m,highCut:g,lowCut:v,smoothness:y,seed:x,quality:w},_,S.mode,A,S.isMask)}case"normal":{let n=new Ls(i.cnormal??new P(1,1,1)),s=Cs(i),a=new Z5(n,s.alpha),o=new Mr(a.calpha,"f");return new Gr(t,r,e,{cnormal:n,...s},a,s.mode,o,s.isMask)}case"gradient":{let n=new gr(i.gradientType??0),s=new Mn(i.smooth??!1),a;i.colors?a=new zc(i.colors.length,i.colors):(a=new zc(10,new Lt(0,0,0,1)),a.value[1]=new Lt(1,1,1,1));let o;i.steps?o=new kc(i.steps.length,i.steps):(o=new kc(10,1),o.value[0]=0);let l=new Gi(i.offset??new J(0,0)),u=new Gi(i.morph??new J(0,0)),h=new Ze(i.angle??0),c=Cs(i),d=new tH(n,s,a,o,l,u,h,c.alpha,c.isMask),f=new Mr(d.calpha,"f");return new Gr(t,r,e,{gradientType:n,smooth:s,colors:a,steps:o,offset:l,morph:u,angle:h,...c},d,c.mode,f,c.isMask)}case"pattern":{let n=new gr(i.style??0),s=new gr(i.projection??0),a=new gr(["x","y","z"].indexOf(i.axis)??0),o=new Ze(i.blending??0),l=new Gi(i.offset??new J(0,0)),u=new ll(i.colorA),h=new ll(i.colorB),c=new Gi(i.frequency??new J(10,10)),d=new Ze(i.size??.5),f=new Ze(i.variation??0),p=new Ze(i.smoothness??.5),m=new Ze(i.zigzag??0),g=new Ze(i.rotation??0),v=new Gi(i.vertical??new J(0,1)),y=new Gi(i.horizontal??new J(0,1)),x=new gr(i.sides??6),w=Cs(i),S=new oH(n,s,a,o,l,u,h,c,d,f,p,m,g,v,y,x,w.alpha,w.isMask),_=new Mr(S.calpha,"f");return new Gr(t,r,e,{style:n,projection:s,axis:a,blending:o,offset:l,colorA:u,colorB:h,frequency:c,size:d,variation:f,smoothness:p,zigzag:m,rotation:g,vertical:v,horizontal:y,sides:x,...w},S,w.mode,_,w.isMask)}default:{let n=new Qr(1,0,0,1),s=Cs(i),a=new lT(n,s.alpha),o=new Mr(a.calpha,"f");return new Gr(t,r,e,{color:n,...s},a,s.mode,o,s.isMask)}}}function Nme(e,t,r,i){let n=wme(r,i);return zme(r,e,t,n)}function _H(e,t,r){if(r.type==="displace"&&(e==="intensity"||e==="visible")){let i=t.uniforms[`f${t.id}_intensity`];return i?(i.value=r.intensity*(r.visible?1:0),i):void 0}if(r.type!=="displace"&&(e==="alpha"||e==="visible")){let i=t.uniforms[`f${t.id}_alpha`];if(!i)return;if(i.value=r.alpha*(r.visible?1:0),r.type==="outline"&&e==="visible"){let n=t.uniforms[`f${t.id}_compensation`];n&&(n.value=r.compensation&&r.visible)}return i}}function Zx(e,t){let r=0,i=e.layers.find(n=>n.data.type==="light");if(i&&i.data.alphaOverride<1)return!0;for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,u=t.color(n.data.colorD).a,h=Math.min(a,Math.min(o,Math.min(l,u)));h<1&&(s=h)}r+=(1-r)*s}}return r<1}var ic=class extends br{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},Bme=class extends ic{constructor(e,t,r,i){super(),this.flatShading=e,this.side=t,this.wireframe=r,this.root=i}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,r){return this.root.getFlavor(e,t,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,r){this.root.updateByOp(e,t,r)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},d2=class extends ic{constructor(e,t){super(),this.data=e,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,r){let i=r?6:(e?3:0)+t;if(i===0)return this;this.flavors===void 0&&(this.flavors=[]),i-=1;let n=this.flavors[i];return n===void 0&&(n=new Bme(e,t,r,this),this.flavors[i]=n,n.flatShading=e,n.side=t,n.updateAfterBuild()),n}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t){this.data!==e&&this.reset0(e,t)}reset0(e,t){this.data=e;let r=e.layers??an.defaultTwoLayerData("phong").layers;try{this.layers=r.map(i=>lh.create(this.layerIdGen++,i.id,i.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(),this.transparent=Zx(e,t.shared)}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(e=>e instanceof ul),this.lightLayer===void 0&&(this.lightLayer=new ul(0,"",{...Nn.defaultData("light","phong"),visible:!1},new gH,{})),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let e=this.layers.find(n=>n instanceof ul);if(!e)return;let t=e.data,r=t.bumpMap,i=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof Gr&&s.color instanceof c2&&(s.uuid===r&&(e.node.bumpMap=s.color),s.uuid===i&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,r){if(t!==void 0?this.data=t:t=this.data,this.transparent=Zx(t,r.shared),e.path[0]==="layers"){this.data=t;let i=r.shared,n=e.path[1];if(n===void 0){if(this.layers.reverse(),e.type===4){let s=lh.create(this.layerIdGen++,e.id,e.data,r.shared);this.layers.splice(e.localIndex,0,s),r.scene.markNeedsUpdateRendererDirty()}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose(),r.scene.markNeedsUpdateRendererDirty();else if(e.type===6){let s=this.layers.findIndex(o=>o.uuid===e.id),a=this.layers[s];this.layers.splice(s,1),this.layers.splice(e.localIndex,0,a),r.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate()}else{e.type===0&&e.props.occlusion!==void 0&&r.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n);if(s.updateByOp({...e,path:e.path.slice(2)},a,r)){let o=lh.create(this.layerIdGen++,n,a,i);this.layers.splice(this.layers.findIndex(l=>l.uuid===n),1,o),this.onUpdate()}}}}else this.reset(t,r)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Gr?t.color.mask=void 0:t instanceof ul&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Gr&&t.isMask.value&&t.data.visible&&e>0){let r=e-1,i=this.layers[r];i instanceof ul?i.node.mask=new kn(t.color,t.alpha,kn.MUL):i instanceof Gr&&(i.isMask.value||(i.color.mask=new kn(t.color,t.alpha,kn.MUL)))}}}blendColors(){let e=this.layers.findIndex(r=>r instanceof Gr),t=this.layers.findIndex(r=>r instanceof ul);if(e!==-1&&e<t){let r=this.layers[e].color;for(let i=e+1;i<t;++i){let n=this.layers[i];if(n instanceof Gr){if(n.isMask.value)continue;r=new Rk(r,n.color,n.alpha,n.mode)}}this.fragment.color=r}else this.fragment.color=void 0}blendAfterColors(){let e=new Mr("outgoingLight","f"),t=this.layers.findIndex(r=>r instanceof ul);if(this.layers.length>t+1){for(let r=t+1;r<this.layers.length;++r){let i=this.layers[r];if(i instanceof Gr){if(i.isMask.value)continue;e=new Rk(e,i.color,i.alpha,i.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof bH);if(e.length>0){let t=e[0].position;for(let r=1;r<e.length;++r)e[r]&&(t=new kn(t,e[r].position,kn.ADD),t=new kn(t,new Ze(.5).setReadonly(!0),kn.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let r=(i,n,s)=>Math.min(Math.max(i,n),s);for(let i of this.layers)if(i.type==="displace"){let n=r(i.uniforms[`f${i.id}_intensity`].value,e,t);i.uniforms[`f${i.id}_intensity`].value=n}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if(t.type==="light")e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let r=(yH[t.type]??[]).map(o=>t[o]),i=(xH[t.type]??[]).map(o=>{var l;return((l=t[o])==null?void 0:l.length)??0}),n=[...r,...i],s="isMask"in t&&t.isMask,a=`"${t.type}-${t.visible}-${s}"`;n.length?e+=`[${a}, "${n.join('","')}"],`:e+=a}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new sme;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Gr){let t=e.params.texture;if(t instanceof oT&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(ic.prototype,{properties:{get:function(){return this.fragment.properties}}});var cT=class extends d2{},Fme=dp(S$()),kk=new Map;function Ume(e){if(typeof e=="string")return e;let t=kk.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},kk.set(e,t)),t.url}var Xm=class{constructor({src:e,volume:t,delay:r,loop:i}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:Ume(e),format:"wav"},this.sound=new Fme.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),r!==void 0&&(this.delay=r),i!==void 0&&(this.loop=i)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,r){this.sound.on(e,t,r)}off(e,t,r){this.sound.off(e,t,r)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},jme=class{constructor(){this.type="ShapePath",this.color=new gt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new yx,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var r;return(r=this.currentPath)==null||r.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,r,i,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function r(f,p,m,g){let v=f.x,y=p.x,x=m.x,w=g.x,S=f.y,_=p.y,A=m.y,M=g.y,T=(w-x)*(S-A)-(M-A)*(v-x),C=(y-v)*(S-A)-(_-S)*(v-x),L=(M-A)*(y-v)-(w-x)*(_-S),I=T/L,k=C/L;if(L===0&&T!==0||I<=0||I>=1||k<0||k>1)return null;if(T===0&&L===0){for(let z=0;z<2;z++)if(i(z===0?m:g,f,p),t.loc===e.ORIGIN){let V=z===0?m:g;return{x:V.x,y:V.y,t:t.t}}else if(t.loc===e.BETWEEN){let V=+(v+t.t*(y-v)).toPrecision(10),K=+(S+t.t*(_-S)).toPrecision(10);return{x:V,y:K,t:t.t}}return null}else{for(let K=0;K<2;K++)if(i(K===0?m:g,f,p),t.loc===e.ORIGIN){let q=K===0?m:g;return{x:q.x,y:q.y,t:t.t}}let z=+(v+I*(y-v)).toPrecision(10),V=+(S+I*(_-S)).toPrecision(10);return{x:z,y:V,t:I}}}function i(f,p,m){let g=m.x-p.x,v=m.y-p.y,y=f.x-p.x,x=f.y-p.y,w=g*x-y*v;if(f.x===p.x&&f.y===p.y){t.loc=e.ORIGIN,t.t=0;return}if(f.x===m.x&&f.y===m.y){t.loc=e.DESTINATION,t.t=1;return}if(w<-Number.EPSILON){t.loc=e.LEFT;return}if(w>Number.EPSILON){t.loc=e.RIGHT;return}if(g*y<0||v*x<0){t.loc=e.BEHIND;return}if(Math.sqrt(g*g+v*v)<Math.sqrt(y*y+x*x)){t.loc=e.BEYOND;return}let S;g!==0?S=y/g:S=x/v,t.loc=e.BETWEEN,t.t=S}function n(f,p){let m=[],g=[];for(let v=1;v<f.length;v++){let y=f[v-1],x=f[v];for(let w=1;w<p.length;w++){let S=p[w-1],_=p[w],A=r(y,x,S,_);A!==null&&m.find(M=>M.t<=A.t+Number.EPSILON&&M.t>=A.t-Number.EPSILON)===void 0&&(m.push(A),g.push(new J(A.x,A.y)))}}return g}function s(f,p,m){let g=new J;p.getCenter(g);let v=[];return m.forEach(y=>{y.boundingBox.containsPoint(g)&&n(f,y.points).forEach(x=>{v.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),v.sort((y,x)=>y.point.x-x.point.x),v}function a(f,p,m,g,v){(v==null||v==="")&&(v="nonzero");let y=new J;f.boundingBox.getCenter(y);let x=[new J(m,y.y),new J(g,y.y)],w=s(x,f.boundingBox,p);w.sort((C,L)=>C.point.x-L.point.x);let S=[],_=[];w.forEach(C=>{C.identifier===f.identifier?S.push(C):_.push(C)});let A=S[0].point.x,M=[],T=0;for(;T<_.length&&_[T].point.x<A;)M.length>0&&M[M.length-1]===_[T].identifier?M.pop():M.push(_[T].identifier),T++;if(M.push(f.identifier),v==="evenodd"){let C=M.length%2===0,L=M[M.length-2];return{identifier:f.identifier,isHole:C,for:L}}else if(v==="nonzero"){let C=!0,L=null,I=null;for(let k=0;k<M.length;k++){let z=M[k];p[z]&&(C?(I=p[z].isCW,C=!1,L=z):I!==p[z].isCW&&(I=p[z].isCW,C=!0))}return{identifier:f.identifier,isHole:C,for:L}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let o=0,l=999999999,u=-999999999,h=[];this.subPaths.forEach(f=>{let p=f.getPoints(),m=-999999999,g=999999999,v=-999999999,y=999999999;for(let x=0;x<p.length;x++){let w=p[x];w.y>m&&(m=w.y),w.y<g&&(g=w.y),w.x>v&&(v=w.x),w.x<y&&(y=w.x)}u<=v&&(u=v+1),l>=y&&(l=y-1),p.length&&h.push({curves:f.curves,points:p,isCW:F4.isClockWise(p),identifier:o++,boundingBox:new Bre(new J(y,g),new J(v,m))})});let c=h.map(f=>{var p;return a(f,h,l,u,(p=this.userData)==null?void 0:p.style.fillRule)}),d=[];return h.forEach(f=>{let p=c[f.identifier];if(p&&!p.isHole){let m=new xx;m.curves=f.curves,c.filter(g=>(g==null?void 0:g.isHole)&&g.for===f.identifier).forEach(g=>{if(g){let v=h[g.identifier],y=new yx;y.curves=v.curves,m.holes.push(y)}}),d.push(m)}}),d}},SH,zk=new Promise(e=>{SH=e}),Nk=!1,Fy;function Hme(){if(Nk)return;if(Fy)return Fy;async function e(){let t=await Iv(()=>import("./opentype-fc28cde9.js"),[],import.meta.url);SH(t),Nk=!0}return Fy=e(),Fy}var Vme=class{async load(e,t,r=()=>{}){let{load:i}=await zk;i(e,(n,s)=>{n||!s?r(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:r}=await zk;try{let i=t(e),n=new r,s=a=>i.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(i,i.defaultRenderOptions.features),{font:i,bidi:n}}catch(i){console.error(i)}}};async function Wme(e){return await(await fetch(e)).arrayBuffer()}var Gme=new Vme;async function Bk(e){let t,r,i=!1;if(e.url?(t=await Wme(e.url),r=e.url,i=e.url.startsWith("/")):e.data&&(t=e.data.buffer),t){let n=await Gme.parse(t);if(n)return{font:n.font,url:r,intercepted:i,arr:t,bidi:n.bidi}}}function Yme(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var qme=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Bk(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=Bk(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,r){if(!this._bidi)return[];let i=this._bidi;i.getTextGlyphs(t);let n=i.tokenizer.tokens,s=[],a=0,o=r.length===n.length;for(let l=0;l<r.length;l++){let u=r[l].index,h=String.fromCharCode(r[l].unicode),c=n[a];if(Yme(u,c)||o)s.push({char:h,index:u,replacements:[c.state.glyphIndex],replacementChars:[c.char]}),a++;else{let d=c.char,f="",p=[c.state.glyphIndex],m=[],g=!1;for(;!g;)a++,f=t.charAt(a),d+=f,p.push(e.charToGlyphIndex(f)),m=e.stringToGlyphs(d),m.length===1&&m[0].index===u&&(g=!0),a>t.length&&(g=!0);s.push({char:h,index:u,replacements:p,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let r=this.font,i=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(v=>this.getTextWidth(v,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,u=this.computeSpaceWidthForLine(e,0,t),h=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),c=this.getLineInitialOffsetY(n,e.length,t.height,i,t.verticalAlign),d=[],f=e.map(v=>[]),p=e.map(v=>[]),m;for(let v=0;v<e.length;v++){let y=e[v],x={features:{liga:!0}},w=[];try{w=r.stringToGlyphs(y,x)}catch(_){console.warn(_)}h=this.getLineInitialOffsetX(s[v],a,t.horizontalAlign,y,o);let S=[];try{S=this.reverseLigaturesTable(r,y,w)}catch(_){console.warn(_)}u=this.computeSpaceWidthForLine(e,v,t);for(let _=0;_<w.length;_++){let A=w[_],M=A.index===0?`
`:A.unicode?String.fromCharCode(A.unicode):void 0,T=S[_],C=0,L=0;_===0&&t.horizontalAlign===2&&A.leftSideBearing!==void 0&&(L=-A.leftSideBearing*i),m&&(C=r.getKerningValue(A,m)*i),h+=L+C;let I=0;if(M===`
`)I=l;else if(M===" ")I=u;else{let k=this.createPath(A,i,h,c,t);k&&(I=k.offsetX-(C+L),d.push(k.path))}if(T.replacements.length===1)p[v].push([h,c]),f[v].push(I);else{let k=T.replacements.map(q=>(r.glyphs.get(q).advanceWidth??0)*i),z=k.reduce((q,O)=>q+=O,0),V=k.map(q=>q/z),K=h;for(let q=0;q<V.length;q++){let O=I*V[q];p[v].push([K,c]),f[v].push(O),K+=O}}h+=I,m=A}c-=n}let g=[];for(let v=0,y=d.length;v<y;v++)g.push(...d[v].toShapes());return{shapes:g,charWidths:f,lineWidths:s,charCoords:p}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,r,i,n){return(r===3||r===2)&&i.indexOf(`
`)>=0&&(e-=n),r===3?t*.5-e*.5:r===2?t-e:0}getLineInitialOffsetY(e,t,r,i,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*i,o=e-a,l=-this.ascender*i-o/2;return n===3?-(r-s-l):n===2?-(r*.5-s*.5-l):l}createPath(e,t,r,i,n){var l;let s=e.getPath(r,-i,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new jme,o=(e.advanceWidth??1)*t;if(e)for(let u of s.commands){let h=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(h&&u.type!=="Z"&&h.x===u.x&&-h.y===u.y))switch(u.type){case"M":a.moveTo(u.x,-u.y);break;case"L":a.lineTo(u.x,-u.y);break;case"Q":a.quadraticCurveTo(u.x1,-u.y1,u.x,-u.y);break;case"C":a.bezierCurveTo(u.x1,-u.y1,u.x2,-u.y2,u.x,-u.y);break}}return a.subPaths.forEach(u=>{let h=Xme(u.curves);h!==void 0&&u.currentPoint.distanceTo(h)>0&&u.lineTo(h.x,h.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var r;return((r=this.font)==null?void 0:r.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var r;return((r=this.font)==null?void 0:r.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,r){let i=this.getCharWidth(" ",r),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(r.horizontalAlign===4&&t<e.length-1&&s){let a=r.width,o=this.getTextWidth(n,r);return(a-(o-s*i))/s}}return i}countSpaces(e){return(e.match(/ /g)||[]).length}};function Xme(e){if(e.length){let t=e[0];if(t instanceof Aa)return t.v1;if(t instanceof ya||t instanceof tc)return t.v0}}var $me=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t),this.objects.set(e,r)):r.isShared=!0,r}mutateIfUnique(e,t){let r=this.objects.get(e);if(r&&r.isShared!==!0)return this.objects.delete(e),this.objects.set(t,r),r}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let r=this.objects.get(e);t===r&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},Fk=class extends $me{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t){let r=Qx(e,t,this.flatShading);return r.computeBoundingSphere(),r}},Qme={markNeedsUpdateRendererDirty:()=>{}},Kme=class extends xme{constructor(e){super(),this.shared=e}create(e){return new vH(e,this.shared)}},f2=class{constructor(e,t={}){if(this.geometryCache=new Fk(!0),this.geometryCache2=new Fk(!1),this.imageHolderCache=new Kme(this),this.thisContext={scene:Qme,shared:this},this.deletedMaterial=new cT(an.defaultTwoLayerData("phong"),this.thisContext),this.deletedImage=new Qc(Gx.emptyImage,this),this.deletedVideo=new Qc(Bx.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[r,i]of Object.entries(t.images))this.addImage(r,i);if(t.videos)for(let[r,i]of Object.entries(t.videos))this.addVideo(r,i);if(t.audios)for(let[r,i]of Object.entries(t.audios))this.addAudio(r,i.data);this.reset(e)}setRequestRender(e){this._requestRender=e}reset(e){for(let[t,r]of Object.entries(e.images))this.addImage(t,r);for(let[t,r]of Object.entries(e.videos))this.addVideo(t,r);for(let[t,r]of Object.entries(e.colors))this.addColor(t,r);for(let[t,r]of Object.entries(e.materials))this.addMaterial(t,new cT(r,this.thisContext));for(let[t,r]of Object.entries(e.audios))this.addAudio(t,r.data);for(let[t,r]of Object.entries(e.fonts))this.addFont(t,r)}addMaterial(e,t){t.uuid=e,this.materials[e]?(this.materials[e].reset(t.data,this.thisContext),t.dispose()):this.materials[e]=t}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new d2(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Qc(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Qc(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new Kx(t.r,t.g,t.b,t.a):this.colors[e]=new Kx(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let r=this.colors[e];return this.colors[e].r=t.r??r.r,this.colors[e].g=t.g??r.g,this.colors[e].b=t.b??r.b,this.colors[e].a=t.a??r.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let r=this.getColor(e);r?t=r:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new $n(0,0,0,0))}else return"a"in e?new $n(e.r,e.g,e.b,e.a):new $n(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof Xm)return t;{let r=new Xm({src:t});return this.audios[e]=r,r}}deleteAudio(e){let t=this.audios[e];t&&(t instanceof Xm&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new qme(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof Xm&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}};new f2(qA.emptyData());var Dp=class extends es{updateByPatchedOp(e,t,r){if(super.updateByPatchedOp(e,t,r),Lhe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[i,n]of Object.entries(e.props)){let s=r.shared.material(n);this.material[Number(i)]=s}else if(js(e.path,["material"])&&this.material instanceof ic)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(ms.drop(e,1),t.material,r);else if(js(e.path,["materials","*"])&&Array.isArray(this.material)){let i=e.path[1];if("materials"in t&&i<this.material.length){let n=t.materials[i];typeof n!="string"&&this.material[i].updateByOp(ms.drop(e,2),n,r)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var i,n;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let r=this.dataPatched;if(((i=e.geometry)==null?void 0:i.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(r.flatShading,r.side,r.wireframe),t.scene.markNeedsUpdateRendererDirty()),((n=e.geometry)==null?void 0:n.type)==="NonParametricGeometry"&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(s=>t.shared.material(s).getFlavor(r.flatShading,r.side,r.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(r.flatShading,r.side,r.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let s=0;s<this.material.length;s++)this.material[s]=this.material[s].getFlavor(r.flatShading,r.side,r.wireframe);else this.material=this.material.getFlavor(r.flatShading,r.side,r.wireframe)}disposeMaterial(){this.material&&Oj(this.material).forEach(e=>{e instanceof ic&&(e instanceof cT||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},Uk=new P,jk=new Lt,Hk=new Lt,Zme=new P,Vk=new Oe,Qn=class extends Dp{constructor(e,t,r){super(e,t),this.data=t,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.isSkinnedMesh=!0,this.bindMode=t.bindMode,this.bindMatrix=new Oe().fromArray(t.bindMatrix),this.bindMatrixInverse=new Oe)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof _t&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof f2){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return jx.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return jx.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,r){super.updateByPatchedOp(e,t,r),js(e.path,["geometry"])&&this.updateByPatchedOpGeometry(ms.drop(e,1),t.geometry,r)}removeInteractionGeometry(){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var i;this.invalidateDownstreamBooleanData();let r=this.data.geometry.type;if(r==="NonParametricGeometry"||r==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let u={...this.data.geometry,...n};this.localGeometry=Qx(u,t,this.data.flatShading)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&sT(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...e};(i=this.localGeometry)==null||i.dispose(),this.localGeometry=Qx(n,t,this.data.flatShading)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,r){var n;let i=!1;e.type===0&&e.path.length===0&&UD(["scaleBaked"],Object.keys(e.props))&&this.geometryCreateDeleyed instanceof _n&&this.chooseGeoemtryCache(r.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(i=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(r),this.refreshAttachedPaths(r)),i||((n=r.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(r)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let r=this.geometry.userData.parameters;this.is2DType?e.set(0,0,r.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(r.width,r.height,r.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(r.width,r.height,r.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new Lt,r=this.geometry.attributes.skinWeight;for(let i=0,n=r.count;i<n;i++){t.fromBufferAttribute(r,i);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),r.setXYZW(i,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let r=this.skeleton;if(r===void 0)return;let i=this.geometry;jk.fromBufferAttribute(i.attributes.skinIndex,e),Hk.fromBufferAttribute(i.attributes.skinWeight,e),Uk.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=Hk.getComponent(n);if(s!==0){let a=jk.getComponent(n);Vk.multiplyMatrices(r.bones[a].matrixWorld,r.boneInverses[a]),t.addScaledVector(Zme.copy(Uk).applyMatrix4(Vk),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function Jme(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,r=e.geometry.attributes,i=r.position.array,n=r.normal.array,s=new Float32Array(i.length);for(let l=0;l<i.length;l+=3){let u=`${i[l]}_${i[l+1]}_${i[l+2]}`,h=new P(n[l],n[l+1],n[l+2]);t.has(u)?(a=t.get(u))==null||a.normals.push(h):t.set(u,{normals:[h],result:new P})}t.forEach((l,u)=>{for(let h of l.normals)l.result.add(h);l.result.divideScalar(l.normals.length)});for(let l=0;l<i.length;l+=3){let u=`${i[l]}_${i[l+1]}_${i[l+2]}`,h=(o=t.get(u))==null?void 0:o.result;h&&(s[l]=h.x,s[l+1]=h.y,s[l+2]=h.z)}e.geometry.setAttribute("extrudeNormal",new nt(s,3))}function ege(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,r=new Float32Array(t.length),i=new P;for(let n=0;n<t.length;n+=3)i.set(t[n],t[n+1],t[n+2]).normalize(),r[n]=i.x,r[n+1]=i.y,r[n+2]=i.z;e.geometry.setAttribute("extrudeNormal",new nt(r,3))}function p2(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof ic)||e.material.getLayersOfType("outline").length===0)return;e instanceof Qn&&e.is2DAndNoDepth?ege(e):Jme(e)}function m2(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,r=new Float32Array(t.length),i=parseInt(e.uuid.replace(/\D/g,"")),n=[zt.seededRandom(i),zt.seededRandom(i+1e4),zt.seededRandom(i+2e4)];for(let s=0;s<t.length;s++)r[s]=n[s%3];e.geometry.setAttribute("randomColor",new Mt(r,3))}a2.then(e=>{});var Va=new ai,bm=new P;function tge(e){let t=!1;return e.scene.objects.traverse((r,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var lv=class extends Qn{constructor(t,r,i){super(t,r,i),this.data=r,this.hiddenMatrixOld=new Oe,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,r){let i=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),r.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(t){var a,o,l;if(this.skipReactionUpdate===!0)return;let r=(a=this.localGeometry)==null?void 0:a.uuid,{originalGeometry:i,subdividedGeometry:n,subdivPointer:s}=_n.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,i!==void 0&&((o=this.originalGeometry)==null||o.dispose(),this.originalGeometry=i),n!==void 0&&((l=this.subdividedGeometry)==null||l.dispose(),this.subdividedGeometry=n??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,p2(this),m2(this),this.calcBoundingBox(),r&&(this.localGeometry.uuid=r)}updateState(t,r){if(super.updateState(t,r),t.flatShading!==void 0){let i=this.material;this.material=i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(r)}}updateMesh(t=!1){_n.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&_n.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=_n.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=_n.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,r){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,es.prototype.raycast.call(this,t,r),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new ys,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let r=t.attributes.position,i=t.boundingSphere.center;Va.setFromBufferAttribute(r),Va.getCenter(i),t.boundingSphere.radius=i.distanceTo(Va.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Va.getSize(bm),this.hasNonUniformScale&&bm.divide(this.scale);let n={width:bm.x,height:bm.y,depth:bm.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(t){let r=this.originalGeometry;Va.min.set(t[0],t[2],t[4]),Va.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(Va.min.applyMatrix4(this.shearScaleInv),Va.max.applyMatrix4(this.shearScaleInv)),r.boundingSphere===null&&(r.boundingSphere=new ys);let i=r.boundingSphere.center;Va.getCenter(i),r.boundingSphere.radius=i.distanceTo(Va.max)}freeSubdivPointer(){var t,r;this.subdivPointer&&(_n.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(t=this.originalGeometry)==null||t.dispose(),(r=this.subdividedGeometry)==null||r.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,r,i){super.updateByPatchedOpGeometry(t,r,i),this.localGeometry&&this.createGeometryByControls(r)}},Wk=-1,rge=1,ige={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},nge={polygon_center:0,edge:1,vertex:2},Uy=(e,t)=>(r,i)=>!t||r===0||e===0?0:e*i/100,Pt=(e,t)=>{let r=Math.abs(t),i=r*-1;return(e-Wk)*(r-i)/(rge-Wk)+i};function sge(e){let t=[],r={};for(var i=0,n=e.length;i<n;i++){var s=JSON.stringify(e[i].pos.map(a=>Math.round(a*1e4)/1e4));r[s]||(t.push(e[i]),r[s]=!0)}return t}var age=new P,jy=new P,oge=new P,lge=new P;function Ef(e,t){let r=oge.fromArray(e),i=lge.fromArray(t);jy.copy(i).sub(r);let n=jy.length();return jy.normalize().multiplyScalar(n*.5),age.copy(r).add(jy).toArray()}var Bs=new nn,Hy=new P,Jx=new P,Hc=new P;function uge(e){let t=[];for(let r=0;r<=e.index.count;r++)if(Hy.fromArray(e.index.array,r*3),Bs.setFromAttributeAndIndices(e.attributes.position,Hy.x,Hy.y,Hy.z),Bs.getNormal(Jx),Bs.getMidpoint(Hc),!(isNaN(Hc.x)||isNaN(Hc.y)||isNaN(Hc.z))){let{a:i,b:n,c:s}=Bs,a=i.toArray(),o=n.toArray(),l=s.toArray(),u=i.distanceTo(n),h=n.distanceTo(s),c=s.distanceTo(i),d=Ef(a,o),f=Ef(o,l),p=Ef(l,a),m=[u,h,c],g=Math.max(...m),v=m.filter(w=>Math.round(w)===Math.round(g)).length>1,y=[],x=Bs.getMidpoint(Hc).toArray();g===u&&!v&&(y=[f,p,p],x=d),g===h&&!v&&(y=[d,p,p],x=f),g===c&&!v&&(y=[d,f,f],x=p),v&&(y=[d,f,p]),t.push({vertices:[a,o,l],faceCenters:y,midpoint:x,norm:Bs.getNormal(Jx).toArray()})}return t}function cge(e){let t=[],{position:r}=e.attributes;for(let i=0;i<r.count;i++){Bs.setFromAttributeAndIndices(r,i*3,i*3+1,i*3+2),Bs.getNormal(Jx),Bs.getMidpoint(Hc);let n=Bs.a.toArray(),s=Bs.b.toArray(),a=Bs.c.toArray();t.push({vertices:[n,s,a],faceCenters:[Ef(n,s),Ef(s,a),Ef(a,n)],midpoint:Hc.toArray(),norm:Jx.toArray()})}return t}var hge=4,dge=.5,sM=e=>.5*(1-Math.cos(e*Math.PI)),fge=class{constructor(){this.perlin=new Array(4095+1)}noise(e,t=0,r=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let g=0;g<4095+1;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),r<0&&(r=-r);let i=Math.floor(e),n=Math.floor(t),s=Math.floor(r),a=e-i,o=t-n,l=r-s,u,h,c=0,d=.5,f,p,m;for(let g=0;g<hge;g++){let v=i+(n<<4)+(s<<8);u=sM(a),h=sM(o),f=this.perlin[v&4095],f+=u*(this.perlin[v+1&4095]-f),p=this.perlin[v+16&4095],p+=u*(this.perlin[v+16+1&4095]-p),f+=h*(p-f),v+=256,p=this.perlin[v&4095],p+=u*(this.perlin[v+1&4095]-p),m=this.perlin[v+16&4095],m+=u*(this.perlin[v+16+1&4095]-m),p+=h*(m-p),f+=sM(l)*(p-f),c+=f*d,d*=dge,i<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(i++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return c}noiseSeed(e){let t=(()=>{let r,i;return{setSeed(n){i=r=(n??Math.random()*4294967296)>>>0},getSeed(){return r},rand(){return i=(1664525*i+1013904223)%4294967296,i/4294967296}}})();t.setSeed(e),this.perlin=new Array(4095+1);for(let r=0;r<4095+1;r++)this.perlin[r]=t.rand()}},pge=fge,Gk=new P,Yk=new Oe,qk=new pp;function Xk(e){let t=!1;return e.scene.objects.traverse((r,i)=>{i.type==="Mesh"&&i.geometry.type==="TextGeometry"&&(t=!0)}),t}var MH=class extends Qn{constructor(e,t,r){super(e,t,r),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:r}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(Yk.copy(r).invert(),qk.copy(e.ray).applyMatrix4(Yk),qk.intersectBox(this.singleBBox,Gk))){let i=Gk.applyMatrix4(r),n=e.ray.origin.distanceTo(i);t.push({distance:n,point:i.clone(),object:this})}}},vn=1e-4,Wa,EH,AH,TH,$k=new P,Qk=new P;a2.then(e=>{Wa=e,EH=[Wa.get_face_center,Wa.get_edge_midpoint,Wa.get_vertex_position],AH=[Wa.get_face_normal,Wa.get_edge_normal,Wa.get_vertex_normal],TH=[Wa.face_count,Wa.edge_count,Wa.vertex_count]});var mge=new Oe,gge=new Oe,lu=new P,Ec=new P,_m=new P,aM=new P,vge=new P,yge=new P,$o=new pge,ba=class extends ZD(dr){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof sn&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof sn&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(t=0),this.parameters.type==="toObject"&&this.objectForSample){for(let i=0,n=this.children.length;i<n;++i)this.remove(this.children[0]);let r=this.children;if(r.length===t)return;if(r.length<t)for(let i=0,n=t-r.length;i<n;++i){let s=new sn(this.object);s.expand(),this.add(s)}else for(let i=0,n=r.length-t;i<n;++i)this.remove(r[i])}else{if(this.children.length===t)return;if(this.children.length<t)for(let r=0,i=t-this.children.length;r<i;++r){let n=new sn(this.object);n.expand(),this.add(n)}else for(let r=0,i=this.children.length-t;r<i;++r)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,r=t.start*zt.DEG2RAD,i=t.end*zt.DEG2RAD,n=r-i,s=new Ri(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new P(0,0,1);break;case"y":a=new P(0,1,0);break;default:case"x":a=new P(1,0,0);break}let o=e.randomnessObject??Ou.defaultData([1,1,1]).randomnessObject,l=o.noiseType==="perlin";$o.noiseSeed(o.seed);let u=VS((0,mm.default)(o.seed)),h=Uy(o.strength,this.parameters.randomness);for(let[c,d]of this.children.entries()){let f=c*(o.freqScale/10)+o.movement,p=l?$o.noise(f):u(f,f),m=c+1;d.scale.x=t.scale[0]+h(m,Pt(p,o.scale[0]))||vn,d.scale.y=t.scale[1]+h(m,Pt(p,o.scale[1]))||vn,d.scale.z=t.scale[2]+h(m,Pt(p,o.scale[2]))||vn,d.position.setScalar(0);let g=n/e.count*c-r;switch(t.axis){case"x":d.rotation.set(0,g,0);break;case"y":d.rotation.set(0,0,g);break;case"z":d.rotation.set(g,0,0);break}d.translateOnAxis(a,t.radius),d.position.x+=t.position[0]+h(m,Pt(p,o.position[0])),d.position.y+=t.position[1]+h(m,Pt(p,o.position[1])),d.position.z+=t.position[2]+h(m,Pt(p,o.position[2]));let v=h(m,Pt(p,o.rotation[0])),y=h(m,Pt(p,o.rotation[1])),x=h(m,Pt(p,o.rotation[2]));t.alignment===!0?(d.rotation.x+=s.x+v,d.rotation.y+=s.y+y,d.rotation.z+=s.z+x):d.rotation.set(s.x+v,s.y+y,s.z+x)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,r=new Ri(t.rotation[0],t.rotation[1],t.rotation[2]),i=e.randomnessObject??Ou.defaultData([1,1,1]).randomnessObject,n=i.noiseType==="perlin";$o.noiseSeed(i.seed);let s=VS((0,mm.default)(i.seed)),a=Uy(i.strength,this.parameters.randomness);for(let[o,l]of this.children.entries()){let u=o*(i.freqScale/10)+i.movement,h=n?$o.noise(u):s(u,u),c=o+1,d=a(c,Pt(h,i.rotation[0])),f=a(c,Pt(h,i.rotation[1])),p=a(c,Pt(h,i.rotation[2]));l.scale.x=1+(t.scale[0]-1)*o+a(c,Pt(h,i.scale[0]))||vn,l.scale.y=1+(t.scale[1]-1)*o+a(c,Pt(h,i.scale[1]))||vn,l.scale.z=1+(t.scale[2]-1)*o+a(c,Pt(h,i.scale[2]))||vn,l.rotation.x=r.x*o+d,l.rotation.y=r.y*o+f,l.rotation.z=r.z*o+p,l.position.x=t.position[0]*o+a(c,Pt(h,i.position[0])),l.position.y=t.position[1]*o+a(c,Pt(h,i.position[1])),l.position.z=t.position[2]*o+a(c,Pt(h,i.position[2]))}}_updateGrid(e){let t=0,r=e.grid,i=e.randomnessObject??Ou.defaultData([1,1,1]).randomnessObject,n=Uy(i.strength,this.parameters.randomness),s=i.noiseType==="perlin";$o.noiseSeed(i.seed);let a=afe((0,mm.default)(i.seed));if(r.useCenter===!0){let o={x:r.count[0]%2===0?2:1,y:r.count[1]%2===0?2:1,z:r.count[2]%2===0?2:1},l=new P(r.size[0]*(r.count[0]-o.x)*.5,r.size[1]*(r.count[1]-o.y)*.5,r.size[2]*(r.count[2]-o.z)*.5);for(let u=0;u<r.count[0];u++)for(let h=0;h<r.count[1];h++)for(let c=0;c<r.count[2];c++){let d=[(u+1)*(i.freqScale/10)+i.movement,(h+1)*(i.freqScale/10)+i.movement,(c+1)*(i.freqScale/10)+i.movement],f=s?$o.noise(...d):a(...d),p=this.children[t++];p.scale.x=1+n(t,Pt(f,i.scale[0]))||vn,p.scale.y=1+n(t,Pt(f,i.scale[1]))||vn,p.scale.z=1+n(t,Pt(f,i.scale[2]))||vn;let m=n(t,Pt(f,i.rotation[0])),g=n(t,Pt(f,i.rotation[1])),v=n(t,Pt(f,i.rotation[2]));p.rotation.set(m,g,v),p.position.x=r.size[0]*u-l.x+n(t,Pt(f,i.position[0])),p.position.y=r.size[1]*h-l.y+n(t,Pt(f,i.position[1])),p.position.z=r.size[2]*c-l.z+n(t,Pt(f,i.position[2]))}}else for(let o=0;o<r.count[0];o++)for(let l=0;l<r.count[1];l++)for(let u=0;u<r.count[2];u++){let h=[(o+1)*(i.freqScale/10)+i.movement,(l+1)*(i.freqScale/10)+i.movement,(u+1)*(i.freqScale/10)+i.movement],c=s?$o.noise(...h):a(...h),d=this.children[t++];d.scale.x=1+n(t,Pt(c,i.scale[0]))||vn,d.scale.y=1+n(t,Pt(c,i.scale[1]))||vn,d.scale.z=1+n(t,Pt(c,i.scale[2]))||vn;let f=n(t,Pt(c,i.rotation[0])),p=n(t,Pt(c,i.rotation[1])),m=n(t,Pt(c,i.rotation[2]));d.rotation.set(f,p,m),d.position.x=r.size[0]*o+n(t,Pt(c,i.position[0])),d.position.y=-r.size[1]*l+n(t,Pt(c,i.position[1])),d.position.z=-r.size[2]*u+n(t,Pt(c,i.position[2]))}}_updateToObject(e){var m;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,r=new Ri(t.rotation[0],t.rotation[1],t.rotation[2]),i=e.randomnessObject??Ou.defaultData([1,1,1]).randomnessObject,n=i.noiseType==="perlin";$o.noiseSeed(i.seed);let s=VS((0,mm.default)(i.seed)),a=Uy(i.strength,this.parameters.randomness);if(!t.object){for(let[,g]of this.children.entries())g.position.set(0,0,0),g.scale.setScalar(1),g.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof MH)if(!((m=this.objectForSample.font)!=null&&m.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let o=this.getSubdivData(),l=[],u=g=>{let v=g.length,y=g.map(S=>S[0]).reduce((S,_)=>S+_,0),x=g.map(S=>S[1]).reduce((S,_)=>S+_,0),w=g.map(S=>S[2]).reduce((S,_)=>S+_,0);return[y/v,x/v,w/v]},h=g=>Math.round(g*1e6)/1e6;o.forEach(g=>{let v=o.filter(y=>h(g.pos[0])===h(y.pos[0])&&h(g.pos[1])===h(y.pos[1])&&h(g.pos[2])===h(y.pos[2]));v.length>1?l.push({pos:g.pos,norm:u(v.map(y=>y.norm))}):l.push(g)});let c=sge(l);if(o.length>0){let g=Math.round(c.length*t.count/100);this._updateCount(g)}this.objectForSample.updateMatrixWorld();let d=new ofe(this.objectForSample).build(),f=ige[t.axis],p=this.children;d.setRandomGenerator((0,mm.default)(this.object.uuid+t.seed));for(let[g,v]of p.entries()){let y=g*(i.freqScale/10)+i.movement,x=n?$o.noise(y):s(y,y),w=g+1,S=a(w,Pt(x,i.rotation[0])),_=a(w,Pt(x,i.rotation[1])),A=a(w,Pt(x,i.rotation[2]));t.spreadType==="random"?d.sample(_m,aM):(c.length&&(_m.fromArray(c[g].pos),aM.fromArray(c[g].norm)),this.objectForSample instanceof lv&&_m.applyMatrix4(mge.copy(this.objectForSample.matrixWorld).invert())),_m.applyMatrix4(this.object.hiddenMatrix.clone().invert()),v.position.copy(_m),lu.fromArray(f);let M=t.align==="normal"?aM:this.object.getWorldDirection(yge),T=Ec.fromArray(t.position);Ec.x+=Ec.x+a(w,Pt(x,i.position[0])),Ec.y+=Ec.y+a(w,Pt(x,i.position[1])),Ec.z+=Ec.z+a(w,Pt(x,i.position[2]));let C=Math.acos(M.dot(lu)),L=vge.crossVectors(lu,M).normalize(),I=gge.makeRotationAxis(L,C),k=M.clone().cross(this.object.up).normalize(),z=k.clone().cross(M).normalize(),V=new Oe().makeBasis(k,M,z),K=new P(lu.y,lu.z,lu.x).normalize(),q=K.clone().cross(lu).normalize(),O=new Oe().makeBasis(K,lu,q).invert(),W=new Oe().multiplyMatrices(V,O);v.rotation.setFromRotationMatrix(W),T.applyMatrix4(I),v.position.add(T),v.rotation.x=v.rotation.x+r.x+S,v.rotation.y=v.rotation.y+r.y+_,v.rotation.z=v.rotation.z+r.z+A,v.scale.setScalar(1),v.scale.x=v.scale.x+t.scale[0]+a(w,Pt(x,i.scale[0]))||vn,v.scale.y=v.scale.y+t.scale[1]+a(w,Pt(x,i.scale[1]))||vn,v.scale.z=v.scale.z+t.scale[2]+a(w,Pt(x,i.scale[2]))||vn,v.scale.multiply(this.object.scale),v.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof lv){let t=this.objectForSample,r=nge[e],i=TH[r],n=EH[r],s=AH[r],a=[],o=i(t.subdivPointerNew);for(let l=0;l<=o-1;l++){let u=n(t.subdivPointerNew,l),h=s(t.subdivPointerNew,l);$k.fromArray(u).applyMatrix4(t.matrixWorld),Qk.fromArray(h),a.push({pos:$k.toArray(),norm:Qk.toArray()})}return a}else return(this.objectForSample.geometry.index?uge(this.objectForSample.geometry):cge(this.objectForSample.geometry)).map((t,r)=>e==="polygon_center"?{pos:t.midpoint,norm:t.norm}:e==="vertex"?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:e==="edge"?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){var r;if(this.parameters=nb(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(r=this.object.parent)==null||r.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let i=t.find(this.parameters.toObject.object);i instanceof es?this.objectForSample=i:this.objectForSample=void 0,this.matrix=new Oe,this.hiddenMatrix=new Oe,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,i&&i.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Hv=e=>{var t;return t=class extends e{},t.geometryHelper=new xo(30,30,30),t},Vy=new pp,oM=new ys,Kk=new Oe,Vv=(e,t,r,i,n=!1)=>{let s=t,a=e.matrixWorld;if(s.boundingSphere===null&&s.computeBoundingSphere(),oM.copy(s.boundingSphere),oM.applyMatrix4(a),r.ray.intersectsSphere(oM)===!1||(Kk.copy(a).invert(),Vy.copy(r.ray).applyMatrix4(Kk),s.boundingBox!==null&&Vy.intersectsBox(s.boundingBox)===!1))return;let o,l,u,h,c=s.index,d=s.attributes.position,f=s.drawRange,p,m;if(n===!1){let v=Math.max(0,f.start),y=Math.min(c.count,f.start+f.count);for(p=v,m=y;p<m;p+=3)if(l=c.getX(p),u=c.getX(p+1),h=c.getX(p+2),o=g(e,r,Vy,d,l,u,h),o){o.faceIndex=Math.floor(p/3),i.push(o);return}}else{let v=s.attributes.position,y=new P,x=new P,w=new P,S=new P,_=2,A=1/((e.scale.x+e.scale.y+e.scale.z)/3),M=A*A,T=Math.max(0,f.start),C=Math.min(v.count,f.start+f.count);for(let L=T,I=C-1;L<I;L+=_){if(y.fromBufferAttribute(v,L),x.fromBufferAttribute(v,L+1),Vy.distanceSqToSegment(y,x,S,w)>M)continue;S.applyMatrix4(e.matrixWorld);let k=r.ray.origin.distanceTo(S);k<r.near||k>r.far||i.push({distance:k,point:w.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(v,y,x,w,S,_,A){let M=new P,T=new P,C=new P,L=new P,I=new P;if(M.fromBufferAttribute(w,S),T.fromBufferAttribute(w,_),C.fromBufferAttribute(w,A),x.intersectTriangle(M,T,C,!1,L)===null)return null;I.copy(L),I.applyMatrix4(v.matrixWorld);let k=y.ray.origin.distanceTo(I);return k<y.near||k>y.far?null:{faceIndex:1,distance:k,point:I.clone(),object:v}}},Wy=new P,Ds=new gp,xge=class extends Nv{constructor(e){let t=new _t,r=new dc({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],n=[],s={},a=new gt(15711266),o=new gt(15711266),l=new gt(2857471);u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l);function u(c,d,f){h(c,f),h(d,f)}function h(c,d){i.push(0,0,0),n.push(d.r,d.g,d.b),s[c]===void 0&&(s[c]=[]),s[c].push(i.length/3-1)}t.setAttribute("position",new nt(i,3)),t.setAttribute("color",new nt(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Ds.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let r=1,i=1,n=.8;ua("n1",t,e,Ds,-r,-i,n),ua("n2",t,e,Ds,r,-i,n),ua("n3",t,e,Ds,-r,i,n),ua("n4",t,e,Ds,r,i,n);let s=n;ua("f1",t,e,Ds,-r,-i,s),ua("f2",t,e,Ds,r,-i,s),ua("f3",t,e,Ds,-r,i,s),ua("f4",t,e,Ds,r,i,s);let a=s,o=.5;ua("u1",t,e,Ds,r*.7*o,i*1.1,a),ua("u2",t,e,Ds,-r*.7*o,i*1.1,a),ua("u3",t,e,Ds,0,i*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ua(e,t,r,i,n,s,a){Wy.set(n,s,a).unproject(i);let o=t[e];if(o!==void 0){let l=r.getAttribute("position");for(let u=0,h=o.length;u<h;u++)l.setXYZ(o[u],Wy.x,Wy.y,Wy.z)}}var wge=class extends Hv(xge){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Vv(this.object,this.geometry,e,t,!0)}},hT;(e=>e.is=t=>"objectHelper"in t)(hT||(hT={}));var Wv=(e,t)=>class extends JD(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(r,i){this.objectHelper.raycast(r,i)}showGizmos(){for(let r in this.gizmos){let i=this.gizmos[r];i instanceof Sx&&(i.visible=!0)}}updateEntityBoxSize(r,i){this.objectHelper.visible&&this.geometryHelper instanceof xo?(r.setScalar(0),i.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(r,i)}hideGizmos(){for(let r in this.gizmos){let i=this.gizmos[r];i instanceof Sx&&(i.visible=!1)}}},Gy=790,vd=new P,lM=new P,uM=new kt,cM=new P,Sm=new P,hM=new P,on=class extends Wv(gp,wge){constructor(e="",t={...rv.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=Yf.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new Oe,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let r=this.width,i=this.height;this.orthoCamera=new cD(r*-.5,r*.5,i*.5,i*-.5,-5e4,1e4),this.perspCamera=new rn(45,r/i,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,r){typeof e=="number"&&(e=new P(e,t,r)),super.lookAt(e),this.getWorldPosition(vd),this.targetOffset=vd.distanceTo(e)}getTarget(e=new P){return this.getWorldDirection(lM),this.getWorldPosition(vd),lM.multiplyScalar(this.targetOffset),e.copy(vd).add(lM),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(vd),vd.distanceTo(e)}updateUp(){this.getWorldQuaternion(uM),cM.set(0,0,1).applyQuaternion(uM),Sm.copy(dr.DEFAULT_UP),this.isUpVectorFlipped&&Sm.negate(),Sm.applyQuaternion(uM),hM.copy(dr.DEFAULT_UP).projectOnPlane(cM),this.angleOffsetFromUp=hM.angleTo(Sm),this.angleOffsetFromUp*=hM.cross(Sm).dot(cM)>=0?1:-1}updateTransformState(e){let t=super.updateTransformState(e);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),t}getViewFrontToObject(e){let t=e.getWorldPosition(new P),r=e.getWorldDirection(new P).multiplyScalar(this.targetOffset);return{position:t.clone().add(r),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new P).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new P;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,r=!1){if(this.aspect=e/t,r){let i=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-Gy*.5*i,this.right=Gy*.5*i,this.top=Gy*.5*(1/n),this.bottom=-Gy*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,r,i,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,r,i,n,s):this.orthoCamera.setViewOffset(e,t,r,i,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return gA(t,e)}updateCameraSubtype(e,t){let r=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(r,t.zoom),t.near!==void 0&&this.setNear(r,t.near),t.fov!==void 0&&r==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,r){super.updateByPatchedOp(e,t,r),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},yd=new Oe,bge=new Oe;function Zk(e){let t=!1;return e.scene.objects.traverse((r,i)=>{var n;((n=i.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var Zf=class extends Dp{constructor(e,t,r){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new _t,this.onAfterRender=(i,n,s,a,o,l)=>{super.onAfterRender(i,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,r){super.updateByPatchedOp(e,t,r),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var i;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof Zf&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof es&&s.dataPatched.visible===!0&&((i=s.geometry.attributes.position)==null?void 0:i.count)>0&&s.geometry.drawRange.count>0){if(yd.multiplyMatrices(s.hiddenMatrix,s.matrix),s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=ol.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;ol.transformMeshSet(s.booleanMeshSetAddress,yd),s.booleanMatrixInvOld.copy(yd).invert(),s.booleanWasTransformed=!1}else s instanceof Zf&&s.needsTransformForDownstream===!0?(ol.transformMeshSet(s.booleanMeshSetAddress,yd),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(ol.transformMeshSet(s.booleanMeshSetAddress,bge.multiplyMatrices(yd,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(yd).invert(),s.booleanWasTransformed=!1);ol.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.wasFilteredFromBoolean=!1):s.geometry.userData.wasFilteredFromBoolean=!0}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new nt([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return ol.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let r=this.geometry;r.dispose(),this.geometry=new _t,this.geometry.userData=r.userData,this.geometry.boundingSphere=r.boundingSphere;try{this.booleanMeshSetAddress=ol.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,p2(this),m2(this)}dispose(){super.dispose(),this.geometry.dispose()}},dT;(e=>{function t(r){return $t.is(r)&&r instanceof Fv}e.is=t})(dT||(dT={}));var g2=(e,t)=>class extends Wv(e,t){updateState_Light(r,i){this.updateState_Entity(r,i),r.color!==void 0&&(this.color=i.shared.color(r.color)),r.intensity!==void 0&&(this.intensity=r.intensity),r.depth!==void 0&&(this.shadow.camera.far=r.depth,this.shadow.needsUpdate=!0),r.shadows!==void 0&&(this.castShadow=r.shadows)}},va=e=>e instanceof es,bl=e=>e!==null&&e instanceof Zf,_ge=e=>e instanceof on,Sge=e=>dT.is(e),fT=e=>hT.is(e),fb=class extends Hv(Hre){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){Vv(this.object,fb.geometryHelper,e,t)}update(){}},ew=class extends Wv(Jd,fb){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},CH={RED:0,GREEN:1,BLUE:2,ALPHA:3},Gv="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Mge=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Yy=class extends br{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new Pe(null),kernel16:new Pe(null),inputBuffer:new Pe(null),cocBuffer:new Pe(null),texelSize:new Pe(new J),scale:new Pe(1)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Mge,vertexShader:Gv}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),r=new Float32Array(32),i=0,n=0;for(let o=0;o<80;++o){let l=o*e,u=Math.sqrt(o)/Math.sqrt(80),h=u*Math.cos(l),c=u*Math.sin(l);o%5===0?(r[n++]=h,r[n++]=c):(t[i++]=h,t[i++]=c)}let s=[],a=[];for(let o=0;o<128;)s.push(new Lt(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new Lt(r[o++],r[o++],r[o++],r[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function Jk(e,t,r){return e*(t-r)-t}function pT(e,t,r){return Math.min(Math.max((e+t)/(t-r),0),1)}var Ege=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Age=class extends br{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Pe(null),focusDistance:new Pe(0),focusRange:new Pe(0),cameraNear:new Pe(.3),cameraFar:new Pe(1e3)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Ege,vertexShader:Gv}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Wl){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-Jk(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=pT(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-Jk(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=pT(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof rn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Tge=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,Cge="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",ez=class extends br{constructor(e=new J){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Pe(null),texelSize:new Pe(new J),halfTexelSize:new Pe(new J),kernel:new Pe(0),scale:new Pe(1)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Tge,vertexShader:Cge}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let r=this.uniforms;r.texelSize.value.set(1/e,1/t),r.halfTexelSize.value.copy(r.texelSize.value).multiplyScalar(.5)}},Dge=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,Pge=class extends br{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Pe(null),opacity:new Pe(1)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Dge,vertexShader:Gv}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},Oge=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,Lge=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,pb={DEPTH:0,LUMA:1,COLOR:2},Ige={DISABLED:0,DEPTH:1,CUSTOM:2},Rge=class extends br{constructor(e=new J,t=pb.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:fp.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Pe(null),depthBuffer:new Pe(null),predicationBuffer:new Pe(null),texelSize:new Pe(e)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Oge,vertexShader:Lge}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Wl){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},kge=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,zge="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",ca={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},mT=class extends br{constructor(e,t,r,i,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:fp.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Pe(null),depthBuffer:new Pe(null),resolution:new Pe(new J),texelSize:new Pe(new J),cameraNear:new Pe(.3),cameraFar:new Pe(1e3),aspect:new Pe(1),time:new Pe(0)},blending:pi,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),r&&this.setUniforms(r),this.adoptCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Wl){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=kge.replace(ca.FRAGMENT_HEAD,e.get(ca.FRAGMENT_HEAD)).replace(ca.FRAGMENT_MAIN_UV,e.get(ca.FRAGMENT_MAIN_UV)).replace(ca.FRAGMENT_MAIN_IMAGE,e.get(ca.FRAGMENT_MAIN_IMAGE)),this.vertexShader=zge.replace(ca.VERTEX_HEAD,e.get(ca.VERTEX_HEAD)).replace(ca.VERTEX_MAIN_SUPPORT,e.get(ca.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof rn?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let r=this.uniforms;r.resolution.value.set(e,t),r.texelSize.value.set(1/e,1/t),r.aspect.value=e/t}static get Section(){return ca}},Nge=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Bge=class extends br{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:fp.replace(/\D+/g,"")},uniforms:{inputBuffer:new Pe(null),threshold:new Pe(0),smoothing:new Pe(1),range:new Pe(null)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Nge,vertexShader:Gv}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Fge=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,DH={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},Uge=class extends br{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Pe(e),inputBuffer:new Pe(null),strength:new Pe(1)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:Fge,vertexShader:Gv}),this.toneMapped=!1,this.setColorChannel(CH.RED),this.setMaskFunction(DH.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==cn&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},jge=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Hge="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Vge=class extends br{constructor(e=new J,t=new J){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Pe(null),searchTexture:new Pe(null),areaTexture:new Pe(null),resolution:new Pe(t),texelSize:new Pe(e)},blending:pi,depthWrite:!1,depthTest:!1,fragmentShader:jge,vertexShader:Hge}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let r=this.uniforms;r.texelSize.value.set(1/e,1/t),r.resolution.value.set(e,t)}},Wge=new gp,uu=null;function Gge(){if(uu===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);uu=new _t,uu.setAttribute!==void 0?(uu.setAttribute("position",new Mt(e,3)),uu.setAttribute("uv",new Mt(t,2))):(uu.addAttribute("position",new Mt(e,3)),uu.addAttribute("uv",new Mt(t,2)))}return uu}var On=class{constructor(e="Pass",t=new Yu,r=Wge){this.name=e,this.renderer=null,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Hn(Gge(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Yu),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Wl){}render(e,t,r,i,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Yu||t===this.renderer)continue;this[e].dispose()}}}},gT=class extends On{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new Pge,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new cr(1,1,{minFilter:Bt,magFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,r,i,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,r){r!==void 0&&(this.renderTarget.texture.type=r,r!==cn?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===Ot&&(this.renderTarget.texture.encoding=Ot))}},Yge=class extends On{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,r,i,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},dM=new gt,v2=class extends On{constructor(e=!0,t=!0,r=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=r,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,r){this.color=e,this.depth=t,this.stencil=r}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,r,i,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,u=a>=0;l?(dM.copy(e.getClearColor(dM)),e.setClearColor(s,u?a:o)):u&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(dM,o):u&&e.setClearAlpha(o)}},cu=-1,Wn=class extends Xi{constructor(e,t=cu,r=cu,i=1){super(),this.resizable=e,this.base=new J(1,1),this.preferred=new J(t,r),this.target=this.preferred,this.s=i}get width(){let{base:e,preferred:t,scale:r}=this,i;return t.width!==cu?i=t.width:t.height!==cu?i=Math.round(t.height*(e.width/Math.max(e.height,1))):i=Math.round(e.width*r),i}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:r}=this,i;return t.height!==cu?i=t.height:t.width!==cu?i=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):i=Math.round(e.height*r),i}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(cu),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return cu}},fM=!1,tz=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let r;if(t.material.flatShading)switch(t.material.side){case ds:r=this.materialsFlatShadedDoubleSide;break;case ki:r=this.materialsFlatShadedBackSide;break;default:r=this.materialsFlatShaded;break}else switch(t.material.side){case ds:r=this.materialsDoubleSide;break;case ki:r=this.materialsBackSide;break;default:r=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=r[2]:t.isInstancedMesh?t.material=r[1]:t.material=r[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let r of t)r.uniforms=Object.assign({},e.uniforms),r.side=Ca;t[2].skinning=!0,this.materialsBackSide=t.map(r=>{let i=r.clone();return i.uniforms=Object.assign({},e.uniforms),i.side=ki,i}),this.materialsDoubleSide=t.map(r=>{let i=r.clone();return i.uniforms=Object.assign({},e.uniforms),i.side=ds,i}),this.materialsFlatShaded=t.map(r=>{let i=r.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(r=>{let i=r.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=ki,i}),this.materialsFlatShadedDoubleSide=t.map(r=>{let i=r.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=ds,i})}}render(e,t,r){let i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,fM){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,r);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,r),t.overrideMaterial=n}e.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return fM}static set workaroundEnabled(e){fM=e}},qge=class extends On{constructor(e,t,r=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new v2,this.overrideMaterialManager=r===null?null:new tz(r),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new tz(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,r,i,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,u=s.background,h=e.shadowMap.autoUpdate,c=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(c),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=u,e.shadowMap.autoUpdate=h}},rz=class extends On{constructor(e,t,{resolutionScale:r=1,width:i=Wn.AUTO_SIZE,height:n=Wn.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new qge(e,t,new T4({depthPacking:f4}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new gt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new cr(1,1,{minFilter:wr,magFilter:wr,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Wn(this,i,n,r);l.addEventListener("change",u=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,r,i,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height)}},Xt={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},Xge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",$ge="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",Qge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",Kge="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Zge="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Jge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",eve="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",tve="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",rve="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",ive="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",nve="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",sve="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",ave="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",ove="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",lve="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",uve="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",cve="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",hve="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",dve=new Map([[Xt.SKIP,null],[Xt.ADD,Xge],[Xt.ALPHA,$ge],[Xt.AVERAGE,Qge],[Xt.COLOR_BURN,Kge],[Xt.COLOR_DODGE,Zge],[Xt.DARKEN,Jge],[Xt.DIFFERENCE,eve],[Xt.EXCLUSION,tve],[Xt.LIGHTEN,rve],[Xt.MULTIPLY,ive],[Xt.DIVIDE,nve],[Xt.NEGATION,sve],[Xt.NORMAL,ave],[Xt.OVERLAY,ove],[Xt.REFLECT,lve],[Xt.SCREEN,uve],[Xt.SOFT_LIGHT,cve],[Xt.SUBTRACT,hve]]),fve=class extends Xi{constructor(e,t=1){super(),this.f=e,this.opacity=new Pe(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return dve.get(this.blendFunction)}},po={NONE:0,DEPTH:1,CONVOLUTION:2},Po=class extends Xi{constructor(e,t,{attributes:r=po.NONE,blendFunction:i=Xt.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=r,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new fve(i),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Wl){}update(e,t,r){}setSize(e,t){}initialize(e,t,r){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Yu||t===this.renderer)continue;this[e].dispose()}}}};function iz(e,t,r){for(let i of t){let n="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),s=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(let a of r.entries())a[1]!==null&&r.set(a[0],a[1].replace(s,n))}}function pve(e,t,r,i,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),u=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),h=[],c=[],d=!1,f=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(u&&a&po.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!u)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let p=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=mT.Section;if(u){let v=`	${e}MainUv(UV);
`;r.set(m.FRAGMENT_MAIN_UV,r.get(m.FRAGMENT_MAIN_UV)+v),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,r.set(m.VERTEX_MAIN_SUPPORT,r.get(m.VERTEX_MAIN_SUPPORT)+v),h=h.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),c=c.concat(h).concat([...o.get("vertex").matchAll(p)].map(y=>y[1]))}c=c.concat([...o.get("fragment").matchAll(p)].map(v=>v[1])),c=c.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),c=c.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>n.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),iz(e,c,n),iz(e,c,o);let g=t.blendMode;if(i.set(g.blendFunction,g),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${e}MainImage(color0, UV, `;a&po.DEPTH&&v.test(o.get("fragment"))&&(y+="depth, ",f=!0),y+=`color1);
	`;let x=e+"BlendOpacity";s.set(x,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${x});

	`,r.set(m.FRAGMENT_MAIN_IMAGE,r.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,r.set(m.FRAGMENT_HEAD,r.get(m.FRAGMENT_HEAD)+y)}r.set(m.FRAGMENT_HEAD,r.get(m.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&r.set(m.VERTEX_HEAD,r.get(m.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:h,transformedUv:d,readDepth:f}}var tw=class extends On{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new mT(null,null,null,e),this.effects=t.sort((r,i)=>i.attributes-r.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=mT.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),r=new Map,i=new Map,n=new Map,s=new Set,a=0,o=0,l=0,u=!1,h=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Xt.SKIP)l|=d.getAttributes()&po.DEPTH;else if(l&d.getAttributes()&po.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f="e"+a++,p=pve(f,d,t,r,i,n,l);if(o+=p.varyings.length,u=u||p.transformedUv,h=h||p.readDepth,d.extensions!==null)for(let m of d.extensions)s.add(m)}let c=/\bblend\b/g;for(let d of r.values()){let f=d.getShaderCode().replace(c,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+f+`
`)}if(l&po.DEPTH){if(h){let d=`float depth = readDepth(UV);

	`;t.set(e.FRAGMENT_MAIN_IMAGE,d+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(u){let d=`vec2 transformedUv = vUv;
`;t.set(e.FRAGMENT_MAIN_UV,d+t.get(e.FRAGMENT_MAIN_UV)),i.set("UV","transformedUv")}else i.set("UV","vUv");t.forEach((d,f,p)=>p.set(f,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(i)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Wl){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let r of this.effects)r.setDepthTexture(e,t)}render(e,t,r,i,n){for(let s of this.effects)s.update(e,t,i);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=i,e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let r of this.effects)r.setSize(e,t)}initialize(e,t,r){this.renderer=e;for(let i of this.effects)i.initialize(e,t,r),i.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),r!==void 0&&r!==cn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},mve=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],PH=class extends On{constructor({resolutionScale:e=.5,width:t=Wn.AUTO_SIZE,height:r=Wn.AUTO_SIZE,kernelSize:i=y2.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new cr(1,1,{minFilter:Bt,magFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Wn(this,t,r,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new ez,this.ditheredBlurMaterial=new ez,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=i}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,r,i,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,u=mve[this.kernelSize],h=this.blurMaterial,c=t,d,f;for(this.fullscreenMaterial=h,d=0,f=u.length-1;d<f;++d){let p=d&1?l:o;h.kernel=u[d],h.inputBuffer=c.texture,e.setRenderTarget(p),e.render(s,a),c=p}this.dithering&&(h=this.ditheredBlurMaterial,this.fullscreenMaterial=h),h.kernel=u[d],h.inputBuffer=c.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(s,a)}setSize(e,t){let r=this.resolution;r.setBaseSize(e,t);let i=r.width,n=r.height;this.renderTargetA.setSize(i,n),this.renderTargetB.setSize(i,n),this.blurMaterial.setSize(i,n),this.ditheredBlurMaterial.setSize(i,n)}initialize(e,t,r){r!==void 0&&(this.renderTargetA.texture.type=r,this.renderTargetB.texture.type=r,r!==cn?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===Ot&&(this.renderTargetA.texture.encoding=Ot,this.renderTargetB.texture.encoding=Ot))}static get AUTO_SIZE(){return Wn.AUTO_SIZE}},gve=class extends On{constructor({width:e=Wn.AUTO_SIZE,height:t=Wn.AUTO_SIZE,renderTarget:r,luminanceRange:i,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new Bge(n,i),this.needsSwap=!1,this.renderTarget=r,this.renderTarget===void 0&&(this.renderTarget=new cr(1,1,{minFilter:Bt,magFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Wn(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,r,i,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height)}initialize(e,t,r){r!==void 0&&r!==cn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},vve=class extends On{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new v2(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,r,i,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,u=this.clearPass,h=this.inverted?0:1,c=1-h;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,h,4294967295),a.stencil.setClear(c),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?u.render(e,null):(u.render(e,t),u.render(e,r))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(r),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},eo=class extends On{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,r,i,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}initialize(e,t,r){r!==void 0&&r!==cn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},pM=1/1e3,yve=1e3,xve=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*pM}getFixedDelta(){return this.fixedDelta*pM}setFixedDelta(e){return this.fixedDelta=e*yve,this}getElapsed(){return this.elapsed*pM}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},y2={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},wve=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,bve=class extends Po{constructor({blendFunction:e=Xt.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:r=.025,resolutionScale:i=.5,intensity:n=1,width:s=Wn.AUTO_SIZE,height:a=Wn.AUTO_SIZE,kernelSize:o=y2.LARGE}={}){super("BloomEffect",wve,{blendFunction:e,uniforms:new Map([["map",new Pe(null)],["intensity",new Pe(n)]])}),this.renderTarget=new cr(1,1,{minFilter:Bt,magFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new gve({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=r,this.blurPass=new PH({resolutionScale:i,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",u=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,r){let i=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,i),this.blurPass.render(e,i,i)):this.blurPass.render(e,t,i)}setSize(e,t){let r=this.resolution;r.setBaseSize(e,t),this.renderTarget.setSize(r.width,r.height),this.luminancePass.resolution.copy(r)}initialize(e,t,r){this.blurPass.initialize(e,t,r),r!==void 0&&(this.renderTarget.texture.type=r,e.outputEncoding===Ot&&(this.renderTarget.texture.encoding=Ot))}},_ve="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",Sve=class extends Po{constructor({blendFunction:e=Xt.NORMAL,brightness:t=0,contrast:r=0}={}){super("BrightnessContrastEffect",_ve,{blendFunction:e,uniforms:new Map([["brightness",new Pe(t)],["contrast",new Pe(r)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},Mve="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",Eve=class extends Po{constructor(e=Xt.NORMAL){super("ColorAverageEffect",Mve,{blendFunction:e})}},Ave="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",Tve="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",Cve=class extends Po{constructor({blendFunction:e=Xt.NORMAL,offset:t=new J(.001,5e-4)}={}){super("ChromaticAberrationEffect",Ave,{vertexShader:Tve,blendFunction:e,attributes:po.CONVOLUTION,uniforms:new Map([["offset",new Pe(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},Dve=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,Pve=class extends Po{constructor(e,{blendFunction:t=Xt.NORMAL,worldFocusDistance:r,worldFocusRange:i,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Wn.AUTO_SIZE,height:u=Wn.AUTO_SIZE}={}){super("DepthOfFieldEffect",Dve,{blendFunction:t,attributes:po.DEPTH,uniforms:new Map([["nearColorBuffer",new Pe(null)],["farColorBuffer",new Pe(null)],["nearCoCBuffer",new Pe(null)],["scale",new Pe(1)]])}),this.camera=e,this.renderTarget=new cr(1,1,{minFilter:Bt,magFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new eo(new Age(e));let h=this.cocMaterial;h.focusDistance=n,h.focusRange=a,r!==void 0&&(h.worldFocusDistance=r),i!==void 0&&(h.worldFocusRange=i),this.blurPass=new PH({kernelSize:y2.MEDIUM,width:l,height:u});let c=this.blurPass.getResolution();c.addEventListener("change",f=>this.setSize(c.getBaseWidth(),c.getBaseHeight())),this.maskPass=new eo(new Uge(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=DH.MULTIPLY,d.colorChannel=CH.GREEN,this.bokehNearBasePass=new eo(new Yy(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new eo(new Yy(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new eo(new Yy(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new eo(new Yy(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let r of t)r.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,r=t.position.distanceTo(e);return pT(-r,t.near,t.far)}setDepthTexture(e,t=Wl){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,r){let i=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,i),this.bokehFarFillPass.render(e,i,this.renderTargetFar),this.bokehNearBasePass.render(e,t,i),this.bokehNearFillPass.render(e,i,this.renderTargetNear)}setSize(e,t){let r=this.resolution;r.setBaseSize(e,t);let i=r.width,n=r.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(i,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(i,n))}initialize(e,t,r){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(i=>i.initialize(e,t,r)),this.blurPass.initialize(e,t,cn),r!==void 0&&(this.renderTarget.texture.type=r,this.renderTargetNear.texture.type=r,this.renderTargetFar.texture.type=r,this.renderTargetMasked.texture.type=r,e.outputEncoding===Ot&&(this.renderTarget.texture.encoding=Ot,this.renderTargetNear.texture.encoding=Ot,this.renderTargetFar.texture.encoding=Ot,this.renderTargetMasked.texture.encoding=Ot))}};new P;new Oe;var Ove="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",Lve=class extends Po{constructor({blendFunction:e=Xt.NORMAL,hue:t=0,saturation:r=0}={}){super("HueSaturationEffect",Ove,{blendFunction:e,uniforms:new Map([["hue",new Pe(new P)],["saturation",new Pe(r)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),r=Math.cos(e);this.uniforms.get("hue").value.set((2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new gt;var Ive=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,Rve=class extends Po{constructor({blendFunction:e=Xt.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",Ive,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},kve="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",zve=class extends Po{constructor(e=30){super("PixelationEffect",kve,{uniforms:new Map([["active",new Pe(!1)],["d",new Pe(new J)]])}),this.resolution=new J,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new P;new P;var nz="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",sz="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",Nve="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Bve="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Vc={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},OH=class extends Po{constructor({preset:e=Vc.MEDIUM,edgeDetectionMode:t=pb.COLOR,predicationMode:r=Ige.DISABLED}={}){super("SMAAEffect",Nve,{vertexShader:Bve,blendFunction:Xt.NORMAL,attributes:po.CONVOLUTION|po.DEPTH,uniforms:new Map([["weightMap",new Pe(null)]])});let i,n;arguments.length>1&&(i=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new cr(1,1,{minFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new v2(!0,!1,!1),this.clearPass.overrideClearColor=new gt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new eo(new Rge),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new eo(new Vge);let s=new Y4;s.onLoad=()=>{let a=new Mi(i);a.name="SMAA.Search",a.magFilter=wr,a.minFilter=wr,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Mi(n);o.name="SMAA.Area",o.magFilter=Bt,o.minFilter=Bt,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),i!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(i=new Image,n=new Image,i.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),i.src=nz,n.src=sz),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,r=this.weightsMaterial;switch(e){case Vc.LOW:t.edgeDetectionThreshold=.15,r.orthogonalSearchSteps=4,r.diagonalDetection=!1,r.cornerDetection=!1;break;case Vc.MEDIUM:t.edgeDetectionThreshold=.1,r.orthogonalSearchSteps=8,r.diagonalDetection=!1,r.cornerDetection=!1;break;case Vc.HIGH:t.edgeDetectionThreshold=.1,r.orthogonalSearchSteps=16,r.diagonalSearchSteps=8,r.cornerRounding=25,r.diagonalDetection=!0,r.cornerDetection=!0;break;case Vc.ULTRA:t.edgeDetectionThreshold=.05,r.orthogonalSearchSteps=32,r.diagonalSearchSteps=16,r.cornerRounding=25,r.diagonalDetection=!0,r.cornerDetection=!0;break}}setDepthTexture(e,t=Wl){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,r){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return nz}static get areaImageDataURL(){return sz}},Fve=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,qy={DEFAULT:0,ESKIL:1},Uve=class extends Po{constructor({blendFunction:e=Xt.NORMAL,technique:t=qy.DEFAULT,eskil:r=!1,offset:i=.5,darkness:n=.5}={}){super("VignetteEffect",Fve,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Pe(i)],["darkness",new Pe(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===qy.ESKIL}set eskil(e){this.technique=e?qy.ESKIL:qy.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},Gl=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(r){this.effect.blendMode.opacity.value=r},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(r){this.effect.blendMode.setBlendFunction(Number(r))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Xt.NORMAL}},jve=class extends Gl{constructor(){super(bve),this.blendFunction=Xt.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},Hve=class extends Gl{constructor(){super(Sve)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},Vve=class extends Gl{constructor(){super(Cve),this.effect.offset=new J(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},Wve=class extends Gl{constructor(){super(Eve)}},Gve=class extends Gl{constructor(){super(Lve),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},Yve=class extends Gl{constructor(){super(Rve),this.blendFunction=Xt.OVERLAY}},qve=class extends Gl{constructor(){super(Uve)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},Xve=class extends Gl{constructor(e){super(Pve,e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}},$ve=class extends Gl{constructor(){super(zve)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Qve=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Kve=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Zve=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Jve=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,vT=class extends br{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Pe(null)},blending:pi,depthWrite:!1,depthTest:!1,vertexShader:Zve,fragmentShader:Jve})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},e0e=class extends On{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new vT,this.resolutionVector=new J,this.resolveMaterial=new br({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Pe(null),historyBuffer:new Pe(null),velocityBuffer:new Pe(null),depthBuffer:new Pe(null),resolution:new Pe(new J)},blending:pi,depthWrite:!1,depthTest:!1,vertexShader:Qve,fragmentShader:Kve}),this.historyRenderTarget=new cr(1024,1024,{minFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new cr(1024,1024,{minFilter:Bt,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let r=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(r),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},t0e=class extends On{constructor(e,t,r){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new rz(e,t,{renderTarget:r.transmissionDepthTarget}),this.passThroughMaterial=new vT,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new vT,this.depthPass=new rz(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,r){let i=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,r),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=i}},az=new Yu,r0e=new br({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),yT=class extends On{constructor(e,t,r){super("OpaquePass",t??az,r),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??az}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(i=>{i.layers.isEnabled(3)&&i instanceof es&&(this.originalMaterials.set(i.id,i.material),i.material=r0e)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let r=this.renderToScreen?null:t;e.setRenderTarget(r),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((i,n)=>{let s=this.scene.getObjectById(n);s&&(s.material=i)})}},i0e=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new gT,this.depthTexture=null,this.timer=new xve,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,r,n,i,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,r,n,i,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,r,n,i,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let r=e.getSize(new J),i=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===cn&&e.outputEncoding===Ot&&(this.inputBuffer.texture[0].encoding=Ot,this.outputBuffer.texture[0].encoding=Ot,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(r.width,r.height,!1);for(let s of this.passes)s.initialize(e,i,n)}}replaceRenderer(e,t=!0){let r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){let e=this.depthTexture=new jf(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=bh,e.type=rh):e.type=Cu,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i,n,s){let a=this.renderer,o=a===null?new J:a.getDrawingBufferSize(new J),l={minFilter:Bt,magFilter:Bt,wrapS:ii,wrapT:ii,stencilBuffer:t,depthBuffer:e},u;return i>0?(u=new cr(o.width,o.height,l),u.samples=i):(n?(u=new kQ(o.width,o.height,2,l),u.texture[1].type=Ff):u=new cr(o.width,o.height,l),u.depthTexture=new jf(2048,2048),u.depthTexture.type=fs),r===cn&&a!==null&&a.outputEncoding===Ot&&(Array.isArray(u.texture)?u.texture.forEach(h=>h.encoding=Ot):u.texture.encoding=Ot),Array.isArray(u.texture)?u.texture.forEach((h,c)=>{h.name=`EffectComposer.Buffer ${n} ${c}`,h.generateMipmaps=!1}):(u.texture.name=`EffectComposer.Buffer ${n}`,u.texture.generateMipmaps=!1),u.name=s,u}addPass(e,t){var o;let r=this.passes,i=this.renderer,n=i.getDrawingBufferSize(new J),s=((o=i.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(i),e.setSize(n.width,n.height),e.initialize(i,s,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?r.splice(t,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of r)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,r=t.indexOf(e);if(r!==-1&&t.splice(r,1).length>0){if(this.depthTexture!==null){let i=(n,s)=>n||s.needsDepthTexture;t.reduce(i,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,r=this.copyPass,i=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,u,h,c;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,i,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(r.renderToScreen=d.renderToScreen,l=t.getContext(),u=t.state.buffers.stencil,u.setFunc(l.NOTEQUAL,1,4294967295),r.render(t,i,n,e,o),u.setFunc(l.EQUAL,1,4294967295)),h=i,c=s,i=n,s=a,n=h,a=c),d instanceof vve?o=!0:d instanceof Yge&&(o=!1))}setSize(e,t,r){let i=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=i.getSize(new J);e=s.width,t=s.height}i.setSize(e,t,r);let n=i.getDrawingBufferSize(new J);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},n0e=new br({name:"CombineMaterial",uniforms:{inputBufferA:new Pe(null),inputBufferB:new Pe(null)},blending:pi,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),s0e=class extends On{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=n0e,this.helperPass=new yT(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new yT(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new OH({preset:Vc.LOW,edgeDetectionMode:pb.COLOR});this.effectPass=new tw(this.camera,t),this.rt=new cr(10,10,{minFilter:Bt,magFilter:Bt,wrapS:ii,wrapT:ii,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,r){super.initialize(e,t,r),this.effectPass.initialize(e,t,r)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,r){this.rt.depthTexture=t.depthTexture;let i=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,r),this.fullscreenMaterial.uniforms.inputBufferA.value=r.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(i),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},a0e=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,o0e=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,l0e=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,u0e=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,c0e=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,h0e=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Mm=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],d0e=new br({vertexShader:a0e,fragmentShader:o0e}),Xy=new br({vertexShader:c0e,fragmentShader:h0e,uniforms:{texture_ao_lrez:new Pe(null),texture_depth_lrez:new Pe(null),texture_depth_hrez:new Pe(null),near:new Pe(null),far:new Pe(null)}}),f0e=class extends On{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let r=1024,i=1024;this.gBuffer=new cr(r,i,{type:fs,depthTexture:new jf(r,i),minFilter:Bt,magFilter:Bt}),this.depthBufferHighRes=new cr(r,i,{depthTexture:new jf(r,i)}),this.aoBuffer=new cr(r,i,{minFilter:Bt,magFilter:Bt}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(Mm.length*2);for(let a=0;a<Mm.length;a++){let o=a*2;n[o+0]=Mm[a][0],n[o+1]=Mm[a][1]}this.blueNoiseInDiskTexture=new gx(n,Mm.length,1,c4,fs),this.blueNoiseInDiskTexture.wrapS=xl,this.blueNoiseInDiskTexture.wrapT=xl,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new br({vertexShader:l0e,fragmentShader:u0e,uniforms:{near:new Pe(null),far:new Pe(null),fov:new Pe(null),proj_info:new Pe(new Lt),is_ortho:new Pe(!1),resolution:new Pe(new J),radius_of_influence:new Pe(8),radius_in_screen_space:new Pe(1),exponent:new Pe(1),ao_color:new Pe(new P),bias:new Pe(.5),texture_depth:new Pe(null),texture_normals:new Pe(null),texture_blue_noise:new Pe(null),texture_blue_noise_in_disk:new Pe(this.blueNoiseInDiskTexture),frame_index:new Pe(0),fog_enabled:new Pe(!1),fog_near:new Pe(1),fog_far:new Pe(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new cr(r,i,{minFilter:Bt,magFilter:Bt,wrapS:ii,wrapT:ii,depthBuffer:!1,type:fs});let s=new OH({preset:Vc.ULTRA,edgeDetectionMode:pb.COLOR});this.effectPass=new tw(this.camera,s)}initialize(e,t,r){super.initialize(e,t,r),this.effectPass.initialize(e,t,r)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let r=this._runHalfRes?.5:1,i=e*r,n=t*r;this.gBuffer.setSize(i,n),this.aoBuffer.setSize(i,n),this.hbaoMaterial.uniforms.resolution.value.set(i,n),this.aaBuffer.setSize(i,n),this.effectPass.setSize(i,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}render(e,t,r){this.splineScene.overrideMaterial=d0e;let i=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=i,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let u=this.splineCamera.perspCamera.fov*(Math.PI/180),h=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(u*.5)*2),c=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*h;this.hbaoMaterial.uniforms.radius_in_screen_space.value=c,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let u=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),h=this.hbaoMaterial.uniforms.radius_of_influence.value*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Xy,Xy.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Xy.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Xy.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},p0e=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,m0e=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,g0e=class extends eo{constructor(){super(new br({vertexShader:p0e,fragmentShader:m0e,uniforms:{tInput:new Pe(null),tMap:new Pe(null),uResolution:new Pe(new J),uSize:new Pe(new J),uCoords:new Pe(new J),uScale:new Pe(1),uSceneColor:new Pe(new gt(16711680)),uDPR:new Pe(1),uCurrent:new Pe(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},v0e=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,y0e=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,x0e=[],w0e=class extends eo{constructor(){super(new br({vertexShader:v0e,fragmentShader:y0e,uniforms:{toScene:new Pe(null),fromScene:new Pe(null),uResolution:new Pe(new J),uDPR:new Pe(1),mixRatio:new Pe(0),threshold:new Pe(.1),useTexture:new Pe(0),tMixTexture:{value:x0e[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}};function oz(e,t){return t&&t.enabled&&e.push(t.effect),e}var b0e=e=>Object.values(Xt).includes(e)?e:Xt.NORMAL,_0e=class extends Xi{constructor(e){super(),this.postprocessingState=Hx.defaultData,this._scene=new Yu,this._camera=new on,this.effects=new Map,this.blueNoiseTexture=new gx,this._renderToScreen=!0,this.clock=new Mre,this.renderer=e,this.debug=!1,this.effects.set("bloom",new jve),this.effects.set("chromaticAberration",new Vve),this.effects.set("vignette",new qve),this.effects.set("noise",new Yve),this.effects.set("colorAverage",new Wve),this.effects.set("hueSaturation",new Gve),this.effects.set("brightnessContrast",new Hve),this.effects.set("depthOfField",new Xve),this.effects.set("pixelation",new $ve),this.effectComposer=new i0e(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new yT(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new t0e(this.scene,this.camera,this.renderer),this.aoPass=new f0e(this.scene,this.camera),this.taaPass=new e0e,this.taaPass.renderToScreen=!1,this.helperPass=new s0e(this.camera),this.helperPass.renderToScreen=!1,this.overlayPass=new g0e,this.overlayPass.enabled=!1,this.sceneTransitionPass=new w0e,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.overlayPass.texture=e,this.overlayPass.enabled=!0):this.overlayPass.enabled=!1}get overlayTexture(){return this.overlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.aoPass.setCamera(e),this.helperPass.setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let r=this.effectComposer.passes[t];if(r.enabled===!0&&!e&&this._renderToScreen){r.renderToScreen=!0,e=!0;continue}r.renderToScreen=!1}}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new gx(e,128,128),this.blueNoiseTexture.wrapS=xl,this.blueNoiseTexture.wrapT=xl,this.blueNoiseTexture.minFilter=wr,this.blueNoiseTexture.magFilter=wr,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,r,i,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=r,this.aoPass.aoColor=i,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(oz,[]);r.length>0&&(this.uvEffectPass=new tw(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let i=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(oz,[]);i.length>0&&(this.effectPass=new tw(this.camera,...i),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.overlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new J;this.renderer.getDrawingBufferSize(e),this._rt=new cr(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:xl,wrapT:xl}),this._rt.samples=0,this._savePass=new gT(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new gT(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...r}=e,i=!1;t!==this.postprocessingState.enabled&&(i=!0);for(let n of Object.entries(r)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(i=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=b0e(l):a[o]=l}}this.postprocessingState=e,i&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,r,i){e instanceof Lt?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,r,i),this.effectComposer.outputBuffer.scissor.set(e,t,r,i));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,r,i)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,r,i){e instanceof Lt?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,r,i),this.effectComposer.outputBuffer.viewport.set(e,t,r,i))}resize(e,t,r){if(this.effectComposer.setSize(e,t,r),this._rt){let i=this.renderer.getPixelRatio();this._rt.setSize(e*i,t*i)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},S0e=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,M0e=Rt.lights_fragment_begin,E0e=Rt.shadowmask_pars_fragment,lz=null,A0e=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},T0e=(e="medium")=>{if(lz===e)return!1;lz=e;let t=A0e(e);Rt.shadowmap_pars_fragment=S0e(t);let r=M0e.slice();r=r.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),r=r.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Rt.lights_fragment_begin=r;let i=E0e.slice();return i=i.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Rt.shadowmask_pars_fragment=i,!0},C0e=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,D0e=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,mM=new br({vertexShader:C0e,fragmentShader:D0e,uniforms:{depthContrast:{value:1}}}),uz=new Mi,P0e=class extends C4{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new J,this.pipeline=new _0e(this),this.dummyCamra=new on,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.autoClear=!1;let t=this.setPixelRatio.bind(this),r=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=iD;let i=this.getContext();if(i&&"drawingBufferColorSpace"in i)try{i.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,r(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new cr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Bt,magFilter:Bt,wrapS:ii,wrapT:ii,depthBuffer:!1}))}_resizeTransmission(e,t){var r,i;(r=this.transmissionRenderTarget)==null||r.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(i=this.aoRenderTarget)==null||i.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return mt.transmissionLod.value===1}set hdTransmission(e){mt.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new cr(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Bf,magFilter:Bt,wrapS:ii,wrapT:ii,depthBuffer:!1}),this.transmissionDepthTarget=new cr(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:wr,magFilter:wr,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new cr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:wr,magFilter:wr,type:fs,depthTexture:new jf(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,r){this.normalRenderTarget&&(this.setClearColor(0),r.layers.enable(8),r.layers.disable(0),r.layers.disable(3),t.traverseEntity(i=>{i.layers.isEnabled(8)&&(i.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),r instanceof on?mM.uniforms.depthContrast.value=(r.far-r.near)/1e4:mM.uniforms.depthContrast.value=1,t.overrideMaterial=mM,this.render(t,r),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?bT:null,r.layers.enable(0),r.layers.enable(3),t.traverseEntity(i=>{i.layers.isEnabled(8)&&(i.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,r=1){this.dummyCamra.updateCameraState(t.dataPatched);let i=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<i?n=i*s:i=n/s,this.dummyCamra.setViewplaneSize(n,i);for(let a=0;a<r;a++)this.renderSplineScene(e,this.dummyCamra)}renderSplineScene(e,t,{sceneHelpers:r=void 0,sceneHelpersOnTop:i=void 0,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){let a=e instanceof _2?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((d,f)=>{mt.penumbraSize.value[f]=d}),mt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?mt.resolution.value.set(this.resolution.x,this.resolution.y):mt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(mt.normalRenderTarget.value=s,mt.normalRenderTargetDepth.value=uz):l.needsNormal()&&(this.createNormalRenderTarget(),mt.normalRenderTarget.value=this.normalRenderTarget.texture,mt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let u=a.data.ao,h=u.occlusion;h&&(this.createAORenderTarget(),mt.aoRenderTarget.value=this.aoRenderTarget.texture),mt.aoEnabled.value=h,this.pipeline.setAmbientOcclusionParams(u.occlusion,u.radius,u.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,u.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture);let c=!1;if(n!==void 0)mt.transmissionRenderTarget.value=n,mt.transmissionRenderTargetDepth.value=uz,this.pipeline.setTransmissionPassEnabled(!1);else{let d=l.needsTransmission();d&&(this.transmissionRenderTarget===void 0&&(c=!0),this.createTransmissionRenderTarget(),mt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,mt.aspectRatio.value=cme(this.viewportWidth,this.viewportHeight),mt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(d)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=r,this.pipeline.sceneHelpersOnTop=i,this.pipeline.scene=a,this.pipeline.camera=t,c&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!r&&!i&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),a.overrideMaterial=l.wireframeState?bT:null,this.pipeline.render(),mt.frameIndex.value=(mt.frameIndex.value+1)%16,t instanceof on&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,r){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=r,this.sceneTransitionTimeRemaining=r,this.pipeline.renderToScreen=!0;let i=this.pipeline.sceneTransitionPass.uniforms;i.uDPR.value=window.devicePixelRatio,i.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,r,i,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(r=this.transmissionDepthTarget)==null||r.dispose(),(i=this.normalRenderTarget)==null||i.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},LH=class extends Hv(jre){constructor(e,t=15,r=10066329){super(e,t,r),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Vv(this.object,LH.geometryHelper,e,t)}},IH=class extends Hv(Ure){constructor(e,t=15,r=6710886){super(e,t,r),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Vv(this.object,IH.geometryHelper,e,t)}},xT=class extends Hv(Fre){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Vv(this.object,xT.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=xT._vector,t=this.object.distance?this.object.distance:1e3,r=t*Math.tan(this.object.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let i=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(i);else this.cone.material.color.set(i)}}},RH=xT;RH._vector=new P;function O0e(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var kH=class extends g2(_re,LH){constructor(e,t,r){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.top=1250,i.bottom=-1250,i.right=1250,i.left=-1250,i.near=-1e4,i.far=2500;let n=new _x(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof _x&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let r=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&O0e(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),r&&this.update()}},cz=new P,hz=new P,dz=new kt,zH=class extends g2(yre,RH){constructor(e,t,r){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=zt.RAD2DEG*2*this.angle,i.aspect=1,i.near=100,i.far=2500;let n=new _x(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof _x&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),hz.setFromMatrixPosition(this.matrixWorld),dz.setFromRotationMatrix(this.matrixWorld),cz.copy(this.up).applyQuaternion(dz).negate().multiplyScalar(this.distance),this.target.position.copy(hz).add(cz),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Ku=class extends JD(Yu){constructor(e,t){super(),this.data=t,this.bgColor=new $n(1,1,1,1),this.fog=null,this.backupFog=new D4(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new gt,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new on(Ap,{...rv.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new gre(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=En(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Dp)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&T0e(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let r=this.scene;r.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=En(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=En(e.aoColor,t))}updateByOp(e,t,r,i){super.updateByOp(e,t,r,i);let n=t;js(e.path,["fog"])?this.updateFog(n.fog,r.shared):js(e.path,["ao"])?this.updateAo(n.ao,r.shared):js(e.path,["ambient"])?this.updateAmbientLight(n.ambient,r.shared):js(e.path,["shadow"])&&this.updateShadow(n.shadow)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(En(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(r=>{if(!r.visible)return!0;r instanceof kH&&r.visible&&e<3&&(this.penumbraSizeArrayCache[e]=r.data.penumbraSize,e+=1),r instanceof zH&&r.visible&&e<5-3&&(this.penumbraSizeArrayCache[3+t]=r.data.penumbraSize,t+=1)})}raycastWithClones(e){let t=[],r=i=>{for(let n of i.children){let s=n.cloner;$t.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((va(n)||fT(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),wT(n,e,t,!0)),r(n))}};return r(this),t}},L0e=class extends g2(wre,IH){constructor(e,t,r){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=90,i.aspect=1,i.near=100,i.far=2500;let n=new P(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new P(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z),a=new ai(n,s),o=new Sx(a,new gt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof Sx){let r=this.shadow.camera,i=new P(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),n=new P(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z);t.box.set(i,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},I0e=class extends Qn{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let r=this.geometry.getAttribute("position");r!==void 0?o2(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):super.updateEntityBoxSize(e,t)}},x2=class extends Qn{constructor(e,t,r){super(e,t,r),this._shapeId=null,this._context=r}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var i;let e=this.data.geometry.extrusion.shape,t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(i=s.geometry.userData)==null?void 0:i.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=z5;break;case"Ellipse":n=s2;break;case"Polygon":n=k5;break;case"Star":n=N5;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let r=this.geometry;t&&r.inputs&&(r.inputs.shapeData=t,r.build(),this.attachedSurfaceCloners.forEach(n=>n.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e){return super.updateTransformState(e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let r=this.geometry.getAttribute("position");r!==void 0?o2(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,t):super.updateEntityBoxSize(e,t)}},Af=class extends Wv(Jd,fb){constructor(e,t,r){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,r)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let r=t.scene.data.objects.get(e.component);if(r){let i,n;for(let s of Lu.rootOverrideProps)e[s]===void 0?(i===void 0&&(i={...e}),i[s]=r.data[s]):(n===void 0&&(n={}),n[s]=e[s],i===void 0&&(i={...e}),i[s]=qu.apply(r.data[s],e[s]));return this.overrideData=n,i}else return{...Tn.defaultData,...e,...Tl(Tn.defaultData,Lu.rootOverrideProps)}}updateByOp(e,t,r,i){let n;if(this.isInstanceRoot&&!i){if(t=this.transformAssignData(t,r),e.type===0&&e.path.length===0&&this.component)for(let s of Lu.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&Lu.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,r,i)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let r=e.scene.find(t.component)??null,i=!1;if(r!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if($t.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),w2(s),n+=1;else break;this.children.splice(0,n)}i=!0}if(r){let n={};NH(e,[this.uuid],t.overrides,this,r,r,0,i,n);for(let s of this.children)if($t.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{if(o instanceof Qn&&o.isSkinnedMesh){let l=o.dataPatched;if(l.bones&&l.boneInverses){let u=l.bones.map(d=>e.scene.find(n[d])),h=l.boneInverses.map(d=>new Oe().fromArray(d)),c=new dD(u,h);o.bind(c,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function w2(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let r of e.children)$t.is(r)&&w2(r)}}function fz(e,t,r,i){return e.component===t&&UD(e.identity,i)?e.overrideData===r?2:1:0}function NH(e,t,r,i,n,s,a,o,l){if(a>50)return!1;if(i.component!==n){if(i.component){let h=i.component.instances.indexOf(i);h>=0&&i.component.instances.splice(h,1)}n.instances.push(i),i.component=n}n instanceof Af&&n.isInstanceRoot&&n.expandInstanceChildren(e);let u=0;for(let h of n.children)if($t.is(h)){let c=[...t,...typeof h.identity=="string"?[h.identity]:h.identity],d=Vx.resolve(r,c,1);d!=null&&!(d instanceof Ei)&&(Object.setPrototypeOf(d,Ei.prototype),console.error("wrong prototype"));let f=null,p;if(!o){let m=i.children[u];if(f=$t.is(m)?m:null,f!==null){let g=fz(f,h,d,c);p=g>=1?f.stateSelection:void 0,g!==2&&(f=null)}if(f===null&&(f=e.scene.findInstance(c)??null,f!==null)){let g=fz(f,h,d,c);if(p=g>=1?f.stateSelection:void 0,g!==2)f=null;else{let v=f.parent.children.indexOf(f);f.parent.children.splice(v,1),i.children.splice(u,0,f),f.parent===i?v<=u&&console.error("not possible"):(f.parent=i,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),e.pendingDeletes.delete(f))}}}if(f===null){let m=d?qu.apply(h.data,d):h.data;Mh.is(m.type)&&(m={...m,type:"Empty"}),f=Iu.createEntity(c,m,e),f.overrideData=d,i.add(f),i.children.splice(i.children.length-1,1),i.children.splice(u,0,f),f.updateState(f.data,e),p&&f.changeSelectedState(p,e),e.scene.registerInstanceAndSetUuid(f)}if(f.isBone){let m=f.identity[f.identity.length-1];l[m]=f.uuid}u+=1,NH(e,t,r,f,h,s,a+1,o,l)}if(!o){let h=u;for(;;){let c=i.children[u];if($t.is(c))e.pendingDeletes.add(c);else break;u+=1}i.children.splice(h,u-h)}return!0}var R0e=class extends Wv(P4,fb){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}};function k0e(e,t,r){let i;return t.geometry.type==="TextGeometry"?new MH(e,t,r):(t.geometry.type==="SubdivGeometry"?i=new lv(e,t,r):t.geometry.type==="PathGeometry"?i=new x2(e,t,r):t.geometry.type==="VectorGeometry"?i=new I0e(e,t,r):t.geometry.type==="BooleanGeometry"?i=new Zf(e,t,r):i=new Qn(e,t,r),i)}function b2(e,t,r){return t.type==="Mesh"?k0e(e,t,r):t.type==="Empty"?new ew(e,t):t.type==="Bone"?new R0e(e,t):t.type==="Page"?new Ku(e,t):t.type==="PointLight"?new L0e(e,t,r):t.type==="SpotLight"?new zH(e,t,r):t.type==="DirectionalLight"?new kH(e,t,r):t.type==="Component"||t.type==="Instance"?new Af(e,t,r):Mh.is(t.type)?new on(e,t):(console.error(t),new ew(e,t))}Iu.createEntity=b2;function z0e(e,t,r){let i=b2(e.identity,t,r),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,u=e.overrideData,h=e.uuid,c=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(i));for(let d of Object.keys(i))e[d]=i[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=h,e.overrideData=u,e.updateState(e.data,r),c&&e.changeSelectedState(c,r),e.resetBBoxNeedsUpdate()}Iu.changeEntityProptotype=z0e;Iu.Cloner=ba;function N0e(e,t,r,i){e.updateByOp(t,r,i,!1)}function pz(e,t){let r=!1,i=t.getLayersOfType("transmission"),n=t.getLayersOfType("outline");return n.length>0&&(e.layers.set(8),i.length>0&&e.layers.enable(3),r=!0,m2(e),p2(e)),i.length===0&&n.length===0&&e.layers.set(0),e instanceof Dp&&e.needsAO&&e.layers.enable(5),r}function mz(e,t){if(!t.layers)return!1;let r=!1,i=t.getLayersOfType("transmission").filter(s=>s.data.visible),n=t.getLayersOfType("outline").filter(s=>s.data.visible);return i.length>0&&(e.layers.set(3),n.length>0&&e.layers.enable(8),r=!0),i.length===0&&n.length===0&&e.layers.set(0),e.needsAO&&e.layers.enable(5),r}function B0e(e){let t=!1;return e.traverseEntity(r=>{if(r instanceof Dp)if(Array.isArray(r.material))for(let i=0;i<r.material.length;i++)pz(r,r.material[i])&&(t=!0);else pz(r,r.material)&&(t=!0)}),t}function F0e(e){let t=!1;return e.traverseEntity(r=>{if(r instanceof Dp)if(Array.isArray(r.material))for(let i=0;i<r.material.length;i++)mz(r,r.material[i])&&(t=!0);else mz(r,r.material)&&(t=!0)}),t}var U0e=new X4,j0e=new Oe,H0e=new pp;function wT(e,t,r,i=!1){let n=e.cloner;if(n)for(let s of n.children){let a=j0e.copy(s.matrixWorld).invert(),o=H0e.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let u=U0e;u.set(o.origin,o.direction),u.near=t.near,u.far=t.far;let h=u.intersectObject(e,!1);h.length>0&&r.push({...h[0],object:i?s:e})}}var V0e=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((r,i)=>{let n=[i,r],s=r;for(;this._constraints.has(s);)s=this._constraints.get(s),t.has(s)||n.push(s);for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let r=e;for(;this._constraints.has(r);)if(r=this._constraints.get(r),r===t)return!0;return!1}},bT=new zv;bT.wireframe=!0;var gz=new P,_2=class extends Yu{constructor(e,t){super(),this.data=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new V0e,this.errorPage=new Ku("fdasfa",{...Qf.defaultData,name:""}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=F0e(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=B0e(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),r=this.entityIdentityToEntity[t];r&&(e.uuid=r.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof Ku&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let r=[],i=t;for(;i!==this;){let n=i;i=i.parent;let s=i.children.indexOf(n);r.splice(0,0,s)}return{entity:t,sortKey:r}}getAllSorted(e){let t=[];for(let r of e){let i=this.getWithSortKey(r.id);i!==void 0&&t.push(i)}return t.sort((r,i)=>fhe(r.sortKey,i.sortKey)),t.map(r=>r.entity)}nonExistOrDescendantOf(e,t){let r=this.find(e);if(r===void 0)return!0;for(;r;){if(r.uuid===t)return!0;r=r.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===Ap)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateTreeByOp(e,t){var r;if(e.path.length===0&&e.type===7){let i=e.parent===null?this:this.find(e.parent);if(i===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);n.updateVisible(),n.resetBBoxNeedsUpdate(),va(n)&&bl(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty()}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i===void 0)throw new Error("unexpected");this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);let n=i.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(i),this.markPenumbraSizeDirty(),i.parent.remove(i),bl(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),va(i)&&(i.freeBooleanPointer(),n instanceof Zf&&n.invalidateDownstreamBooleanData().recomputeBoolean()),i instanceof x2&&i.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),this.pathConstraints.removeDependencies(i.uuid)}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(i);let n=i.parent;this.markNeedsRecomputeInstancesForAncessors(n),(r=i.cloner)==null||r.resetOnMove(),this.markToExpandCloner(i);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(i),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(i),i.invalidateClonerTransform(i),i.updateVisible(),i.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),va(i)&&(i.invalidateUpstreamBooleanData(),bl(i.parent)?i.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof Zf&&n.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let t of this.children)t instanceof Ku&&(t.visible=t.uuid===e,t.visible&&(this.activePage=t,this.activePage.onActive(this)))}updateEntityByOp(e,t,r,i){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{N0e(n,t,r,{scene:this,shared:i}),n instanceof Qn&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}init(e,t){this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{bl(r)&&r.recomputeBoolean(),r instanceof on&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){$t.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{$t.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,r,i,n,s,a){if(e){let o=i.find(e);o&&o!==i&&n.forInstancesRec(l=>{l.data=Ix(l.data,u=>{let h=u.events.data(a.id),c=l.goUp(s);if(c){let d=[...Oj(c.identity),e].join("-"),f=this.entityIdentityToEntity[d];if(f){let p=f.uuid,m=fo.zoom(h,t);m[r]=p}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,r,i,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",r,i,n,s):a.data.type==="Animation"&&this.relativeizeInner(a.data.object,[...t,a.id],"object",r,i,n,s)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Af&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,r)=>{t.data.events.forEach(i=>{if(i.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=Ix(s.data,a=>{s.isInstanceRoot||(a.events.delete(i.id),n=!0)}).data}),n===!1)for(let s of XA.list)this.rewriteActions(i.data.gameActions[s],["gameActions",s],e,t,r,i)}else i.data.type==="Conditional"?(i.data.condition.type==="Distance"?(this.relativeizeInner(i.data.condition.fromObject,["condition"],"fromObject",e,t,r,i),this.relativeizeInner(i.data.condition.toObject,["condition"],"toObject",e,t,r,i)):i.data.condition.type==="State"?this.relativeizeInner(i.data.condition.object,["condition"],"object",e,t,r,i):i.data.condition.type==="Comparison"&&(i.data.condition.lOperand.type==="Property"&&this.relativeizeInner(i.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,r,i),i.data.condition.rOperand.type==="Property"&&this.relativeizeInner(i.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,r,i)),this.rewriteActions(i.data.inActions,["inActions"],e,t,r,i),this.rewriteActions(i.data.outActions,["outActions"],e,t,r,i)):"actions"in i.data&&this.rewriteActions(i.data.actions,["actions"],e,t,r,i)})}),!0})}expandInstances(e,t,r){let i=new Set;this.traverseEntity(n=>{if(n instanceof Af&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:i}),t||n.resetBBoxNeedsUpdate(),r&&n.traverseEntity(s=>{r.addClip(s)}),!0});for(let n of i)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),w2(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(r=>{r instanceof Af&&r.isInstanceRoot&&(r.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let r=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[r]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[r]),t.dispose()})}clearScene(){for(let e of this.children)$t.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let r=[],i=n=>{for(let s of n.children){let a=s.cloner;if($t.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let u=s.matrixWorld.clone().invert();l.point.applyMatrix4(u),r.push(l)}}else(va(s)||fT(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,r),wT(s,e,r)),i(s)}};return i(this),r}raycastWithClones(e){let t=[],r=i=>{for(let n of i.children){let s=n.cloner;$t.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((va(n)||fT(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),wT(n,e,t,!0)),r(n))}};return r(this),t}forEachEntity(e){for(let t of this.children)$t.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)$t.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)$t.is(t)&&t.traverseEntity(e)}traverseObject(e){for(let t of this.children)ov.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)$t.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,r){let i=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,i,r),i+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,r,i,n,s){var l;let a={scene:this,shared:s},o=b2(e,t,a);return o&&(this.entityByUuid[e]=o,i.add(o),i.children.splice(n,0,i.children.pop()),r.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(r,o,s)),o.updateState(t,a),o instanceof Qn&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(u=>{if(u instanceof Qn&&u.isSkinnedMesh){let h=u.dataPatched;if(h.bones&&h.boneInverses){let c=h.bones.map(p=>this.find(p)),d=h.boneInverses.map(p=>new Oe().fromArray(p)),f=new dD(c,d);u.bind(f,u.bindMatrix)}}else u.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let i=0,n=e.length;i<n;++i){let{id:s,recursive:a}=e[i],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let r=new ai;return r.setFromPoints(t),r.getCenter(gz),gz}copyMatrixWorld(e,t){if(e===null){t.identity();return}let r=this.find(e);r?t.copy(r.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var i;if(e===null){t.identity();return}let r=(i=this.find(e))==null?void 0:i.parent;r?t.copy(r.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof es)if(Array.isArray(t.material))for(let r=0;r<t.material.length;r++)t.material[r]instanceof ic&&e(t.material[r]);else t.material instanceof ic&&e(t.material)})}updateViewPlaneSize(e,t,r=!1){this.traverseConcreteEntity(i=>{i instanceof on&&i.setViewplaneSize(e,t,r)})}},T1=(e,t)=>{let r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)},W0e=(e,t)=>{let r=t.x-e.x,i=t.y-e.y;return Y0e(Math.atan2(i,r))},G0e=(e,t,r)=>{let i={x:0,y:0};return r=_T(r),i.x=e.x-t*Math.cos(r),i.y=e.y-t*Math.sin(r),i},_T=e=>e*(Math.PI/180),Y0e=e=>e*(180/Math.PI),q0e=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,gM=new Map,vz=e=>{gM.has(e)&&clearTimeout(gM.get(e)),gM.set(e,setTimeout(e,100))},rw=(e,t,r)=>{let i=t.split(/[ ,]+/g),n;for(let s=0;s<i.length;s+=1)n=i[s],e.addEventListener?e.addEventListener(n,r,!1):e.attachEvent&&e.attachEvent(n,r)},yz=(e,t,r)=>{let i=t.split(/[ ,]+/g),n;for(let s=0;s<i.length;s+=1)n=i[s],e.removeEventListener?e.removeEventListener(n,r):e.detachEvent&&e.detachEvent(n,r)},BH=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),xz=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},ST=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},S2=(e,t,r)=>{let i=FH(e);for(let n in i)if(i.hasOwnProperty(n))if(typeof t=="string")i[n]=t+" "+r;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+r+", ";i[n]=s.slice(0,-2)}return i},X0e=(e,t)=>{let r=FH(e);for(let i in r)r.hasOwnProperty(i)&&(r[i]=t);return r},FH=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(r){t[r+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},vM=(e,t)=>{for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},$0e=(e,t)=>{let r={};for(let i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)?r[i]=t[i]:e.hasOwnProperty(i)&&(r[i]=e[i]);return r},MT=(e,t)=>{if(e.length)for(let r=0,i=e.length;r<i;r+=1)t(e[r]);else t(e)},Q0e=(e,t,r)=>({x:Math.min(Math.max(e.x,t.x-r),t.x+r),y:Math.min(Math.max(e.y,t.y-r),t.y+r)});typeof window<"u"&&(UH="ontouchstart"in window,jH=!!window.PointerEvent,HH=!!window.MSPointerEvent);var UH,jH,HH,Em={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},nf,uv={};jH?nf=Em.pointer:HH?nf=Em.MSPointer:UH?(nf=Em.touch,uv=Em.mouse):nf=Em.mouse;function zh(){}zh.prototype.on=function(e,t){var r=this,i=e.split(/[ ,]+/g),n;r._handlers_=r._handlers_||{};for(var s=0;s<i.length;s+=1)n=i[s],r._handlers_[n]=r._handlers_[n]||[],r._handlers_[n].push(t);return r};zh.prototype.off=function(e,t){var r=this;return r._handlers_=r._handlers_||{},e===void 0?r._handlers_={}:t===void 0?r._handlers_[e]=null:r._handlers_[e]&&r._handlers_[e].indexOf(t)>=0&&r._handlers_[e].splice(r._handlers_[e].indexOf(t),1),r};zh.prototype.trigger=function(e,t){var r=this,i=e.split(/[ ,]+/g),n;r._handlers_=r._handlers_||{};for(var s=0;s<i.length;s+=1)n=i[s],r._handlers_[n]&&r._handlers_[n].length&&r._handlers_[n].forEach(function(a){a.call(r,{type:n,target:r},t)})};zh.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=$0e(t.options,e))};zh.prototype.bindEvt=function(e,t){var r=this;return r._domHandlers_=r._domHandlers_||{},r._domHandlers_[t]=function(){typeof r["on"+t]=="function"?r["on"+t].apply(r,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},rw(e,nf[t],r._domHandlers_[t]),uv[t]&&rw(e,uv[t],r._domHandlers_[t]),r};zh.prototype.unbindEvt=function(e,t){var r=this;return r._domHandlers_=r._domHandlers_||{},yz(e,nf[t],r._domHandlers_[t]),uv[t]&&yz(e,uv[t],r._domHandlers_[t]),delete r._domHandlers_[t],this};var M2=zh;function Di(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Di.id,Di.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Di.prototype=new M2;Di.constructor=Di;Di.id=0;Di.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Di.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=X0e("borderRadius","50%"),r=S2("transition","opacity",e),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},vM(i.el,r),this.options.shape==="circle"&&vM(i.back,t),vM(i.front,t),this.applyStyles(i),this};Di.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var r in e[t])this.ui[t].style[r]=e[t][r];return this};Di.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Di.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Di.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Di.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Di.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var r=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=r,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let r=t.options.restJoystick,i={};i.x=r===!0||r.x!==!1?0:t.instance.frontPosition.x,i.y=r===!0||r.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,i)}return t};Di.prototype.setPosition=function(e,t){var r=this;r.frontPosition={x:t.x,y:t.y};var i=r.options.fadeTime+"ms",n={};n.front=S2("transition",["top","left"],i);var s={front:{}};s.front={left:r.frontPosition.x+"px",top:r.frontPosition.y+"px"},r.applyStyles(n),r.applyStyles(s),r.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(r),r.restCallback()},r.options.fadeTime)};Di.prototype.restCallback=function(){var e=this,t={};t.front=S2("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Di.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Di.prototype.computeDirection=function(e){var t=e.angle.radian,r=Math.PI/4,i=Math.PI/2,n,s,a;if(t>r&&t<r*3&&!e.lockX?n="up":t>-r&&t<=r&&!e.lockY?n="left":t>-r*3&&t<=-r&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-i&&t<i?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var u={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(u[l]=!0);if(u.x&&u.y&&u.angle)return e;(!u.x||!u.y)&&this.trigger("plain",e),u.x||this.trigger("plain:"+s,e),u.y||this.trigger("plain:"+a,e),u.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var K0e=Di;function si(e,t){var r=this;r.nipples=[],r.idles=[],r.actives=[],r.ids=[],r.pressureIntervals={},r.manager=e,r.id=si.id,si.id+=1,r.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},r.config(t),(r.options.mode==="static"||r.options.mode==="semi")&&(r.options.multitouch=!1),r.options.multitouch||(r.options.maxNumberOfNipples=1);let i=getComputedStyle(r.options.zone.parentElement);return i&&i.display==="flex"&&(r.parentIsFlex=!0),r.updateBox(),r.prepareNipples(),r.bindings(),r.begin(),r.nipples}si.prototype=new M2;si.constructor=si;si.id=0;si.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(r){if(r===void 0)return t[0];for(var i=0,n=t.length;i<n;i+=1)if(t[i].identifier===r)return t[i];return!1}};si.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};si.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var r=e.createNipple(t.position,e.manager.getIdentifier());r.add(),e.idles.push(r)}};si.prototype.createNipple=function(e,t){var r=this,i=r.manager.scroll,n={},s=r.options,a={x:r.parentIsFlex?i.x:i.x+r.box.left,y:r.parentIsFlex?i.y:i.y+r.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+i.x,y:l.top+i.y}}var u=new K0e(r,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(ST(u.ui.el,n),ST(u.ui.front,u.frontPosition)),r.nipples.push(u),r.trigger("added "+u.identifier+":added",u),r.manager.trigger("added "+u.identifier+":added",u),r.bindNipple(u),u};si.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};si.prototype.bindNipple=function(e){var t=this,r,i=function(n,s){r=n.type+" "+s.id+":"+n.type,t.trigger(r,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)};si.prototype.pressureFn=function(e,t,r){var i=this,n=0;clearInterval(i.pressureIntervals[r]),i.pressureIntervals[r]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),i.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(i),100)};si.prototype.onstart=function(e){var t=this,r=t.options,i=e;e=BH(e),t.updateBox();var n=function(s){t.actives.length<r.maxNumberOfNipples?t.processOnStart(s):i.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(i.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<r.maxNumberOfNipples&&t.processOnStart(s))};return MT(e,n),t.manager.bindDocument(),!1};si.prototype.processOnStart=function(e){var t=this,r=t.options,i,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(h){h.trigger("start",h),t.trigger("start "+h.id+":start",h),h.show(),s>0&&t.pressureFn(e,h,h.identifier),t.processOnMove(e)};if((i=t.idles.indexOf(o))>=0&&t.idles.splice(i,1),t.actives.push(o),t.ids.push(o.identifier),r.mode!=="semi")l(o);else{var u=T1(a,o.position);if(u<=r.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};si.prototype.getOrCreate=function(e,t){var r=this,i=r.options,n;return/(semi|static)/.test(i.mode)?(n=r.idles[0],n?(r.idles.splice(0,1),n):i.mode==="semi"?r.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=r.createNipple(t,e),n)};si.prototype.processOnMove=function(e){var t=this,r=t.options,i=t.manager.getIdentifier(e),n=t.nipples.get(i),s=t.manager.scroll;if(!q0e(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+i),t.manager.removeIdentifier(i);return}if(r.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=i;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};r.lockX&&(l.y=n.position.y),r.lockY&&(l.x=n.position.x);var u=T1(l,n.position),h=W0e(l,n.position),c=_T(h),d=u/o,f={distance:u,position:l},p,m;if(n.options.shape==="circle"?(p=Math.min(u,o),m=G0e(n.position,p,h)):(m=Q0e(l,n.position,o),p=T1(m,n.position)),r.follow){if(u>o){let x=l.x-m.x,w=l.y-m.y;n.position.x+=x,n.position.y+=w,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",u=T1(l,n.position)}}else l=m,u=p;var g=l.x-n.position.x,v=l.y-n.position.y;n.frontPosition={x:g,y:v},r.dataOnly||ST(n.ui.front,n.frontPosition);var y={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:u,angle:{radian:c,degree:h},vector:{x:g/o,y:-v/o},raw:f,instance:n,lockX:r.lockX,lockY:r.lockY};y=n.computeDirection(y),y.angle={radian:_T(180-h),degree:180-h},n.trigger("move",y),t.trigger("move "+n.id+":move",y)};si.prototype.processOnEnd=function(e){var t=this,r=t.options,i=t.manager.getIdentifier(e),n=t.nipples.get(i),s=t.manager.removeIdentifier(n.identifier);!n||(r.dataOnly||n.hide(function(){r.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(r.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(r.mode)&&(t.manager.ids[s.id]=s.identifier))};si.prototype.onDestroyed=function(e,t){var r=this;r.nipples.indexOf(t)>=0&&r.nipples.splice(r.nipples.indexOf(t),1),r.actives.indexOf(t)>=0&&r.actives.splice(r.actives.indexOf(t),1),r.idles.indexOf(t)>=0&&r.idles.splice(r.idles.indexOf(t),1),r.ids.indexOf(t.identifier)>=0&&r.ids.splice(r.ids.indexOf(t.identifier),1),r.manager.removeIdentifier(t.identifier),r.manager.unbindDocument()};si.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(r){r.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var Z0e=si;function Fi(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=xz(),t.config(e),t.prepareCollections();var r=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;rw(window,"resize",function(){vz(r)});var i=function(){t.scroll=xz()};return rw(window,"scroll",function(){vz(i)}),t.collections}Fi.prototype=new M2;Fi.constructor=Fi;Fi.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var r;return e.collections.every(function(i){return r=i.get(t),!r}),r}};Fi.prototype.create=function(e){return this.createCollection(e)};Fi.prototype.createCollection=function(e){var t=this,r=new Z0e(t,e);return t.bindCollection(r),t.collections.push(r),r};Fi.prototype.bindCollection=function(e){var t=this,r,i=function(n,s){r=n.type+" "+s.id+":"+n.type,t.trigger(r,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)};Fi.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Fi.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Fi.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Fi.prototype.removeIdentifier=function(e){var t={};for(var r in this.ids)if(this.ids[r]===e){t.id=r,t.identifier=this.ids[r],delete this.ids[r];break}return t};Fi.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Fi.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Fi.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Fi.prototype.onAny=function(e,t){var r=this,i,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=BH(t);var s=function(o,l,u){u.ids.indexOf(l)>=0&&(u[n](o),o._found_=!0)},a=function(o){i=r.getIdentifier(o),MT(r.collections,s.bind(null,o,i)),o._found_||r.removeIdentifier(i)};return MT(t,a),!1};Fi.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Fi.prototype.onDestroyed=function(e,t){var r=this;if(r.collections.indexOf(t)<0)return!1;r.collections.splice(r.collections.indexOf(t),1)};var J0e=Fi,wz=new J0e,eye={create:function(e){return wz.create(e)},factory:wz},VH=new Map,pg=new Map,Kc=class{constructor(e,t,r,i){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?i.getAudio(n).src:n.data;this.audioPlayer=new Xm({src:l,volume:s,delay:a,loop:o}),pg.has(r.uuid)?pg.get(r.uuid).push(this):pg.set(r.uuid,[this]),VH.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},ET=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=VH.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=pg.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(r=>r.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(r=>r.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...pg.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(r=>{r.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(r=>{r.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},mg=class{constructor(e,t,r,i){if(this.data=t,t.interaction==="play")this.interaction=new Kc(e,t,r,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new ET(t);else throw new Error("Missing property")}dispatchBasic(){this.interaction instanceof Kc?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){this.interaction instanceof Kc?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){this.interaction instanceof Kc&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},tye="text/plain",rye="us-ascii",bz=(e,t)=>t.some(r=>r instanceof RegExp?r.test(e):r===e),iye=(e,{stripHash:t})=>{let r=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!r)throw new Error(`Invalid URL: ${e}`);let{type:i,data:n,hash:s}=r.groups,a=i.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),u=[...a.map(h=>{let[c,d=""]=h.split("=").map(f=>f.trim());return c==="charset"&&(d=d.toLowerCase(),d===rye)?"":`${c}${d?`=${d}`:""}`}).filter(Boolean)];return o&&u.push("base64"),(u.length>0||l&&l!==tye)&&u.unshift(l),`data:${u.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function nye(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return iye(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let r=e.startsWith("//");!r&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let i=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&i.protocol==="https:"&&(i.protocol="http:"),t.forceHttps&&i.protocol==="http:"&&(i.protocol="https:"),t.stripAuthentication&&(i.username="",i.password=""),t.stripHash?i.hash="":t.stripTextFragment&&(i.hash=i.hash.replace(/#?:~:text.*?$/i,"")),i.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let u=s.exec(i.pathname);if(!u)break;let h=u[0],c=u.index,d=i.pathname.slice(a,c);o+=d.replace(/\/{2,}/g,"/"),o+=h,a=c+h.length}let l=i.pathname.slice(a,i.pathname.length);o+=l.replace(/\/{2,}/g,"/"),i.pathname=o}if(i.pathname)try{i.pathname=decodeURI(i.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=i.pathname.split("/"),a=s[s.length-1];bz(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),i.pathname=s.slice(1).join("/")+"/")}if(i.hostname&&(i.hostname=i.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(i.hostname)&&(i.hostname=i.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...i.searchParams.keys()])bz(s,t.removeQueryParameters)&&i.searchParams.delete(s);if(t.removeQueryParameters===!0&&(i.search=""),t.sortQueryParameters){i.searchParams.sort();try{i.search=decodeURIComponent(i.search)}catch{}}t.removeTrailingSlash&&(i.pathname=i.pathname.replace(/\/$/,""));let n=e;return e=i.toString(),!t.removeSingleSlash&&i.pathname==="/"&&!n.endsWith("/")&&i.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||i.pathname==="/")&&i.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),r&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var sye=class{constructor({url:e,context:t},r){if(this.eventManager=r,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:nye(e,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=t??"tab"}dispatch(){var e;Pj?window.location.assign(this.url):(this.context==="tab"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.eventManager.controlsManager.orbitControls)==null||e.onPointerUp(xt[0]),phe())}},WH=class{constructor(e,t,r){this.data=e,this.page=t,this.eventManager=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=i=>{var o,l;this.timeoutIdQueue.shift();let n=this.page.scene.find(i);if(n===void 0)return;let s=this.controlsManager.sharedGameControlGlobals.rapierWorld,a=s?(o=n.dataPatched.physics)==null?void 0:o.fusedBody:!0;if(n.cloner){for(let u of n.cloner.children)a?(u.playModeVisible=!1,u.rigidBody&&((l=n.dataPatched.physics)==null?void 0:l.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),s.removeRigidBody(u.rigidBody),u.rigidBody=void 0),u.bvhGeometry&&(u.bvhGeometry=void 0)):this.clone===void 0||this.clone===u?(u.playModeVisible=!1,u.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),s.removeRigidBody(u.rigidBody),u.rigidBody=void 0)):u.playModeVisible===void 0&&(u.playModeVisible=!0);(a||this.clone===void 0||this.clone===!1)&&(n.visible=!1,n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),s.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0))}else n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),s.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0),n.visible=!1;s===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.rigidBody!==void 0),this.eventManager.requestRender()},this.objects=[...e.objects],this.controlsManager=r.controlsManager}dispatch(e){this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},aye=class{constructor(e,t,r){this.page=e,this.eventManager=r,this.sharedAssets=t}dispatch(){var e;R2(this.page,this.sharedAssets,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender()}},GH={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},E2={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},oye=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],iw={CSS:{},springs:{}};function _a(e,t,r){return Math.min(Math.max(e,t),r)}function gg(e,t){return e.indexOf(t)>-1}function yM(e,t){return e.apply(null,t)}var bt={arr:function(e){return Array.isArray(e)},obj:function(e){return gg(Object.prototype.toString.call(e),"Object")},pth:function(e){return bt.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||bt.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return bt.hex(e)||bt.rgb(e)||bt.hsl(e)},key:function(e){return!GH.hasOwnProperty(e)&&!E2.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function YH(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(r){return parseFloat(r)}):[]}function qH(e,t){var r=YH(e),i=_a(bt.und(r[0])?1:r[0],.1,100),n=_a(bt.und(r[1])?100:r[1],.1,100),s=_a(bt.und(r[2])?10:r[2],.1,100),a=_a(bt.und(r[3])?0:r[3],.1,100),o=Math.sqrt(n/i),l=s/(2*Math.sqrt(n*i)),u=l<1?o*Math.sqrt(1-l*l):0,h=1,c=l<1?(l*o+-a)/u:-a+o;function d(p){var m=t?t*p/1e3:p;return l<1?m=Math.exp(-m*l*o)*(h*Math.cos(u*m)+c*Math.sin(u*m)):m=(h+c*m)*Math.exp(-m*o),p===0||p===1?p:1-m}function f(){var p=iw.springs[e];if(p)return p;for(var m=1/6,g=0,v=0;;)if(g+=m,d(g)===1){if(v++,v>=16)break}else v=0;var y=g*m*1e3;return iw.springs[e]=y,y}return t?d:f}function lye(e){return e===void 0&&(e=10),function(t){return Math.ceil(_a(t,1e-6,1)*e)*(1/e)}}var uye=function(){var e=11,t=1/(e-1);function r(h,c){return 1-3*c+3*h}function i(h,c){return 3*c-6*h}function n(h){return 3*h}function s(h,c,d){return((r(c,d)*h+i(c,d))*h+n(c))*h}function a(h,c,d){return 3*r(c,d)*h*h+2*i(c,d)*h+n(c)}function o(h,c,d,f,p){var m,g,v=0;do g=c+(d-c)/2,m=s(g,f,p)-h,m>0?d=g:c=g;while(Math.abs(m)>1e-7&&++v<10);return g}function l(h,c,d,f){for(var p=0;p<4;++p){var m=a(c,d,f);if(m===0)return c;var g=s(c,d,f)-h;c-=g/m}return c}function u(h,c,d,f){if(!(0<=h&&h<=1&&0<=d&&d<=1))return;var p=new Float32Array(e);if(h!==c||d!==f)for(var m=0;m<e;++m)p[m]=s(m*t,h,d);function g(v){for(var y=0,x=1,w=e-1;x!==w&&p[x]<=v;++x)y+=t;--x;var S=(v-p[x])/(p[x+1]-p[x]),_=y+S*t,A=a(_,h,d);return A>=.001?l(v,_,h,d):A===0?_:o(v,y,y+t,h,d)}return function(v){return h===c&&d===f||v===0||v===1?v:s(g(v),c,f)}}return u}(),XH=function(){var e={linear:function(){return function(i){return i}}},t={Sine:function(){return function(i){return 1-Math.cos(i*Math.PI/2)}},Circ:function(){return function(i){return 1-Math.sqrt(1-i*i)}},Back:function(){return function(i){return i*i*(3*i-2)}},Bounce:function(){return function(i){for(var n,s=4;i<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-i,2)}},Elastic:function(i,n){i===void 0&&(i=1),n===void 0&&(n=.5);var s=_a(i,1,10),a=_a(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},r=["Quad","Cubic","Quart","Quint","Expo"];return r.forEach(function(i,n){t[i]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(i){var n=t[i];e["easeIn"+i]=n,e["easeOut"+i]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+i]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function A2(e,t){if(bt.fnc(e))return e;var r=e.split("(")[0],i=XH[r],n=YH(e);switch(r){case"spring":return qH(e,t);case"cubicBezier":return yM(uye,n);case"steps":return yM(lye,n);default:return yM(i,n)}}function $H(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function mb(e,t){for(var r=e.length,i=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<r;s++)if(s in e){var a=e[s];t.call(i,a,s,e)&&n.push(a)}return n}function gb(e){return e.reduce(function(t,r){return t.concat(bt.arr(r)?gb(r):r)},[])}function _z(e){return bt.arr(e)?e:(bt.str(e)&&(e=$H(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function T2(e,t){return e.some(function(r){return r===t})}function C2(e){var t={};for(var r in e)t[r]=e[r];return t}function AT(e,t){var r=C2(e);for(var i in e)r[i]=t.hasOwnProperty(i)?t[i]:e[i];return r}function vb(e,t){var r=C2(e);for(var i in t)r[i]=bt.und(e[i])?t[i]:e[i];return r}function cye(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function hye(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=e.replace(t,function(o,l,u,h){return l+l+u+u+h+h}),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),n=parseInt(i[1],16),s=parseInt(i[2],16),a=parseInt(i[3],16);return"rgba("+n+","+s+","+a+",1)"}function dye(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),r=parseInt(t[1],10)/360,i=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,f,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(f-d)*6*p:p<1/2?f:p<2/3?d+(f-d)*(2/3-p)*6:d}var o,l,u;if(i==0)o=l=u=n;else{var h=n<.5?n*(1+i):n+i-n*i,c=2*n-h;o=a(c,h,r+1/3),l=a(c,h,r),u=a(c,h,r-1/3)}return"rgba("+o*255+","+l*255+","+u*255+","+s+")"}function fye(e){if(bt.rgb(e))return cye(e);if(bt.hex(e))return hye(e);if(bt.hsl(e))return dye(e)}function Dl(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function pye(e){if(gg(e,"translate")||e==="perspective")return"px";if(gg(e,"rotate")||gg(e,"skew"))return"deg"}function TT(e,t){return bt.fnc(e)?e(t.target,t.id,t.total):e}function uo(e,t){return e.getAttribute(t)}function D2(e,t,r){var i=Dl(t);if(T2([r,"deg","rad","turn"],i))return t;var n=iw.CSS[t+r];if(!bt.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+r;var l=s/a.offsetWidth;o.removeChild(a);var u=l*parseFloat(t);return iw.CSS[t+r]=u,u}function QH(e,t,r){if(t in e.style){var i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(i)||"0";return r?D2(e,n,r):n}}function P2(e,t){if(bt.dom(e)&&!bt.inp(e)&&(uo(e,t)||bt.svg(e)&&e[t]))return"attribute";if(bt.dom(e)&&T2(oye,t))return"transform";if(bt.dom(e)&&t!=="transform"&&QH(e,t))return"css";if(e[t]!=null)return"object"}function KH(e){if(bt.dom(e)){for(var t=e.style.transform||"",r=/(\w+)\(([^)]*)\)/g,i=new Map,n;n=r.exec(t);)i.set(n[1],n[2]);return i}}function mye(e,t,r,i){var n=gg(t,"scale")?1:0+pye(t),s=KH(e).get(t)||n;return r&&(r.transforms.list.set(t,s),r.transforms.last=t),i?D2(e,s,i):s}function O2(e,t,r,i){switch(P2(e,t)){case"transform":return mye(e,t,i,r);case"css":return QH(e,t,r);case"attribute":return uo(e,t);default:return e[t]||0}}function L2(e,t){var r=/^(\*=|\+=|-=)/.exec(e);if(!r)return e;var i=Dl(e)||0,n=parseFloat(t),s=parseFloat(e.replace(r[0],""));switch(r[0][0]){case"+":return n+s+i;case"-":return n-s+i;case"*":return n*s+i}}function ZH(e,t){if(bt.col(e))return fye(e);if(/\s/g.test(e))return e;var r=Dl(e),i=r?e.substr(0,e.length-r.length):e;return t?i+t:i}function I2(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function gye(e){return Math.PI*2*uo(e,"r")}function vye(e){return uo(e,"width")*2+uo(e,"height")*2}function yye(e){return I2({x:uo(e,"x1"),y:uo(e,"y1")},{x:uo(e,"x2"),y:uo(e,"y2")})}function JH(e){for(var t=e.points,r=0,i,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(r+=I2(i,s)),i=s}return r}function xye(e){var t=e.points;return JH(e)+I2(t.getItem(t.numberOfItems-1),t.getItem(0))}function eV(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return gye(e);case"rect":return vye(e);case"line":return yye(e);case"polyline":return JH(e);case"polygon":return xye(e)}}function wye(e){var t=eV(e);return e.setAttribute("stroke-dasharray",t),t}function bye(e){for(var t=e.parentNode;bt.svg(t)&&bt.svg(t.parentNode);)t=t.parentNode;return t}function tV(e,t){var r=t||{},i=r.el||bye(e),n=i.getBoundingClientRect(),s=uo(i,"viewBox"),a=n.width,o=n.height,l=r.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:i,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function _ye(e,t){var r=bt.str(e)?$H(e)[0]:e,i=t||100;return function(n){return{property:n,el:r,svg:tV(r),totalLength:eV(r)*(i/100)}}}function Sye(e,t){function r(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var i=tV(e.el,e.svg),n=r(),s=r(-1),a=r(1);switch(e.property){case"x":return(n.x-i.x)*i.w;case"y":return(n.y-i.y)*i.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function Sz(e,t){var r=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,i=ZH(bt.pth(e)?e.totalLength:e,t)+"";return{original:i,numbers:i.match(r)?i.match(r).map(Number):[0],strings:bt.str(e)||t?i.split(r):[]}}function rV(e){var t=e?gb(bt.arr(e)?e.map(_z):_z(e)):[];return mb(t,function(r,i,n){return n.indexOf(r)===i})}function iV(e){var t=rV(e);return t.map(function(r,i){return{target:r,id:i,total:t.length,transforms:{list:KH(r)}}})}function Mye(e,t){var r=C2(t);if(/^spring/.test(r.easing)&&(r.duration=qH(r.easing)),bt.arr(e)){var i=e.length,n=i===2&&!bt.obj(e[0]);n?e={value:e}:bt.fnc(t.duration)||(r.duration=t.duration/i)}var s=bt.arr(e)?e:[e];return s.map(function(a,o){var l=bt.obj(a)&&!bt.pth(a)?a:{value:a};return bt.und(l.delay)&&(l.delay=o?0:t.delay),bt.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return vb(a,r)})}function Eye(e){for(var t=mb(gb(e.map(function(s){return Object.keys(s)})),function(s){return bt.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),r={},i=function(s){var a=t[s];r[a]=e.map(function(o){var l={};for(var u in o)bt.key(u)?u==a&&(l.value=o[u]):l[u]=o[u];return l})},n=0;n<t.length;n++)i(n);return r}function Aye(e,t){var r=[],i=t.keyframes;i&&(t=vb(Eye(i),t));for(var n in t)bt.key(n)&&r.push({name:n,tweens:Mye(t[n],e)});return r}function Tye(e,t){var r={};for(var i in e){var n=TT(e[i],t);bt.arr(n)&&(n=n.map(function(s){return TT(s,t)}),n.length===1&&(n=n[0])),r[i]=n}return r.duration=parseFloat(r.duration),r.delay=parseFloat(r.delay),r}function Cye(e,t){var r;return e.tweens.map(function(i){var n=Tye(i,t),s=n.value,a=bt.arr(s)?s[1]:s,o=Dl(a),l=O2(t.target,e.name,o,t),u=r?r.to.original:l,h=bt.arr(s)?s[0]:u,c=Dl(h)||Dl(l),d=o||c;return bt.und(a)&&(a=u),n.from=Sz(h,d),n.to=Sz(L2(a,h),d),n.start=r?r.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=A2(n.easing,n.duration),n.isPath=bt.pth(s),n.isColor=bt.col(n.from.original),n.isColor&&(n.round=1),r=n,n})}var nV={css:function(e,t,r){return e.style[t]=r},attribute:function(e,t,r){return e.setAttribute(t,r)},object:function(e,t,r){return e[t]=r},transform:function(e,t,r,i,n){if(i.list.set(t,r),t===i.last||n){var s="";i.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function sV(e,t){var r=iV(e);r.forEach(function(i){for(var n in t){var s=TT(t[n],i),a=i.target,o=Dl(s),l=O2(a,n,o,i),u=o||Dl(l),h=L2(ZH(s,u),l),c=P2(a,n);nV[c](a,n,h,i.transforms,!0)}})}function Dye(e,t){var r=P2(e.target,t.name);if(r){var i=Cye(t,e),n=i[i.length-1];return{type:r,property:t.name,animatable:e,tweens:i,duration:n.end,delay:i[0].delay,endDelay:n.endDelay}}}function Pye(e,t){return mb(gb(e.map(function(r){return t.map(function(i){return Dye(r,i)})})),function(r){return!bt.und(r)})}function aV(e,t){var r=e.length,i=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=r?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return i(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=r?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return i(s)+a+o+s.delay})):t.delay,n.endDelay=r?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return i(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var Mz=0;function Oye(e){var t=AT(GH,e),r=AT(E2,e),i=Aye(r,e),n=iV(e.targets),s=Pye(n,i),a=aV(s,r),o=Mz;return Mz++,vb(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:r.startOnceDelay,pingPongDelayCorrection:r.pingPongDelayCorrection,pingPongEndDelayCorrection:r.pingPongEndDelayCorrection})}var Ys=[],Ez=[],C1,Lye=function(){function e(){C1=requestAnimationFrame(t)}function t(r){var i=Ys.length;if(i){for(var n=0;n<i;){var s=Ys[n];s.paused?(Ys.splice(n,1),i-=1):(s.tick(r),n++)}e()}else C1=cancelAnimationFrame(C1)}return e}();function Iye(e){document.hidden?(Ys.forEach(function(t){return t.pause(e.timeStamp)}),Ez=Ys.slice(0),ni.running=Ys=[]):Ez.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",Iye);function ni(e){e===void 0&&(e={});var t=0,r=0,i=0,n,s,a=0,o=null;function l(_){var A=window.Promise&&new Promise(function(M){return o=M});return _.finished=A,A}var u=Oye(e);l(u);function h(){var _=u.direction;_!=="alternate"&&(u.direction=_!=="normal"?"normal":"reverse"),u.reversed=!u.reversed,s.forEach(function(A){(A.loop===1||A.loop%2===0)&&(A.reversed=u.reversed)})}function c(){u.direction="normal",u.reversed=!1,s.forEach(function(_){return _.reversed=!1})}function d(_){return u.reversed?u.duration-_:_}function f(){t=0,r=d(u.currentTime)*(1/ni.speed)}function p(_,A,M=!1){A&&(u.reversed?A.seek(A.duration*A.loop-(_-A.timelineOffset-A.pingPongDelayCorrection),M):A.seek(_-A.timelineOffset-A.startOnceDelay-A.pingPongDelayCorrection,M))}function m(_,A=!1){if(u.reversed)for(var M=a;M--;)p(_,s[M],A);else for(var T=0;T<a;T++)p(_,s[T],A)}function g(_){var se,re,ae,ce,me,be,Ae,$e,Le,Qe;var A=0,M=u.animations,T=M.length;for(u.direction!=="alternate"&&((se=u.parent)==null?void 0:se.direction)==="alternate"?((re=u.parent)==null?void 0:re.rewind)===!1&&u.reversePlayback===!0&&u.rewind===!1&&((ae=u.parent)!=null&&ae.reversed&&u.direction==="alternate"?_=u.duration-u.delay+u.endDelay-_:_=u.duration+u.delay-u.endDelay-_):w(!1,(ce=u.parent)==null?void 0:ce.rewind,u.rewind,(me=u.parent)==null?void 0:me.reversePlayback,u.reversePlayback)&&((be=u.parent)!=null&&be.reversed&&u.direction==="alternate"?_=u.duration-u.delay+u.endDelay-_:_=u.duration+u.delay-u.endDelay-_);A<T;){var C=M[A],L=C.animatable,I=C.tweens,k=I.length-1,z=I[k];k&&(z=mb(I,function(Re){return _<Re.end})[0]||z);let Xe;(Ae=u.parent)!=null&&Ae.reversed&&u.direction==="alternate"?Xe=_a(_-z.start-z.endDelay,0,z.duration)/z.duration:Xe=_a(_-z.start-z.delay,0,z.duration)/z.duration;for(var V=isNaN(Xe)?1:z.easing(Xe),K=z.to.strings,q=z.round,O=[],W=z.to.numbers.length,N=void 0,B=0;B<W;B++){var j=void 0;let Re,Ie;u.direction!=="alternate"?(($e=u.parent)==null?void 0:$e.rewind)===!1&&u.reversePlayback===!0&&u.rewind===!1?(Re=z.to.numbers[B],Ie=z.from.numbers[B]||0):(Ie=z.to.numbers[B],Re=z.from.numbers[B]||0):w(!0,(Le=u.parent)==null?void 0:Le.rewind,u.rewind,(Qe=u.parent)==null?void 0:Qe.reversePlayback,u.reversePlayback)?(Re=z.to.numbers[B],Ie=z.from.numbers[B]||0):(Ie=z.to.numbers[B],Re=z.from.numbers[B]||0),z.isPath?j=Sye(z.value,V*Ie):j=Re+V*(Ie-Re),q&&(z.isColor&&B>2||(j=Math.round(j*q)/q)),O.push(j)}var Q=K.length;if(!Q)N=O[0];else{N=K[0];for(var H=0;H<Q;H++){K[H];var G=K[H+1],$=O[H];isNaN($)||(G?N+=$+G:N+=$+" ")}}nV[C.type](L.target,C.property,N,L.transforms),C.currentValue=N,A++}}function v(_){u[_]&&!u.passThrough&&u[_](u)}function y(){u.remaining&&u.remaining!==!0&&u.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function w(_,A,M,T,C){return x[_<<4|A<<3|M<<2|T<<1|C]}function S(_,A=!1){var I;var M=u.duration;let T=u.delay,C=M-u.endDelay;(I=u.parent)!=null&&I.reversed&&u.direction==="alternate"&&(T=u.endDelay,C=M-u.delay);var L=d(_);if(u.progress=_a(L/M*100,0,100),A||(u.reversePlayback=L<u.currentTime),a&&m(L,A),!u.began&&u.currentTime>=0&&(u.began=!0,v("begin")),!u.loopBegan&&u.currentTime>0&&(u.loopBegan=!0,v("loopBegin")),(u.reversed||L>=0)&&L<=T&&u.currentTime!==0&&(g(0),v("change")),(L>=C&&u.currentTime!==M+u.pingPongDelayCorrection||!M)&&(g(M),v("change")),L>T&&L<C?(u.changeBegan||(u.changeBegan=!0,u.changeCompleted=!1,v("changeBegin")),g(L),v("change")):u.changeBegan?(u.changeCompleted=!0,u.changeBegan=!1,v("change"),a&&v("timelineChangeComplete")):u.began&&L>C&&v("changeComplete"),u.currentTime=_a(L,0,M+u.pingPongDelayCorrection),u.began&&v("update"),_>=M)if(y(),!u.remaining)u.paused=!0,u.completed||(u.completed=!0,v("loopComplete"),v("complete"),!u.passThrough&&"Promise"in window&&(o(),l(u)));else{a?t+=u.duration/ni.speed:t+=u.duration;for(let k of s)k.setStartTime(0),k.remaining=k.loop;v("loopComplete"),u.loopBegan=!1,u.direction==="alternate"?h():a&&c()}}return u.reset=function(){var _=u.direction;u.passThrough=!1,u.currentTime=0,u.progress=0,u.paused=!0,u.began=!1,u.loopBegan=!1,u.changeBegan=!1,u.completed=!1,u.changeCompleted=!1,u.reversePlayback=!1,u.reversed=_==="reverse",u.remaining=u.loop,s=u.children,a=s.length;for(var A=a;A--;)u.children[A].reset();(u.reversed&&u.loop!==!0||_==="alternate"&&u.loop===1)&&u.remaining++,g(u.reversed?u.duration:0)},u.setStartTime=function(_){t=_},u.set=function(_,A){return sV(_,A),u},u.tick=function(_){i=_,t||(t=i),S((i+(r-t))*ni.speed)},u.seek=function(_,A=!1){S(_-t,A)},u.pause=function(_){u.paused=!0,a&&(n=_??performance.now())},u.play=function(_){!u.paused||(u.completed&&u.reset(),u.paused=!1,Ys.push(u),a&&n!==void 0&&(t+=(_??performance.now())-n),C1||Lye())},u.reverse=function(){h(),u.completed=!u.reversed,f()},u.restart=function(){u.reset(),u.play()},u.reset(),u.autoplay&&u.play(),u}function Az(e,t){for(var r=t.length;r--;)T2(e,t[r].animatable.target)&&t.splice(r,1)}function Rye(e){for(var t=rV(e),r=Ys.length;r--;){var i=Ys[r],n=i.animations,s=i.children;Az(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;Az(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&i.pause()}}function kye(e,t){t===void 0&&(t={});var r=t.direction||"normal",i=t.easing?A2(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",u=a==="last",h=bt.arr(e),c=parseFloat(h?e[0]:e),d=h?parseFloat(e[1]):0,f=Dl(h?e[1]:e)||0,p=t.start||0+(h?c:0),m=[],g=0;return function(v,y,x){if(o&&(a=0),l&&(a=(x-1)/2),u&&(a=x-1),!m.length){for(var w=0;w<x;w++){if(!n)m.push(Math.abs(a-w));else{var S=l?(n[0]-1)/2:a%n[0],_=l?(n[1]-1)/2:Math.floor(a/n[0]),A=w%n[0],M=Math.floor(w/n[0]),T=S-A,C=_-M,L=Math.sqrt(T*T+C*C);s==="x"&&(L=-T),s==="y"&&(L=-C),m.push(L)}g=Math.max.apply(Math,m)}i&&(m=m.map(function(k){return i(k/g)*g})),r==="reverse"&&(m=m.map(function(k){return s?k<0?k*-1:-k:Math.abs(g-k)}))}var I=h?(d-c)/g:c;return p+I*(Math.round(m[y]*100)/100)+f}}function zye(e){e===void 0&&(e={});var t=ni(e);return t.duration=0,t.add=function(r,i){var n=Ys.indexOf(t),s=t.children;n>-1&&Ys.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=vb(r,AT(E2,e));l.targets=l.targets||e.targets;var u=t.duration;l.autoplay=!1,l.timelineOffset=bt.und(i)?u:L2(i,u),a(t);var h=ni(l);a(h),s.push(h),h.parent=t;var c=aV(s,e);return t.delay=c.delay,t.endDelay=c.endDelay,t.duration=c.duration,h.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}ni.version="3.2.0";ni.speed=1;ni.running=Ys;ni.remove=Rye;ni.get=O2;ni.set=sV;ni.convertPx=D2;ni.path=_ye;ni.setDashoffset=wye;ni.stagger=kye;ni.timeline=zye;ni.easing=A2;ni.penner=XH;ni.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var oV=ni,Tz=new P,Cz=new P,Dz=new kt;function Nye(e,t,r,i){if(i===0)return r.copy(e);if(i===1)return r.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return r.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let h=1-i;return r.w=h*e.w+i*t.w,r.x=h*e.x+i*t.x,r.y=h*e.y+i*t.y,r.z=h*e.z+i*t.z,r.normalize(),r}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-i)*o)/a,u=Math.sin(i*o)/a;return r.w=e.w*l+t.w*u,r.x=e.x*l+t.x*u,r.y=e.y*l+t.y*u,r.z=e.z*l+t.z*u,r}function Eh(e,t,r,i,n){let s=r[e]?r[e]:void 0,a=i[e];if(a==null)return;let o=s??t[e],l=a;if(o!==l)return{update:u=>{let h=zt.lerp(o,l,u);n?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=o},end:()=>{t[e]=l}}}function lV(e,t,r,i,n){let s=r[e]?r[e]:void 0,a=i[e];if(!a)return;let o=t[e],l=[...s??o],u=[...a];if(!(l.length!==u.length||UD(l,u)))return{update:h=>{l.forEach((c,d)=>{let f=zt.lerp(c,u[d],h);t[e][d]=n?Math.trunc(f):f})},start:()=>{Object.assign(t[e],l)},end:()=>{Object.assign(t[e],u)}}}function Pz(e,t,r,i){let n=r[e]?r[e]:void 0,s=i[e];if(!s)return;let a=t[e],o=n?new P().fromArray(n):a.clone(),l=new P().fromArray(s);if(!o.equals(l))return{update:u=>{a.lerpVectors(o,l,u)},start:()=>{a.copy(o)},end:()=>{a.copy(l)}}}function Bye(e,t,r,i){let n=r[e]?r[e]:void 0,s=i[e];if(!s)return;let a=t[e],o=n?new Oe().fromArray(n):a.clone(),l=new P,u=new kt,h=new P;o.decompose(l,u,h);let c=new Oe().fromArray(s),d=new P,f=new kt,p=new P;if(c.decompose(d,f,p),!o.equals(c))return{update:m=>{Dz.slerpQuaternions(u,f,m),Tz.lerpVectors(l,d,m),Cz.lerpVectors(h,p,m),a.compose(Tz,Dz,Cz)},start:()=>{a.compose(l,u,h)},end:()=>{a.compose(d,f,p)}}}function Fye(e,t,r,i,n){let s=r[e]?r[e]:void 0,a=i[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new gt().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new gt().setRGB(a.r,a.g,a.b);if(l.equals(u))return;let h=o.clone();return t[e]=h,{update:c=>{h.lerpColors(l,u,c)},start:()=>{h.copy(l)},end:()=>{h.copy(u)}}}function pc(e,t,r,i){if(typeof t[e]=="number")return Eh(e,t,r??{},i);if(Array.isArray(t[e]))return lV(e,t,r??{},i)}function Uye(e,t,r){var a,o,l,u;let i=[],n=e.cameraType==="OrthographicCamera"?(a=t.orthographic)==null?void 0:a.zoom:(o=t.perspective)==null?void 0:o.zoom,s=e.cameraType==="OrthographicCamera"?(l=r.orthographic)==null?void 0:l.zoom:(u=r.perspective)==null?void 0:u.zoom;if(s!==void 0){let h=n??e.zoom,c=s;h!==c&&i.push({update:d=>{e.zoom=zt.lerp(h,c,d),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=c,e.updateProjectionMatrix()}})}if(r.targetOffset!==void 0){let h=Eh("targetOffset",e,t,r);h&&i.push(h)}return i}function jye(e,t,r,i){if(r.scaleBaked===void 0)return;let n=t.scaleBaked??e.data.geometry.scaleBaked,s=r.scaleBaked;if(sh.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[zt.lerp(n[0],s[0],o),zt.lerp(n[1],s[1],o),zt.lerp(n[2],s[2],o)]},i),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},i),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},i),e.invalidateDownstreamBooleanData()}}),a}function Hye(e,t,r){if(!r.extrusion)return;let i=e.extrusion,n=t.extrusion??{},s=r.extrusion,a=[];return d5.forEach(o=>{let l=pc(o,i,n,s);l&&a.push(l)}),a}function Vye(e,t,r,i){let n=[];if(!("geometry"in r))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=r.geometry;if(e instanceof lv){let l=jye(e,a,o,i);l&&n.push(...l)}else{let l={};if(Object.assign(l,Tl(s,zR)),zR.forEach(u=>{let h=pc(u,l,a,o);h&&n.push(h)}),e instanceof x2){Object.assign(l,{extrusion:{...s.extrusion}});let u=Hye(l,a,o);u&&n.push(...u)}n.length&&n.push({update:u=>{e.updateGeometryInteractions(l,i),e.updateGeometryGroupsIfNeeded()},start:u=>{e.updateGeometryInteractions(l,i),e.updateGeometryGroupsIfNeeded()},end:u=>{e.updateGeometryInteractions(l,i),e.updateGeometryGroupsIfNeeded()}})}return n}function Wye(e,t,r,i){let n=[];if(r.intensity!==void 0){let s=Eh("intensity",e,t,r);s&&n.push(s)}if(r.color!==void 0){let s=Fye("color",e,t,r,i);s&&n.push(s)}return n}function Gye(e,t,r,i){let n=[];if(Array.isArray(e.material)){if(!("materials"in r&&r.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=r.materials;e.material.forEach((o,l)=>{if(!a[l])return;let u=s[l]??{},h=a[l];typeof u=="string"||typeof h=="string"||n.push(...Oz(o,u,h,i))})}else{if(!("material"in r&&r.material))return n;let s="material"in t&&t.material?t.material:{},a=r.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...Oz(e.material,s,a,i))}return n}function Oz(e,t,r,i){var a;let n=[],s=Zx(r,i)||!!t.layers&&Zx(t,i);n.push(e1e(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),u=r.layers.data(o.uuid);if(!u||!(o.visible??!0)||!(u.visible??!0))continue;let h=o.getNames().filter(c=>!u5.some(d=>c.includes(d)));for(let c of h)try{let d=o.getValue(c),f;if(c==="colors")f=Zye(o,l,u,c);else if(Array.isArray(d))c==="steps"&&(f=Kye(o,l,u,c));else if(typeof d=="number")f=Yye(o,l,u,c);else{if(typeof d=="boolean")continue;d instanceof J?f=qye(o,l,u,c):d instanceof P?f=Xye(o,l,u,c):d instanceof $n?f=Qye(o,l,u,c,i):d instanceof gt?f=$ye(o,l,u,c,i):"isTexture"in d&&(f=Jye(o,l,u,c))}f&&(Array.isArray(f)?n.push(...f):n.push(f))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${c}`,d)}}return n}function Yye(e,t,r,i){if(!e.hasValue(i)||!(i in r))return;let n=t?t[i]:e.getValue(i),s=r[i];if(n!==s)return{update:a=>{e.setValue(i,zt.lerp(n,s,a))},start:()=>{e.setValue(i,n)},end:()=>{e.setValue(i,s)}}}function qye(e,t,r,i){if(!e.hasValue(i)||!(i in r))return;let n=e.getValue(i),s=t?new J().fromArray(t[i]):n.clone(),a=new J().fromArray(r[i]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function Xye(e,t,r,i){if(!e.hasValue(i)||!(i in r))return;let n=e.getValue(i),s=t?new P().fromArray(t[i]):n.clone(),a=new P().fromArray(r[i]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function $ye(e,t,r,i,n){if(!e.hasValue(i)||!(i in r))return;let s=t?t[i]:void 0,a=r[i],o=e.getValue(i),l=s?typeof s=="string"?n.getColor(s).clone():new gt().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new gt().setRGB(a.r,a.g,a.b);if(l.equals(u))return;let h=o.clone();return{update:c=>{e.getValue(i)!==h&&e.setValue(i,h),h.lerpColors(l,u,c)},start:()=>{h.copy(l)},end:()=>{h.copy(u)}}}function Qye(e,t,r,i,n){if(!e.hasValue(i)||!(i in r))return;let s=t?t[i]:void 0,a=r[i],o=e.getValue(i),l=s?typeof s=="string"?n.getColor(s).clone():new gt().setRGB(s.r,s.g,s.b):o.clone(),u=typeof a=="string"?n.getColor(a).clone():new $n(a.r,a.g,a.b,a.a);if(l.equals(u))return;let h=o.clone();return{update:c=>{e.getValue(i)!==h&&e.setValue(i,h),h.lerpColors(l,u,c)},start:()=>{h.copy(l)},end:()=>{h.copy(u)}}}function Kye(e,t,r,i="steps"){if(!e.hasValue(i)||!(i in r))return;let n=[],s=e.getValue(i),a=t?t[i]:s,o=r[i];for(let l=0;l<s.length;++l){let u=a[l],h=o[l];u!==h&&n.push({update:c=>{s[l]=zt.lerp(u,h,c)},start:()=>{s[l]=u},end:()=>{s[l]=h}})}return n.length?n:void 0}function Zye(e,t,r,i="colors"){if(!e.hasValue(i)||!(i in r))return;let n=[],s=e.getValue(i),a=t?t[i]:s.map(l=>l.toArray()),o=r[i];for(let l=0;l<s.length;++l){let u=[...a[l]],h=[...o[l]];Nx.isEqual(u,h)||n.push({update:c=>{s[l].fromArray(Nx.lerp(u,h,c))},start:()=>{s[l].fromArray(u)},end:()=>{s[l].fromArray(h)}})}return n.length?n:void 0}function Jye(e,t,r,i="texture"){if(!e.hasValue(i)||!(i in r))return;let n=e.getNode("mat");if(!n)return;let s=t?t[i]:n,a=r[i],o=[...s.repeat],l=[...s.offset],u=[...a.repeat],h=[...a.offset];if(!tf.isEqual(o,u)||!tf.isEqual(l,h))return{update:c=>{n.repeat=tf.lerp(o,u,c),n.offset=tf.lerp(l,h,c),n.updateMatrix()},start:()=>{n.repeat=[...o],n.offset=[...l],n.updateMatrix()},end:()=>{n.repeat=[...u],n.offset=[...h],n.updateMatrix()}}}function e1e(e,t){return{update:()=>{e.transparent=t}}}var xM=new P,Lz=new Ri;function t1e(e,t,r,i){let n=[],s,a,o,l,u,h,c={slide:(t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping).slide,offset:(t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping).offset};if(u=Eh("slide",c,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,r.pathSnapping??e.dataPatched.pathSnapping),u&&n.push(u),h=Eh("offset",c,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,r.pathSnapping??e.dataPatched.pathSnapping),h&&n.push(h),!u&&!h&&(s=Pz("position",e,t,r),s&&n.push(s),a=Pz("scale",e,t,r),a&&n.push(a),o=r1e(e,t,r,i),o&&n.push(o),l=Bye("hiddenMatrix",e,t,r),l&&n.push(l)),s||a||o||l||u||h){let d=()=>{var f;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(f=e.parent)!=null&&f.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),va(e)&&bl(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,c))};n.push({update:d,start:d,end:d})}return n}function r1e(e,t,r,i){let n=t!=null&&t.rotation?t.rotation:void 0,s=r.rotation;if(!s)return;let a=n?new P().fromArray(n):new P().setFromEuler(e.rotation),o=new P().fromArray(s);if(a.equals(o))return;let l=xM.subVectors(o,a);if(i&&l.toArray().every(u=>Math.abs(u)<2*Math.PI)){let u=new kt().setFromEuler(Lz.setFromVector3(a)),h=new kt().setFromEuler(Lz.setFromVector3(o));return{update:c=>{Nye(u,h,e.quaternion,c)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(o)}}}else return{update:u=>{xM.lerpVectors(a,o,u),e.rotation.setFromVector3(xM)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(o)}}}function i1e(e,t,r){let i=[];if(!("cloner"in r)||!e.cloner)return i;let n=e.cloner,s="cloner"in t?t.cloner:{},a=r.cloner;i5.forEach(d=>{let f;d==="count"?f=Eh("count",n.parameters,s,a,!0):f=pc(d,n.parameters,s??{},a),f&&i.push(f)});let o=n1e(n,s,a);o!=null&&o.length&&i.push(...o);let l=s1e(n,s,a);l!=null&&l.length&&i.push(...l);let u=a1e(n,s,a);u!=null&&u.length&&i.push(...u);let h=o1e(n,s,a);h!=null&&h.length&&i.push(...h);let c=l1e(n,s,a);return c!=null&&c.length&&i.push(...c),i.length&&i.push({update:()=>{n.update()}}),i}function n1e(e,t,r){if(e.parameters.type!=="radial")return;let i=t.radial,n=r.radial;if(!n)return;let s=e.parameters.radial,a=[];return n5.forEach(o=>{let l=pc(o,s,i??{},n);l&&a.push(l)}),a}function s1e(e,t,r){if(e.parameters.type!=="linear")return;let i=t.linear,n=r.linear;if(!n)return;let s=[],a=e.parameters.linear;return s5.forEach(o=>{let l=pc(o,a,i??{},n);l&&s.push(l)}),s}function a1e(e,t,r){if(e.parameters.type!=="grid")return;let i=t.grid,n=r.grid;if(!n)return;let s=[],a=e.parameters.grid;return a5.forEach(o=>{let l;o==="count"?l=lV(o,a,i??{},n,!0):l=pc(o,a,i??{},n),l&&s.push(l)}),s}function o1e(e,t,r){if(e.parameters.type!=="toObject")return;let i=t.toObject,n=r.toObject;if(!n)return;let s=[],a=e.parameters.toObject;return o5.forEach(o=>{let l;o==="count"?l=Eh(o,a,i??{},n,!0):l=pc(o,a,i??{},n),l&&s.push(l)}),s}function l1e(e,t,r){if(!e.parameters.randomness)return;let i=t.randomnessObject,n=r.randomnessObject;if(!n)return;let s=[],a=e.parameters.randomnessObject;return l5.forEach(o=>{let l=pc(o,a,i??{},n);l&&s.push(l)}),s}function Iz(e,t,r,i,n){let s=[];return e.data.visible&&s.push(...t1e(e,t,r,n)),e.data.visible&&s.push(...i1e(e,t,r)),va(e)?(e instanceof Qn&&e.data.visible&&s.push(...Vye(e,t,r,i)),e.data.visible&&s.push(...Gye(e,t,r,i))):Sge(e)?e.data.visible&&s.push(...Wye(e,t,r,i)):_ge(e)&&s.push(...Uye(e,t,r)),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var Rz=new P;function R2(e,t,r=!1){let i=[];e.traverseChildren(n=>{var l,u,h,c,d;if(r&&((l=n.rigidBody)==null||l.setTranslation(n.position0,!0),(u=n.rigidBody)==null||u.setRotation(n.rotation0,!0),(h=n.rigidBody)==null||h.setLinvel(Rz,!0),(c=n.rigidBody)==null||c.setAngvel(Rz,!0)),!$t.is(n))return;let s=n.uuid,a=n.data;if(delete n.states,n.uuid===Ap)return;let o=!1;i.some(f=>{var p;return(p=e.scene.find(s))==null?void 0:p.isDescendantOf(f)})?o=!0:((d=a.physics)==null?void 0:d.fusedBody)===!0&&a.physics.rigidBody==="dynamic"&&i.push(s),n.data=a,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let f of a.states){let p={...f.data};e.data.globalPhysics.usePhysics===!0&&a.physics&&(a.physics.rigidBody==="dynamic"||o)&&(f.data.position!==void 0&&delete p.position,f.data.rotation!==void 0&&delete p.rotation,f.data.hiddenMatrix!==void 0&&delete p.hiddenMatrix),n.states||(n.states={}),n.states[f.id]=Xc.patch(a,p)}c1e(e.scene,n,null,t,a.events.find(f=>f.data.type==="Follow"||f.data.type==="LookAt")!==void 0),u1e(e)})}function u1e(e){e.traverseEntity(t=>{for(let r of t.data.events){let i=[];switch(r.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":i.push(...r.data.actions);break;case"GameControl":for(let n of Object.values(r.data.gameActions))i.push(...n);break;case"DragDrop":i.push(...r.data.dragDropActions.drag,...r.data.dragDropActions.drop);break;case"Conditional":i.push(...r.data.inActions,...r.data.outActions);break}for(let n of i)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function c1e(e,t,r,i,n=!1){if(t instanceof Qn&&t.removeInteractionGeometry(),t.changeSelectedState(r,{scene:e,shared:i},n),t instanceof Qn&&t.updateGeometryGroupsIfNeeded(),t instanceof on&&t.updateCameraState(t.dataPatched,{scene:e,shared:i}),t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}function uV(e){let t;if(e.easing===5){let{control1:r,control2:i}=e;t=`cubicBezier(
			${r[0]}, ${r[1]}, ${i[0]}, ${i[1]}
		)`}else if(e.easing===6){let{mass:r,stiffness:i,damping:n,velocity:s}=e;t=`spring( ${r}, ${i}, ${n}, ${s} )`}else{let r;switch(e.easing){case 0:r=xu.linear;break;case 1:r=xu.ease;break;case 2:r=xu.easeIn;break;case 3:r=xu.easeOut;break;case 4:r=xu.easeInOut;break;default:r=xu.linear}let[i,n,s,a]=r;t=`cubicBezier( ${i}, ${n}, ${s}, ${a} )`}return{duration:e.duration,easing:t}}function cV(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var h1e={type:"beginState"},d1e={type:"completeState",isfromEntity:!1},kz=class{constructor(e,t,r,i,n,s){if(this.object=e,this.data=i,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.dispatchEvent({type:"requestRender"})),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object.traverseEntity(o=>{o!==this.object&&o instanceof on&&o.dispatchEvent(h1e)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object.traverseEntity(o=>{o!==this.object&&o instanceof on&&o.dispatchEvent(d1e)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=Iz(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=D1(this.object,this.object.currentState===r?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=D1(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(r===void 0)throw new Error("Missing property");{let a=D1(this.object,r);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||r===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...cV(i),...uV(i),change:this.onChange},this.callback=Iz(this.object,t===void 0?{}:this.from.data,r===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},vg=class extends Xi{constructor(e,t,r){if(super(),this.data=e,this.page=t,this.sharedAssets=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{var n;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((n=this.timeline)==null||n.pause(),this.buildTimeline({isForward:this.toggleIsForward,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let i=this.page.scene.find(e.object);if(!i)throw new Error("Missing property");if(!i.states)throw new Error("Missing property");if(this.object=i,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=D1(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,isRebuild:t=!1}={}){var r,i,n,s;try{let a=cV(this.data.tweens[0].data),o=a.loop;t&&typeof a.loop=="number"&&a.loop--,(r=this.timeline)==null||r.pause(),this.timeline=oV.timeline({autoplay:!1,...a,...o===!0||o>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(u=>u==null?void 0:u.changeBegan);if(this.timelineNeedsRebuild=l!==-1&&(o===!0||o>1),a.pingPongDelayCorrection&&t===!1&&(this.timelineNeedsRebuild=!0),e){let u=l===-1?0:l;for(let h=u;h<this.data.tweens.length-1;h++){let c=this.data.tweens[h],d=this.data.tweens[h+1],f;h===u&&(this.object.wasMovedByUser===!0||((i=this.object.previousAction)==null?void 0:i.playing)===!0)?(f=void 0,this.object instanceof on&&(this.object.wasMovedByUser=!1)):f=c.data.state===void 0?this.currentState:c.data.state;let p=new kz(this.object,f,d.data.state===void 0?this.currentState:d.data.state,d.data,this.sharedAssets,this.data.allowSlerp??!1);l!==-1&&h===u&&Object.assign(p.params,{startOnceDelay:0}),this.tweens[h]=p,this.timeline.add(p.params,this.timeline.duration+(h===u?a.delay:0)+(h===u&&!t?a.pingPongDelayCorrection:0))}this.timeline.duration+=a.endDelay}else{let u=l===-1?this.data.tweens.length-1:l+1;for(let h=u;h>0;h--){let c=this.data.tweens[h],d=this.data.tweens[h-1],f;h===u&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.playing)===!0)?(f=void 0,this.object instanceof on&&(this.object.wasMovedByUser=!1)):f=c.data.state===void 0?this.currentState:c.data.state;let p=new kz(this.object,f,d.data.state===void 0?this.currentState:d.data.state,c.data,this.sharedAssets,this.data.allowSlerp??!1);l!==-1&&h===u&&Object.assign(p.params,{startOnceDelay:0}),this.tweens[h-1]=p,this.timeline.add(p.params,this.timeline.duration+(h===u?a.endDelay:0))}this.timeline.duration+=a.delay+(t?0:a.pingPongDelayCorrection)}}catch(a){a instanceof Error&&console.error(a.message)}((s=this.object.previousAction)==null?void 0:s.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(this.playing)return!1;clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(e){e instanceof Error&&console.error(e.message)}},this.startOnceDelay)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.sharedAssets}),this.object.currentState=e}seek(e){var t;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var r;(r=this.timeline)==null||r.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function D1(e,t){var n;let r,i;if(typeof t=="string"?(r=t,i=(n=e.states)==null?void 0:n[r]):t===null&&(r=null,i=e.data),!(r===void 0||i===void 0))return{id:r,data:i}}var f1e={type:"beginState"},zz={type:"completeState",isfromEntity:!1},Nz={type:"requestRender"},hV=class extends Xi{constructor(e,t){super(),this.data=e,this.page=t,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new P,this.posEnd=new P,this.qStart=new kt,this.qEnd=new kt,this.zoomStart=1,this.zoomEnd=1,this.toCamera=this.page.scene.find(e.targetCamera)}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=oV({targets:t,t:1,...uV(this.data),update:()=>{t.t===0&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera)):(this.posEnd.copy(this.toCamera.position),this.qEnd.copy(this.toCamera.quaternion),this.zoomEnd=this.toCamera.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(this.toCamera)),this.page.activeCamera.dispatchEvent(f1e));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,t.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,t.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*t.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(Nz),t.t===1&&r.dispatchEvent(zz)}})}switchCamera(e){this.page.switchActiveCamera(e),this.page.activeCamera.dispatchEvent({type:"cameraChange",camera:e})}play(){this.playing||this.page.activeCamera!==this.toCamera&&(clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId;try{this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.toCamera)}catch(t){t instanceof Error&&console.error(t.message)}},this.data.delay*1e3))}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,r;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.animation)==null||t.pause(),this.buildAnimation(!0),(r=this.animation)==null||r.play()):this.timeoutId=window.setTimeout(()=>{var i,n;delete this.timeoutId,this.data.animate?((i=this.animation)==null||i.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.toCamera)):this.switchCamera(this.fromCamera),this.page.activeCamera.dispatchEvent(zz),this.page.activeCamera.dispatchEvent(Nz))},this.data.delay*1e3)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},yg=class extends Xi{constructor(e,t,r){var o,l,u;super(),this.page=t,this.animationControls=r,this.startOnceDelay=0,this.toggleIsForward=!1;let i=e.object,n=t.scene.find(e.object);n&&Array.isArray(n.identity)&&(i=n.identity[0]),this.data={...e,object:i};let s=this.animationControls.clipIdToAction[e.clipId+"/"+i];this.duration=((o=s==null?void 0:s.getClip())==null?void 0:o.duration)??1;let a=((u=(l=s==null?void 0:s.getClip())==null?void 0:l.tracks[0])==null?void 0:u.times.length)??1/0;this.leftFrameTime=this.data.crop[0]/a*this.duration,this.rightFrameTime=this.data.crop[1]/a*this.duration,this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var r;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([i,n])=>{let s=i.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((r=this.threeAnimAction)==null||r.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=zt.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var r;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===i&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((r=this.threeAnimAction)==null||r.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},dV=class{constructor(e,t,r,i){this.data=e,this.page=t,this.eventManager=r,this.shared=i,this.timeOutId=-1,this.scene=t.scene}dispatch(){this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),R2(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}};function xs(e,t,r,i,n,s){let a={Audio:[],Video:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[]};return t.forEach(({id:o,data:l})=>{try{l.type==="Audio"?Fa[e.type].includes("Audio")&&a.Audio.push(new mg(o,l,s,i)):l.type==="Video"?Fa[e.type].includes("Video")&&a.Video.push(new k2(o,l,s)):l.type==="Link"?Fa[e.type].includes("Link")&&a.Link.push(new sye(l,n)):l.type==="Create"?Fa[e.type].includes("Create")&&a.Create.push(new wg(l,r,n.controlsManager)):l.type==="Destroy"?Fa[e.type].includes("Destroy")&&a.Destroy.push(new WH(l,r,n)):l.type==="Reset"?Fa[e.type].includes("Reset")&&a.Reset.push(new aye(r,i,n)):l.type==="Transition"?Fa[e.type].includes("Transition")&&a.Transition.push(new vg(l,r,i)):l.type==="SwitchCamera"?Fa[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new hV(l,r)):l.type==="SceneTransition"?Fa[e.type].includes("SceneTransition")&&a.SceneTransition.push(new dV(l,r,n,i)):l.type==="Animation"&&Fa[e.type].includes("Animation")&&a.Animation.push(new yg(l,r,n.animationControls))}catch{}}),a}function ts(e){Object.values(e).forEach(t=>{t.forEach(r=>{(r instanceof mg||r instanceof k2||r instanceof yg||r instanceof vg||r instanceof wg||r instanceof WH||r instanceof hV||r instanceof dV)&&r.dispose()})})}function p1e(e,t){let r;if("material"in e){let i=e.material;Array.isArray(i)?r=e.material[0].layers.find(n=>n.uuid===t):r=e.material.layers.find(n=>n.uuid===t)}if(r)return r.color.texture.image.img instanceof HTMLVideoElement?r.color.texture.image.img:void 0}var fV=new Map,xg=new Map,Tf=class{constructor(e,t,r){this.data=t,this.delay=0,this.status="stopped";let{layerId:i,loop:n,volume:s,delay:a}=t;if(this.object=r,i===void 0)throw new Error("Missing property");let o=p1e(r,i);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,this.videoElement.autoplay=!0,s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),xg.has(r.uuid)?xg.get(r.uuid).push(this):xg.set(r.uuid,[this]),fV.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let r=this.videoElement.play();r!==void 0&&r.then(i=>{}).catch(i=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},CT=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=fV.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=xg.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(r=>r[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(r=>r[this.data.interaction]()))}pauseAllVideos(){let e=[...xg.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(r=>{r[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(r=>{r[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},k2=class{constructor(e,t,r){if(this.data=t,t.interaction==="play")this.interaction=new Tf(e,t,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new CT(t);else throw new Error("Missing property")}dispatchBasic(){this.interaction instanceof Tf?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){this.interaction instanceof Tf?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},Bz=(()=>{let e,t,r,i;function n(o){!e&&!Fz()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,i=o.requestRender)}function s(o){let l=r?o-r:0,u=t.sharedGameControlGlobals.createdObjects,h=t.sharedGameControlGlobals.nCreatedPerAction,c=u.length,d=0;for(;d<c;){let f=u[d];f.userData.createdTime===void 0&&(f.userData.createdTime=o),f.userData.lifetime===void 0&&f.userData.quantity===void 0||f.userData.lifetime&&o-f.userData.createdTime<f.userData.lifetime||f.userData.quantity&&h[f.userData.actionId]<=f.userData.quantity?(f.userData.velocity&&(f.position.addScaledVector(f.userData.velocity,l/1e3),f.updateMatrix(),i()),d++):(h[f.userData.actionId]>f.userData.quantity&&h[f.userData.actionId]--,u.splice(d,1),f.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&f.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(f.rigidBody)):(f.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(p=>p.bvhGeometry!==void 0)),c--,i())}e=d>0?requestAnimationFrame(s):void 0,r=d>0?o:void 0}function a(){Fz()?e&&(cancelAnimationFrame(e),e=void 0,r=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function Fz(){return!!document&&document.hidden}var Uz=new kt,m1e=new P,g1e=new P,wg=class{constructor(e,t,r){this.data=e,this.page=t,this.controlsManager=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=zt.generateUUID(),this.dispatch=()=>{this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=the(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let n=new sn(this.object);if(n.playModeVisible=!0,n.expand(),this.data.coordinateSystem!=="world"){let a=this.data.coordinateSystem,o=this.page.scene.find(a);o&&(o.updateMatrixWorldSVD(),n.hiddenMatrix.copy(o.matrixWorldRigid))}n.position.fromArray(this.data.position),n.rotation.fromArray(this.data.rotation),n.updateMatrix(),this.page.add(n);let s=this.controlsManager.sharedGameControlGlobals;s.createdObjects.push(n),s.nCreatedPerAction[this.uniqueId]===void 0?s.nCreatedPerAction[this.uniqueId]=1:s.nCreatedPerAction[this.uniqueId]++,n.updateWorldMatrix(!0,!0),n.traverseObject(this.traverseObjectCB),Bz(),this.controlsManager.requestRender()},this.traverseObjectCB=n=>{var l,u,h,c;n.hasNonUniformScale&&n.updateMatrixWorldSVD();let s;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(n instanceof ba)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof sn)s=n.object;else if(s=n,(l=s.dataPatched.cloner)==null?void 0:l.hideBase)return!0}else{if(n instanceof ba)return;n instanceof sn?s=n.object:s=n}this.data.destroy==="Time"?n.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(n.userData.quantity=this.data.destroyAfterQuantity,n.userData.actionId=this.uniqueId);let a=new P().fromArray(this.data.velocity),o=s.dataPatched;if(!(o.physics.enabled==="visibility"?!o.visible:!o.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(n,s,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((u=n.rigidBody)==null||u.collider(0).setActiveEvents(1),n.userData.hasCollisionDestroy=!0),n.matrixWorld.decompose(m1e,Uz,g1e),a.applyQuaternion(Uz),this.data.velocity.some(d=>d!==0)&&this.data.dynamic&&((h=n.rigidBody)==null||h.setLinvel(a.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in n.object&&this.controlsManager.addBoundsTree(n),this.data.velocity.some(d=>d!==0)&&this.data.dynamic&&(n.userData.velocity=a)),((c=s.dataPatched.physics)==null?void 0:c.fusedBody)===!0))return!0};let i=this.page.scene.find(this.data.object);if(!i)throw new Error("Missing Property");if(this.object=i,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");Bz(r)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},pV=200,wM=.02,bM=.3,v1e=65;new P;var jz=new P,Hz=new P,y1e=new P,Hi=new P,yn=new P,hu=new P,$y=new Oe,_M=new Oe,x1e=new Oe;new Oe;var as=new kt,Qo=new kt,Ga=new Ri(0,0,0,"YXZ"),w1e=new P(1,0,0),ha=new P(0,1,0),b1e=new P(0,0,1),SM=new P(1,1,1),MM=new ys,_1e=1,S1e=.025,M1e=16e-6,Vz=12,E1e=20,Oi=new Gs,Ps=new ai,A1e={type:"requestRender"},T1e={type:"updateMatrix"},Wz=Math.PI/6,DT=class extends Xi{constructor(e,t,r,i,n,s,a,o,l){var p;super(),this.object=e,this.domElement=t,this.data=r,this.gloabalPhysics=i,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new Oe,this.target0=new P,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=pV,this.euler0=new Ri(0,0,0,"YXZ"),this.position0Cam=new P,this.quat0Cam=new kt,this.scale0Cam=new P,this.hiddenMatrix0Cam=new Oe,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Gs(new P(0,-40,0),new P(0,40,0)),matrix:new Oe,position:new P,rotation:new kt},this.euler=new Ri(0,0,0,"YXZ"),this.eulerDelta=new P,this.lastPosition=new P,this.lastCameraQuaternion=new kt,this.lastCameraPosition=new P,this.PI_2=Math.PI/2,this.prevMouse=new J,this.velocityTarget=new P,this.velocity=new P,this.directionXZ=new P,this.rotVelocityStick=new P,this.rotVelocityTarget=new P,this.rotVelocity=new P,this.rotDirection=new P,this.nonColliderRotOffset=new Oe,this.nonColliderPosOffset=new Oe,this.firstPointerId=-1,this.rot=new P,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Oe,this.objectToTarget=new P,this.objectToTarget0=new P,this.objectToCamXZ=new P,this.objectToCamXZ0=new P,this.targetToCamera=new P,this.targetToCamera0=new P,this.cameraPolarAxis0=new P,this.targetPos=new P,this.targetQuat=new kt,this.lerpFactorPos=new P().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new kt,this.objXZQuatInv=new kt,this.objXZRotMat=new Oe,this.isFirstPerson=!1,this.actions={},this.didHit=!1,this.groundVelocity=new P,this.pushedVelocity=new P,this.groundYRotation=0,this.objectRealQuat=new kt,this.colliderWorldQuat=new kt,this.groundNormal=new P,this.groundTilt=new kt,this.groundTiltInv=new kt,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new P,this.quaternion=new kt,this.scale=new P,this.initialAction=!0,this.onPointerDown=m=>{m.target!==this.domElement||this.firstPointerId!==-1||(this.firstPointerId=m.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!ps&&(!lR||uR>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(m.clientX,m.clientY))},this.onPointerUp=m=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),m.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=m=>{if(m.pointerId!==this.firstPointerId)return;let g=m.clientX-this.prevMouse.x,v=m.clientY-this.prevMouse.y;this.prevMouse.set(m.clientX,m.clientY),m.pointerType==="mouse"&&this.rotBy!=="keys"&&(lR&&uR<15.5&&!ps?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-v*this.mouseOrbitSensitivity):(this.eulerDelta.y=-m.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-m.movementY*this.mouseOrbitSensitivity)),m.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-v*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=m=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?DT.isLocked=!0:DT.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let m in this.movementState)this.movementState[m]=0},this.onKeyDown=m=>{!(m.target instanceof HTMLInputElement)&&(m.code==="ArrowLeft"||m.code==="ArrowUp"||m.code==="ArrowRight"||m.code==="ArrowDown"||m.code==="Space")&&m.preventDefault();for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=m=>{for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]||m.code.slice(3,m.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(m,g)=>{for(let v=2;v<4;v++){let y=m.axes[v];g===0?v===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(m.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,v===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let u=this.euler0.clone(),h=u.y;if(this.objectRealQuat.copy(this.quaternion),u.y=0,this.quaternion.setFromEuler(u),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),u.set(0,h,0),this.quaternion.setFromEuler(u),this.rot.setFromEuler(u),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((p=this.camera)==null?void 0:p.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let m=new P(0,0,-1).applyQuaternion(this.camera.quaternion),g=new P().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let v,y;Math.abs(m.y)<1e-6?(g.y=0,m.y=0,y=g.projectOnVector(m)):g.y/m.y>0?y=m.multiplyScalar(g.y/m.y):y=m.multiplyScalar(g.length()),this.targetToCamera0.copy(y).negate(),v=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(v,this.position);let x=new Ri().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x.x,x.x=0,x.z=0,x.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x)}if(this.object instanceof on&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=r.rotByTouch??"joystick",this.rotBy=r.rotBy??"keys",this.rotationMode=r.rotationMode??"normal",this.moveMode=r.moveMode??"walk",this.collisionEnabled=r.collisionEnabled,this.speedTranslate=(r.speedTranslate??250)*_1e,this.speedOrbit=(r.speedRotate??100)*S1e,this.mouseOrbitSensitivity=(r.speedRotate??100)*M1e,this.keyAssignments=r.keyAssignments.map(m=>{let g=[m[0],m[1]];return g[1]==="▲"?g[1]="ArrowUp":g[1]==="◀"?g[1]="ArrowLeft":g[1]==="▼"?g[1]="ArrowDown":g[1]==="▶"?g[1]="ArrowRight":g[1]==="⇧"?g[1]="Shift":g[1]==="↵"?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]==="⌘"?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),r.rotBy==="mouse"){let m;m=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),m!==-1&&(this.keyAssignments[m][1]="")}this.lerpFactorPosStart=1-.02**(1/((r.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((r.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((r.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((r.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((r.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((r.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??Xf.defaultData.gravity)*Vz,this.usePhysics=this.gloabalPhysics.usePhysics??Xf.defaultData.usePhysics,this.jumpPower=r.jumpPower*E1e,this.resetYPosition=this.position.y+Math.abs(r.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=r.alignToGround??!1,this.orientMode=r.autoOrientMove?r.orientMode:"none",this.orientWith=r.orientWith??Yx.defaultDataThirdPerson.orientWith,this.slopeThresh=v1e*Math.PI/180,r.collider.type==="capsule"?(this.collider.radius=r.collider.radius,this.collider.segment.start.y=r.collider.height/2-r.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=r.collider.height*wM/this.pixelsPerMeter,this.stepThresh=r.collider.height*bM/this.pixelsPerMeter,this.colliderHeight=r.collider.height):r.collider.type==="sphere"?(this.collider.radius=r.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*r.collider.radius*wM/this.pixelsPerMeter,this.stepThresh=2*r.collider.radius*bM/this.pixelsPerMeter,this.colliderHeight=r.collider.radius*2):(this.offset=r.collider.height*wM/this.pixelsPerMeter,this.stepThresh=r.collider.height*bM/this.pixelsPerMeter,this.colliderHeight=r.collider.height),this.collider.type=r.collider.type;let c=new P().fromArray(r.collider.position),d=new kt().setFromEuler(new Ri().fromArray([...r.collider.rotation,"XYZ"]));this.collider.position.copy(c).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(c,d,SM),r.cameraXAxis!==void 0&&(this.cameraXAxis=r.cameraXAxis,this.cameraYAxis=r.cameraYAxis,this.minPolarAngle=r.cameraRotXLimits[0],this.maxPolarAngle=r.cameraRotXLimits[1],this.minAzimuthAngleRel=r.cameraRotYLimits[0],this.maxAzimuthAngleRel=r.cameraRotYLimits[1]),this.forwardDir=r.forwardDirection??"-z",this.runMultiplier=r.runMultiplier??2;let f=r.navmesh.destinationHelperRadius*2;if(f>0){let m=new At;m.push({fi:0,data:{...Nn.defaultData("light","phong"),alpha:0},id:"layer1"}),m.push({fi:0,data:{...Nn.defaultData("color"),color:r.navmesh.destinationHelperColor,alpha:r.navmesh.destinationHelperColor.a},id:"layer2"});let g=new d2({layers:m},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new Hn(y5.create({parameters:{width:f,height:f/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=r.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new Ri().setFromQuaternion(this.quaternion,"YXZ"),r=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,r,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof on?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.page,r=this.sharedAssets,i=this.object;e.gameActions!==void 0&&Object.entries(e.gameActions).forEach(([n,s],a)=>{s.forEach(({id:o,data:l})=>{try{this.actions[n]===void 0&&(this.actions[n]=[]),l.type==="Transition"?this.actions[n].push(new vg(l,t,r)):l.type==="Animation"?this.actions[n].push(new yg(l,t,this.controlsManager.eventManager.animationControls)):l.type==="Audio"?this.actions[n].push(new mg(o,l,i,r)):l.type==="Video"?this.actions[n].push(new k2(o,l,i)):l.type==="Create"&&this.actions[n].push(new wg(l,t,this.controlsManager))}catch{}})}),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),ts(this.actions)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].forEach(t=>{t instanceof vg?t.play():t instanceof yg?t.play(this.initialAction===!1):t instanceof wg?t.dispatchStart():t instanceof mg&&t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].forEach(t=>{t instanceof vg?(t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})):t instanceof yg||(t instanceof wg?t.dispatchStop():t instanceof mg&&t.dispatchGameControl("stop"))})))}get colliderWorldPosition(){return Hi.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,r){var o,l,u,h,c,d,f,p,m,g,v;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let i=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=i*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let y=yn.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*Vz),1)*(this.gravity>0?1:-1):this.velocity.y)*i,0).divideScalar(this.pixelsPerMeter),x=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,y,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(x){this.onObject=!0,this.groundNormal.set(x.normal2.x,x.normal2.y,x.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=x.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let w=x.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let S of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(S.rigidBody===w&&S.userData.isFollowingObj!==this.object.uuid){(S.hasNonUniformScale?S.matrixWorldRigid:S.matrixWorld).decompose(Hi,Qo,yn),this.groundVelocity.subVectors(Hi,S.prevT),this.object.getWorldPosition(yn).add(this.collider.position).sub(Hi),this.groundYRotation=Ga.setFromQuaternion(Qo).y-S.prevR.y,hu.copy(yn).applyAxisAngle(ha,this.groundYRotation),this.groundVelocity.add(hu.sub(yn)).divideScalar(i);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let y=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let x=Hi.subVectors(this.path[1],this.position),w=yn.subVectors(this.path[1],this.path[0]);x.dot(w)<0?this.path.shift():(this.directionXZ.x=w.x,this.directionXZ.z=w.z),y.opacity=y.userData.opacity0}else y.opacity-=.05*y.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=y1e.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let y=yn.copy(a);y.y=0,a.set(0,a.y,y.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none")if(this.orientWith==="camera"&&this.path.length<=1){let y=Hi;this.camera.getWorldDirection(y);let x=hu.copy(ha).multiplyScalar(y.dot(ha));y.sub(x);let w=yn.copy(this.directionXZ);w.x*=-1,this.rot.y=y.angleTo(w)*(y.cross(w).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(Ga.setFromVector3(this.rot),this.moveMode==="walk"&&(Ga.x=0),a.applyEuler(Ga),s&&(Qo.setFromUnitVectors(ha,this.groundNormal),a.applyQuaternion(Qo)),r){let y=Ga.set(0,this.vrEulerYOffset*Wz,0);r.applyEuler(y),a.x+=r.x,a.z+=r.z,this.nonColliderPosOffset.elements[13]+=r.y*i}if(this.usePhysics===!0){let y=yn;this.pushedVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim){let w=hu.setFromMatrixPosition(x.matrixWorld).sub(x.prevT).divideScalar(i).divideScalar(this.pixelsPerMeter),S=x.rigidBody.collider(0).castCollider(w,this.object.rigidBody.collider(0),Hi.copy(a).divideScalar(this.pixelsPerMeter),i,!1);w.multiplyScalar(this.pixelsPerMeter);let _=$t.is(x)?x:x.object;if(S!==null&&this.lastHitObj!==_){let A;x instanceof sn&&(A=x);let M=this.sharedGameControlGlobals.entityToCollisionEvents[_.uuid];if(M)for(let T of M)T.data.target==="character"&&(T.dispatch(A),_.dispatchEvent(LT));this.lastHitObj=_}if(S!==null){this.pushedVelocity.copy(w),y.copy(S.normal1).applyQuaternion(x.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let x=y.dot(a);x<0&&a.addScaledVector(y,-x),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(i),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*i,this.euler.y+=this.rotVelocity.y*i+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*i),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(ha,this.euler.y-this.euler0.y);let y=yn.copy(this.objectToCamXZ).normalize(),x=hu.copy(a).multiplyScalar(i);x.y=0;let w=x.sub(Hi.copy(y).multiplyScalar(x.dot(y))).cross(y).y;this.euler.y-=Math.atan2(w,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*i+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=zt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=zt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=zt.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(Ga.copy(t),Ga.y=0):(Ga.copy(this.euler),Ga.y=0),this.nonColliderRotOffset.makeRotationFromEuler(Ga)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*Wz),as.setFromAxisAngle(w1e,this.rot.x),Qo.setFromAxisAngle(ha,this.rot.y),Qo.multiply(as),as.setFromAxisAngle(b1e,this.rot.z),Qo.multiply(as),this.quaternion.copy(Qo),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let y=yn.copy(a).multiplyScalar(i/this.pixelsPerMeter),x=null;this.didHit=!1;let w=new P;for(let S=0;S<5;S++){let _=y.length(),A=hu.copy(y).normalize();if(x=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(w),this.colliderWorldQuat,A,(u=this.object.rigidBody)==null?void 0:u.collider(0).shape,_,!1,24,void 0,void 0,this.object.rigidBody),x!==null){this.didHit=!0;let M=this.sharedGameControlGlobals.colliderToEntity.get(x.collider.handle);if(M!==this.lastHitObj&&S===0){this.lastHitObj=M;let I=this.sharedGameControlGlobals.entityToCollisionEvents[M==null?void 0:M.uuid];if(I){for(let k of I)if(k.data.target==="character"){let z=((h=this.sharedGameControlGlobals.rapierWorld)==null?void 0:h.getCollider(x.collider.handle))._parent,V;if(M.cloner){for(let K of M.cloner.children)if(K.rigidBody===z){V=K;break}}k.dispatch(V),M.dispatchEvent(LT)}}}let T=jz.set(x.normal2.x,x.normal2.y,x.normal2.z).applyQuaternion(this.colliderWorldQuat),C=Hz.copy(A).multiplyScalar(x.toi).dot(T),L=x.toi;if(L===0&&(this.position.y+=this.offset*this.pixelsPerMeter),C>this.offset&&(L=x.toi*(C-this.offset)/C,w.addScaledVector(A,L)),y.copy(A).multiplyScalar(_-L),Math.acos(-T.y)>this.slopeThresh){let I=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(w),k=hu.copy(x.witness2).applyQuaternion(this.colliderWorldQuat);k.y=0;let z=I.add(k);z.y+=this.stepThresh;let V=this.sharedGameControlGlobals.rapierWorld.castShape(z,this.colliderWorldQuat,y,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);V!==null&&V.toi===0&&(T.y=0,T.normalize())}y.addScaledVector(T,-y.dot(T))}else{S===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),w.add(y);break}}this.position.addScaledVector(w,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(Hi.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(f=this.object.rigidBody)==null||f.setRotation(as.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let y=this.onObject?1:5,x=a.multiplyScalar(i/y);for(let w=0;w<y;w++)this.position.add(x),w===0&&this.checkTrigger(),this.collisionAdjustment(i/y)}else this.position.addScaledVector(a,i);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let y=this.objectToTarget.add(this.position),x=this.targetToCamera.add(y);$y.lookAt(x,y,ha).setPosition(x),$y.decompose(this.targetPos,this.targetQuat,Hi),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=zt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=zt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(T1e),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&((m=(p=this.navMeshPathDest)==null?void 0:p.material)==null?void 0:m.opacity)<-.04*((v=(g=this.navMeshPathDest)==null?void 0:g.material)==null?void 0:v.userData.opacity0)?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(A1e),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=as.setFromAxisAngle(ha,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?zt.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=zt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=zt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let r=Hi.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&r.applyQuaternion(e);let i=Qo.setFromAxisAngle(r,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(i)}groundTiltAdjustment(e){ha.angleTo(e)*180/Math.PI<15||ha.angleTo(e)*180/Math.PI>85?as.identity():as.setFromUnitVectors(ha,e),this.groundTilt.slerp(as,.06),this.groundTiltInv.copy(this.groundTilt).invert()}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[r,i,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject($t.is(o)?o:o.object)===!1)continue;let l=_M.copy(n.matrixWorld).decompose(Hi,as,yn).compose(Hi,as,SM).multiply(i),u=$y.copy(o.matrixWorld).invert().multiply(l);r instanceof ai?e=o.bvhGeometry.boundsTree.intersectsBox(r,u):(MM.radius=r,MM.center.setFromMatrixPosition(u),e=o.bvhGeometry.boundsTree.intersectsSphere(MM)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(kxe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(h=>h!==o)}}}collisionAdjustment(e){var n;let t=Hz.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let r=$y.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(Hi,as,yn).compose(Hi,as,SM);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Ps.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=_M.copy(a).invert(),l=x1e.copy(_M).multiply(r);Oi.copy(this.collider.segment),Oi.start.applyMatrix4(l),Oi.end.applyMatrix4(l);let u=jz.copy(this.position).applyMatrix4(o);Ps.expandByPoint(Oi.start),Ps.expandByPoint(Oi.end),Ps.min.addScalar(-this.collider.radius),Ps.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(h){return h.distanceToPoint(Oi.end)},intersectsBounds:h=>h.intersectsBox(Ps),intersectsTriangle:h=>{let c=Hi,d=yn,f=h.closestPointToSegment(Oi,c,d);if(f<this.collider.radius){let p=this.collider.radius-f,m=d.sub(c).normalize(),g=hu.copy(u);g.addScaledVector(m,p);let v=g.applyMatrix4(a).sub(this.position);t.add(v),Oi.start.addScaledVector(m,p),Oi.end.addScaledVector(m,p)}}})}),Ps.makeEmpty(),Oi.copy(this.collider.segment),Oi.start.applyMatrix4(r),Oi.end.applyMatrix4(r),Ps.expandByPoint(Oi.start),Ps.expandByPoint(Oi.end),Ps.min.addScalar(-this.collider.radius),Ps.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(Oi.end)},intersectsBounds:s=>s.intersectsBox(Ps),intersectsTriangle:s=>{let a=Hi,o=yn,l=s.closestPointToSegment(Oi,a,o);if(l<this.collider.radius){let u=this.collider.radius-l,h=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(h),t.addScaledVector(h,u),Oi.start.addScaledVector(h,u),Oi.end.addScaledVector(h,u)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let i=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(i),this.position.add(t)}},mV=DT;mV.isLocked=!1;var C1e=dp(n4());function pl(e,t){let r=new _t;if(!e.getAttribute("position"))return r.setAttribute("position",new nt([],3)),r.setIndex([]),r;let{positions:i,triIndices:n}=db(e.getAttribute("position"),e.getIndex());return r.setAttribute("position",new nt(i,3)),r.setIndex(n),t&&r.applyMatrix4(t),r}var D1e=new Oe,P1e=new Oe,Ya=[[0,0,0],[0,0,0],[0,0,0]];function gV(e){let t=e.elements;Ya[0][0]=t[0],Ya[0][1]=t[4],Ya[0][2]=t[8],Ya[1][0]=t[1],Ya[1][1]=t[5],Ya[1][2]=t[9],Ya[2][0]=t[2],Ya[2][1]=t[6],Ya[2][2]=t[10];let{u:r,v:i}=(0,C1e.SVD)(Ya),n=D1e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),s=P1e.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var O1e=class extends X4{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,r=[]){return e.forEach(i=>{i.visible&&this.intersectObject(i,t,r)}),r}createRaycastLineHelper(){let e=new dc({color:65280,linewidth:10}),t=new P(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),r=new P(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),i=this.camera.far-this.camera.near,n=new P().addVectors(t,r.multiplyScalar(i)),s=new _t;return s.setFromPoints([t,n]),new vx(s,e)}},vV=e=>e instanceof ew||e instanceof Af;function L1e(e,t){return e.distance-t.distance}function yV(e,t,r){if(!(!fl(t)||!t.visible)){va(t)&&t.raycast(e,r);for(let i of t.children)yV(e,i,r)}}function PT(e,t,r){if(!r.some(n=>nw(e,n)!==void 0))return[];let i=[];return t.children.forEach(n=>yV(e,n,i)),i.sort(L1e),i}function OT(e){let t=[];if(e.length){let r=e[0].object;fl(r)&&t.push(r);let i=r.parent;for(;i;)vV(i)&&t.push(i),i=i.parent}return t}function nw(e,t){if(va(t)){if(t.visible){let r=[];return t.raycast(e,r),r.length?r[0]:void 0}}else if(vV(t))return xV(e,t)}function xV(e,t){if(!(!fl(t)||!t.visible)){if(va(t)){let r=[];if(t.raycast(e,r),r.length)return r[0]}for(let r of t.children){let i=xV(e,r);if(i)return i}}}function I1e(e,t,r){return{x:(e-(r.left+window.scrollX))/r.width*2-1,y:-((t-(r.top+window.scrollY))/r.height)*2+1}}var R1e=class{constructor(e,t,r,i,n,s,a){this.renderer=e,this.publish=t,this.scene=r,this.getCamera=i,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.raycaster=new O1e,this.raycasterNeedsUpdate=!0,this._useWindowEvents=!1,this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}updateRaycaster(e){var n;if(!this.raycasterNeedsUpdate)return;this.raycasterNeedsUpdate=!1;let{pageX:t,pageY:r}=((n=e.touches)==null?void 0:n.length)>0?e.touches[0]:e,i=this.domElement.getBoundingClientRect();this.raycaster.setFromCamera(I1e(t,r,i),this.getCamera())}},wV=(e=>(e[e.keydown=0]="keydown",e[e.keyup=1]="keyup",e[e.pointerdown=2]="pointerdown",e[e.pointerup=3]="pointerup",e[e.pointermove=4]="pointermove",e[e.wheel=5]="wheel",e[e.scroll=6]="scroll",e))(wV||{}),Oo=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},z2=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],bV=e=>{var t;return(t=z2.find(([r,i])=>i===e))==null?void 0:t[0]},Yv=e=>{var t;return(t=z2.find(([r])=>r===e))==null?void 0:t[1]},k1e=(e,t)=>{let r=bV(e);if(r){let i=new CustomEvent(r,{bubbles:!0});return Object.defineProperty(i,"target",{writable:!1,value:t}),i}},z1e=class extends Oo{constructor(e){super(e),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=r=>{var s;if(!r.eventName||!r.target||r.eventName==="Scroll")return;let i=(s=this.splineEvents[bV(r.eventName)])==null?void 0:s[r.target.uuid];if(!i)return;r.eventName==="Scroll"&&r.deltaY!==void 0&&Object.assign(i,{deltaY:r.deltaY});let{domElement:n}=this.eventContext;n.dispatchEvent(i)};let{page:t}=this.eventContext;t.traverseEntity(r=>{var i,n;if((i=r.data)!=null&&i.events.length){for(let[s,a]of z2)if(r.data.events.some(o=>o.data.type===a&&!o.data.disabled)){this.objectsPerEvents.has(s)?(n=this.objectsPerEvents.get(s))==null||n.push(r):this.objectsPerEvents.set(s,[r]);let o={id:r.uuid,name:r.name},l=k1e(a,o),u=this.splineEvents[s];u?u[r.uuid]=l:this.splineEvents[s]={[r.uuid]:l}}}})}connect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},N1e=class{constructor(e,t,r,i,n,s){if(this.id=e,this.data=t,this.object=r,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle=t.toggle,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=xs(t,t.actions,i,n,s,r)}disconnect(){ts(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):this.useToggle===!1&&this.alreadyPlayedNonTogglingActions.add(t)}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()}),this.actions.SwitchCamera.forEach(t=>{t.toggle()})):this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing)||this.actions.Transition.forEach(t=>{this.alreadyPlayedNonTogglingActions.has(t)===!1&&t.play()}),this.actions.SwitchCamera.some(t=>t.playing)||this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()})}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()})}},B1e=class extends Oo{constructor(e,t){super(e),this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.windowMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.onWindowMouseDown=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(s=>{(s.data.type==="MouseDown"||s.data.type==="MousePress")&&s.dispatch()}),this.windowMouseEvents.forEach(s=>{(s.data.type==="MouseDown"||s.data.type==="MousePress")&&s.dispatch()})},this.onWindowMouseUp=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(s=>{s.data.type==="MouseUp"?s.dispatch():s.data.type==="MousePress"&&s.dispatchRelease()}),this.windowMouseEvents.forEach(s=>{s.data.type==="MouseUp"?s.dispatch():s.data.type==="MousePress"&&s.dispatchRelease()})},this.onMouseDown=n=>{xt.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseDown"))},this.onMouseUp=n=>{xt.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=n=>{xt.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent())},this.onMousePressRelease=n=>{xt.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent(!0))},this.onKeyDown=n=>{this.heldKeys[n.key]||(this.handleKeyEvent(n,"KeyDown"),this.handleKeyEventHeld(n,"KeyDown",!0)),this.heldKeys[n.key]=!0},this.onKeyUp=n=>{this.handleKeyEvent(n,"KeyUp"),this.handleKeyEventHeld(n,"KeyUp",!0)},this.onKeyPressDown=n=>{this.heldKeysPress[n.key]?this.handleKeyEventHeld(n,"KeyPress"):(this.handleKeyEvent(n,"KeyPress"),this.handleKeyEventHeld(n,"KeyPress",!0)),this.heldKeysPress[n.key]=!0},this.onKeyPressUp=n=>{this.handleKeyEvent(n,"KeyPress",!0)},this.releaseHeldKey=n=>{delete this.heldKeys[n.key]},this.releaseHeldKeyPress=n=>{delete this.heldKeysPress[n.key]},this._onUserEvent=({eventName:n,target:s,reverse:a})=>{var l,u,h,c;if(!n||!s)return;let o=Yv(n);o&&(o==="MouseDown"||o==="MouseUp"||o==="MousePress"?(s.dispatchEvent({type:"beginEvent",eventName:o}),(u=(l=this.eventsPerObjects[o])==null?void 0:l[s.uuid])==null||u.forEach(d=>{d.dispatchUserEvent(a)})):(o==="KeyDown"||o==="KeyUp"||o==="KeyPress")&&(s.dispatchEvent({type:"beginEvent",eventName:o}),(c=(h=this.eventsPerObjects[o])==null?void 0:h[s.uuid])==null||c.forEach(d=>{d.dispatchUserEvent()})))};let{page:r,sharedAssets:i}=this.eventContext;r.traverseEntity(n=>{var a,o;if(!((a=n.data)!=null&&a.events.length))return;let s=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let l of s){let u=this.eventsPerObjects[l];n.data.events.filter(({data:h})=>h.type===l&&h.disabled!==!0).forEach(({id:h,data:c})=>{try{let d=new N1e(h,c,n,r,i,t);d.actions.Video.length&&(this.hasVideoAction=!0),(c.type==="MouseDown"||c.type==="MouseUp"||c.type==="MousePress")&&(c.mode==="Canvas"||c.mode==="Window")?c.mode==="Canvas"&&this.canvasMouseEvents.push(d):u[n.uuid]?u[n.uuid].push(d):u[n.uuid]=[d]}catch{}}),(o=u[n.uuid])!=null&&o.length&&this.objectsPerTypes[l].push(n)}})}connect(){var t,r,i,n,s,a;let{domElement:e}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),typeof window<"u"&&(window.addEventListener("pointerdown",this.onWindowMouseDown,{capture:!0}),window.addEventListener("pointerup",this.onWindowMouseUp,{capture:!0})),(t=this.objectsPerTypes.MouseDown)!=null&&t.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),(r=this.objectsPerTypes.MouseUp)!=null&&r.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),(i=this.objectsPerTypes.MousePress)!=null&&i.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMousePressRelease)),(n=this.objectsPerTypes.KeyDown)!=null&&n.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(s=this.objectsPerTypes.KeyUp)!=null&&s.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(a=this.objectsPerTypes.KeyPress)!=null&&a.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([o,l])=>{l.forEach(u=>{u.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},typeof window<"u"&&(window.removeEventListener("pointerdown",this.onWindowMouseDown,{capture:!0}),window.removeEventListener("pointerup",this.onWindowMouseUp,{capture:!0})),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(r=>{r.forEach(i=>{i.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,r])=>{r.forEach(i=>{i.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){let{stopRaycast:t,raycaster:r,page:i}=this.eventContext,n=this.objectsPerTypes[e];if(n.length)if(t){let s=PT(r,i,n);OT(s).forEach(a=>{this.eventsPerObjects[e][a.uuid]&&this.handleObjectMouseEventDispatch(a,e)})}else n.forEach(s=>{nw(r,s)&&this.handleObjectMouseEventDispatch(s,e)})}handleMousePressEvent(e=!1){let t="MousePress",r=this.objectsPerTypes[t],i=[];if(r.length){if(!e){let{stopRaycast:n,raycaster:s,page:a}=this.eventContext;if(n){let o=PT(s,a,r);i=OT(o)}else r.forEach(o=>{nw(s,o)&&i.push(o)})}this._prevObjects.length&&this._prevObjects.forEach(n=>{i.includes(n)||this.handleObjectMouseEventDispatchRelease(n,t)}),i.length&&i.forEach(n=>{this.handleObjectMouseEventDispatch(n,t)}),this._prevObjects=i}}handleObjectMouseEventDispatch(e,t){var r,i;e.dispatchEvent({type:"beginEvent",eventName:t}),(i=(r=this.eventsPerObjects[t])==null?void 0:r[e.uuid])==null||i.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var r,i;e.dispatchEvent({type:"beginEvent",eventName:t}),(i=(r=this.eventsPerObjects[t])==null?void 0:r[e.uuid])==null||i.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,r=!1){this.objectsPerTypes[t].forEach(i=>{let n=this.eventsPerObjects[t][i.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&i.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(r?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,r=!1){this.objectsPerTypes[t].forEach(i=>{this.eventsPerObjects[t][i.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(r)})})}},F1e=new P,U1e=new P,_V=class{constructor(e,t,r,i,n){this.actionsIn=xs(e,e.inActions,r,i,n,t),this.actionsOut=xs(e,e.outActions,r,i,n,t)}disconnect(){ts(this.actionsIn),ts(this.actionsOut)}},j1e=class extends _V{constructor(e,t,r,i,n,s){super(t,r,i,n,s),this.id=e,this.data=t,this.object=r,this.stage="out",this.objects=[],this.onUpdateMatrix=()=>{for(let d of this.objects)if(!d.visible)return;let u=F1e.setFromMatrixPosition(this.objects[0].matrixWorld),h=U1e.setFromMatrixPosition(this.objects[1].matrixWorld),c=u.distanceTo(h)<=this.distance?"in":"out";if(this.stage!==c){this.stage=c;let d=c==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(f=>f.dispatchConditional()),d.Video.forEach(f=>f.dispatchConditional()),d.Link.forEach(f=>f.dispatch()),d.Create.forEach(f=>f.dispatch()),d.Destroy.forEach(f=>f.dispatch()),d.Reset.forEach(f=>f.dispatch()),d.Transition.forEach(f=>{f.object.currentTransitionEvent!==this&&(f.object.currentTransitionEvent=this),f.init()}),d.Transition.forEach(f=>f.play()),d.Animation.forEach(f=>f.play()),d.SwitchCamera.forEach(f=>f.play()),d.SceneTransition.forEach(f=>f.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let u of[o,l]){if(!u)throw new Error("Missing property");let h=i.find(u);if(!h)throw new Error("Missing property");this.objects.push(h)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrix",this.onUpdateMatrix)}),this.onUpdateMatrix()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrix",this.onUpdateMatrix)})}},H1e=class extends _V{constructor(e,t,r,i,n,s){var l;super(t,r,i,n,s),this.id=e,this.data=t,this.object=r,this.onBegin=({target:u,state:h})=>{this.toState!==h&&(this.actionsOut.Audio.forEach(c=>c.dispatchConditional()),this.actionsOut.Video.forEach(c=>c.dispatchConditional()),this.actionsOut.Link.forEach(c=>c.dispatch()),this.actionsOut.Create.forEach(c=>c.dispatch()),this.actionsOut.Destroy.forEach(c=>c.dispatch()),this.actionsOut.Reset.forEach(c=>c.dispatch()),this.actionsIn.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(c=>c.play()),this.actionsOut.Animation.forEach(c=>c.play()),this.actionsIn.SwitchCamera.forEach(c=>c.pause()),this.actionsOut.SwitchCamera.forEach(c=>c.play()),this.actionsOut.SceneTransition.forEach(c=>c.dispatch()))},this.onComplete=({target:u,state:h})=>{this.toState===h&&(this.actionsIn.Audio.forEach(c=>c.dispatchConditional()),this.actionsIn.Video.forEach(c=>c.dispatchConditional()),this.actionsIn.Link.forEach(c=>c.dispatch()),this.actionsIn.Create.forEach(c=>c.dispatch()),this.actionsIn.Destroy.forEach(c=>c.dispatch()),this.actionsIn.Reset.forEach(c=>c.dispatch()),this.actionsOut.Transition.forEach(c=>c.pause()),this.actionsOut.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(c=>c.play()),this.actionsIn.Animation.forEach(c=>c.play()),this.actionsOut.SwitchCamera.forEach(c=>c.pause()),this.actionsIn.SwitchCamera.forEach(c=>c.play()),this.actionsIn.SceneTransition.forEach(c=>c.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=i.find(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length)&&this.toObject.addEventListener("completeState",this.onComplete)}disconnect(){super.disconnect(),(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}},V1e=class extends Oo{constructor(e,t){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:r,sharedAssets:i}=this.eventContext;r.traverseEntity(n=>{var s;if((s=n.data)!=null&&s.events.length){for(let{id:a,data:o}of n.data.events)if(!o.disabled&&o.type==="Conditional")try{let l;o.condition.type==="Comparison"||(o.condition.type==="Distance"?l=new j1e(a,o,n,r,i,t):o.condition.type==="State"&&(l=new H1e(a,o,n,r,i,t))),l&&(this.eventsPerConditions[o.condition.type].push(l),(l.actionsIn.Video.length||l.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Am=new P,du=new P,Ac=new P,Gz=new us,W1e=.01,sr=new P,xi=new P,Yz=new P,Zc=new kt,EM=new Ri,G1e=new Oe,AM=new zi,xd=new P,qa=new P,wd=.2;function TM(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var Y1e=function(){let e=new Oe;return(t,r,i)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(r),t.reference==="global"&&TM(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?TM(n.position,t.limits):t.reference==="local"&&(Zc.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Zc),TM(n.position,t.limits),Zc.invert(),n.position.applyQuaternion(Zc),n.position.add(t.position0)),e.multiply(i??n.matrixWorld).decompose(sr,n.quaternion,xi),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof es&&bl(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),q1e=class{constructor(e,t,r,i,n,s){this.object=e,this.data=t,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=xs(t,t.dragDropActions.drag,r,i,n,this.object),this.actionsDrop=xs(t,t.dragDropActions.drop,r,i,n,this.object);let a=[];this.data.objects.forEach(o=>{let l=r.find(o);!l||l.data.visible!==!1&&(a.push(l),s[l.uuid]&&s[l.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&a.push(h)}))}),this.data.dropDestinations.forEach(o=>{let l=r.find(o);!l||l.data.visible!==!1&&(this.dropDestIds.push(l.uuid),s[l.uuid]&&s[l.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=a.map(o=>(this.data.planeMode==="locked"&&(o.userData.lockedPlane=!0),o.userData.worldPosition0=new P().setFromMatrixPosition(o.matrixWorld),{obj:o,fromPosition:new P().setFromMatrixPosition(o.matrixWorld),pointStart:new P,pointEnd:new P,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new P().copy(o.position),quat0:new kt().copy(o.quaternion),snapped:!1,orientationMatrix:new Oe,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){ts(this.actionsDrag),ts(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},X1e=class extends Oo{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var o;if(xt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:n,page:s}=this.eventContext,a=s.raycastWithClones(n);if(this.lastDropDestination=null,a.length===0){this.activeEvent=null;return}for(let l of this.events){let u=0;for(let{obj:h,pointEnd:c,pointStart:d}of l.dragItems){if(h===a[0].object||h===a[0].object.object||$t.is(h)&&h.isAncestorOf(a[0].object.uuid)){if(l.activeIdx=u,l.activeDragItem.reset=!1,l.activeDragItem.currentDampingFactor=l.data.dampingFactor,l.activeDragItem.snapped=!1,l.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){l.activeDragItem.obj.rigidBody&&l.activeDragItem.obj.rigidBody.setBodyType(2,!0);let f=l.activeDragItem.obj;h.hasNonUniformScale&&h.updateMatrixWorldSVD(),(f.hasNonUniformScale?f.matrixWorldRigid:f.matrixWorld).decompose(sr,Zc,xi),EM.setFromQuaternion(Zc),f.prevR===void 0?(f.prevR=EM.clone(),f.prevT=sr.clone()):(f.prevR.copy(EM),f.prevT.copy(sr)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(l.activeDragItem.obj)}this.calcPlaneIntersectPos(h,d,l.data.plane,l.data.referenceFrame),c.copy(d),(this.eventManager.controlsManager.usePhysics&&((o=h.data.physics)==null?void 0:o.rigidBody)==="dynamic"||l.data.drop===!1||l.data.resetOnSnapFail===!1)&&l.activeDragItem.fromPosition.setFromMatrixPosition(l.activeDragItem.obj.matrixWorld),this.activeEvent=l,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}u++}}this.activeEvent=null},this.onPointerMove=i=>{var o,l,u,h;if(xt.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:n,page:s}=this.eventContext,a=s.raycastWithClones(n);if(xt.length===0){let c=!1;for(let d of this.events){for(let{obj:f}of d.dragItems)if(f===((o=a[0])==null?void 0:o.object)||f===((u=(l=a[0])==null?void 0:l.object)==null?void 0:u.object)||$t.is(f)&&f.isAncestorOf((h=a[0])==null?void 0:h.object.uuid)){switch(c=!0,d.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(c)break}c||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let c=this.activeEvent.activeDragItem;c.snapped=!1;let d;if(this.activeEvent.data.drop&&(d=a.filter(f=>c.obj!==f.object&&!c.obj.isAncestorOf(f.object.uuid)&&!(f.object instanceof ew)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(p=>p===f.object.uuid||s.scene.find(p).isAncestorOf(f.object.uuid))))[0]),d){let f=Yz.copy(d.face.normal).applyMatrix3(AM.getNormalMatrix(d.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")c.fromPosition.setFromMatrixPosition(d.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(c.fromPosition.copy(d.point),this.activeEvent.data.snapSurfaceMode==="bbox"){sr.copy(f).applyMatrix3(AM.setFromMatrix4(c.obj.matrixWorld).transpose());let p=c.obj;sr.x>wd?xi.x=-p.recursiveBBox.min.x:sr.x<-wd&&(xi.x=-p.recursiveBBox.max.x),sr.y>wd?xi.y=-p.recursiveBBox.min.y:sr.y<-wd&&(xi.y=-p.recursiveBBox.max.y),sr.z>wd?xi.z=-p.recursiveBBox.min.z:sr.z<-wd&&(xi.z=-p.recursiveBBox.max.z),xi.applyMatrix3(AM.invert())}else xi.copy(f).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);c.fromPosition.add(xi)}this.activeEvent.data.autoOrient&&(sr.set(0,1,0).cross(f),sr.length()<1e-4&&sr.set(-1,0,0).cross(f),xi.crossVectors(Yz,sr),c.orientationMatrix.makeBasis(sr,xi,f)),c.pointStart.copy(c.fromPosition),c.pointEnd.copy(c.pointStart),c.currentDampingFactor=this.activeEvent.snapDampingFactor,c.snapped=!0,this.lastDropDestination!==d.object&&(this.lastDropDestination=d.object,this.activeEvent.actionsDrop.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(p=>{p.dispatchThrottled()}))}else c.orientationMatrix.makeRotationFromQuaternion(c.quat0),this.lastDropDestination=null,c.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(c.obj,c.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(f=>{f.stop(),f.object.currentState!==null&&f.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.stop()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(f=>{f.dispatchThrottled()}),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrag.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrag.Audio.forEach(f=>{f.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(f=>{f.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(f=>{f.stop(),f.object.currentState!==null&&f.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(f=>{f.stop()}))},500),this.updateDragItem(c),c.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var n;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let s=((n=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:n.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!s)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&s&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(a=>{a.stop(),a.object.currentState!==null&&a.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(a=>{a.stop()}),this.activeEvent.actionsDrag.Audio.forEach(a=>{a.dispatchGameControl("stop")})),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let r={};e.page.traverseEntity(i=>{i.component&&(r[i.component.uuid]?r[i.component.uuid].push(i.uuid):r[i.component.uuid]=[i.uuid])}),e.page.traverseEntity(i=>{var n;(n=i.data)==null||n.events.filter(s=>s.data.type==="DragDrop"&&!s.data.disabled).forEach(s=>{this.events.push(new q1e(i,s.data,e.page,e.sharedAssets,t,r))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,r,i){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(du),du.negate();let a=Zc.identity();switch(i==="parent"?G1e.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(sr,a,xi):i==="local"&&e.matrixWorld.decompose(sr,a,xi),r){case"x":sr.set(1,0,0).applyQuaternion(a),xd.copy(du).cross(sr),qa.copy(sr).cross(xd);break;case"y":sr.set(0,1,0).applyQuaternion(a),xd.copy(du).cross(sr),qa.copy(sr).cross(xd);break;case"z":sr.set(0,0,1).applyQuaternion(a),xd.copy(du).cross(sr),qa.copy(sr).cross(xd);break;case"xy":qa.set(0,0,1).applyQuaternion(a);break;case"yz":qa.set(1,0,0).applyQuaternion(a);break;case"xz":qa.set(0,1,0).applyQuaternion(a);break;case"adaptive":du.angleTo(xi.set(0,1,0))>Math.PI/6?(sr.crossVectors(xi.set(0,1,0),du),qa.crossVectors(sr,xi)):qa.set(0,1,0);break;default:qa.copy(du);break}Ac.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Ac;if(Gz.setFromNormalAndCoplanarPoint(qa,o),!!s.ray.intersectPlane(Gz,t)&&(r==="x"||r==="y"||r==="z")){let l=xi.subVectors(t,o).dot(sr);t.copy(o).addScaledVector(sr,l)}}updateDragItem(e,t=!1){var r,i;Ac.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?Am.subVectors(e.fromPosition,Ac).divideScalar(e.currentDampingFactor):e.reset==="original"?(Am.subVectors(e.obj.userData.worldPosition0,Ac).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Am.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Ac).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?Am.length()<W1e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&Y1e(e,Am.add(Ac),(r=this.activeEvent)!=null&&r.data.drop&&((i=this.activeEvent)!=null&&i.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},bd=new P,CM=new P,Ko=new P,Zo=new P,qz=new us,$1e=.01,Q1e={type:"requestRender"},K1e=function(){let e=new P,t=new P;return(r,i,n)=>n>0?(e.subVectors(r,i),e.length()<=n?r:t.copy(i).add(e.normalize().multiplyScalar(n))):i}(),Xz=function(){let e=new Oe;return(t,r)=>{t.position.copy(r),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof es&&bl(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Z1e=class{constructor(e,t,r,i,n){this.data=e,this.object=t,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new P,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...MA.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=xs(e,e.actions,r,i,n,t)}},J1e=class extends Oo{constructor(e,t){super(e),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(xt.length>1)){this.eventContext.updateRaycaster(i);for(let n of this.events)n.target===void 0&&this.updateSingleEvent(n)}},this.onMouseEnter=i=>{for(let n of this.events)n.target===void 0&&(n.isReset=!1,n.currentDampingFactor=n.data.dampingFactor)},this.onMouseLeave=i=>{for(let n of this.events)n.target===void 0&&(n.data.resetOnPointerLeave&&(n.isReset=!0,n.currentDampingFactor=n.resetDampingFactor),this.updateSingleEvent(n))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)};let{page:r}=this.eventContext;r.traverseEntity(i=>{var s,a;let n=(s=i.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!r.data.globalPhysics.usePhysics||((a=i.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new Z1e(n.data,i,r,e.sharedAssets,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ps&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let i=r.target,n=this.onTargetChange(r);this.pairOfEventListeners.push([i,n]),i.addEventListener("requestRender",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ps&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[r,i]of this.pairOfEventListeners)r.removeEventListener("requestRender",i);for(let r of this.events)r.paused=!0,r.isReset=!1,ts(r.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:r,limitDistance:i,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(Ko),e.isReset)Zo.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(Zo);else{let{getCamera:o,raycaster:l}=this.eventContext;if(r==="custom"?(o().getWorldDirection(CM),CM.negate(),bd.copy(CM)):r==="xy"?bd.set(0,0,1):r==="xz"?bd.set(0,1,0):r==="yz"&&bd.set(1,0,0),qz.setFromNormalAndCoplanarPoint(bd,Ko),!l.ray.intersectPlane(qz,Zo))return}if(!e.isReset){if(Zo.distanceTo(e.worldPosition0)>i&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Zo.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(Zo.x=Ko.x),e.data.enabledTranslation[1]===!1&&(Zo.y=Ko.y),e.data.enabledTranslation[2]===!1&&(Zo.z=Ko.z);let s=K1e(Ko,Zo,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=bd.subVectors(s,Ko).divideScalar(e.currentDampingFactor);Ko.add(o),t&&Xz(e.object,Ko),e.paused=o.length()<$1e}else Xz(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(Q1e)}},Tm=new P,Qy=new P,Cm=new Oe,_d=new kt,fu=new kt,Dm=new P,Pm=new P,Tc=new P,Jo=new P,DM=new us,exe=1e-6,txe={type:"requestRender"},rxe={type:"changeRotation"},$z=function(){let e=new Oe;return function(t,r){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),r.premultiply(gV(e).invert()),t.rotation.setFromRotationMatrix(r),t.updateMatrix(),t instanceof es&&bl(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),ixe=class{constructor(e,t,r){this.object=t,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new kt,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...EA.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},nxe=class extends Oo{constructor(e){super(e),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=r=>{if(!(xt.length>1)){this._lastMouseEvent=r,this.eventContext.updateRaycaster(r);for(let i of this.events)i.target===void 0&&this.updateSingleEvent(i)}},this.onMouseEnter=r=>{for(let i of this.events)i.target===void 0&&(i.isReset=!1,i.currentDampingFactor=i.data.dampingFactor)},this.onMouseLeave=r=>{for(let i of this.events)i.target===void 0&&(i.data.resetOnPointerLeave&&(i.isReset=!0,i.currentDampingFactor=i.resetDampingFactor),this.updateSingleEvent(i))},this.onScroll=r=>{if(this._lastMouseEvent){let i=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(i)}},this.onTargetChange=r=>()=>{this.updateSingleEvent(r)},this.createUserEventListener=r=>({eventName:i,target:n})=>{if(!i||!n)return;let s=Yv(i);s&&s==="LookAt"&&this.updateSingleEvent(r)};let{page:t}=this.eventContext;t.traverseEntity(r=>{var n,s;let i=(n=r.data)==null?void 0:n.events.find(a=>a.data.type==="LookAt"&&!a.data.disabled);i&&(!t.data.globalPhysics.usePhysics||((s=r.dataPatched.physics)==null?void 0:s.rigidBody)!=="dynamic")&&this.events.push(new ixe(i.data,r,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ps&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?t.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let s=this.onTargetChange(r),a=r.target;this.pairOfEventListeners.push([a,s]),a.addEventListener("requestRender",s)}let i=this.createUserEventListener(r),n=r.object;this.pairOfUserEventListeners.push([n,i]),n.addEventListener("userEvent",i)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),ps&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[r,i]of this.pairOfEventListeners)r.removeEventListener("requestRender",i);for(let[r,i]of this.pairOfUserEventListeners)r.removeEventListener("userEvent",i);for(let r of this.events)r.paused=!0,r.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:r,distance:i,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:u}=this.eventContext,{object:h,target:c}=e;if(h.getWorldPosition(Dm),!e.isReset)if(e.target)e.target.getWorldPosition(Pm);else{if(n==="custom"?(l().getWorldDirection(Qy),Qy.negate(),DM.setFromNormalAndCoplanarPoint(Qy,Dm)):(n==="xy"?Tm.set(0,0,1):n==="xz"?Tm.set(0,1,0):n==="yz"&&Tm.set(1,0,0),DM.setFromNormalAndCoplanarPoint(Tm,Dm)),!u.ray.intersectPlane(DM,Pm))return;i>0&&(n==="custom"||n===void 0)&&Pm.addScaledVector(Qy,i)}if(e.isReset||(c?t==="target"?Tc.copy(c.up).applyMatrix4(Cm.extractRotation(c.matrixWorld)).normalize():a.some(f=>f===!1)?(r==="x"?(Jo.set(0,0,1),a[2]===!1&&Jo.set(0,1,0)):r==="y"?(Jo.set(1,0,0),a[0]===!1&&Jo.set(0,0,1)):(Jo.set(0,1,0),a[1]===!1&&Jo.set(1,0,0)),Tc.copy(Jo).applyQuaternion(e.worldQuaternion0).normalize()):Tc.set(0,1,0):n==="custom"?Tc.set(0,1,0):Tc.copy(Tm)),e.isReset)fu.copy(e.worldQuaternion0);else if(Dm.distanceTo(Pm)>s&&o&&c)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)fu.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;sxe(Cm,Pm,Dm,Tc,r,Jo),fu.setFromRotationMatrix(Cm),_d.setFromUnitVectors(Jo.applyQuaternion(fu),Tc),a.some(f=>f===!1)&&t!=="target"&&fu.premultiply(_d).normalize()}e.currentDampingFactor>1?(h.updateWorldMatrix(!0,!1),_d.setFromRotationMatrix(gV(h.matrixWorld)),_d.slerp(fu,1/e.currentDampingFactor),$z(h,Cm.makeRotationFromQuaternion(_d)),e.paused=8*(1-_d.dot(fu))<exe):($z(h,Cm.makeRotationFromQuaternion(fu)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),h.dispatchEvent(txe),h.dispatchEvent(rxe)}},Os=new P,yi=new P,Jr=new P;function sxe(e,t,r,i,n,s){let a=e.elements;Jr.subVectors(t,r),Jr.lengthSq()===0&&(Jr.z=1),Jr.normalize(),yi.crossVectors(i,Jr),yi.lengthSq()===0&&(Math.abs(i.z)===1?Jr.x+=1e-4:Jr.z+=1e-4,Jr.normalize(),yi.crossVectors(i,Jr)),yi.normalize(),Os.crossVectors(Jr,yi),n==="x"?s.z===1?[yi,Os,Jr]=[Jr,yi,Os]:(yi.negate(),[yi,Jr]=[Jr,yi]):n==="y"?s.x===1?[yi,Os,Jr]=[Os,Jr,yi]:(yi.negate(),[Os,Jr]=[Jr,Os]):s.x===1&&(yi.negate(),[yi,Os]=[Os,yi]),a[0]=yi.x,a[4]=Os.x,a[8]=Jr.x,a[1]=yi.y,a[5]=Os.y,a[9]=Jr.y,a[2]=yi.z,a[6]=Os.z,a[10]=Jr.z}var axe=class{constructor(e,t,r,i,n,s){this.id=e,this.data=t,this.object=r,this.entered=!1,this.actions=xs(t,t.actions,i,n,s,r)}disconnect(){ts(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch())}},oxe=class extends Oo{constructor(e,t){super(e),this.eventsPerObjects={},this.objects=[],this._prevObjects=[],this.onMouseDown=n=>{xt.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseHoverEvent())},this.onMouseUp=n=>{xt.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=n=>{xt.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:n,target:s,reverse:a})=>{var l;if(!n||!s)return;let o=Yv(n);o&&o==="MouseHover"&&(s.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(l=this.eventsPerObjects[s.uuid])==null||l.forEach(u=>u.dispatchUserEvent(a)))};let{page:r,sharedAssets:i}=this.eventContext;r.traverseEntity(n=>{var s,a;if(!(!n.visible||!((s=n.data)!=null&&s.events.length))){for(let{id:o,data:l}of n.data.events)if(!l.disabled&&l.type==="MouseHover")try{let u=new axe(o,l,n,r,i,t);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(a=this.eventsPerObjects[n.uuid])!=null&&a.length&&this.objects.push(n)}})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),ps&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(t=>{t.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),ps&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(r=>{r.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:r,raycaster:i,page:n}=this.eventContext;if(r){let s=PT(i,n,this.objects);t=OT(s)}else this.objects.forEach(s=>{nw(i,s)&&t.push(s)})}this._prevObjects.length&&this._prevObjects.forEach(r=>{var i;t.includes(r)||(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(i=this.eventsPerObjects[r.uuid])==null||i.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(r=>{var i;r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(i=this.eventsPerObjects[r.uuid])==null||i.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},lxe=class{constructor(e,t,r,i,n,s){this.id=e,this.data=t,this.object=r,this.scrollCounter=0,this.actions=xs(t,t.actions,i,n,s,r)}connect(){this.scrollCounter=0}disconnect(){ts(this.actions)}dispatch(e){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this,i.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let r=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(i=>i.seek(r)),this.actions.Animation.forEach(i=>i.seek(t)),this.actions.Create.forEach(i=>i.dispatchThrottled())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled())}},uxe=class{constructor(e,t,r,i,n,s,a){this.id=e,this.data=t,this.object=r,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=xs(t,t.actions,i,n,a,r)}computeScrollBounds(){let e=this.domElement.getBoundingClientRect(),t=document.body,r=document.documentElement,i=window.pageYOffset||r.scrollTop||t.scrollTop,n=r.clientTop||t.clientTop||0,s=Math.round(e.top+i-n);if(this.data.startFrom==="enter"){let a=window.innerHeight,o=e.height,l=this.data.enterAnchor,u=l==="top"?a:l==="bottom"?a-o:a-o*.5;this.scrollStart=s-u}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.dispatch({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){ts(this.actions)}handleResize(){this.computeScrollBounds()}dispatch({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let r=this.scrollEnd-this.scrollStart,i=Math.min(1,Math.max(0,(t-this.scrollStart)/r));this.actions.Transition.forEach(n=>n.seek(i)),this.actions.Animation.forEach(n=>n.seek(i)),this.actions.Create.forEach(n=>n.dispatchThrottled())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled())}},cxe=class extends Oo{constructor(e,t){super(e),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([a,o])=>{o.forEach(l=>l.handleResize())})},this.onScroll=a=>{if(!this.isInview)return;let o={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([l,u])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:o}),u.forEach(h=>h.dispatch(o))})},this.onWheel=a=>{!this.isInview||a.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([o,l])=>{o.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:a.deltaY}),l.forEach(u=>u.dispatch(a.deltaY))})},this.onUserEvent=({eventName:a,target:o,reverse:l})=>{var h;if(!a||!o)return;let u=Yv(a);u&&u==="Scroll"&&(o.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(h=this.wheelEventsPerObject.get(o))==null||h.forEach(c=>{c.dispatchUserEvent(l)}))};let{page:r,sharedAssets:i,domElement:n,isExport:s}=this.eventContext;r.traverseEntity(a=>{var o,l,u;if((o=a.data)!=null&&o.events.length){for(let{id:h,data:c}of a.data.events)if(!c.disabled&&c.type==="Scroll")if(c.trigger==="load"||!s){let d=new lxe(h,c,a,r,i,t);this.wheelEventsPerObject.has(a)?(l=this.wheelEventsPerObject.get(a))==null||l.push(d):this.wheelEventsPerObject.set(a,[d])}else{let d=new uxe(h,c,a,r,i,n,t);this.scrollEventsPerObject.has(a)?(u=this.scrollEventsPerObject.get(a))==null||u.push(d):this.scrollEventsPerObject.set(a,[d])}}}),this.intersectionObserver=new IntersectionObserver(a=>{let o=a[0];o&&(this.isInview=o.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(r=>r.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(r=>r.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(r=>r.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(r=>r.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},hxe=class{constructor(e,t,r,i,n,s){this.id=e,this.data=t,this.object=r,this.actions=xs(t,t.actions,i,n,s,r)}disconnect(){ts(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Kc?t.interaction.audioPlayer.play():t.interaction instanceof ET&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let r=t.interaction.data.triggerAfter??"autoplay";r===e&&(t.interaction instanceof Tf?t.interaction.play(r==="autoplay"):t.interaction instanceof CT&&t.interaction.dispatch())})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Kc?t.interaction.audioPlayer.play():t.interaction instanceof ET&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof Tf?t.interaction.play():t.interaction instanceof CT&&t.interaction.dispatch()})}},dxe=class extends Oo{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,i])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,i])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:r,isExport:i}=this.eventContext;(i?document:r).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>{a.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,i])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof Kc&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof Tf&&s.interaction.play(a==="autoplay")})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,i])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:r,target:i,reverse:n})=>{var a,o;if(!r||!i)return;let s=Yv(r);s&&s==="Start"&&(i.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(i))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(i))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext;if(t.traverseEntity(r=>{var i,n,s,a;if((i=r.data)!=null&&i.events.length)for(let{id:o,data:l}of r.data.events){if(l.disabled||l.type!=="Start")continue;let u=new hxe(o,l,r,t,e,this.eventManager);(u.actions.Transition.length||u.actions.Animation.length||u.actions.SwitchCamera.length||u.actions.Create.length||u.actions.Destroy.length||u.actions.SceneTransition.length)&&(this.eventsPerObject.has(r)?(n=this.eventsPerObject.get(r))==null||n.push(u):this.eventsPerObject.set(r,[u])),u.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(s=this.eventsAfterPerObject.get(r))==null||s.push(u):this.eventsAfterPerObject.set(r,[u])),u.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(u):this.eventsAfterPerObject.set(r,[u]))}}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:i}=this.eventContext,n=i?document:r;n.addEventListener("pointerdown",this.onMouseDown,{once:!0}),n.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),n.addEventListener("pointerdown",this.onAny),n.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,i])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach(n=>n.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,r=t?document:e;r.removeEventListener("pointerdown",this.onMouseDown),r.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),r.removeEventListener("pointerdown",this.onAny),r.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([i,n])=>{i.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(r=>r.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},fxe=class{constructor(e,t,r,i,n,s){this.id=e,this.data=t,this.object=r,this.disabled=!1,this.actions=xs(t,t.actions,i,n,s,r),this.target=t.target,this.useToggle=t.toggle}disconnect(){ts(this.actions)}dispatch(e){this.disabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()})):(this.actions.Transition.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}))}},pxe="https://unpkg.com/@splinetool/runtime@0.9.432/build/",mxe="https://unpkg.com/@splinetool/navmesh-wasm@0.9.432/build/",gxe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${pxe}' + 'navmesh.js'),
		fetch('${mxe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,vxe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,yxe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,xxe=.001,wxe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},SV,Wt,Vi;vhe.then(e=>{SV=e,Wt=new e.Vec3,Vi=new e.Vec3});var bxe=new P,_xe=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=r=>{if(xt.length!==1)return;let{raycaster:i,page:n}=this.eventContext;this.eventContext.updateRaycaster(r);let s=n.raycastWithClones(i);if(s.length!==0){if(this.gameControl){let a=bxe.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(r,i)=>n=>{var d,f,p,m,g,v,y;let s;if(n instanceof ba)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof sn)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((f=s.dataPatched.cloner)==null?void 0:f.hideBase)&&((p=s.dataPatched.physics)==null?void 0:p.fusedBody)!==!0)return!0;if(i&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((m=a.physics)==null?void 0:m.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=sw(a),l=s.userData.hasDestroy,u=s.userData.hasDrag,h=!1,c=!1;for(let x of a.events)x.data.disabled!==!0&&(x.data.type==="GameControl"?h=!0:x.data.type==="Follow"&&(c=!0));if(h||o||c||l||u)return!0;if(this.usePhysics&&((g=a.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((v=a.physics)!=null&&v.fusedBody))return!0}else if("geometry"in n&&n.geometry&&r.push(pl(n.geometry,n.matrixWorld)),this.usePhysics&&((y=a.physics)==null?void 0:y.fusedBody))return n.traverseObject((x,w)=>{var A,M;if(w===0)return;let S;if(x instanceof ba)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;S=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof sn)S=x.object;else if(S=x,(A=x.dataPatched.cloner)==null?void 0:A.hideBase)return!0;let _=S.dataPatched;if(!_.visible&&((M=_.physics)==null?void 0:M.enabled)!==!0)return!0;"geometry"in x&&x.geometry&&r.push(pl(x.geometry,x.matrixWorld))}),!0},this.traverseNoPhysics=(r,i)=>n=>{let s;if(n instanceof ba)return;n instanceof sn?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(i&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,u=s.userData.hasDrag===!0;if(sw(a)||l||u||s.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return!0;o&&r.push(pl(o,n.matrixWorld))},this.navmeshWasm=SV,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?gxe:vxe)+yxe])),this._worker=new Worker(this._workerURL)}init(e,t,r){this.gameControl=t,this.eventContext=r,this.resolution=e.ch,this.setDefaultQueryExtent(new P().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(r.page,e,i=>{this.buildFromNavmeshData(i.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,r){t.objects.forEach(l=>{var h;let u=e.scene.find(l);u.traverseEntity(c=>{c.userData.navmesh=!0}),(h=u.cloner)==null||h.traverseObject(c=>{c.userData.navmesh=!0})});let i=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(i,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var h;let u=e.scene.find(l);u.traverseEntity(c=>{c.userData.navmesh=void 0}),(h=u.cloner)==null||h.traverseObject(c=>{c.userData.navmesh=void 0})}),i.length===0)return!1;let s=$c(i),{positions:a,triIndices:o}=db(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...wxe,...t}]),this._worker.onmessage=r,!0}createDebugNavGeometry(){let e,t,r=this.navMesh.getDebugNavMesh(),i=r.getTriangleCount(),n=new Uint32Array(i*3),s=new Float32Array(i*3*3);for(e=0;e<i*3;e++)n[e]=e;for(e=0;e<i;e++)for(t=0;t<3;t++){let o=r.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new _t;return a.setIndex(new Mt(n,1)),a.setAttribute("position",new Mt(s,3)),a}getClosestPoint(e){return Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,this.navMesh.getClosestPoint(Wt)}getClosestPointToRef(e,t){Wt.x=e.x,Wt.y=e.y,Wt.z=e.z;let r=this.navMesh.getClosestPoint(Wt);t.set(r.x,r.y,r.z)}getRandomPointAround(e,t){return Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,this.navMesh.getRandomPointAround(Wt,t)}getRandomPointAroundToRef(e,t,r){Wt.x=e.x,Wt.y=e.y,Wt.z=e.z;let i=this.navMesh.getRandomPointAround(Wt,t);r.set(i.x,i.y,i.z)}moveAlong(e,t){return Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,Vi.x=t.x,Vi.y=t.y,Vi.z=t.z,this.navMesh.moveAlong(Wt,Vi)}moveAlongToRef(e,t,r){return Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,Vi.x=t.x,Vi.y=t.y,Vi.z=t.z,this.navMesh.moveAlong(Wt,Vi)}computePath(e,t){let r=this.getClosestPoint(t);Vi.x=r.x,Vi.y=r.y,Vi.z=r.z,this.getClosestPoint(e);let i=this.navMesh.computePath(Wt,Vi),n=i.getPointCount(),s=[];for(let a=0;a<n;a++){let o=i.getPoint(a);s.push(new P(o.x,o.y,o.z))}return s}createCrowd(e,t){return new Sxe(this,e,t)}setDefaultQueryExtent(e){Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,this.navMesh.setDefaultQueryExtent(Wt)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,r=this.navmeshWasm._malloc(t),i=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,r,t);i.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=i.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(i.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),r=new Uint8Array(e.size);return r.set(t),this.navMesh.freeNavmeshData(e),r}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,r){return Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,this.navMesh.addCylinderObstacle(Wt,t,r)}addBoxObstacle(e,t,r){return Wt.x=e.x,Wt.y=e.y,Wt.z=e.z,Vi.x=t.x,Vi.y=t.y,Vi.z=t.z,this.navMesh.addBoxObstacle(Wt,Vi,r)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},Sxe=class{constructor(e,t,r){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,r,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,r){let i=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;i.radius=t.radius,i.height=t.height,i.maxAcceleration=t.maxAcceleration,i.maxSpeed=t.maxSpeed,i.collisionQueryRange=t.collisionQueryRange,i.pathOptimizationRange=t.pathOptimizationRange,i.separationWeight=t.separationWeight,i.updateFlags=7,i.obstacleAvoidanceType=0,i.queryFilterType=0,i.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),i);return this.transforms.push(r),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new P(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let r=this.crowd.getAgentPosition(e);t.set(r.x,r.y,r.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let r=this.crowd.getAgentVelocity(e);t.set(r.x,r.y,r.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let r=this.crowd.getAgentNextTargetPath(e);t.set(r.x,r.y,r.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let r=this.agents.indexOf(e);r>-1&&(this._agentDestinationArmed[r]=!0,this._agentDestination[r].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let r=this.crowd.getAgentParameters(e);t.radius!==void 0&&(r.radius=t.radius),t.height!==void 0&&(r.height=t.height),t.maxAcceleration!==void 0&&(r.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(r.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(r.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(r.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(r.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,r)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=xxe)return;let t=1/60,r=10;{let i=Math.floor(e/t);i>r&&(i=r),i<1&&(i=1);let n=e/i;for(let s=0;s<i;s++)this.crowd.update(n)}for(let i=0;i<this.agents.length;i++){let n=this.agents[i],s=this.getAgentPosition(n);if(this.transforms[i].copy(s),this._agentDestinationArmed[i]){let a=s.x-this._agentDestination[i].x,o=s.z-this._agentDestination[i].z,l=this.reachRadii[i],u=this._agentDestination[i].y-this.reachRadii[i],h=this._agentDestination[i].y+this.reachRadii[i],c=a*a+o*o;s.y>u&&s.y<h&&c<l*l&&(this.onReachTarget(n,this._agentDestination[i]),this._agentDestinationArmed[i]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,r=this.crowd.getCorners(e),i=r.getPointCount(),n=[];for(t=0;t<i;t++){let s=r.getPoint(t);n.push(new P(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function Mxe(e){let t=!1;return e.scene.objects.forEach(r=>{r.data.type==="Page"&&!t&&r.data.publish.gameControlObject&&iv.traverseModuleInstances(e.scene.objects,r.id,(i,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var Exe={type:"change"},Qz={type:"changeZoom"},Axe={type:"changePan"},Sd={type:"start"},Md={type:"end",changed:!0},Txe={type:"end",changed:!1},PM=new kt,Kz=new J,Cxe=2*Math.PI,Dxe=1e-8,Pxe=.01,OM=new P,Ky=new J,LM=new P,Zy=new kt,Zz=new Oe,Oxe={type:"requestRender"},MV=class extends Xi{constructor(e,t,r={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=r,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,As.DOLLY_ROTATE,As.PAN],this.offset=new P,this.eye=new P,this.lastPosition=new P,this.lastQuaternion=new kt,this.current=new J,this.overShoot=new J,this.overRatio=new J,this.spherical=new wI,this.sphericalDelta=new wI,this.panOffset=new P,this.panLeftV=new P,this.panUpV=new P,this.panV=new P,this.rotateStart=new J,this.rotateEnd=new J,this.rotateDelta=new J,this.panStart=new J,this.panEnd=new J,this.panDelta=new J,this.dollyStart=new J,this.dollyEnd=new J,this.dollyDelta=new J,this.rotationRangeFactor=new J,this.panRangeFactor=new J,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=i=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=i.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(LM,Zy,OM),this.offset.copy(LM).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(PM.copy(Zy).invert()),this.panOffset.applyQuaternion(PM),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Zy),this.panOffset.applyQuaternion(Zy)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),LM.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(Zz.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(Zz));let i=this.spherical.phi%Cxe;return this.eye.copy(this.offset).normalize(),this.object.up.copy(dr.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),i>0&&i>Math.PI||i<0&&i>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>Pxe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>Dxe?(this.dispatchEvent(Exe),this.object.dispatchEvent(Oxe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=i=>{this.enabled!==!1&&(i.pointerType==="touch"||i.pointerType==="pen"&&ps?this.onPointerDownTouch(i):this.onPointerDownMouse(i),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Sd),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),i.stopPropagation(),i.pointerType==="touch"||i.pointerType==="pen"&&ps||this.domElement.setPointerCapture(i.pointerId)))},this.onPointerLeave=i=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,OM.subVectors(this.position0,this.target0),this.spherical.setFromVector3(OM),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=i},this.onPointerEnter=i=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?Ky.set(i.clientX-this.domElement.clientWidth/2,i.clientY-this.domElement.clientHeight/2):Ky.set(i.clientX-this.pointerLeaveEvent.clientX,i.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(Ky).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(Kz,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(i.clientX,i.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(Ky).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(i.clientX,i.clientY)),this.update()},this.onPointerMove=i=>{this.enabled!==!1&&(this.checkRaycastLock()||(i.pointerType==="touch"||i.pointerType==="pen"&&ps?this.onPointerMoveTouch(i):this.onPointerMoveMouse(i),i.stopPropagation()))},this.onPointerUp=i=>{this.isPointerDown=!1,xt.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),xt.length>1&&i.preventDefault(),this.hasChange?this.dispatchEvent(Md):this.dispatchEvent(Txe),this.state=-1,i&&(i.stopPropagation(),i.pointerType==="touch"||i.pointerType==="pen"&&ps||this.domElement.releasePointerCapture(i.pointerId))},this.onPointerDownMouse=i=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[i.button]:n=this.mouseButtonsPlay[i.button],n){case 0:if(i.altKey===!0&&!i.shiftKey&&!my(i)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(i),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(i),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(i),this.state=2;break;case 3:if(my(i)||i.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(i),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(i),this.state=0}break;case 5:if(my(i)||i.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(i),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(i),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=i=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(i);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(i);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(i);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=i=>{switch(xt.length>1&&i.preventDefault(),this.touches[xt.length-1]){case As.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case As.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case As.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case As.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=i=>{switch(xt.length>1&&i.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(i),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(i),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(i),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(i),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=FD(()=>this.dispatchEvent(Md),33),this.onMouseWheel=i=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&i.preventDefault(),this.dispatchEvent(Sd),this.handleMouseWheel(i),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=i=>{if(i.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!Pj)if(i.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Sd),i.scale>this.prevScale?this.dollyIn(this.getZoomScale()):i.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=i.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Md)},this.onContextMenu=i=>{i.preventDefault()},this.onTouchEnd=i=>{i.preventDefault()},this.onKeyDown=i=>{this.enabled!==!1&&(this.key=i.key,i.key===" "&&this.dispatchEvent(Sd))},this.onKeyUp=i=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&i.key==="Alt"&&this.onPointerUp(xt[0]),i.key===" "&&this.dispatchEvent(Md))},this.onPointerHover=i=>{i.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(i,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(i,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=i=>{i.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let r=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=r**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let i=this.object.getTarget().applyQuaternion(PM.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+i.y,this.maxV=e.panVerticalOffset.max+i.y,this.minH=-e.panHorizontalOffset.min+i.x,this.maxH=e.panHorizontalOffset.max+i.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Xa(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Xa(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Xa(Xa(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Xa(Xa(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=As.ROTATE),e.panTouches===1&&(this.touches[0]=As.PAN),e.orbitTouches===2&&(this.touches[1]=As.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=As.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=As.ROTATE),e.panTouches===3&&(this.touches[2]=As.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,r,i,n,s,a,o){this.overShoot.set(0,0);let l,u,h;e instanceof P?(l=e.x,u=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,u=e.phi,this.current.set(Xa(this.spherical.theta),Xa(this.spherical.phi)),h=!1),r===0&&(this.current.x+=l,this.current.y+=u),(t===3||t===2)&&(!h&&this.isThetaFlipped?this.current.x>i&&this.current.x<0?this.overShoot.x=i-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>i?this.overShoot.x=i-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),h||(this.overShoot.x=Xa(this.overShoot.x),this.overShoot.y=Xa(this.overShoot.y)),r!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),r===1&&(this.overRatio.x=Jz(Math.abs(this.overRatio.x)),this.overRatio.y=Jz(Math.abs(this.overRatio.y))),this.isPointerDown||r===1?r===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),u*this.overShoot.y<0&&!this.phiIsFree&&(u*=1-this.overRatio.y)):r===2&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(u=this.overShoot.y*.05),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,u+=this.overShoot.y),e instanceof P?(e.x=l,e.y=u):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=u))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let r=this.domElement;if(r&&this.object.isPerspectiveCamera){let i=this.object.position;this.panV.copy(i).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/r.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/r.clientHeight,this.object.matrixWorld)}else r&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrixWorld));this.dispatchEvent(Axe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Qz)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Qz)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Sd),this.dollyOut(e),this.dispatchEvent(Md)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Sd),this.dollyIn(e),this.dispatchEvent(Md)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(Kz,-this.object.angleOffsetFromUp);let r=this.domElement,i=this.useWindowEvents?window.innerHeight:r.clientHeight,n=2*Math.PI*this.rotateDelta.x/i,s=2*Math.PI*this.rotateDelta.y/i;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(dhe===!1&&my(e)===!1&&Lxe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(xt.length===2){let e=.5*(xt[0].pageX+xt[1].pageX),t=.5*(xt[0].pageY+xt[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(xt[0].pageX,xt[0].pageY)}handleTouchStartPan(){if(xt.length===2){let e=.5*(xt[0].pageX+xt[1].pageX),t=.5*(xt[0].pageY+xt[1].pageY);this.panStart.set(e,t)}else this.panStart.set(xt[0].pageX,xt[0].pageY)}handleTouchStartDolly(){let e=xt[0].pageX-xt[1].pageX,t=xt[0].pageY-xt[1].pageY,r=Math.sqrt(e*e+t*t);this.dollyStart.set(0,r)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(xt.length===2){let r=LS(e),i=.5*(e.pageX+r.x),n=.5*(e.pageY+r.y);this.rotateEnd.set(i,n)}else{if(e.pointerId!==xt[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(xt.length===2){let t=LS(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this.panEnd.set(r,i)}else{if(e.pointerId!==xt[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=LS(e),r=e.pageX-t.x,i=e.pageY-t.y,n=Math.sqrt(r*r+i*i);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function Xa(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function Jz(e){return 1-Math.pow(1-e,4)}function Lxe(e){return e.wheelDeltaY===0||e.deltaY===0?sb&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY:e.deltaMode===0}var eN=class{constructor(e,t,r,i,n,s){this.id=e,this.data=t,this.object=r,this.currentIntersectedObjects=[],this.disabled=!1,this.actions=xs(t,t.actions,i,n,s,r),this.target=t.target,this.useToggle=t.toggle,this.triggeringObjects=t.triggeringObjects.map(a=>i.scene.find(a))}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){ts(this.actions)}dispatch(){this.disabled||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.SwitchCamera.forEach(e=>{e.toggle()})):(this.actions.Transition.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}))}},qt;xhe.then(e=>qt=e);var ui=new P,da=new kt,pu=new P,IM=new Ri(0,0,0,"YXZ"),tN=new Ri(0,0,0,"XYZ"),el=new P,rN=new P,iN=new P(1,1,1),Ed=new kt,RM=new Oe,Ixe=new Oe,Rxe={type:"updateMatrix"},LT={type:"beginEvent",eventName:"Collision"},kxe={type:"beginEvent",eventName:"Trigger"};function zxe(e){if(iv.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((r,i)=>{if(i.events){for(let n of i.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}}),t}var sw=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),Nxe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==qt.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[r,i,n]=this.rigidBodyToMesh.get(t.handle);if(ui.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),da.copy(t.rotation()),r.matrixWorld.compose(ui,da,i),r.hasNonUniformScale&&r.matrixWorld.multiply(r.shearScale),r.dispatchEvent(Rxe),n){let s=r.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(r.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of r.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,r,i)=>{var a,o,l,u;if(i===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(r)):this.sensorToTriggerEvent[r]&&(n=this.sensorToTriggerEvent[r],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let h=this.sharedGameControlGlobals.createdObjects.length-1;h>=0;h--){let c=this.sharedGameControlGlobals.createdObjects[h];if(c.userData.hasCollisionDestroy&&(((a=c.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=c.rigidBody)==null?void 0:o.collider(0).handle)===r)){this.sharedGameControlGlobals.createdObjects.splice(h,1),c.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(c.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)===this.sharedGameControlGlobals.colliderToEntity.get(t)){let h=this.sharedGameControlGlobals.colliderToEntity.get(r),c=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(c===void 0)return;for(let d of c)d.data.target==="character"&&this.dispatchCollisionEvent(d,h,r)}else if(((u=this.gameControl)==null?void 0:u.object)===this.sharedGameControlGlobals.colliderToEntity.get(r)){let h=this.sharedGameControlGlobals.colliderToEntity.get(t),c=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(c===void 0)return;for(let d of c)d.data.target==="character"&&this.dispatchCollisionEvent(d,h,t)}else{let h=this.sharedGameControlGlobals.colliderToEntity.get(t),c=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(c!==void 0)for(let p of c)p.data.target==="scene"&&this.dispatchCollisionEvent(p,h,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(r),f=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(f!==void 0)for(let p of f)p.data.target==="scene"&&this.dispatchCollisionEvent(p,d,r)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=pV,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",r=>{"gamepad"in r.data&&"axes"in r.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(r.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var r,i;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(i=(r=n.data.actions)==null?void 0:r.find(a=>a.data.type==="Destroy"))==null?void 0:i.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let r of t.events)if(!(r.data.disabled===!0||r.data.type!=="DragDrop"))for(let i of r.data.objects){let n=this.page.scene.find(i);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var o,l;let r;if(t instanceof ba)return;t instanceof sn?r=t.object:r=t;let i=r.dataPatched;if(((o=i.physics)==null?void 0:o.enabled)==="visibility"?!i.visible:!((l=i.physics)!=null&&l.enabled))return!0;let n=t.geometry,s=r.userData.hasDestroy===!0,a=r.userData.hasDrag===!0;if(sw(i)||s||a||r.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;n&&e.push(pl(n,t.matrixWorld))}),e.length>0){let t=$c(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new dg(t)}}addRigidBody(e,t,r){let i=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&i.push(pl(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,i);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(i.length>0){let a,o=!r.fromCreate&&s.physics.rigidBody==="dynamic"||r.fromCreate&&r.dynamic;o?(a=qt.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(r.hasTransformAnim||r.hasFollow||r.hasDrag)&&!r.fromCreate?(a=qt.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=qt.RigidBodyDesc.fixed();let l=$c(i);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(ui,da,pu),e.position0=ui.clone().divideScalar(this.pixelsPerMeter),e.rotation0=da.clone(),ui.divideScalar(this.pixelsPerMeter),a.setTranslation(ui.x,ui.y,ui.z).setRotation(da),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(pu.x/this.pixelsPerMeter,pu.y/this.pixelsPerMeter,pu.z/this.pixelsPerMeter);let u=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(u.handle,[e,pu.clone(),s.physics.fusedBody]);let h=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(u,s.physics,l,t,h)}catch{try{this.addCollider(u,s.physics,l,t,!1)}catch(c){console.error(c)}}e.rigidBody=u}}addBoundsTree(e){var r;let t=[];if(((r=e.geometry)==null?void 0:r.getAttribute("position"))!==void 0&&t.push(pl(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(i=>i.updateMatrixWorld(!0)),t.length>0){let i=$c(t,!1);e.bvhGeometry=i,e.bvhGeometry.boundsTree=new dg(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)}}addCollider(e,t,r,i,n=!0){var o,l;if((r==null?void 0:r.getAttribute("position").count)===0||((o=r==null?void 0:r.getIndex())==null?void 0:o.count)===0)return;let s;r&&(t.colliderType==="trimesh"?s=qt.ColliderDesc.trimesh(r.getAttribute("position").array,r.getIndex().array):s=qt.ColliderDesc.convexMesh(r.getAttribute("position").array,n?r.getIndex().array:void 0)),s.setFrictionCombineRule(qt.CoefficientCombineRule.Average).setRestitutionCombineRule(qt.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,i),(l=this.sharedGameControlGlobals.entityToCollisionEvents[i.uuid])!=null&&l.some(u=>u.target==="scene")&&a.setActiveEvents(qt.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(r,i)=>{var o;if(i===0)return;let n;if(r instanceof ba)if(r.objectForSample){if(r.objectForSample.dataPatched.physics.fusedBody)return;n=r.object}else return r.object.dataPatched.physics.fusedBody===!0&&r.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(r instanceof sn)n=r.object;else if(n=r,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;i===1?e.hasNonUniformScale?r.matrixWorld.multiplyMatrices(e.shearScale,r.hiddenMatrix):r.matrixWorld.copy(r.hiddenMatrix):r.matrixWorld.multiplyMatrices(r.parent.matrixWorld,r.hiddenMatrix),r.matrixWorld.multiply(r.matrix);let a=r.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(pl(a,r.matrixWorld))}}activate(e){var d,f;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,r=!1,i=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,u=null;if(l)for(let p of l.data.events){if(p.data.disabled||p.data.type!=="GameControl")break;let m=l;for(;this.usePhysics&&((d=m=m.parent)==null?void 0:d.parent)!==null&&!((f=m.data.physics)!=null&&f.fusedBody););p.data.collisionEnabled&&(this.needsCollisionDetection=!0),u===null&&(u=p.data)}if(l&&u){r=r||u.camera===t.uuid||l.uuid===t.uuid;let p=new mV(l,this.renderer.domElement,u,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&u.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=p,u.keyAssignments,i=u.joystickPosLoc,n=u.joystickRotLoc,s=u.jumpTouchButtonLoc,a=u.rotByTouch,ps&&u.touchControl&&(this.joystickToGameControls[i]="pos",u.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let p=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new _xe(this.usePhysics,this.isExport);let m;p.collider.type==="sphere"?m=p.collider.radius*2:m=p.collider.height,m=Math.floor(m/p.navmesh.ch-1),this.navigationMeshWrapper.init({...p.navmesh,walkableHeight:m},this.gameControl,this.eventContext)}}if(r===!1){let{enableRotate:p,enablePan:m,enableZoom:g,autoRotate:v,hoverRotatePanMode:y}=this.eventManager.publish.orbitControls;(p||m||g||v||y!==0)&&(this.orbitControls=new MV(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let h=this.renderer.domElement.width/this.renderer.getPixelRatio(),c=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((p,m)=>{let g=document.body.appendChild(document.createElement("div")),[v,y,x]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[m],w=(h-5*v)/4+v,S={},_=p==="jmp",A=_?0:v;m<10?(m<5?S.top=A/2:S.bottom=A/2,S.left=A/2+m%5*w):m===10?(S.left=A/2,S.top=c/2):(S.right=A/2,S.top=c/2),S.top?S.top-=y[1]:S.bottom+=y[1],S.left?S.left+=y[0]:S.right-=y[0];for(let C in S)S[C]+="px";if(_){let C=g.appendChild(document.createElement("div"));Object.assign(C.style,S,{position:"absolute",width:v+"px",height:v+"px",backgroundColor:`rgba(255,255,255,${x==="show"?.4:0})`,zIndex:"9999",borderRadius:v+"px",border:x==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let L=v/16*16*.4;x==="show"&&(C.innerHTML=`
						<svg width="${L}" height="${v*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",I=>I.preventDefault()),this.joysticks[m]=[void 0,g];return}let M={zone:g,mode:"static",position:S,size:v};x==="hide"&&(M.restOpacity=0);let T=eye.create(M);T.on("move",(C,L)=>{let I=this.gameControl;p==="pos"?L.force<.2?I.moveForce=0:(I.movementState.movePosZ=Math.sin(-L.angle.radian),I.movementState.movePosX=Math.cos(-L.angle.radian),L.force>1.2?I.movementState.run=1:I.movementState.run=0,L.force<.3?I.moveForce=(L.force-.2)/.1:I.moveForce=1):p==="rot"&&(L.force<.2?I.rotForce=0:(I.movementState.rotPosX=L.vector.y,I.movementState.rotPosY=-L.vector.x,L.force<.3?I.rotForce=(L.force-.2)/.1:I.rotForce=1)),this.requestRender()}),T.on("end",(C,L)=>{let I=this.gameControl;p==="pos"?(I.movementState.movePosZ=0,I.movementState.movePosX=0,I.moveForce=1):p==="rot"&&(I.movementState.rotPosX=0,I.movementState.rotPosY=0,I.rotForce=1)}),this.joysticks[m]=[T,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(p=>p.disabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new qt.World(new qt.Vector3(0,this.gravity,0)),this.events=new qt.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var v,y,x,w;let l;if(o instanceof ba)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof sn)l=o.object;else if(l=o,((v=l.dataPatched.cloner)==null?void 0:v.disabled)===!1&&((y=l.dataPatched.cloner)==null?void 0:y.hideBase)&&((x=l.dataPatched.physics)==null?void 0:x.fusedBody)!==!0)return!0;let u=l.dataPatched,h;for(let S of u.events)S.data.disabled!==!0&&S.data.type==="GameControl"&&(h=S.data);if(!u.physics||(u.physics.enabled==="visibility"?!u.visible:!u.physics.enabled))return!0;o.updateMatrixWorldSVD();let c=sw(u),d=!1,f=l.userData.hasDestroy,p=l.userData.hasDrag,m=!1;for(let S of u.events)if(S.data.disabled!==!0){if(S.data.type==="Collision"){d=!0;let _=new fxe(S.id,S.data,l,this.page,this.sharedAssets,this.eventManager);_.disabled=!0,this.collisionEvents.push(_),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(A=>A.id!==S.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(_):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[_]}else if(S.data.type==="Follow"){m=!0;let _=S.data.target;o.traverseVisible(A=>{A.userData.isFollowingObj=_})}}u.physics.rigidBody==="dynamic"&&u.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let g=o.geometry;if(h!==void 0){let S=qt.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(ui,da,pu),o.position0=ui.clone().divideScalar(this.pixelsPerMeter),o.rotation0=da.clone(),ui.divideScalar(this.pixelsPerMeter),S.setTranslation(ui.x,ui.y,ui.z).setRotation(da);let _=this.sharedGameControlGlobals.rapierWorld.createRigidBody(S);o.rigidBody=_;let A;h.collider.type==="sphere"?A=qt.ColliderDesc.ball(h.collider.radius/this.pixelsPerMeter):h.collider.type==="capsule"?A=qt.ColliderDesc.capsule((h.collider.height/2-h.collider.radius)/this.pixelsPerMeter,h.collider.radius/this.pixelsPerMeter):A=qt.ColliderDesc.cuboid(h.collider.width/this.pixelsPerMeter/2,h.collider.height/this.pixelsPerMeter/2,h.collider.depth/this.pixelsPerMeter/2),A.setFrictionCombineRule(qt.CoefficientCombineRule.Average).setRestitutionCombineRule(qt.CoefficientCombineRule.Average).setDensity(u.physics.density).setFriction(u.physics.friction).setRestitution(u.physics.restitution);let M=this.sharedGameControlGlobals.rapierWorld.createCollider(A,_);this.sharedGameControlGlobals.colliderToEntity.set(M.handle,l),ui.fromArray(h.collider.position).multiply(pu.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),M.setTranslationWrtParent(ui);let T=new kt().setFromEuler(new Ri().setFromVector3(new P().fromArray(h.collider.rotation)));M.setRotationWrtParent(T),M.setActiveEvents(qt.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else u.physics.rigidBody==="dynamic"||c||m||f||p||d?(this.addRigidBody(o,l,{hasFollow:m,hasTransformAnim:c,hasDrag:p}),this.generateSensorColliderDescs(l,u.physics.fusedBody)):(g&&e.push(pl(g,o.matrixWorld)),u.physics.fusedBody&&o.traverseObject((S,_)=>{var C;if(_===0)return;let A;if(S instanceof ba)if(S.objectForSample){if(S.objectForSample.dataPatched.physics.fusedBody)return;A=S.object}else return S.object.dataPatched.physics.fusedBody===!0&&S.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(S instanceof sn)A=S.object;else if(A=S,(C=A.dataPatched.cloner)==null?void 0:C.hideBase)return!0;let M=A.dataPatched;if(M.physics.enabled==="visibility"?!M.visible:!M.physics.enabled)return!0;let T=S.geometry;(T==null?void 0:T.getAttribute("position"))!==void 0&&e.push(pl(T,S.matrixWorld))}),this.generateSensorColliderDescs(l,u.physics.fusedBody,t));if(((w=u.physics)==null?void 0:w.fusedBody)===!0||h)return!0}),e.length===0)return;let r=$c(e);r.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let i=qt.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(i),s=qt.ColliderDesc.trimesh(r.getAttribute("position").array,r.getIndex().array).setFrictionCombineRule(qt.CoefficientCombineRule.Multiply).setRestitutionCombineRule(qt.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let u=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[u.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?(this.gameControl===null||this.needsCollisionDetection)&&this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let r=new eN(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),i=new Oe().compose(el.fromArray(t.data.position),Ed.setFromEuler(tN.fromArray(t.data.rotation)),iN);if(t.data.triggerZone==="box"){let n=new ai;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,i,e,r])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,i,e,r])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,r,i;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(r=this.gameControl)==null||r.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(i=this.navigationMeshWrapper)==null||i.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,r){if(!this.isEnabled)return!0;let i=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(i=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,i=!1):this.initializationCounter===2&&this.gameControl&&(i=!this.gameControl.update(e,t,r)&&i),this.usePhysics){let n=.016666666666666666;if(e===0)i=this.stepPhysics()&&i;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(i=this.stepPhysics()&&i,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return i}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(ui,da,pu),IM.setFromQuaternion(da);let r=t;r.prevR===void 0?(r.prevR=IM.clone(),r.prevT=ui.clone()):(r.prevR.copy(IM),r.prevT.copy(ui)),t.rigidBody.setNextKinematicTranslation(ui.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(da)}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,r){var s;let i=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(r))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===i){n=a;break}}e.dispatch(n),t.dispatchEvent(LT)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,r){let i=Ixe.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new eN(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=qt.ColliderDesc.cuboid(...a.data.size.map(u=>u/(2*this.pixelsPerMeter))):l=qt.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(qt.ActiveEvents.COLLISION_EVENTS),el.fromArray(a.data.position),Ed.setFromEuler(tN.fromArray(a.data.rotation)),RM.compose(el,Ed,iN).premultiply(n.matrixWorld),r?(RM.decompose(el,Ed,rN),l.setActiveCollisionTypes(qt.ActiveCollisionTypes.KINEMATIC_FIXED|qt.ActiveCollisionTypes.DYNAMIC_FIXED)):(RM.premultiply(i).decompose(el,Ed,rN),e.rigidBody.bodyType()===qt.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===qt.RigidBodyType.Fixed?l.setActiveCollisionTypes(qt.ActiveCollisionTypes.KINEMATIC_FIXED|qt.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(qt.ActiveCollisionTypes.KINEMATIC_KINEMATIC|qt.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),el.divideScalar(this.pixelsPerMeter),l.setTranslation(el.x,el.y,el.z),l.setRotation(Ed),r)r.push([l,o]);else{let u=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[u.handle]=o}}})}};function Bxe(e){let t=this._clip.duration,r=this._clip.start??0,i=this.loop,n=this.time+e,s=this._loopCount,a=i===nD;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-r):n;if(i===h4){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<r){let o=Math.floor((n-r)/(t-r));n-=(t-r)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:r,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-r)}return n}var nN=!1,Fxe=class{constructor(e,t,r,i){this.scene=e,this.requestRender=t,this.updateDisplayProgress=r,this.animationInspectorState=i,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=aA.parse(JSON.parse(s[2]));n.animations[a]=l;let u=this.mixer.clipAction(l,n);nN===!1&&(Object.getPrototypeOf(u)._updateTime=Bxe,nN=!0),u.clampWhenFinished=!0,this.clipIdToAction[o]=u})},this.mixer=new Nre(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let r=this.scene.find(t);if(!r)return;let i=r.animations.find(s=>s.uuid===e);if(!i)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(i),delete this.clipIdToAction[e],r.animations=r.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=d4}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,r=this.clipIdToAction[t];if(r)return e&&(e.repeat>=0&&(r.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(r.loop=nD)),r.play(),r.paused=!1,this.requestRender(),r}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){var e,t;return((t=(e=this.activeClip)==null?void 0:e.tracks[0])==null?void 0:t.times.length)??0}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let r=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?e/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),r&&(this.clipIdToAction[t].paused=!0)}},kM=new WeakMap,Uxe=class extends yD{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new oA(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){let n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let r=JSON.stringify(t);if(kM.has(e)){let o=kM.get(e);if(o.key===r)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(i=o,new Promise((l,u)=>{i._callbacks[n]={resolve:l,reject:u},i.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{i&&n&&this._releaseTask(i,n)}),kM.set(e,{key:r,promise:a}),a}_createGeometry(e){let t=new _t;e.index&&t.setIndex(new Mt(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let i=e.attributes[r],n=i.name,s=i.array,a=i.itemSize;t.setAttribute(n,new Mt(s,a))}return t}_loadLibrary(e,t){let r=new oA(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((i,n)=>{r.load(e,i,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{let i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);let n=jxe.toString(),s=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(n){let s=n.data;switch(s.type){case"decode":i._callbacks[s.id].resolve(s);break;case"error":i._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,n){return i._taskLoad>n._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function jxe(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(h){e.onModuleLoaded=function(c){h({draco:c})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,u=o.taskConfig;t.then(h=>{let c=h.draco,d=new c.Decoder,f=new c.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{let p=r(c,d,f,u),m=p.attributes.map(g=>g.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{c.destroy(f),c.destroy(d)}});break}};function r(a,o,l,u){let h=u.attributeIDs,c=u.attributeTypes,d,f,p=o.GetEncodedGeometryType(l);if(p===a.TRIANGULAR_MESH)d=new a.Mesh,f=o.DecodeBufferToMesh(l,d);else if(p===a.POINT_CLOUD)d=new a.PointCloud,f=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());let m={index:null,attributes:[]};for(let g in h){let v=self[c[g]],y,x;if(u.useUniqueIDs)x=h[g],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,a[h[g]]),x===-1)continue;y=o.GetAttribute(d,x)}m.attributes.push(n(a,o,d,g,v,y))}return p===a.TRIANGULAR_MESH&&(m.index=i(a,o,d)),a.destroy(d),m}function i(a,o,l){let u=l.num_faces()*3,h=u*4,c=a._malloc(h);o.GetTrianglesUInt32Array(l,h,c);let d=new Uint32Array(a.HEAPF32.buffer,c,u).slice();return a._free(c),{array:d,itemSize:1}}function n(a,o,l,u,h,c){let d=c.num_components(),f=l.num_points()*d,p=f*h.BYTES_PER_ELEMENT,m=s(a,h),g=a._malloc(p);o.GetAttributeDataArrayForAllPoints(l,c,m,p,g);let v=new h(a.HEAPF32.buffer,g,f).slice();return a._free(g),{name:u,array:v,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var ku;function Hxe(){return ku||(ku=new Uxe,ku.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),ku.decoderPending}async function Vxe(e){if(ku){let t={attributeIDs:ku.defaultAttributeIDs,attributeTypes:ku.defaultAttributeTypes,useUniqueIDs:!1},r;try{r=await ku.decodeGeometry(new Int8Array(e).buffer,t)}catch(i){console.error(i)}if(r)return{index:r.index?{array:r.index.array}:void 0,attributes:Object.entries(r.attributes).map(([i,n])=>({name:i,itemSize:n.itemSize,array:n.array}))}}return null}async function Wxe(e,t){let[r,i]=Wj(_A.deserialize(new Uint8Array(e)));Lde(r);let n=[];r.scene.objects.traverse((s,a)=>{a.type==="Mesh"&&a.geometry.type==="NonParametricGeometry"&&a.geometry.data.draco!==void 0&&n.push(a)}),n.length&&await Hxe();for(let s of n){let a=await Vxe(Bi(s.geometry.data.draco));if(a){a.index&&(s.geometry.data.index={array:a.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let o={};a.attributes.forEach(({name:l,array:u,itemSize:h})=>{o[l]={array:u,itemSize:h,type:"Float32Array",normalized:!1}}),s.geometry.data.attributes=o,s.geometry.data.draco=void 0}}return t&&t(r),i.result().data}var Gxe=class{constructor(e,t,r,i,n,s,a){this.id=e,this.data=t,this.dataEvent=r,this.object=i,this.stage=!1,this.actions=xs(r,t.actions,n,s,a,i)}disconnect(){ts(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},Yxe=class extends Oo{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.onResize=()=>{let r=window.innerWidth,i=window.innerHeight;this.breakpoints.forEach(n=>{let s=AA.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?r:i,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})}}connect(){let{page:e,sharedAssets:t}=this.eventContext;window.addEventListener("resize",this.onResize),e.traverseEntity(r=>{var i;if(!(!r.visible||!((i=r.data)!=null&&i.events.length)))for(let{data:n}of r.data.events)n.disabled||n.type==="Resize"&&n.breakpoints.forEach(({data:s,id:a})=>{try{let o=new Gxe(a,s,n,r,e,t,this.eventManager);this.breakpoints.push(o)}catch{}})}),this.onResize()}disconnect(){window.removeEventListener("resize",this.onResize),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},sN=Object.keys(wV).filter(e=>isNaN(Number(e))),qxe=class{constructor(e,t,r,i){this.publish=e,this.controlsManager=t,this.animationControls=r,this.eventContext=i,this.isEnabled=!1,this.activateCount=0,this.onResetRaycaster=()=>{this.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=n=>{(n.touches.length>1||this.preventTouchScroll)&&n.preventDefault()},this.onMouseWheelPreventScroll=n=>{this.preventScroll&&n.preventDefault()},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=i.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.handlers={Spline:new z1e(this.eventContext),Conditional:new V1e(this.eventContext,this),Start:new dxe(this.eventContext,this),Basic:new B1e(this.eventContext,this),MouseHover:new oxe(this.eventContext,this),Scroll:new cxe(this.eventContext,this),Follow:new J1e(this.eventContext,this),DragDrop:new X1e(this.eventContext,this),LookAt:new nxe(this.eventContext),Resize:new Yxe(this.eventContext,this)};let{page:e,domElement:t,eventElement:r}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity(i=>{i.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(i=>i.connect()),sN.forEach(i=>{(Object.values(this.handlers).some(n=>n.domEventsNeeded.has(i))||i==="pointerdown"&&this.controlsManager.navigationMeshWrapper)&&(t.addEventListener(i,this.onResetRaycaster),r.addEventListener(i,this.onResetRaycaster))}),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){var r;if(!this.isEnabled)return;this.isEnabled=!1;let{page:e,domElement:t}=this.eventContext;t.style.cursor="",Object.values(this.handlers).forEach(i=>i.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(i=>{i.removeEventListener("requestRender",this.requestRender)}),sN.forEach(i=>{t.removeEventListener(i,this.onResetRaycaster)}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}},Xxe=class{constructor(e,t,r,i,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new J().copy(r),this._editorSize=new J().copy(i),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,r=this._editorSize.y;this._aspect=e/t,t<=r&&(this._camera.zoom*=r/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,r=this._editorSize.y,i=this._fov;if(e&&t>r){let n=$xe(t,1080,2160,1,15)/100;i*=t/r,i*=1-n}this._camera.aspect=this._aspect,this._camera.fov=i,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function $xe(e,t,r,i,n){return(e-t)/(r-t)*(n-i)+i}var Qxe=class{get sharedAssets(){return this.shared}constructor(e,t={}){this.shared=new f2(e.shared,t),this.scene=new _2(e.scene,this.sharedAssets)}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof Ku&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof Qn&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},Kxe=class{constructor({x:e=10,y:t=10}){this._startTime=0;let r=document.getElementById("spe-perfs");r?this.element=r:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function Zxe(e){let t;if(e.index)for(let r=0;r<e.index.array.length;r+=3)t=e.index.array[r],e.index.array[r]=e.index.array[r+2],e.index.array[r+2]=t}function bg(e){return e instanceof lv?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function Jxe(e,t){let r={};return e.traverseEntity(i=>{var l;if(!i.visible||!(i instanceof es)||i.type!=="Mesh"||Array.isArray(i.material)||i.states&&Object.keys(i.states).length)return;let n=i.parent;for(;n;){if(n instanceof es&&i.states&&Object.keys(i.states).length)return;n=n.parent}let s=i.material.uuid,a=t.shared.materials[s];if(a){if(!an.isMergable(a))return}else{let u=(l=t.scene.objects.get(i.uuid))==null?void 0:l.data;if(u&&"material"in u&&typeof u.material!="string"){if(!an.isMergable(u.material))return;s=an.getHash(u.material)}}r[s]||(r[s]={});let o=r[s][bg(i)];if(o){if(o.push(i),i.cloner)for(let u of i.cloner.children)o.push(u)}else if(r[s][bg(i)]=[i],i.cloner)for(let u of i.cloner.children)r[s][bg(i)].push(u)}),r}function ewe(e){let t=0;return Object.values(e).forEach(r=>{Object.values(r).forEach(i=>{let n=i.length;n>t&&(t=n)})}),t}function twe(e,t){let r=Jxe(t,e),i=ewe(r),n=new Array(i),s=0,a=new Array(i),o=0,l=new Array(i),u=0,h=new Array(i),c=0;for(let[d,f]of Object.entries(r))for(let p of Object.values(f)){if(o=0,u=0,p.forEach(g=>{g instanceof es&&(a[o++]=g.geometry.clone(),l[u++]=g)}),u<2)continue;for(let g=0;g<u;g++)l[g].updateWorldMatrix(!0,!1),a[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&Zxe(a[g]);let m=$c(a.slice(0,o),!1);if(m){let g;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new Hn(m,l[0].material);break}default:{g=new Hn(m,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let v=y=>{c=0;for(let x of y)x.children&&v(x.children),x instanceof es&&(Array.isArray(x.material)||r[x.material.uuid]&&r[x.material.uuid][bg(x)]&&r[x.material.uuid][bg(x)].length>1||(h[c++]=x));for(let x=0;x<c;x++)t.attach(h[x])};for(let y=0;y<u;y++){let x=l[y];v(x.children),n[s++]=x}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var rwe=dp(M$(),1),iwe=new J;function nwe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var swe=class{constructor(e,{renderOnDemand:t,renderMode:r="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=i=>{var n,s,a,o,l,u,h,c,d,f,p,m;if(this.time=i,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(u=this._eventManager.handlers)!=null&&u.Conditional.hasVideoAction)&&(this._skipRender=!1),(h=this._animationControls)==null||h.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(c=this._eventManager)!=null&&c.isEnabled&&(((d=this._eventManager.handlers)==null?void 0:d.Follow).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.LookAt).onAnimationFrameDamping(),((p=this._eventManager.handlers)==null?void 0:p.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let g=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=g,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(m=this._perfs)==null||m.end()},this._resize=()=>{var i,n,s,a,o,l,u,h,c,d;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=iwe.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=(i=this._scene)==null?void 0:i.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((s=(n=this._frameView)==null?void 0:n.frameSize)==null?void 0:s.x)??this._viewportWidth,((o=(a=this._frameView)==null?void 0:a.frameSize)==null?void 0:o.y)??this._viewportHeight,((l=this._frameView)==null?void 0:l.enableResponsive)??!1),this._camera){let f=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(c=this._frameView)==null||c.setCamera(this._camera),(d=this._frameView)==null||d.updateCamera(f!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this._requestRenderAutoMode()}},this._debouncedResize=FD(this._resize,10),this.canvas=e,this.renderMode=t?"auto":r,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new Kxe({x:10,y:10})),mhe(e)}async load(e,t){nwe(e),this.disposed=!1;let r=await(await fetch(e,t)).arrayBuffer();await this.start(r)}async start(e,{interactive:t=!0}={}){var s,a,o;if(this.disposed)return;let r=await Wxe(e);this._data=r,r.version&&(0,rwe.default)(r.version,"0.9.432")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([Zk(r)&&Rpe(),tge(r)&&Ope(),iv.physicsEnabled(r.scene.objects)&&whe(),Xk(r)&&Hme(),Mxe(r)&&yhe()].filter(Boolean)),(s=this._eventManager)==null||s.deactivate(),(a=this._controls)==null||a.deactivate(),(o=this._scene)==null||o.dispose();let i=new Qxe(r);if(i.resetPersonalCameraFromDocumentData(),this._scene=i.scene,this._sharedAssetsManager=i.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let l=performance.now();twe(r,i.scene);let u=performance.now();console.log("Merged geometries in ",u-l," ms")}Zk(r)&&this._scene.traverse(l=>{bl(l)&&l.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var l;this._requestRenderAutoMode(),(l=this._scene)==null||l.traverse(u=>{u instanceof ba&&u.pendingMediaLoad&&u.update()})});let n=Object.keys(r.shared.fonts).map(l=>this._sharedAssetsManager.getFont(l).loadingPromise);if(Promise.all(n).then(()=>{i.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),Xk(r)&&zxe(r)&&await Promise.all(n),this._scene.rewriteEventsBeforeGoToPlayMode(),R2(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new P0e({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData),this._frameView)this._frameView.setCamera(this._camera);else{let l=Object.values(r.frames)[0];l.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=l.size[0],this._viewportHeight=l.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new Xxe(this._renderer,this._camera,new J(this._viewportWidth,this._viewportHeight),new J(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(l.allowResponsive??!1)&&l.preset==="fullscreen"}if(t){let l=new R1e(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0);this._scene.updateMatrixWorld(!0),this._controls=new Nxe(l),this._animationControls=new Fxe(this._scene,this._requestRenderAutoMode),this._eventManager=new qxe(r.scene.publish,this._controls,this._animationControls,l),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var l;(l=this._renderer)==null||l.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300)}findObjectById(e){var r;let t=(r=this._scene)==null?void 0:r.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var r;let t=(r=this._scene)==null?void 0:r.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(r=>{if(r.uuid!==Ap&&!(r instanceof Ku)){let i=this._createProxyObject(r);i&&e.push(i)}}),e}getSplineEvents(){var e;return((e=this._eventManager)==null?void 0:e.handlers.Spline).splineEvents}emitEvent(e,t){var r;(r=this.findObjectById(t)||this.findObjectByName(t))==null||r.emitEvent(e)}emitEventReverse(e,t){var r;(r=this.findObjectById(t)||this.findObjectByName(t))==null||r.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,r;((t=this._controls)==null?void 0:t.orbitControls)instanceof MV&&((r=this._controls)==null||r.orbitControls.zoomOut(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:r,b:i,a:n}={r:0,g:0,b:0,a:1},s=new $n(t,r,i,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,r,i,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(r=this._sharedAssetsManager)==null||r.dispose(),this._proxyObjectCache.forEach(o=>{PI.unsubscribe(o)}),(i=this._renderer)==null||i.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),ghe(this.canvas)}get isStopped(){return this._isPaused}stop(){var e,t,r;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(r=this._controls)!=null&&r.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,r;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(r=this._renderer)==null||r.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof Ku&&(t=s.name)});let r={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof Ku||e instanceof _2||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},i=PI(r,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,i),i}},Jy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},IT={},awe={get exports(){return IT},set exports(e){IT=e}},Om={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aN;function owe(){if(aN)return Om;aN=1;var e=fe,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,u){var h,c={},d=null,f=null;u!==void 0&&(d=""+u),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(f=l.ref);for(h in l)i.call(l,h)&&!s.hasOwnProperty(h)&&(c[h]=l[h]);if(o&&o.defaultProps)for(h in l=o.defaultProps,l)c[h]===void 0&&(c[h]=l[h]);return{$$typeof:t,type:o,key:d,ref:f,props:c,_owner:n.current}}return Om.Fragment=r,Om.jsx=a,Om.jsxs=a,Om}(function(e){e.exports=owe()})(awe);const RT=IT.jsx;var lwe="Expected a function",oN=0/0,uwe="[object Symbol]",cwe=/^\s+|\s+$/g,hwe=/^[-+]0x[0-9a-f]+$/i,dwe=/^0b[01]+$/i,fwe=/^0o[0-7]+$/i,pwe=parseInt,mwe=typeof Jy=="object"&&Jy&&Jy.Object===Object&&Jy,gwe=typeof self=="object"&&self&&self.Object===Object&&self,vwe=mwe||gwe||Function("return this")(),ywe=Object.prototype,xwe=ywe.toString,wwe=Math.max,bwe=Math.min,zM=function(){return vwe.Date.now()};function _we(e,t,r){var i,n,s,a,o,l,u=0,h=!1,c=!1,d=!0;if(typeof e!="function")throw new TypeError(lwe);t=lN(t)||0,kT(r)&&(h=!!r.leading,c="maxWait"in r,s=c?wwe(lN(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d);function f(_){var A=i,M=n;return i=n=void 0,u=_,a=e.apply(M,A),a}function p(_){return u=_,o=setTimeout(v,t),h?f(_):a}function m(_){var A=_-l,M=_-u,T=t-A;return c?bwe(T,s-M):T}function g(_){var A=_-l,M=_-u;return l===void 0||A>=t||A<0||c&&M>=s}function v(){var _=zM();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,d&&i?f(_):(i=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),u=0,i=l=n=o=void 0}function w(){return o===void 0?a:y(zM())}function S(){var _=zM(),A=g(_);if(i=arguments,n=this,l=_,A){if(o===void 0)return p(l);if(c)return o=setTimeout(v,t),f(l)}return o===void 0&&(o=setTimeout(v,t)),a}return S.cancel=x,S.flush=w,S}function kT(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Swe(e){return!!e&&typeof e=="object"}function Mwe(e){return typeof e=="symbol"||Swe(e)&&xwe.call(e)==uwe}function lN(e){if(typeof e=="number")return e;if(Mwe(e))return oN;if(kT(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=kT(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(cwe,"");var r=dwe.test(e);return r||fwe.test(e)?pwe(e.slice(2),r?2:8):hwe.test(e)?oN:+e}var Ewe=_we;function Awe(e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}const Twe=[],Cwe={width:"100%",height:"100%"},Dwe=pe.forwardRef(function({className:e,children:t,debounceTime:r=300,ignoreDimensions:i=Twe,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const u=pe.useRef(null),h=pe.useRef(0),[c,d]=pe.useState({width:0,height:0,top:0,left:0}),f=pe.useMemo(()=>{const p=Array.isArray(i)?i:[i];return Ewe(m=>{d(g=>Object.keys(g).filter(v=>g[v]!==m[v]).every(v=>p.includes(v))?g:m)},r,{leading:s})},[r,s,i]);return pe.useEffect(()=>{const p=a||window.ResizeObserver,m=new p(g=>{g.forEach(v=>{const{left:y,top:x,width:w,height:S}=(v==null?void 0:v.contentRect)??{};h.current=window.requestAnimationFrame(()=>{f({width:w,height:S,top:x,left:y})})})});return u.current&&m.observe(u.current),()=>{window.cancelAnimationFrame(h.current),m.disconnect(),f.cancel()}},[f,a]),RT("div",{style:{...Cwe,...n},ref:Awe([l,u]),className:e,...o,children:t({...c,ref:u.current,resize:f})})}),Pwe=pe.forwardRef(({scene:e,style:t,onMouseDown:r,onMouseUp:i,onMouseHover:n,onKeyDown:s,onKeyUp:a,onStart:o,onLookAt:l,onFollow:u,onWheel:h,onLoad:c,renderOnDemand:d=!0,...f},p)=>{const m=pe.useRef(null),[g,v]=pe.useState(!0);return pe.useEffect(()=>{v(!0);let y;const x=[{name:"mouseDown",cb:r},{name:"mouseUp",cb:i},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:u},{name:"scroll",cb:h}];if(m.current){y=new swe(m.current,{renderOnDemand:d});async function w(){await y.load(e);for(let S of x)S.cb&&y.addEventListener(S.name,S.cb);v(!1),c==null||c(y)}w()}return()=>{for(let w of x)w.cb&&y.removeEventListener(w.name,w.cb);y.dispose()}},[e]),RT(Dwe,{ref:p,parentSizeStyles:t,debounceTime:50,...f,children:()=>RT("canvas",{ref:m,style:{display:g?"none":"block"}})})});const EV=()=>ge(Pwe,{scene:"./assets/3d/cubic.splinecode"}),Owe=()=>{i4();const{login:e}=To(),t=r=>{r.preventDefault();const{email:i,password:n,remember:s}=r.target.elements;s.checked?e(i.value,n.value,30):e(i.value,n.value,24)};return St("div",{className:"auth",children:[ge("div",{className:"auth__interactive",children:ge(pe.Suspense,{fallback:ge("div",{children:"Loading..."}),children:ge(EV,{})})}),ge("div",{className:"auth__form",children:St("form",{onSubmit:t,children:[ge("img",{src:"",alt:"logo"}),ge("h1",{children:"WELCOME BACK"}),ge("input",{type:"text",name:"email",placeholder:"Email"}),ge("input",{type:"password",name:"password",placeholder:"Password"}),St("div",{className:"auth__form__remember__container",children:[St("div",{className:"auth__form__remember",children:[ge("input",{type:"checkbox",name:"remember",id:"remember"}),ge("label",{htmlFor:"remember",children:"Remember me for 30 days"})]}),ge(oo,{to:"/forgot-password",target:"_blank",className:"forgot__btn",children:"Forgot Password?"})]}),ge("button",{type:"submit",children:"Login"}),ge(oo,{className:"register__login",to:"/register",children:"Register"})]})})]})},Lwe=()=>{i4();const{register:e}=To(),t=r=>{r.preventDefault();const{user_firstname:i,user_lastname:n,user_email:s,user_password:a}=r.target.elements;e(i.value,n.value,s.value,a.value)};return St("div",{className:"auth",children:[ge("div",{className:"auth__interactive",children:ge(pe.Suspense,{fallback:ge("div",{children:"Loading..."}),children:ge(EV,{})})}),ge("div",{className:"auth__form",children:St("form",{onSubmit:t,children:[ge("img",{src:"",alt:"logo"}),ge("h1",{children:"WELCOME"}),ge("input",{type:"text",name:"user_firstname",placeholder:"First Name"}),ge("input",{type:"text",name:"user_lastname",placeholder:"Last Name"}),ge("input",{type:"text",name:"user_email",placeholder:"Email"}),ge("input",{type:"password",name:"user_password",placeholder:"Password"}),ge("button",{type:"submit",children:"Register"}),ge(oo,{className:"register__login",to:"/login",children:"Login"})]})})]})},yb=()=>{const e=Yw(),{user:t}=To();pe.useEffect(()=>{(!t||t===null||t===void 0)&&e("/login")},[t])};const Iwe=""+new URL("icon-calendar-dc3c5395.svg",import.meta.url).href,Rwe=""+new URL("icon-task-7befd80f.svg",import.meta.url).href,kwe=""+new URL("icon-pro-b8637046.svg",import.meta.url).href,AV=""+new URL("icon-setting-5baa6cff.svg",import.meta.url).href,xb=()=>{const e=Lv();return St("div",{className:"sidebar",children:[St("ul",{children:[ge("li",{children:St(oo,{to:"/home",className:e.pathname==="/home"?"active":"",children:[ge("span",{children:ge("img",{src:Rwe,alt:"My Tasks"})}),"My Tasks"]})}),ge("li",{children:St(oo,{to:"/calendar",className:e.pathname==="/calendar"?"active":"",children:[ge("span",{children:ge("img",{src:Iwe,alt:"Calendar"})}),"Calendar"]})}),ge("li",{children:St(oo,{to:"/premium",className:e.pathname==="/premium"?"active":"",children:[ge("span",{children:ge("img",{src:kwe,alt:"Go to pro"})}),"Go To Pro"]})})]}),ge("ul",{children:ge("li",{children:St(oo,{to:"/settings",className:e.pathname==="/settings"?"active":"",children:[ge("span",{children:ge("img",{src:AV,alt:"Settings"})}),"Settings"]})})})]})};const zwe=""+new URL("icon-search-66def30d.svg",import.meta.url).href,Nwe=""+new URL("icon-notification-a0140e29.svg",import.meta.url).href,Bwe=""+new URL("icon-profil-25657c37.svg",import.meta.url).href,Fwe=""+new URL("icon-logout-67da8372.svg",import.meta.url).href,wb=()=>{const{logout:e}=To(),[t,r]=pe.useState(!1),i=pe.useRef(null);return pe.useEffect(()=>{var n,s;t?(n=i.current)==null||n.classList.add("active__dropdown"):(s=i.current)==null||s.classList.remove("active__dropdown")},[t]),St("div",{className:"headerbar",children:[ge("div",{className:"headerbar__left",children:St("label",{htmlFor:"search",children:[ge("img",{src:zwe,alt:"search"}),ge("input",{type:"text",placeholder:"Search",id:"search"})]})}),ge("div",{className:"headerbar__right",children:St("div",{className:"headerbar__right__user",children:[ge("div",{className:"headerbar__right__user__notifications",children:ge("img",{src:Nwe,alt:"notifications"})}),St("div",{className:"headerbar__right__user__avatar",children:[ge("img",{className:"avatar__img",src:"",alt:"avatar",onClick:()=>r(!t)}),St("ul",{className:"headerbar__right__user__avatar__dropdown",ref:i,children:[ge("li",{children:St(oo,{to:"/settings",children:[ge("img",{src:Bwe,alt:""}),"Profile"]})}),ge("li",{children:St(oo,{to:"/settings",children:[ge("img",{src:AV,alt:""}),"Settings"]})}),ge("li",{children:St(oo,{to:"/",onClick:e,children:[ge("img",{src:Fwe,alt:""}),"Logout"]})})]})]})]})})]})},TV=pe.createContext({tasks:[],urlIcal:"",getTasks:()=>{},getUrlIcal:()=>{}}),Uwe=async e=>{const t=await fetch("http://localhost:3001/tasksync/api/v1/tasks",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Erreur lors de la récupération des tâches");return await t.json()},jwe=({children:e})=>{const{user:t}=To(),[r,i]=pe.useState([]),n=Bc("token"),[s,a]=pe.useState(""),o=()=>{Bc("urlIcal")!==null&&Bc("urlIcal")!==void 0&&Bc("urlIcal")!==""&&a(Bc("urlIcal"))},l=()=>{Uwe(n).then(u=>{console.log(u),u.status===1&&i(u.tasks)}).catch(u=>{console.error(u)})};return pe.useEffect(()=>{t!=null&&(n==null||n===""||(l(),o()))},[t]),ge(TV.Provider,{value:{tasks:r,getTasks:l,urlIcal:s,getUrlIcal:o},children:e})},N2=()=>pe.useContext(TV);const Hwe=""+new URL("icon-more-22292707.svg",import.meta.url).href,Vwe=""+new URL("icon-form1-b21ac0df.svg",import.meta.url).href,Wwe=""+new URL("icon-form2-758065b3.svg",import.meta.url).href,Gwe=()=>{const e=Bc("token"),{getTasks:t}=N2(),[r,i]=pe.useState(!1),n=pe.useRef(null),s=pe.useRef(null);return pe.useEffect(()=>{if(r){const o=new Date,l=new Date(o);l.setDate(l.getDate()+1);const u=l.getDate(),h=l.getMonth()+1,d=l.getFullYear()+"-"+(h<10?"0"+h:h)+"-"+(u<10?"0"+u:u);n.current.value=d,n.current.min=d,s.current.addEventListener("click",p=>{p.target===s.current&&i(!1)}),document.querySelector("form").addEventListener("click",p=>{p.stopPropagation()})}},[r]),St("div",{className:"taskmenu",children:[St("div",{className:"taskmenu_container",children:[ge("div",{className:"taskmenu_left",children:St("button",{children:["Show: ",ge("span",{children:"All"})]})}),ge("div",{className:"taskmenu_right",children:St("ul",{children:[ge("li",{children:ge("button",{onClick:()=>i(!r),children:ge("img",{src:Hwe,alt:""})})}),ge("li",{children:ge("button",{children:ge("img",{src:Vwe,alt:""})})}),ge("li",{children:ge("button",{children:ge("img",{src:Wwe,alt:""})})})]})})]}),r&&ge(kB,{children:ge("div",{className:"taskmenu_modal",ref:s,children:ge("div",{className:"taskmenu_modal__container",children:St("form",{onSubmit:o=>{o.preventDefault();const l=o.target.tasks_name.value,u=o.target.tasks_description.value,h=o.target.tasks_date.value;if(l.trim()===""||u.trim()===""||h.trim()==="")return;const c=new Date(h);c.setDate(c.getDate()+1);const d=c.getDate(),f=c.getMonth()+1;let m=c.getFullYear()+"-"+(f<10?"0"+f:f)+"-"+(d<10?"0"+d:d);const g=new Date,v=g.getHours(),y=g.getMinutes();m+=` ${v}:${y}:00.000`;const x=o.target.tasks_color.value;fetch("http://localhost:3001/tasksync/api/v1/tasks/create",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({task_name:l,task_description:u,task_due_date:m,task_color:x})}).then(w=>{if(!w.ok)throw new Error("Erreur lors de la création de la tâche");t(),console.log(l,u,h),o.target.reset(),i(!1)})},children:[St("div",{className:"form_group",children:[ge("label",{htmlFor:"tasks_name",children:"Titre"}),ge("input",{type:"text",name:"tasks_name",id:"tasks_name"})]}),St("div",{className:"form_group",children:[ge("label",{htmlFor:"tasks_description",children:"Description"}),ge("input",{type:"text",name:"tasks_description",id:"tasks_description"})]}),St("div",{className:"form_group",children:[ge("label",{htmlFor:"tasks_color",children:"Task Color"}),St("select",{name:"tasks_color",id:"tasks_color",children:[ge("option",{value:"orange",children:"Orange"}),ge("option",{value:"blue",children:"Blue"}),ge("option",{value:"pink",children:"Pink"})]})]}),St("div",{className:"form_group",children:[ge("label",{htmlFor:"tasks_date",children:"Date"}),ge("input",{type:"date",name:"tasks_date",id:"tasks_date",ref:n})]}),ge("button",{type:"submit",children:"ADD TASK"})]})})})})]})};const Ywe=""+new URL("Meatballs_menu-e6589c4d.svg",import.meta.url).href,qwe=()=>{To();const{tasks:e}=N2(),t=r=>{console.log(r)};return St("div",{className:"mytasks",children:[e.length===0&&St("div",{className:"mytasks__empty",children:[ge("h2",{children:"You don't have any tasks yet"}),ge("p",{children:"Click on the button below to create your first task and start managing your time"})]}),e.length>0&&ge("ul",{children:e.map(r=>{let i=r.task_due_date,s=i.split("T")[0].split("-"),a=s[1],o="";switch(a){case"01":o="Jan";break;case"02":o="Fev";break;case"03":o="Mar";break;case"04":o="Avr";break;case"05":o="Mai";break;case"06":o="Jun";break;case"07":o="Jul";break;case"08":o="Aou";break;case"09":o="Sept";break;case"10":o="Oct";break;case"11":o="Nov";break;case"12":o="Dec";break;default:o="Invalid Month";break}let l=s[2],u=s[0],h=l+" "+o+" "+u,f=new Date().toISOString().split("T")[0].split("-"),p=f[0]+f[1]+f[2],g=i.split("T")[0].split("-"),y=g[0]+g[1]+g[2]-p;return ge("li",{children:St("div",{className:"mytasks__task",children:[ge("button",{className:"mytasks__task__interaction__btn",onClick:()=>t(r.task_uuid),children:ge("img",{src:Ywe,alt:"Options"})}),ge("div",{className:"mytasks__task__title",children:ge("h3",{children:r.task_name})}),ge("div",{className:"mytasks__task__date",children:ge("p",{children:h})}),St("div",{className:"mytasks__task__dayleft",style:{color:r.task_color},children:[St("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[ge("circle",{cx:"12",cy:"13",r:"7",stroke:r.task_color,strokeWidth:"2"}),ge("path",{d:"M5 5L3 7",stroke:r.task_color,strokeWidth:"2",strokeLinecap:"round"}),ge("path",{d:"M19 5L21 7",stroke:r.task_color,strokeWidth:"2",strokeLinecap:"round"}),ge("path",{d:"M9 11L11.8093 12.8729C11.9172 12.9448 12.0622 12.9223 12.1432 12.821L14 10.5",stroke:r.task_color,strokeWidth:"2",strokeLinecap:"round"})]}),St("span",{children:[y," days left"]})]}),St("div",{className:"mytasks__task__progression",children:[ge("div",{className:"mytasks__task__progression__bar",children:ge("div",{className:"mytasks__task__progression__bar__progress",style:{width:r.task_completed+"%",backgroundColor:r.task_color}})}),St("p",{children:[r.task_completed,"%"]})]}),ge("div",{className:"mytasks__task__description",children:ge("p",{children:r.task_description})})]})},r.id)})})]})};const Xwe=()=>(yb(),St("div",{className:"view__dashboard",children:[ge(xb,{}),St("div",{className:"view__dashboard__content",children:[ge(wb,{}),ge(Gwe,{}),ge(qwe,{})]})]}));function Bl(e){"@babel/helpers - typeof";return Bl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bl(e)}function $we(e,t){if(Bl(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Bl(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function CV(e){var t=$we(e,"string");return Bl(t)==="symbol"?t:String(t)}function Eu(e,t,r){return t=CV(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,i)}return r}function vr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uN(Object(r),!0).forEach(function(i){Eu(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uN(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bb(e,t){if(e==null)return{};var r={},i=Object.keys(e),n,s;for(s=0;s<i.length;s++)n=i[s],!(t.indexOf(n)>=0)&&(r[n]=e[n]);return r}function So(e,t){if(e==null)return{};var r=bb(e,t),i,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function Ui(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cN(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,CV(i.key),i)}}function ji(e,t,r){return t&&cN(e.prototype,t),r&&cN(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function aw(e,t){return aw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},aw(e,t)}function Ln(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aw(e,t)}function ow(e){return ow=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ow(e)}function Qwe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function DV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kwe(e,t){if(t&&(Bl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DV(e)}function In(e){var t=Qwe();return function(){var i=ow(e),n;if(t){var s=ow(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return Kwe(this,n)}}function PV(e){if(Array.isArray(e))return e}function Zwe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,n,s,a,o=[],l=!0,u=!1;try{if(s=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(i=s.call(r)).done)&&(o.push(i.value),o.length!==t);l=!0);}catch(h){u=!0,n=h}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw n}}return o}}function zT(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function B2(e,t){if(e){if(typeof e=="string")return zT(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zT(e,t)}}function OV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gl(e,t){return PV(e)||Zwe(e,t)||B2(e,t)||OV()}function qr(){return qr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},qr.apply(this,arguments)}var Jwe=function(e,t,r,i,n,s,a,o){if(!e){var l;if(t===void 0)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,i,n,s,a,o],h=0;l=new Error(t.replace(/%s/g,function(){return u[h++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}},ebe=Jwe;const cv=sp(ebe);var tbe=function(){};function rbe(e,t){var r={};return Object.keys(e).forEach(function(i){r[P1(i)]=tbe}),r}function hN(e,t){return e[t]!==void 0}function P1(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function ibe(e){return!!e&&(typeof e!="function"||e.prototype&&e.prototype.isReactComponent)}function nbe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,aw(e,t)}function LV(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);e!=null&&this.setState(e)}function IV(e){function t(r){var i=this.constructor.getDerivedStateFromProps(e,r);return i??null}this.setState(t.bind(this))}function RV(e,t){try{var r=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(r,i)}finally{this.props=r,this.state=i}}LV.__suppressDeprecationWarning=!0;IV.__suppressDeprecationWarning=!0;RV.__suppressDeprecationWarning=!0;function sbe(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if(typeof e.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function")return e;var r=null,i=null,n=null;if(typeof t.componentWillMount=="function"?r="componentWillMount":typeof t.UNSAFE_componentWillMount=="function"&&(r="UNSAFE_componentWillMount"),typeof t.componentWillReceiveProps=="function"?i="componentWillReceiveProps":typeof t.UNSAFE_componentWillReceiveProps=="function"&&(i="UNSAFE_componentWillReceiveProps"),typeof t.componentWillUpdate=="function"?n="componentWillUpdate":typeof t.UNSAFE_componentWillUpdate=="function"&&(n="UNSAFE_componentWillUpdate"),r!==null||i!==null||n!==null){var s=e.displayName||e.name,a=typeof e.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+s+" uses "+a+" but also contains the following legacy lifecycles:"+(r!==null?`
  `+r:"")+(i!==null?`
  `+i:"")+(n!==null?`
  `+n:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof e.getDerivedStateFromProps=="function"&&(t.componentWillMount=LV,t.componentWillReceiveProps=IV),typeof t.getSnapshotBeforeUpdate=="function"){if(typeof t.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=RV;var o=t.componentDidUpdate;t.componentDidUpdate=function(u,h,c){var d=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:c;o.call(this,u,h,d)}}return e}var abe="/Users/jquense/src/uncontrollable/src/uncontrollable.js";function kV(e,t,r){r===void 0&&(r=[]);var i=e.displayName||e.name||"Component",n=ibe(e),s=Object.keys(t),a=s.map(P1);n||!r.length||cv(!1);var o=function(u){nbe(h,u);function h(){for(var d,f=arguments.length,p=new Array(f),m=0;m<f;m++)p[m]=arguments[m];d=u.call.apply(u,[this].concat(p))||this,d.handlers=Object.create(null),s.forEach(function(v){var y=t[v],x=function(S){if(d.props[y]){var _;d._notifying=!0;for(var A=arguments.length,M=new Array(A>1?A-1:0),T=1;T<A;T++)M[T-1]=arguments[T];(_=d.props)[y].apply(_,[S].concat(M)),d._notifying=!1}d.unmounted||d.setState(function(C){var L,I=C.values;return{values:qr(Object.create(null),I,(L={},L[v]=S,L))}})};d.handlers[y]=x}),r.length&&(d.attachRef=function(v){d.inner=v});var g=Object.create(null);return s.forEach(function(v){g[v]=d.props[P1(v)]}),d.state={values:g,prevProps:{}},d}var c=h.prototype;return c.shouldComponentUpdate=function(){return!this._notifying},h.getDerivedStateFromProps=function(f,p){var m=p.values,g=p.prevProps,v={values:qr(Object.create(null),m),prevProps:{}};return s.forEach(function(y){v.prevProps[y]=f[y],!hN(f,y)&&hN(g,y)&&(v.values[y]=f[P1(y)])}),v},c.componentWillUnmount=function(){this.unmounted=!0},c.render=function(){var f=this,p=this.props,m=p.innerRef,g=bb(p,["innerRef"]);a.forEach(function(y){delete g[y]});var v={};return s.forEach(function(y){var x=f.props[y];v[y]=x!==void 0?x:f.state.values[y]}),fe.createElement(e,qr({},g,v,this.handlers,{ref:m||this.attachRef}))},h}(fe.Component);sbe(o),o.displayName="Uncontrolled("+i+")",o.propTypes=qr({innerRef:function(){}},rbe(t)),r.forEach(function(u){o.prototype[u]=function(){var c;return(c=this.inner)[u].apply(c,arguments)}});var l=o;return fe.forwardRef&&(l=fe.forwardRef(function(u,h){return fe.createElement(o,qr({},u,{innerRef:h,__source:{fileName:abe,lineNumber:128},__self:this}))}),l.propTypes=o.propTypes),l.ControlledComponent=e,l.deferControlTo=function(u,h,c){return h===void 0&&(h={}),kV(u,qr({},t,h),c)},l}function zV(e){var t,r,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=zV(e[t]))&&(i&&(i+=" "),i+=r);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}function Ai(){for(var e,t,r=0,i="";r<arguments.length;)(e=arguments[r++])&&(t=zV(e))&&(i&&(i+=" "),i+=t);return i}var NV={exports:{}},obe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",lbe=obe,ube=lbe;function BV(){}function FV(){}FV.resetWarningCache=BV;var cbe=function(){function e(i,n,s,a,o,l){if(l!==ube){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:FV,resetWarningCache:BV};return r.PropTypes=r,r};NV.exports=cbe();var hbe=NV.exports;const Ue=sp(hbe);var UV="milliseconds",F2="seconds",U2="minutes",j2="hours",hv="day",lw="week",H2="month",V2="year",uw="decade",cw="century",jV={milliseconds:1,seconds:1e3,minutes:60*1e3,hours:60*60*1e3,day:24*60*60*1e3,week:7*24*60*60*1e3},dbe={month:1,year:12,decade:10*12,century:100*12};function fbe(e){return[31,pbe(e),31,30,31,30,31,31,30,31,30,31]}function pbe(e){return e%4===0&&e%100!==0||e%400===0?29:28}function nc(e,t,r){switch(e=new Date(e),r){case UV:case F2:case U2:case j2:case hv:case lw:return mbe(e,t*jV[r]);case H2:case V2:case uw:case cw:return gbe(e,t*dbe[r])}throw new TypeError('Invalid units: "'+r+'"')}function mbe(e,t){var r=new Date(+e+t);return vbe(e,r)}function gbe(e,t){var r=e.getFullYear(),i=e.getMonth(),n=e.getDate(),s=r*12+i+t,a=Math.trunc(s/12),o=s%12,l=Math.min(n,fbe(a)[o]),u=new Date(e);return u.setFullYear(a),u.setDate(1),u.setMonth(o),u.setDate(l),u}function vbe(e,t){var r=e.getTimezoneOffset(),i=t.getTimezoneOffset(),n=i-r;return new Date(+t+n*jV.minutes)}function hw(e,t,r){return nc(e,-t,r)}function rs(e,t,r){switch(e=new Date(e),t){case cw:case uw:case V2:e=Sbe(e,0);case H2:e=_be(e,1);case lw:case hv:e=pw(e,0);case j2:e=dv(e,0);case U2:e=fw(e,0);case F2:e=dw(e,0)}return t===uw&&(e=hw(e,dN(e)%10,"year")),t===cw&&(e=hw(e,dN(e)%100,"year")),t===lw&&(e=Mbe(e,0,r)),e}function NT(e,t,r){switch(e=new Date(e),e=rs(e,t,r),t){case cw:case uw:case V2:case H2:case lw:e=nc(e,1,t),e=hw(e,1,hv),e.setHours(23,59,59,999);break;case hv:e.setHours(23,59,59,999);break;case j2:case U2:case F2:e=nc(e,1,t),e=hw(e,1,UV)}return e}var _b=Pp(function(e,t){return e===t}),HV=Pp(function(e,t){return e!==t}),W2=Pp(function(e,t){return e>t}),Sb=Pp(function(e,t){return e>=t}),VV=Pp(function(e,t){return e<t}),qv=Pp(function(e,t){return e<=t});function ybe(){return new Date(Math.min.apply(Math,arguments))}function xbe(){return new Date(Math.max.apply(Math,arguments))}function wbe(e,t,r,i){return i=i||"day",(!t||Sb(e,t,i))&&(!r||qv(e,r,i))}var dw=mc("Milliseconds"),fw=mc("Seconds"),dv=mc("Minutes"),pw=mc("Hours"),bbe=mc("Day"),_be=mc("Date"),Sbe=mc("Month"),dN=mc("FullYear");function Mbe(e,t,r){var i=(bbe(e)+7-(r||0))%7;return t===void 0?i:nc(e,t-i,hv)}function mc(e){var t=function(r){switch(r){case"Milliseconds":return 36e5;case"Seconds":return 3600;case"Minutes":return 60;case"Hours":return 1;default:return null}}(e);return function(r,i){if(i===void 0)return r["get"+e]();var n=new Date(r);return n["set"+e](i),t&&n["get"+e]()!=i&&(e==="Hours"||i>=t&&n.getHours()-r.getHours()<Math.floor(i/t))&&n["set"+e](i+t),n}}function Pp(e){return function(t,r,i){return e(+rs(t,i),+rs(r,i))}}function Ebe(e){if(Array.isArray(e))return zT(e)}function WV(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Abe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tbe(e){return Ebe(e)||WV(e)||B2(e)||Abe()}function GV(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),r=r>n?n:r,r<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(n);++i<n;)s[i]=e[i+t];return s}function Xv(e,t){return e===t||e!==e&&t!==t}var Cbe=typeof global=="object"&&global&&global.Object===Object&&global;const YV=Cbe;var Dbe=typeof self=="object"&&self&&self.Object===Object&&self,Pbe=YV||Dbe||Function("return this")();const Lo=Pbe;var Obe=Lo.Symbol;const Ks=Obe;var qV=Object.prototype,Lbe=qV.hasOwnProperty,Ibe=qV.toString,Lm=Ks?Ks.toStringTag:void 0;function Rbe(e){var t=Lbe.call(e,Lm),r=e[Lm];try{e[Lm]=void 0;var i=!0}catch{}var n=Ibe.call(e);return i&&(t?e[Lm]=r:delete e[Lm]),n}var kbe=Object.prototype,zbe=kbe.toString;function Nbe(e){return zbe.call(e)}var Bbe="[object Null]",Fbe="[object Undefined]",fN=Ks?Ks.toStringTag:void 0;function Nh(e){return e==null?e===void 0?Fbe:Bbe:fN&&fN in Object(e)?Rbe(e):Nbe(e)}function Mo(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ube="[object AsyncFunction]",jbe="[object Function]",Hbe="[object GeneratorFunction]",Vbe="[object Proxy]";function G2(e){if(!Mo(e))return!1;var t=Nh(e);return t==jbe||t==Hbe||t==Ube||t==Vbe}var Wbe=9007199254740991;function Y2(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Wbe}function $v(e){return e!=null&&Y2(e.length)&&!G2(e)}var Gbe=9007199254740991,Ybe=/^(?:0|[1-9]\d*)$/;function q2(e,t){var r=typeof e;return t=t??Gbe,!!t&&(r=="number"||r!="symbol"&&Ybe.test(e))&&e>-1&&e%1==0&&e<t}function fv(e,t,r){if(!Mo(r))return!1;var i=typeof t;return(i=="number"?$v(r)&&q2(t,r.length):i=="string"&&t in r)?Xv(r[t],e):!1}var qbe=/\s/;function Xbe(e){for(var t=e.length;t--&&qbe.test(e.charAt(t)););return t}var $be=/^\s+/;function Qbe(e){return e&&e.slice(0,Xbe(e)+1).replace($be,"")}function Fl(e){return e!=null&&typeof e=="object"}var Kbe="[object Symbol]";function Jf(e){return typeof e=="symbol"||Fl(e)&&Nh(e)==Kbe}var pN=0/0,Zbe=/^[-+]0x[0-9a-f]+$/i,Jbe=/^0b[01]+$/i,e_e=/^0o[0-7]+$/i,t_e=parseInt;function r_e(e){if(typeof e=="number")return e;if(Jf(e))return pN;if(Mo(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Mo(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Qbe(e);var r=Jbe.test(e);return r||e_e.test(e)?t_e(e.slice(2),r?2:8):Zbe.test(e)?pN:+e}var mN=1/0,i_e=17976931348623157e292;function O1(e){if(!e)return e===0?e:0;if(e=r_e(e),e===mN||e===-mN){var t=e<0?-1:1;return t*i_e}return e===e?e:0}function XV(e){var t=O1(e),r=t%1;return t===t?r?t-r:t:0}var n_e=Math.ceil,s_e=Math.max;function a_e(e,t,r){(r?fv(e,t,r):t===void 0)?t=1:t=s_e(XV(t),0);var i=e==null?0:e.length;if(!i||t<1)return[];for(var n=0,s=0,a=Array(n_e(i/t));n<i;)a[s++]=GV(e,n,n+=t);return a}function Qv(e){return e&&e.ownerDocument||document}function o_e(e){var t=Qv(e);return t&&t.defaultView||window}function l_e(e,t){return o_e(e).getComputedStyle(e,t)}var u_e=/([A-Z])/g;function c_e(e){return e.replace(u_e,"-$1").toLowerCase()}var h_e=/^ms-/;function e1(e){return c_e(e).replace(h_e,"-ms-")}var d_e=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function f_e(e){return!!(e&&d_e.test(e))}function Rd(e,t){var r="",i="";if(typeof t=="string")return e.style.getPropertyValue(e1(t))||l_e(e).getPropertyValue(e1(t));Object.keys(t).forEach(function(n){var s=t[n];!s&&s!==0?e.style.removeProperty(e1(n)):f_e(n)?i+=n+"("+s+") ":r+=e1(n)+": "+s+";"}),i&&(r+="transform: "+i+";"),e.style.cssText+=";"+r}function pv(e,t){if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return e===t||!!(e.compareDocumentPosition(t)&16)}function p_e(e){return"nodeType"in e&&e.nodeType===document.DOCUMENT_NODE}function X2(e){return"window"in e&&e.window===e?e:p_e(e)&&e.defaultView||!1}function $V(e){var t=e==="pageXOffset"?"scrollLeft":"scrollTop";function r(i,n){var s=X2(i);if(n===void 0)return s?s[e]:i[t];s?s.scrollTo(s[e],n):i[t]=n}return r}const QV=$V("pageXOffset"),KV=$V("pageYOffset");function uh(e){var t=Qv(e),r={top:0,left:0,height:0,width:0},i=t&&t.documentElement;return!i||!pv(i,e)||(e.getBoundingClientRect!==void 0&&(r=e.getBoundingClientRect()),r={top:r.top+KV(i)-(i.clientTop||0),left:r.left+QV(i)-(i.clientLeft||0),width:r.width,height:r.height}),r}var m_e=function(t){return!!t&&"offsetParent"in t};function g_e(e){for(var t=Qv(e),r=e&&e.offsetParent;m_e(r)&&r.nodeName!=="HTML"&&Rd(r,"position")==="static";)r=r.offsetParent;return r||t.documentElement}var v_e=function(t){return t.nodeName&&t.nodeName.toLowerCase()};function ZV(e,t){var r={top:0,left:0},i;if(Rd(e,"position")==="fixed")i=e.getBoundingClientRect();else{var n=t||g_e(e);i=uh(e),v_e(n)!=="html"&&(r=uh(n));var s=String(Rd(n,"borderTopWidth")||0);r.top+=parseInt(s,10)-KV(n)||0;var a=String(Rd(n,"borderLeftWidth")||0);r.left+=parseInt(a,10)-QV(n)||0}var o=String(Rd(e,"marginTop")||0),l=String(Rd(e,"marginLeft")||0);return qr({},i,{top:i.top-r.top-(parseInt(o,10)||0),left:i.left-r.left-(parseInt(l,10)||0)})}const $2=!!(typeof window<"u"&&window.document&&window.document.createElement);var gN=new Date().getTime();function y_e(e){var t=new Date().getTime(),r=Math.max(0,16-(t-gN)),i=setTimeout(e,r);return gN=t,i}var x_e=["","webkit","moz","o","ms"],BT="clearTimeout",FT=y_e,vN=function(t,r){return t+(t?r[0].toUpperCase()+r.substr(1):r)+"AnimationFrame"};$2&&x_e.some(function(e){var t=vN(e,"request");return t in window&&(BT=vN(e,"cancel"),FT=function(i){return window[t](i)}),!!FT});var yN=function(t){typeof window[BT]=="function"&&window[BT](t)},JV=FT,NM;function w_e(e,t){if(!NM){var r=document.body,i=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector;NM=function(s,a){return i.call(s,a)}}return NM(e,t)}var b_e=Function.prototype.bind.call(Function.prototype.call,[].slice);function __e(e,t){return b_e(e.querySelectorAll(t))}var UT=!1,jT=!1;try{var BM={get passive(){return UT=!0},get once(){return jT=UT=!0}};$2&&(window.addEventListener("test",BM,BM),window.removeEventListener("test",BM,!0))}catch{}function S_e(e,t,r,i){if(i&&typeof i!="boolean"&&!jT){var n=i.once,s=i.capture,a=r;!jT&&n&&(a=r.__once||function o(l){this.removeEventListener(t,o,s),r.call(this,l)},r.__once=a),e.addEventListener(t,a,UT?i:s)}e.addEventListener(t,r,i)}function M_e(e){const t=pe.useRef(e);return pe.useEffect(()=>{t.current=e},[e]),t}function xN(e){const t=M_e(e);return pe.useCallback(function(...r){return t.current&&t.current(...r)},[t])}function wN(){return pe.useState(null)}function E_e(){const e=pe.useRef(!0),t=pe.useRef(()=>e.current);return pe.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),t.current}function A_e(e){const t=E_e();return[e[0],pe.useCallback(r=>{if(t())return e[1](r)},[t,e[1]])]}var Kn="top",Zs="bottom",Js="right",Zn="left",Q2="auto",Kv=[Kn,Zs,Js,Zn],ep="start",mv="end",T_e="clippingParents",eW="viewport",Im="popper",C_e="reference",bN=Kv.reduce(function(e,t){return e.concat([t+"-"+ep,t+"-"+mv])},[]),K2=[].concat(Kv,[Q2]).reduce(function(e,t){return e.concat([t,t+"-"+ep,t+"-"+mv])},[]),D_e="beforeRead",P_e="read",O_e="afterRead",L_e="beforeMain",I_e="main",R_e="afterMain",k_e="beforeWrite",z_e="write",N_e="afterWrite",B_e=[D_e,P_e,O_e,L_e,I_e,R_e,k_e,z_e,N_e];function mo(e){return e.split("-")[0]}function ws(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Ah(e){var t=ws(e).Element;return e instanceof t||e instanceof Element}function go(e){var t=ws(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function Z2(e){if(typeof ShadowRoot>"u")return!1;var t=ws(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var ch=Math.max,mw=Math.min,tp=Math.round;function HT(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function tW(){return!/^((?!chrome|android).)*safari/i.test(HT())}function rp(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var i=e.getBoundingClientRect(),n=1,s=1;t&&go(e)&&(n=e.offsetWidth>0&&tp(i.width)/e.offsetWidth||1,s=e.offsetHeight>0&&tp(i.height)/e.offsetHeight||1);var a=Ah(e)?ws(e):window,o=a.visualViewport,l=!tW()&&r,u=(i.left+(l&&o?o.offsetLeft:0))/n,h=(i.top+(l&&o?o.offsetTop:0))/s,c=i.width/n,d=i.height/s;return{width:c,height:d,top:h,right:u+c,bottom:h+d,left:u,x:u,y:h}}function J2(e){var t=rp(e),r=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:i}}function rW(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&Z2(r)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function sc(e){return e?(e.nodeName||"").toLowerCase():null}function Ul(e){return ws(e).getComputedStyle(e)}function F_e(e){return["table","td","th"].indexOf(sc(e))>=0}function gc(e){return((Ah(e)?e.ownerDocument:e.document)||window.document).documentElement}function Mb(e){return sc(e)==="html"?e:e.assignedSlot||e.parentNode||(Z2(e)?e.host:null)||gc(e)}function _N(e){return!go(e)||Ul(e).position==="fixed"?null:e.offsetParent}function U_e(e){var t=/firefox/i.test(HT()),r=/Trident/i.test(HT());if(r&&go(e)){var i=Ul(e);if(i.position==="fixed")return null}var n=Mb(e);for(Z2(n)&&(n=n.host);go(n)&&["html","body"].indexOf(sc(n))<0;){var s=Ul(n);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||t&&s.willChange==="filter"||t&&s.filter&&s.filter!=="none")return n;n=n.parentNode}return null}function Zv(e){for(var t=ws(e),r=_N(e);r&&F_e(r)&&Ul(r).position==="static";)r=_N(r);return r&&(sc(r)==="html"||sc(r)==="body"&&Ul(r).position==="static")?t:r||U_e(e)||t}function eP(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function _g(e,t,r){return ch(e,mw(t,r))}function j_e(e,t,r){var i=_g(e,t,r);return i>r?r:i}function iW(){return{top:0,right:0,bottom:0,left:0}}function nW(e){return Object.assign({},iW(),e)}function sW(e,t){return t.reduce(function(r,i){return r[i]=e,r},{})}var H_e=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,nW(typeof t!="number"?t:sW(t,Kv))};function V_e(e){var t,r=e.state,i=e.name,n=e.options,s=r.elements.arrow,a=r.modifiersData.popperOffsets,o=mo(r.placement),l=eP(o),u=[Zn,Js].indexOf(o)>=0,h=u?"height":"width";if(!(!s||!a)){var c=H_e(n.padding,r),d=J2(s),f=l==="y"?Kn:Zn,p=l==="y"?Zs:Js,m=r.rects.reference[h]+r.rects.reference[l]-a[l]-r.rects.popper[h],g=a[l]-r.rects.reference[l],v=Zv(s),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,x=m/2-g/2,w=c[f],S=y-d[h]-c[p],_=y/2-d[h]/2+x,A=_g(w,_,S),M=l;r.modifiersData[i]=(t={},t[M]=A,t.centerOffset=A-_,t)}}function W_e(e){var t=e.state,r=e.options,i=r.element,n=i===void 0?"[data-popper-arrow]":i;n!=null&&(typeof n=="string"&&(n=t.elements.popper.querySelector(n),!n)||rW(t.elements.popper,n)&&(t.elements.arrow=n))}const G_e={name:"arrow",enabled:!0,phase:"main",fn:V_e,effect:W_e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ip(e){return e.split("-")[1]}var Y_e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function q_e(e,t){var r=e.x,i=e.y,n=t.devicePixelRatio||1;return{x:tp(r*n)/n||0,y:tp(i*n)/n||0}}function SN(e){var t,r=e.popper,i=e.popperRect,n=e.placement,s=e.variation,a=e.offsets,o=e.position,l=e.gpuAcceleration,u=e.adaptive,h=e.roundOffsets,c=e.isFixed,d=a.x,f=d===void 0?0:d,p=a.y,m=p===void 0?0:p,g=typeof h=="function"?h({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var v=a.hasOwnProperty("x"),y=a.hasOwnProperty("y"),x=Zn,w=Kn,S=window;if(u){var _=Zv(r),A="clientHeight",M="clientWidth";if(_===ws(r)&&(_=gc(r),Ul(_).position!=="static"&&o==="absolute"&&(A="scrollHeight",M="scrollWidth")),_=_,n===Kn||(n===Zn||n===Js)&&s===mv){w=Zs;var T=c&&_===S&&S.visualViewport?S.visualViewport.height:_[A];m-=T-i.height,m*=l?1:-1}if(n===Zn||(n===Kn||n===Zs)&&s===mv){x=Js;var C=c&&_===S&&S.visualViewport?S.visualViewport.width:_[M];f-=C-i.width,f*=l?1:-1}}var L=Object.assign({position:o},u&&Y_e),I=h===!0?q_e({x:f,y:m},ws(r)):{x:f,y:m};if(f=I.x,m=I.y,l){var k;return Object.assign({},L,(k={},k[w]=y?"0":"",k[x]=v?"0":"",k.transform=(S.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",k))}return Object.assign({},L,(t={},t[w]=y?m+"px":"",t[x]=v?f+"px":"",t.transform="",t))}function X_e(e){var t=e.state,r=e.options,i=r.gpuAcceleration,n=i===void 0?!0:i,s=r.adaptive,a=s===void 0?!0:s,o=r.roundOffsets,l=o===void 0?!0:o,u={placement:mo(t.placement),variation:ip(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,SN(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,SN(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const $_e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:X_e,data:{}};var t1={passive:!0};function Q_e(e){var t=e.state,r=e.instance,i=e.options,n=i.scroll,s=n===void 0?!0:n,a=i.resize,o=a===void 0?!0:a,l=ws(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&u.forEach(function(h){h.addEventListener("scroll",r.update,t1)}),o&&l.addEventListener("resize",r.update,t1),function(){s&&u.forEach(function(h){h.removeEventListener("scroll",r.update,t1)}),o&&l.removeEventListener("resize",r.update,t1)}}const K_e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Q_e,data:{}};var Z_e={left:"right",right:"left",bottom:"top",top:"bottom"};function L1(e){return e.replace(/left|right|bottom|top/g,function(t){return Z_e[t]})}var J_e={start:"end",end:"start"};function MN(e){return e.replace(/start|end/g,function(t){return J_e[t]})}function tP(e){var t=ws(e),r=t.pageXOffset,i=t.pageYOffset;return{scrollLeft:r,scrollTop:i}}function rP(e){return rp(gc(e)).left+tP(e).scrollLeft}function eSe(e,t){var r=ws(e),i=gc(e),n=r.visualViewport,s=i.clientWidth,a=i.clientHeight,o=0,l=0;if(n){s=n.width,a=n.height;var u=tW();(u||!u&&t==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:s,height:a,x:o+rP(e),y:l}}function tSe(e){var t,r=gc(e),i=tP(e),n=(t=e.ownerDocument)==null?void 0:t.body,s=ch(r.scrollWidth,r.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),a=ch(r.scrollHeight,r.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-i.scrollLeft+rP(e),l=-i.scrollTop;return Ul(n||r).direction==="rtl"&&(o+=ch(r.clientWidth,n?n.clientWidth:0)-s),{width:s,height:a,x:o,y:l}}function iP(e){var t=Ul(e),r=t.overflow,i=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+n+i)}function aW(e){return["html","body","#document"].indexOf(sc(e))>=0?e.ownerDocument.body:go(e)&&iP(e)?e:aW(Mb(e))}function Sg(e,t){var r;t===void 0&&(t=[]);var i=aW(e),n=i===((r=e.ownerDocument)==null?void 0:r.body),s=ws(i),a=n?[s].concat(s.visualViewport||[],iP(i)?i:[]):i,o=t.concat(a);return n?o:o.concat(Sg(Mb(a)))}function VT(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function rSe(e,t){var r=rp(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function EN(e,t,r){return t===eW?VT(eSe(e,r)):Ah(t)?rSe(t,r):VT(tSe(gc(e)))}function iSe(e){var t=Sg(Mb(e)),r=["absolute","fixed"].indexOf(Ul(e).position)>=0,i=r&&go(e)?Zv(e):e;return Ah(i)?t.filter(function(n){return Ah(n)&&rW(n,i)&&sc(n)!=="body"}):[]}function nSe(e,t,r,i){var n=t==="clippingParents"?iSe(e):[].concat(t),s=[].concat(n,[r]),a=s[0],o=s.reduce(function(l,u){var h=EN(e,u,i);return l.top=ch(h.top,l.top),l.right=mw(h.right,l.right),l.bottom=mw(h.bottom,l.bottom),l.left=ch(h.left,l.left),l},EN(e,a,i));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function oW(e){var t=e.reference,r=e.element,i=e.placement,n=i?mo(i):null,s=i?ip(i):null,a=t.x+t.width/2-r.width/2,o=t.y+t.height/2-r.height/2,l;switch(n){case Kn:l={x:a,y:t.y-r.height};break;case Zs:l={x:a,y:t.y+t.height};break;case Js:l={x:t.x+t.width,y:o};break;case Zn:l={x:t.x-r.width,y:o};break;default:l={x:t.x,y:t.y}}var u=n?eP(n):null;if(u!=null){var h=u==="y"?"height":"width";switch(s){case ep:l[u]=l[u]-(t[h]/2-r[h]/2);break;case mv:l[u]=l[u]+(t[h]/2-r[h]/2);break}}return l}function gv(e,t){t===void 0&&(t={});var r=t,i=r.placement,n=i===void 0?e.placement:i,s=r.strategy,a=s===void 0?e.strategy:s,o=r.boundary,l=o===void 0?T_e:o,u=r.rootBoundary,h=u===void 0?eW:u,c=r.elementContext,d=c===void 0?Im:c,f=r.altBoundary,p=f===void 0?!1:f,m=r.padding,g=m===void 0?0:m,v=nW(typeof g!="number"?g:sW(g,Kv)),y=d===Im?C_e:Im,x=e.rects.popper,w=e.elements[p?y:d],S=nSe(Ah(w)?w:w.contextElement||gc(e.elements.popper),l,h,a),_=rp(e.elements.reference),A=oW({reference:_,element:x,strategy:"absolute",placement:n}),M=VT(Object.assign({},x,A)),T=d===Im?M:_,C={top:S.top-T.top+v.top,bottom:T.bottom-S.bottom+v.bottom,left:S.left-T.left+v.left,right:T.right-S.right+v.right},L=e.modifiersData.offset;if(d===Im&&L){var I=L[n];Object.keys(C).forEach(function(k){var z=[Js,Zs].indexOf(k)>=0?1:-1,V=[Kn,Zs].indexOf(k)>=0?"y":"x";C[k]+=I[V]*z})}return C}function sSe(e,t){t===void 0&&(t={});var r=t,i=r.placement,n=r.boundary,s=r.rootBoundary,a=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?K2:l,h=ip(i),c=h?o?bN:bN.filter(function(p){return ip(p)===h}):Kv,d=c.filter(function(p){return u.indexOf(p)>=0});d.length===0&&(d=c);var f=d.reduce(function(p,m){return p[m]=gv(e,{placement:m,boundary:n,rootBoundary:s,padding:a})[mo(m)],p},{});return Object.keys(f).sort(function(p,m){return f[p]-f[m]})}function aSe(e){if(mo(e)===Q2)return[];var t=L1(e);return[MN(e),t,MN(t)]}function oSe(e){var t=e.state,r=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var n=r.mainAxis,s=n===void 0?!0:n,a=r.altAxis,o=a===void 0?!0:a,l=r.fallbackPlacements,u=r.padding,h=r.boundary,c=r.rootBoundary,d=r.altBoundary,f=r.flipVariations,p=f===void 0?!0:f,m=r.allowedAutoPlacements,g=t.options.placement,v=mo(g),y=v===g,x=l||(y||!p?[L1(g)]:aSe(g)),w=[g].concat(x).reduce(function(H,G){return H.concat(mo(G)===Q2?sSe(t,{placement:G,boundary:h,rootBoundary:c,padding:u,flipVariations:p,allowedAutoPlacements:m}):G)},[]),S=t.rects.reference,_=t.rects.popper,A=new Map,M=!0,T=w[0],C=0;C<w.length;C++){var L=w[C],I=mo(L),k=ip(L)===ep,z=[Kn,Zs].indexOf(I)>=0,V=z?"width":"height",K=gv(t,{placement:L,boundary:h,rootBoundary:c,altBoundary:d,padding:u}),q=z?k?Js:Zn:k?Zs:Kn;S[V]>_[V]&&(q=L1(q));var O=L1(q),W=[];if(s&&W.push(K[I]<=0),o&&W.push(K[q]<=0,K[O]<=0),W.every(function(H){return H})){T=L,M=!1;break}A.set(L,W)}if(M)for(var N=p?3:1,B=function(G){var $=w.find(function(se){var re=A.get(se);if(re)return re.slice(0,G).every(function(ae){return ae})});if($)return T=$,"break"},j=N;j>0;j--){var Q=B(j);if(Q==="break")break}t.placement!==T&&(t.modifiersData[i]._skip=!0,t.placement=T,t.reset=!0)}}const lSe={name:"flip",enabled:!0,phase:"main",fn:oSe,requiresIfExists:["offset"],data:{_skip:!1}};function AN(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function TN(e){return[Kn,Js,Zs,Zn].some(function(t){return e[t]>=0})}function uSe(e){var t=e.state,r=e.name,i=t.rects.reference,n=t.rects.popper,s=t.modifiersData.preventOverflow,a=gv(t,{elementContext:"reference"}),o=gv(t,{altBoundary:!0}),l=AN(a,i),u=AN(o,n,s),h=TN(l),c=TN(u);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:h,hasPopperEscaped:c},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":h,"data-popper-escaped":c})}const cSe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:uSe};function hSe(e,t,r){var i=mo(e),n=[Zn,Kn].indexOf(i)>=0?-1:1,s=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,a=s[0],o=s[1];return a=a||0,o=(o||0)*n,[Zn,Js].indexOf(i)>=0?{x:o,y:a}:{x:a,y:o}}function dSe(e){var t=e.state,r=e.options,i=e.name,n=r.offset,s=n===void 0?[0,0]:n,a=K2.reduce(function(h,c){return h[c]=hSe(c,t.rects,s),h},{}),o=a[t.placement],l=o.x,u=o.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=u),t.modifiersData[i]=a}const fSe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:dSe};function pSe(e){var t=e.state,r=e.name;t.modifiersData[r]=oW({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const mSe={name:"popperOffsets",enabled:!0,phase:"read",fn:pSe,data:{}};function gSe(e){return e==="x"?"y":"x"}function vSe(e){var t=e.state,r=e.options,i=e.name,n=r.mainAxis,s=n===void 0?!0:n,a=r.altAxis,o=a===void 0?!1:a,l=r.boundary,u=r.rootBoundary,h=r.altBoundary,c=r.padding,d=r.tether,f=d===void 0?!0:d,p=r.tetherOffset,m=p===void 0?0:p,g=gv(t,{boundary:l,rootBoundary:u,padding:c,altBoundary:h}),v=mo(t.placement),y=ip(t.placement),x=!y,w=eP(v),S=gSe(w),_=t.modifiersData.popperOffsets,A=t.rects.reference,M=t.rects.popper,T=typeof m=="function"?m(Object.assign({},t.rects,{placement:t.placement})):m,C=typeof T=="number"?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),L=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,I={x:0,y:0};if(_){if(s){var k,z=w==="y"?Kn:Zn,V=w==="y"?Zs:Js,K=w==="y"?"height":"width",q=_[w],O=q+g[z],W=q-g[V],N=f?-M[K]/2:0,B=y===ep?A[K]:M[K],j=y===ep?-M[K]:-A[K],Q=t.elements.arrow,H=f&&Q?J2(Q):{width:0,height:0},G=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:iW(),$=G[z],se=G[V],re=_g(0,A[K],H[K]),ae=x?A[K]/2-N-re-$-C.mainAxis:B-re-$-C.mainAxis,ce=x?-A[K]/2+N+re+se+C.mainAxis:j+re+se+C.mainAxis,me=t.elements.arrow&&Zv(t.elements.arrow),be=me?w==="y"?me.clientTop||0:me.clientLeft||0:0,Ae=(k=L==null?void 0:L[w])!=null?k:0,$e=q+ae-Ae-be,Le=q+ce-Ae,Qe=_g(f?mw(O,$e):O,q,f?ch(W,Le):W);_[w]=Qe,I[w]=Qe-q}if(o){var Xe,Re=w==="x"?Kn:Zn,Ie=w==="x"?Zs:Js,Ge=_[S],He=S==="y"?"height":"width",Y=Ge+g[Re],U=Ge-g[Ie],he=[Kn,Zn].indexOf(v)!==-1,Ee=(Xe=L==null?void 0:L[S])!=null?Xe:0,Ce=he?Y:Ge-A[He]-M[He]-Ee+C.altAxis,ke=he?Ge+A[He]+M[He]-Ee-C.altAxis:U,Ye=f&&he?j_e(Ce,Ge,ke):_g(f?Ce:Y,Ge,f?ke:U);_[S]=Ye,I[S]=Ye-Ge}t.modifiersData[i]=I}}const ySe={name:"preventOverflow",enabled:!0,phase:"main",fn:vSe,requiresIfExists:["offset"]};function xSe(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function wSe(e){return e===ws(e)||!go(e)?tP(e):xSe(e)}function bSe(e){var t=e.getBoundingClientRect(),r=tp(t.width)/e.offsetWidth||1,i=tp(t.height)/e.offsetHeight||1;return r!==1||i!==1}function _Se(e,t,r){r===void 0&&(r=!1);var i=go(t),n=go(t)&&bSe(t),s=gc(t),a=rp(e,n,r),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!r)&&((sc(t)!=="body"||iP(s))&&(o=wSe(t)),go(t)?(l=rp(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):s&&(l.x=rP(s))),{x:a.left+o.scrollLeft-l.x,y:a.top+o.scrollTop-l.y,width:a.width,height:a.height}}function SSe(e){var t=new Map,r=new Set,i=[];e.forEach(function(s){t.set(s.name,s)});function n(s){r.add(s.name);var a=[].concat(s.requires||[],s.requiresIfExists||[]);a.forEach(function(o){if(!r.has(o)){var l=t.get(o);l&&n(l)}}),i.push(s)}return e.forEach(function(s){r.has(s.name)||n(s)}),i}function MSe(e){var t=SSe(e);return B_e.reduce(function(r,i){return r.concat(t.filter(function(n){return n.phase===i}))},[])}function ESe(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function ASe(e){var t=e.reduce(function(r,i){var n=r[i.name];return r[i.name]=n?Object.assign({},n,i,{options:Object.assign({},n.options,i.options),data:Object.assign({},n.data,i.data)}):i,r},{});return Object.keys(t).map(function(r){return t[r]})}var CN={placement:"bottom",modifiers:[],strategy:"absolute"};function DN(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function TSe(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,i=r===void 0?[]:r,n=t.defaultOptions,s=n===void 0?CN:n;return function(o,l,u){u===void 0&&(u=s);var h={placement:"bottom",orderedModifiers:[],options:Object.assign({},CN,s),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},c=[],d=!1,f={state:h,setOptions:function(v){var y=typeof v=="function"?v(h.options):v;m(),h.options=Object.assign({},s,h.options,y),h.scrollParents={reference:Ah(o)?Sg(o):o.contextElement?Sg(o.contextElement):[],popper:Sg(l)};var x=MSe(ASe([].concat(i,h.options.modifiers)));return h.orderedModifiers=x.filter(function(w){return w.enabled}),p(),f.update()},forceUpdate:function(){if(!d){var v=h.elements,y=v.reference,x=v.popper;if(DN(y,x)){h.rects={reference:_Se(y,Zv(x),h.options.strategy==="fixed"),popper:J2(x)},h.reset=!1,h.placement=h.options.placement,h.orderedModifiers.forEach(function(C){return h.modifiersData[C.name]=Object.assign({},C.data)});for(var w=0;w<h.orderedModifiers.length;w++){if(h.reset===!0){h.reset=!1,w=-1;continue}var S=h.orderedModifiers[w],_=S.fn,A=S.options,M=A===void 0?{}:A,T=S.name;typeof _=="function"&&(h=_({state:h,options:M,name:T,instance:f})||h)}}}},update:ESe(function(){return new Promise(function(g){f.forceUpdate(),g(h)})}),destroy:function(){m(),d=!0}};if(!DN(o,l))return f;f.setOptions(u).then(function(g){!d&&u.onFirstUpdate&&u.onFirstUpdate(g)});function p(){h.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,x=y===void 0?{}:y,w=g.effect;if(typeof w=="function"){var S=w({state:h,name:v,instance:f,options:x}),_=function(){};c.push(S||_)}})}function m(){c.forEach(function(g){return g()}),c=[]}return f}}var CSe=TSe({defaultModifiers:[cSe,mSe,$_e,K_e,fSe,lSe,ySe,G_e]}),PN=function(t){return{position:t,top:"0",left:"0",opacity:"0",pointerEvents:"none"}},DSe={name:"applyStyles",enabled:!1},PSe={name:"ariaDescribedBy",enabled:!0,phase:"afterWrite",effect:function(t){var r=t.state;return function(){var i=r.elements,n=i.reference,s=i.popper;if("removeAttribute"in n){var a=(n.getAttribute("aria-describedby")||"").split(",").filter(function(o){return o.trim()!==s.id});a.length?n.setAttribute("aria-describedby",a.join(",")):n.removeAttribute("aria-describedby")}}},fn:function(t){var r,i=t.state,n=i.elements,s=n.popper,a=n.reference,o=(r=s.getAttribute("role"))==null?void 0:r.toLowerCase();if(s.id&&o==="tooltip"&&"setAttribute"in a){var l=a.getAttribute("aria-describedby");if(l&&l.split(",").indexOf(s.id)!==-1)return;a.setAttribute("aria-describedby",l?l+","+s.id:s.id)}}},OSe=[];function LSe(e,t,r){var i=r===void 0?{}:r,n=i.enabled,s=n===void 0?!0:n,a=i.placement,o=a===void 0?"bottom":a,l=i.strategy,u=l===void 0?"absolute":l,h=i.modifiers,c=h===void 0?OSe:h,d=bb(i,["enabled","placement","strategy","modifiers"]),f=pe.useRef(),p=pe.useCallback(function(){var w;(w=f.current)==null||w.update()},[]),m=pe.useCallback(function(){var w;(w=f.current)==null||w.forceUpdate()},[]),g=A_e(pe.useState({placement:o,update:p,forceUpdate:m,attributes:{},styles:{popper:PN(u),arrow:{}}})),v=g[0],y=g[1],x=pe.useMemo(function(){return{name:"updateStateModifier",enabled:!0,phase:"write",requires:["computeStyles"],fn:function(S){var _=S.state,A={},M={};Object.keys(_.elements).forEach(function(T){A[T]=_.styles[T],M[T]=_.attributes[T]}),y({state:_,styles:A,attributes:M,update:p,forceUpdate:m,placement:_.placement})}}},[p,m,y]);return pe.useEffect(function(){!f.current||!s||f.current.setOptions({placement:o,strategy:u,modifiers:[].concat(c,[x,DSe])})},[u,o,x,s]),pe.useEffect(function(){if(!(!s||e==null||t==null))return f.current=CSe(e,t,qr({},d,{placement:o,strategy:u,modifiers:[].concat(c,[PSe,x])})),function(){f.current!=null&&(f.current.destroy(),f.current=void 0,y(function(w){return qr({},w,{attributes:{},styles:{popper:PN(u)}})}))}},[s,e,t]),v}function ISe(e,t,r,i){var n=i&&typeof i!="boolean"?i.capture:i;e.removeEventListener(t,r,n),r.__once&&e.removeEventListener(t,r.__once,n)}function $m(e,t,r,i){return S_e(e,t,r,i),function(){ISe(e,t,r,i)}}var RSe=function(){},kSe=RSe;const zSe=sp(kSe);function NSe(e){return e&&"setState"in e?UU.findDOMNode(e):e??null}const BSe=function(e){return Qv(NSe(e))};var FSe=27,ON=function(){};function USe(e){return e.button===0}function jSe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}var LN=function(t){return t&&("current"in t?t.current:t)};function HSe(e,t,r){var i=r===void 0?{}:r,n=i.disabled,s=i.clickTrigger,a=s===void 0?"click":s,o=pe.useRef(!1),l=t||ON,u=pe.useCallback(function(d){var f,p=LN(e);zSe(!!p,"RootClose captured a close event but does not have a ref to compare it to. useRootClose(), should be passed a ref that resolves to a DOM node"),o.current=!p||jSe(d)||!USe(d)||!!pv(p,(f=d.composedPath==null?void 0:d.composedPath()[0])!=null?f:d.target)},[e]),h=xN(function(d){o.current||l(d)}),c=xN(function(d){d.keyCode===FSe&&l(d)});pe.useEffect(function(){if(!(n||e==null)){var d=window.event,f=BSe(LN(e)),p=$m(f,a,u,!0),m=$m(f,a,function(y){if(y===d){d=void 0;return}h(y)}),g=$m(f,"keyup",function(y){if(y===d){d=void 0;return}c(y)}),v=[];return"ontouchstart"in f.documentElement&&(v=[].slice.call(f.body.children).map(function(y){return $m(y,"mousemove",ON)})),function(){p(),m(),g(),v.forEach(function(y){return y()})}}},[e,n,a,u,h,c])}function VSe(e){var t={};return Array.isArray(e)?(e==null||e.forEach(function(r){t[r.name]=r}),t):e||t}function WSe(e){return e===void 0&&(e={}),Array.isArray(e)?e:Object.keys(e).map(function(t){return e[t].name=t,e[t]})}function GSe(e){var t,r,i,n,s=e.enabled,a=e.enableEvents,o=e.placement,l=e.flip,u=e.offset,h=e.fixed,c=e.containerPadding,d=e.arrowElement,f=e.popperConfig,p=f===void 0?{}:f,m=VSe(p.modifiers);return qr({},p,{placement:o,enabled:s,strategy:h?"fixed":p.strategy,modifiers:WSe(qr({},m,{eventListeners:{enabled:a},preventOverflow:qr({},m.preventOverflow,{options:c?qr({padding:c},(t=m.preventOverflow)==null?void 0:t.options):(r=m.preventOverflow)==null?void 0:r.options}),offset:{options:qr({offset:u},(i=m.offset)==null?void 0:i.options)},arrow:qr({},m.arrow,{enabled:!!d,options:qr({},(n=m.arrow)==null?void 0:n.options,{element:d})}),flip:qr({enabled:!!l},m.flip)}))})}function YSe(e,t){return e.classList?!!t&&e.classList.contains(t):(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")!==-1}function qSe(e,t){e.classList?e.classList.add(t):YSe(e,t)||(typeof e.className=="string"?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}function IN(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function XSe(e,t){e.classList?e.classList.remove(t):typeof e.className=="string"?e.className=IN(e.className,t):e.setAttribute("class",IN(e.className&&e.className.baseVal||"",t))}var r1;function lW(e){if((!r1&&r1!==0||e)&&$2){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),r1=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return r1}var FM=function(t){var r;return typeof document>"u"?null:t==null?Qv().body:(typeof t=="function"&&(t=t()),t&&"current"in t&&(t=t.current),(r=t)!=null&&r.nodeType&&t||null)};function RN(e,t){var r=pe.useState(function(){return FM(e)}),i=r[0],n=r[1];if(!i){var s=FM(e);s&&n(s)}return pe.useEffect(function(){t&&i&&t(i)},[t,i]),pe.useEffect(function(){var a=FM(e);a!==i&&n(a)},[e,i]),i}const kN=e=>!e||typeof e=="function"?e:t=>{e.current=t};function $Se(e,t){const r=kN(e),i=kN(t);return n=>{r&&r(n),i&&i(n)}}function QSe(e,t){return pe.useMemo(()=>$Se(e,t),[e,t])}var nP=fe.forwardRef(function(e,t){var r=e.flip,i=e.offset,n=e.placement,s=e.containerPadding,a=s===void 0?5:s,o=e.popperConfig,l=o===void 0?{}:o,u=e.transition,h=wN(),c=h[0],d=h[1],f=wN(),p=f[0],m=f[1],g=QSe(d,t),v=RN(e.container),y=RN(e.target),x=pe.useState(!e.show),w=x[0],S=x[1],_=LSe(y,c,GSe({placement:n,enableEvents:!!e.show,containerPadding:a||5,flip:r,offset:i,arrowElement:p,popperConfig:l})),A=_.styles,M=_.attributes,T=bb(_,["styles","attributes"]);e.show?w&&S(!1):!e.transition&&!w&&S(!0);var C=function(){S(!0),e.onExited&&e.onExited.apply(e,arguments)},L=e.show||u&&!w;if(HSe(c,e.onHide,{disabled:!e.rootClose||e.rootCloseDisabled,clickTrigger:e.rootCloseEvent}),!L)return null;var I=e.children(qr({},T,{show:!!e.show,props:qr({},M.popper,{style:A.popper,ref:g}),arrowProps:qr({},M.arrow,{style:A.arrow,ref:m})}));if(u){var k=e.onExit,z=e.onExiting,V=e.onEnter,K=e.onEntering,q=e.onEntered;I=fe.createElement(u,{in:e.show,appear:!0,onExit:k,onExiting:z,onExited:C,onEnter:V,onEntering:K,onEntered:q},I)}return v?UU.createPortal(I,v):null});nP.displayName="Overlay";nP.propTypes={show:Ue.bool,placement:Ue.oneOf(K2),target:Ue.any,container:Ue.any,flip:Ue.bool,children:Ue.func.isRequired,containerPadding:Ue.number,popperConfig:Ue.object,rootClose:Ue.bool,rootCloseEvent:Ue.oneOf(["click","mousedown"]),rootCloseDisabled:Ue.bool,onHide:function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];if(t.rootClose){var s;return(s=Ue.func).isRequired.apply(s,[t].concat(i))}return Ue.func.apply(Ue,[t].concat(i))},transition:Ue.elementType,onEnter:Ue.func,onEntering:Ue.func,onEntered:Ue.func,onExit:Ue.func,onExiting:Ue.func,onExited:Ue.func};const KSe=nP;function ZSe(){this.__data__=[],this.size=0}function Eb(e,t){for(var r=e.length;r--;)if(Xv(e[r][0],t))return r;return-1}var JSe=Array.prototype,eMe=JSe.splice;function tMe(e){var t=this.__data__,r=Eb(t,e);if(r<0)return!1;var i=t.length-1;return r==i?t.pop():eMe.call(t,r,1),--this.size,!0}function rMe(e){var t=this.__data__,r=Eb(t,e);return r<0?void 0:t[r][1]}function iMe(e){return Eb(this.__data__,e)>-1}function nMe(e,t){var r=this.__data__,i=Eb(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}function Yl(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Yl.prototype.clear=ZSe;Yl.prototype.delete=tMe;Yl.prototype.get=rMe;Yl.prototype.has=iMe;Yl.prototype.set=nMe;function sMe(){this.__data__=new Yl,this.size=0}function aMe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function oMe(e){return this.__data__.get(e)}function lMe(e){return this.__data__.has(e)}var uMe=Lo["__core-js_shared__"];const UM=uMe;var zN=function(){var e=/[^.]+$/.exec(UM&&UM.keys&&UM.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function cMe(e){return!!zN&&zN in e}var hMe=Function.prototype,dMe=hMe.toString;function Bh(e){if(e!=null){try{return dMe.call(e)}catch{}try{return e+""}catch{}}return""}var fMe=/[\\^$.*+?()[\]{}|]/g,pMe=/^\[object .+?Constructor\]$/,mMe=Function.prototype,gMe=Object.prototype,vMe=mMe.toString,yMe=gMe.hasOwnProperty,xMe=RegExp("^"+vMe.call(yMe).replace(fMe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function wMe(e){if(!Mo(e)||cMe(e))return!1;var t=G2(e)?xMe:pMe;return t.test(Bh(e))}function bMe(e,t){return e==null?void 0:e[t]}function Fh(e,t){var r=bMe(e,t);return wMe(r)?r:void 0}var _Me=Fh(Lo,"Map");const vv=_Me;var SMe=Fh(Object,"create");const yv=SMe;function MMe(){this.__data__=yv?yv(null):{},this.size=0}function EMe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var AMe="__lodash_hash_undefined__",TMe=Object.prototype,CMe=TMe.hasOwnProperty;function DMe(e){var t=this.__data__;if(yv){var r=t[e];return r===AMe?void 0:r}return CMe.call(t,e)?t[e]:void 0}var PMe=Object.prototype,OMe=PMe.hasOwnProperty;function LMe(e){var t=this.__data__;return yv?t[e]!==void 0:OMe.call(t,e)}var IMe="__lodash_hash_undefined__";function RMe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=yv&&t===void 0?IMe:t,this}function Th(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Th.prototype.clear=MMe;Th.prototype.delete=EMe;Th.prototype.get=DMe;Th.prototype.has=LMe;Th.prototype.set=RMe;function kMe(){this.size=0,this.__data__={hash:new Th,map:new(vv||Yl),string:new Th}}function zMe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ab(e,t){var r=e.__data__;return zMe(t)?r[typeof t=="string"?"string":"hash"]:r.map}function NMe(e){var t=Ab(this,e).delete(e);return this.size-=t?1:0,t}function BMe(e){return Ab(this,e).get(e)}function FMe(e){return Ab(this,e).has(e)}function UMe(e,t){var r=Ab(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}function ql(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}ql.prototype.clear=kMe;ql.prototype.delete=NMe;ql.prototype.get=BMe;ql.prototype.has=FMe;ql.prototype.set=UMe;var jMe=200;function HMe(e,t){var r=this.__data__;if(r instanceof Yl){var i=r.__data__;if(!vv||i.length<jMe-1)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new ql(i)}return r.set(e,t),this.size=r.size,this}function vo(e){var t=this.__data__=new Yl(e);this.size=t.size}vo.prototype.clear=sMe;vo.prototype.delete=aMe;vo.prototype.get=oMe;vo.prototype.has=lMe;vo.prototype.set=HMe;var VMe="__lodash_hash_undefined__";function WMe(e){return this.__data__.set(e,VMe),this}function GMe(e){return this.__data__.has(e)}function gw(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new ql;++t<r;)this.add(e[t])}gw.prototype.add=gw.prototype.push=WMe;gw.prototype.has=GMe;function YMe(e,t){for(var r=-1,i=e==null?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}function qMe(e,t){return e.has(t)}var XMe=1,$Me=2;function uW(e,t,r,i,n,s){var a=r&XMe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var c=-1,d=!0,f=r&$Me?new gw:void 0;for(s.set(e,t),s.set(t,e);++c<o;){var p=e[c],m=t[c];if(i)var g=a?i(m,p,c,t,e,s):i(p,m,c,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!YMe(t,function(v,y){if(!qMe(f,y)&&(p===v||n(p,v,r,i,s)))return f.push(y)})){d=!1;break}}else if(!(p===m||n(p,m,r,i,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var QMe=Lo.Uint8Array;const vw=QMe;function KMe(e){var t=-1,r=Array(e.size);return e.forEach(function(i,n){r[++t]=[n,i]}),r}function ZMe(e){var t=-1,r=Array(e.size);return e.forEach(function(i){r[++t]=i}),r}var JMe=1,eEe=2,tEe="[object Boolean]",rEe="[object Date]",iEe="[object Error]",nEe="[object Map]",sEe="[object Number]",aEe="[object RegExp]",oEe="[object Set]",lEe="[object String]",uEe="[object Symbol]",cEe="[object ArrayBuffer]",hEe="[object DataView]",NN=Ks?Ks.prototype:void 0,jM=NN?NN.valueOf:void 0;function dEe(e,t,r,i,n,s,a){switch(r){case hEe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case cEe:return!(e.byteLength!=t.byteLength||!s(new vw(e),new vw(t)));case tEe:case rEe:case sEe:return Xv(+e,+t);case iEe:return e.name==t.name&&e.message==t.message;case aEe:case lEe:return e==t+"";case nEe:var o=KMe;case oEe:var l=i&JMe;if(o||(o=ZMe),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;i|=eEe,a.set(e,t);var h=uW(o(e),o(t),i,n,s,a);return a.delete(e),h;case uEe:if(jM)return jM.call(e)==jM.call(t)}return!1}function sP(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}var fEe=Array.isArray;const bs=fEe;function cW(e,t,r){var i=t(e);return bs(e)?i:sP(i,r(e))}function pEe(e,t){for(var r=-1,i=e==null?0:e.length,n=0,s=[];++r<i;){var a=e[r];t(a,r,e)&&(s[n++]=a)}return s}function hW(){return[]}var mEe=Object.prototype,gEe=mEe.propertyIsEnumerable,BN=Object.getOwnPropertySymbols,vEe=BN?function(e){return e==null?[]:(e=Object(e),pEe(BN(e),function(t){return gEe.call(e,t)}))}:hW;const aP=vEe;function yEe(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}var xEe="[object Arguments]";function FN(e){return Fl(e)&&Nh(e)==xEe}var dW=Object.prototype,wEe=dW.hasOwnProperty,bEe=dW.propertyIsEnumerable,_Ee=FN(function(){return arguments}())?FN:function(e){return Fl(e)&&wEe.call(e,"callee")&&!bEe.call(e,"callee")};const oP=_Ee;function SEe(){return!1}var fW=typeof exports=="object"&&exports&&!exports.nodeType&&exports,UN=fW&&typeof module=="object"&&module&&!module.nodeType&&module,MEe=UN&&UN.exports===fW,jN=MEe?Lo.Buffer:void 0,EEe=jN?jN.isBuffer:void 0,AEe=EEe||SEe;const xv=AEe;var TEe="[object Arguments]",CEe="[object Array]",DEe="[object Boolean]",PEe="[object Date]",OEe="[object Error]",LEe="[object Function]",IEe="[object Map]",REe="[object Number]",kEe="[object Object]",zEe="[object RegExp]",NEe="[object Set]",BEe="[object String]",FEe="[object WeakMap]",UEe="[object ArrayBuffer]",jEe="[object DataView]",HEe="[object Float32Array]",VEe="[object Float64Array]",WEe="[object Int8Array]",GEe="[object Int16Array]",YEe="[object Int32Array]",qEe="[object Uint8Array]",XEe="[object Uint8ClampedArray]",$Ee="[object Uint16Array]",QEe="[object Uint32Array]",Dr={};Dr[HEe]=Dr[VEe]=Dr[WEe]=Dr[GEe]=Dr[YEe]=Dr[qEe]=Dr[XEe]=Dr[$Ee]=Dr[QEe]=!0;Dr[TEe]=Dr[CEe]=Dr[UEe]=Dr[DEe]=Dr[jEe]=Dr[PEe]=Dr[OEe]=Dr[LEe]=Dr[IEe]=Dr[REe]=Dr[kEe]=Dr[zEe]=Dr[NEe]=Dr[BEe]=Dr[FEe]=!1;function KEe(e){return Fl(e)&&Y2(e.length)&&!!Dr[Nh(e)]}function Tb(e){return function(t){return e(t)}}var pW=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Mg=pW&&typeof module=="object"&&module&&!module.nodeType&&module,ZEe=Mg&&Mg.exports===pW,HM=ZEe&&YV.process,JEe=function(){try{var e=Mg&&Mg.require&&Mg.require("util").types;return e||HM&&HM.binding&&HM.binding("util")}catch{}}();const np=JEe;var HN=np&&np.isTypedArray,eAe=HN?Tb(HN):KEe;const lP=eAe;var tAe=Object.prototype,rAe=tAe.hasOwnProperty;function mW(e,t){var r=bs(e),i=!r&&oP(e),n=!r&&!i&&xv(e),s=!r&&!i&&!n&&lP(e),a=r||i||n||s,o=a?yEe(e.length,String):[],l=o.length;for(var u in e)(t||rAe.call(e,u))&&!(a&&(u=="length"||n&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||q2(u,l)))&&o.push(u);return o}var iAe=Object.prototype;function uP(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||iAe;return e===r}function gW(e,t){return function(r){return e(t(r))}}var nAe=gW(Object.keys,Object);const sAe=nAe;var aAe=Object.prototype,oAe=aAe.hasOwnProperty;function lAe(e){if(!uP(e))return sAe(e);var t=[];for(var r in Object(e))oAe.call(e,r)&&r!="constructor"&&t.push(r);return t}function Jv(e){return $v(e)?mW(e):lAe(e)}function WT(e){return cW(e,Jv,aP)}var uAe=1,cAe=Object.prototype,hAe=cAe.hasOwnProperty;function dAe(e,t,r,i,n,s){var a=r&uAe,o=WT(e),l=o.length,u=WT(t),h=u.length;if(l!=h&&!a)return!1;for(var c=l;c--;){var d=o[c];if(!(a?d in t:hAe.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=a;++c<l;){d=o[c];var v=e[d],y=t[d];if(i)var x=a?i(y,v,d,t,e,s):i(v,y,d,e,t,s);if(!(x===void 0?v===y||n(v,y,r,i,s):x)){m=!1;break}g||(g=d=="constructor")}if(m&&!g){var w=e.constructor,S=t.constructor;w!=S&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof S=="function"&&S instanceof S)&&(m=!1)}return s.delete(e),s.delete(t),m}var fAe=Fh(Lo,"DataView");const GT=fAe;var pAe=Fh(Lo,"Promise");const YT=pAe;var mAe=Fh(Lo,"Set");const qT=mAe;var gAe=Fh(Lo,"WeakMap");const XT=gAe;var VN="[object Map]",vAe="[object Object]",WN="[object Promise]",GN="[object Set]",YN="[object WeakMap]",qN="[object DataView]",yAe=Bh(GT),xAe=Bh(vv),wAe=Bh(YT),bAe=Bh(qT),_Ae=Bh(XT),Nc=Nh;(GT&&Nc(new GT(new ArrayBuffer(1)))!=qN||vv&&Nc(new vv)!=VN||YT&&Nc(YT.resolve())!=WN||qT&&Nc(new qT)!=GN||XT&&Nc(new XT)!=YN)&&(Nc=function(e){var t=Nh(e),r=t==vAe?e.constructor:void 0,i=r?Bh(r):"";if(i)switch(i){case yAe:return qN;case xAe:return VN;case wAe:return WN;case bAe:return GN;case _Ae:return YN}return t});const wv=Nc;var SAe=1,XN="[object Arguments]",$N="[object Array]",i1="[object Object]",MAe=Object.prototype,QN=MAe.hasOwnProperty;function EAe(e,t,r,i,n,s){var a=bs(e),o=bs(t),l=a?$N:wv(e),u=o?$N:wv(t);l=l==XN?i1:l,u=u==XN?i1:u;var h=l==i1,c=u==i1,d=l==u;if(d&&xv(e)){if(!xv(t))return!1;a=!0,h=!1}if(d&&!h)return s||(s=new vo),a||lP(e)?uW(e,t,r,i,n,s):dEe(e,t,l,r,i,n,s);if(!(r&SAe)){var f=h&&QN.call(e,"__wrapped__"),p=c&&QN.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,g=p?t.value():t;return s||(s=new vo),n(m,g,r,i,s)}}return d?(s||(s=new vo),dAe(e,t,r,i,n,s)):!1}function Cb(e,t,r,i,n){return e===t?!0:e==null||t==null||!Fl(e)&&!Fl(t)?e!==e&&t!==t:EAe(e,t,r,i,Cb,n)}function AAe(e,t){return Cb(e,t)}function VM(e,t){var r=X2(e);return r?r.innerHeight:t?e.clientHeight:uh(e).height}function vW(e,t,r){e.closest&&!r&&e.closest(t);var i=e;do{if(w_e(i,t))return i;i=i.parentElement}while(i&&i!==r&&i.nodeType===document.ELEMENT_NODE);return null}function TAe(e,t,r,i){for(var n=e.length,s=r+(i?1:-1);i?s--:++s<n;)if(t(e[s],s,e))return s;return-1}var CAe=1,DAe=2;function PAe(e,t,r,i){var n=r.length,s=n,a=!i;if(e==null)return!s;for(e=Object(e);n--;){var o=r[n];if(a&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++n<s;){o=r[n];var l=o[0],u=e[l],h=o[1];if(a&&o[2]){if(u===void 0&&!(l in e))return!1}else{var c=new vo;if(i)var d=i(u,h,l,e,t,c);if(!(d===void 0?Cb(h,u,CAe|DAe,i,c):d))return!1}}return!0}function yW(e){return e===e&&!Mo(e)}function OAe(e){for(var t=Jv(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,yW(n)]}return t}function xW(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function LAe(e){var t=OAe(e);return t.length==1&&t[0][2]?xW(t[0][0],t[0][1]):function(r){return r===e||PAe(r,e,t)}}var IAe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,RAe=/^\w*$/;function cP(e,t){if(bs(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Jf(e)?!0:RAe.test(e)||!IAe.test(e)||t!=null&&e in Object(t)}var kAe="Expected a function";function hP(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(kAe);var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var a=e.apply(this,i);return r.cache=s.set(n,a)||s,a};return r.cache=new(hP.Cache||ql),r}hP.Cache=ql;var zAe=500;function NAe(e){var t=hP(e,function(i){return r.size===zAe&&r.clear(),i}),r=t.cache;return t}var BAe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,FAe=/\\(\\)?/g,UAe=NAe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(BAe,function(r,i,n,s){t.push(n?s.replace(FAe,"$1"):i||r)}),t});const jAe=UAe;function Eg(e,t){for(var r=-1,i=e==null?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}var HAe=1/0,KN=Ks?Ks.prototype:void 0,ZN=KN?KN.toString:void 0;function wW(e){if(typeof e=="string")return e;if(bs(e))return Eg(e,wW)+"";if(Jf(e))return ZN?ZN.call(e):"";var t=e+"";return t=="0"&&1/e==-HAe?"-0":t}function VAe(e){return e==null?"":wW(e)}function Db(e,t){return bs(e)?e:cP(e,t)?[e]:jAe(VAe(e))}var WAe=1/0;function e0(e){if(typeof e=="string"||Jf(e))return e;var t=e+"";return t=="0"&&1/e==-WAe?"-0":t}function Pb(e,t){t=Db(t,e);for(var r=0,i=t.length;e!=null&&r<i;)e=e[e0(t[r++])];return r&&r==i?e:void 0}function GAe(e,t,r){var i=e==null?void 0:Pb(e,t);return i===void 0?r:i}function YAe(e,t){return e!=null&&t in Object(e)}function qAe(e,t,r){t=Db(t,e);for(var i=-1,n=t.length,s=!1;++i<n;){var a=e0(t[i]);if(!(s=e!=null&&r(e,a)))break;e=e[a]}return s||++i!=n?s:(n=e==null?0:e.length,!!n&&Y2(n)&&q2(a,n)&&(bs(e)||oP(e)))}function XAe(e,t){return e!=null&&qAe(e,t,YAe)}var $Ae=1,QAe=2;function KAe(e,t){return cP(e)&&yW(t)?xW(e0(e),t):function(r){var i=GAe(r,e);return i===void 0&&i===t?XAe(r,e):Cb(t,i,$Ae|QAe)}}function Ob(e){return e}function ZAe(e){return function(t){return t==null?void 0:t[e]}}function JAe(e){return function(t){return Pb(t,e)}}function eTe(e){return cP(e)?ZAe(e0(e)):JAe(e)}function Lb(e){return typeof e=="function"?e:e==null?Ob:typeof e=="object"?bs(e)?KAe(e[0],e[1]):LAe(e):eTe(e)}var tTe=Math.max;function rTe(e,t,r){var i=e==null?0:e.length;if(!i)return-1;var n=r==null?0:XV(r);return n<0&&(n=tTe(i+n,0)),TAe(e,Lb(t),n)}var iTe=Math.ceil,nTe=Math.max;function sTe(e,t,r,i){for(var n=-1,s=nTe(iTe((t-e)/(r||1)),0),a=Array(s);s--;)a[i?s:++n]=e,e+=r;return a}function aTe(e){return function(t,r,i){return i&&typeof i!="number"&&fv(t,r,i)&&(r=i=void 0),t=O1(t),r===void 0?(r=t,t=0):r=O1(r),i=i===void 0?t<r?1:-1:O1(i),sTe(t,r,i,e)}}var oTe=aTe();const lTe=oTe;var JN=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function uTe(e,t){return!!(e===t||JN(e)&&JN(t))}function cTe(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!uTe(e[r],t[r]))return!1;return!0}function bW(e,t){t===void 0&&(t=cTe);var r=null;function i(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];if(r&&r.lastThis===this&&t(n,r.lastArgs))return r.lastResult;var a=e.apply(this,n);return r={lastResult:a,lastArgs:n,lastThis:this},a}return i.clear=function(){r=null},i}var eB=Ks?Ks.isConcatSpreadable:void 0;function hTe(e){return bs(e)||oP(e)||!!(eB&&e&&e[eB])}function dP(e,t,r,i,n){var s=-1,a=e.length;for(r||(r=hTe),n||(n=[]);++s<a;){var o=e[s];t>0&&r(o)?t>1?dP(o,t-1,r,i,n):sP(n,o):i||(n[n.length]=o)}return n}function dTe(e){return function(t,r,i){for(var n=-1,s=Object(t),a=i(t),o=a.length;o--;){var l=a[e?o:++n];if(r(s[l],l,s)===!1)break}return t}}var fTe=dTe();const pTe=fTe;function fP(e,t){return e&&pTe(e,t,Jv)}function mTe(e,t){return function(r,i){if(r==null)return r;if(!$v(r))return e(r,i);for(var n=r.length,s=t?n:-1,a=Object(r);(t?s--:++s<n)&&i(a[s],s,a)!==!1;);return r}}var gTe=mTe(fP);const vTe=gTe;function yTe(e,t){var r=-1,i=$v(e)?Array(e.length):[];return vTe(e,function(n,s,a){i[++r]=t(n,s,a)}),i}function xTe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}function wTe(e,t){if(e!==t){var r=e!==void 0,i=e===null,n=e===e,s=Jf(e),a=t!==void 0,o=t===null,l=t===t,u=Jf(t);if(!o&&!u&&!s&&e>t||s&&a&&l&&!o&&!u||i&&a&&l||!r&&l||!n)return 1;if(!i&&!s&&!u&&e<t||u&&r&&n&&!i&&!s||o&&r&&n||!a&&n||!l)return-1}return 0}function bTe(e,t,r){for(var i=-1,n=e.criteria,s=t.criteria,a=n.length,o=r.length;++i<a;){var l=wTe(n[i],s[i]);if(l){if(i>=o)return l;var u=r[i];return l*(u=="desc"?-1:1)}}return e.index-t.index}function _Te(e,t,r){t.length?t=Eg(t,function(s){return bs(s)?function(a){return Pb(a,s.length===1?s[0]:s)}:s}):t=[Ob];var i=-1;t=Eg(t,Tb(Lb));var n=yTe(e,function(s,a,o){var l=Eg(t,function(u){return u(s)});return{criteria:l,index:++i,value:s}});return xTe(n,function(s,a){return bTe(s,a,r)})}function STe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var tB=Math.max;function _W(e,t,r){return t=tB(t===void 0?e.length-1:t,0),function(){for(var i=arguments,n=-1,s=tB(i.length-t,0),a=Array(s);++n<s;)a[n]=i[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=i[n];return o[t]=r(a),STe(e,this,o)}}function MTe(e){return function(){return e}}var ETe=function(){try{var e=Fh(Object,"defineProperty");return e({},"",{}),e}catch{}}();const yw=ETe;var ATe=yw?function(e,t){return yw(e,"toString",{configurable:!0,enumerable:!1,value:MTe(t),writable:!0})}:Ob;const TTe=ATe;var CTe=800,DTe=16,PTe=Date.now;function OTe(e){var t=0,r=0;return function(){var i=PTe(),n=DTe-(i-r);if(r=i,n>0){if(++t>=CTe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var LTe=OTe(TTe);const SW=LTe;function MW(e,t){return SW(_W(e,t,Ob),e+"")}var ITe=MW(function(e,t){if(e==null)return[];var r=t.length;return r>1&&fv(e,t[0],t[1])?t=[]:r>2&&fv(t[0],t[1],t[2])&&(t=[t[0]]),_Te(e,dP(t,1),[])});const RTe=ITe;function $T(e,t){var r=X2(e);return r?r.innerWidth:t?e.clientWidth:uh(e).width}function EW(e){return PV(e)||WV(e)||B2(e)||OV()}function AW(e,t){for(var r=-1,i=e==null?0:e.length;++r<i&&t(e[r],r,e)!==!1;);return e}function pP(e,t,r){t=="__proto__"&&yw?yw(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var kTe=Object.prototype,zTe=kTe.hasOwnProperty;function TW(e,t,r){var i=e[t];(!(zTe.call(e,t)&&Xv(i,r))||r===void 0&&!(t in e))&&pP(e,t,r)}function t0(e,t,r,i){var n=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=i?i(r[o],e[o],o,r,e):void 0;l===void 0&&(l=e[o]),n?pP(r,o,l):TW(r,o,l)}return r}function NTe(e,t){return e&&t0(t,Jv(t),e)}function BTe(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var FTe=Object.prototype,UTe=FTe.hasOwnProperty;function jTe(e){if(!Mo(e))return BTe(e);var t=uP(e),r=[];for(var i in e)i=="constructor"&&(t||!UTe.call(e,i))||r.push(i);return r}function Ib(e){return $v(e)?mW(e,!0):jTe(e)}function HTe(e,t){return e&&t0(t,Ib(t),e)}var CW=typeof exports=="object"&&exports&&!exports.nodeType&&exports,rB=CW&&typeof module=="object"&&module&&!module.nodeType&&module,VTe=rB&&rB.exports===CW,iB=VTe?Lo.Buffer:void 0,nB=iB?iB.allocUnsafe:void 0;function WTe(e,t){if(t)return e.slice();var r=e.length,i=nB?nB(r):new e.constructor(r);return e.copy(i),i}function GTe(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}function YTe(e,t){return t0(e,aP(e),t)}var qTe=gW(Object.getPrototypeOf,Object);const Rb=qTe;var XTe=Object.getOwnPropertySymbols,$Te=XTe?function(e){for(var t=[];e;)sP(t,aP(e)),e=Rb(e);return t}:hW;const DW=$Te;function QTe(e,t){return t0(e,DW(e),t)}function PW(e){return cW(e,Ib,DW)}var KTe=Object.prototype,ZTe=KTe.hasOwnProperty;function JTe(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&ZTe.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function mP(e){var t=new e.constructor(e.byteLength);return new vw(t).set(new vw(e)),t}function eCe(e,t){var r=t?mP(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var tCe=/\w*$/;function rCe(e){var t=new e.constructor(e.source,tCe.exec(e));return t.lastIndex=e.lastIndex,t}var sB=Ks?Ks.prototype:void 0,aB=sB?sB.valueOf:void 0;function iCe(e){return aB?Object(aB.call(e)):{}}function nCe(e,t){var r=t?mP(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var sCe="[object Boolean]",aCe="[object Date]",oCe="[object Map]",lCe="[object Number]",uCe="[object RegExp]",cCe="[object Set]",hCe="[object String]",dCe="[object Symbol]",fCe="[object ArrayBuffer]",pCe="[object DataView]",mCe="[object Float32Array]",gCe="[object Float64Array]",vCe="[object Int8Array]",yCe="[object Int16Array]",xCe="[object Int32Array]",wCe="[object Uint8Array]",bCe="[object Uint8ClampedArray]",_Ce="[object Uint16Array]",SCe="[object Uint32Array]";function MCe(e,t,r){var i=e.constructor;switch(t){case fCe:return mP(e);case sCe:case aCe:return new i(+e);case pCe:return eCe(e,r);case mCe:case gCe:case vCe:case yCe:case xCe:case wCe:case bCe:case _Ce:case SCe:return nCe(e,r);case oCe:return new i;case lCe:case hCe:return new i(e);case uCe:return rCe(e);case cCe:return new i;case dCe:return iCe(e)}}var oB=Object.create,ECe=function(){function e(){}return function(t){if(!Mo(t))return{};if(oB)return oB(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();const OW=ECe;function ACe(e){return typeof e.constructor=="function"&&!uP(e)?OW(Rb(e)):{}}var TCe="[object Map]";function CCe(e){return Fl(e)&&wv(e)==TCe}var lB=np&&np.isMap,DCe=lB?Tb(lB):CCe;const PCe=DCe;var OCe="[object Set]";function LCe(e){return Fl(e)&&wv(e)==OCe}var uB=np&&np.isSet,ICe=uB?Tb(uB):LCe;const RCe=ICe;var kCe=1,zCe=2,NCe=4,LW="[object Arguments]",BCe="[object Array]",FCe="[object Boolean]",UCe="[object Date]",jCe="[object Error]",IW="[object Function]",HCe="[object GeneratorFunction]",VCe="[object Map]",WCe="[object Number]",RW="[object Object]",GCe="[object RegExp]",YCe="[object Set]",qCe="[object String]",XCe="[object Symbol]",$Ce="[object WeakMap]",QCe="[object ArrayBuffer]",KCe="[object DataView]",ZCe="[object Float32Array]",JCe="[object Float64Array]",eDe="[object Int8Array]",tDe="[object Int16Array]",rDe="[object Int32Array]",iDe="[object Uint8Array]",nDe="[object Uint8ClampedArray]",sDe="[object Uint16Array]",aDe="[object Uint32Array]",Sr={};Sr[LW]=Sr[BCe]=Sr[QCe]=Sr[KCe]=Sr[FCe]=Sr[UCe]=Sr[ZCe]=Sr[JCe]=Sr[eDe]=Sr[tDe]=Sr[rDe]=Sr[VCe]=Sr[WCe]=Sr[RW]=Sr[GCe]=Sr[YCe]=Sr[qCe]=Sr[XCe]=Sr[iDe]=Sr[nDe]=Sr[sDe]=Sr[aDe]=!0;Sr[jCe]=Sr[IW]=Sr[$Ce]=!1;function I1(e,t,r,i,n,s){var a,o=t&kCe,l=t&zCe,u=t&NCe;if(r&&(a=n?r(e,i,n,s):r(e)),a!==void 0)return a;if(!Mo(e))return e;var h=bs(e);if(h){if(a=JTe(e),!o)return GTe(e,a)}else{var c=wv(e),d=c==IW||c==HCe;if(xv(e))return WTe(e,o);if(c==RW||c==LW||d&&!n){if(a=l||d?{}:ACe(e),!o)return l?QTe(e,HTe(a,e)):YTe(e,NTe(a,e))}else{if(!Sr[c])return n?e:{};a=MCe(e,c,o)}}s||(s=new vo);var f=s.get(e);if(f)return f;s.set(e,a),RCe(e)?e.forEach(function(g){a.add(I1(g,t,r,g,e,s))}):PCe(e)&&e.forEach(function(g,v){a.set(v,I1(g,t,r,v,e,s))});var p=u?l?PW:WT:l?Ib:Jv,m=h?void 0:p(e);return AW(m||e,function(g,v){m&&(v=g,g=e[v]),TW(a,v,I1(g,t,r,v,e,s))}),a}function oDe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function lDe(e,t){return t.length<2?e:Pb(e,GV(t,0,-1))}function uDe(e,t){return t=Db(t,e),e=lDe(e,t),e==null||delete e[e0(oDe(t))]}var cDe="[object Object]",hDe=Function.prototype,dDe=Object.prototype,kW=hDe.toString,fDe=dDe.hasOwnProperty,pDe=kW.call(Object);function mDe(e){if(!Fl(e)||Nh(e)!=cDe)return!1;var t=Rb(e);if(t===null)return!0;var r=fDe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&kW.call(r)==pDe}function gDe(e){return mDe(e)?void 0:e}function vDe(e){var t=e==null?0:e.length;return t?dP(e,1):[]}function yDe(e){return SW(_W(e,void 0,vDe),e+"")}var xDe=1,wDe=2,bDe=4,_De=yDe(function(e,t){var r={};if(e==null)return r;var i=!1;t=Eg(t,function(s){return s=Db(s,e),i||(i=s.length>1),s}),t0(e,PW(e),r),i&&(r=I1(r,xDe|wDe|bDe,gDe));for(var n=t.length;n--;)uDe(r,t[n]);return r});const SDe=_De;var zW=Object.prototype,MDe=zW.hasOwnProperty,EDe=MW(function(e,t){e=Object(e);var r=-1,i=t.length,n=i>2?t[2]:void 0;for(n&&fv(t[0],t[1],n)&&(i=1);++r<i;)for(var s=t[r],a=Ib(s),o=-1,l=a.length;++o<l;){var u=a[o],h=e[u];(h===void 0||Xv(h,zW[u])&&!MDe.call(e,u))&&(e[u]=s[u])}return e});const ADe=EDe;function TDe(e,t,r){var i=bs(e),n=i||xv(e)||lP(e);if(t=Lb(t),r==null){var s=e&&e.constructor;n?r=i?new s:[]:Mo(e)?r=G2(s)?OW(Rb(e)):{}:r={}}return(n?AW:fP)(e,function(a,o,l){return t(r,a,o,l)}),r}function CDe(e,t){var r={};return t=Lb(t),fP(e,function(i,n,s){pP(r,n,t(i,n,s))}),r}var DDe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){return function(r,i,n){i.prototype.isBetween=function(s,a,o,l){var u=n(s),h=n(a),c=(l=l||"()")[0]==="(",d=l[1]===")";return(c?this.isAfter(u,o):!this.isBefore(u,o))&&(d?this.isBefore(h,o):!this.isAfter(h,o))||(c?this.isBefore(u,o):!this.isAfter(u,o))&&(d?this.isAfter(h,o):!this.isBefore(h,o))}}})})(DDe);var PDe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){return function(r,i){i.prototype.isSameOrAfter=function(n,s){return this.isSame(n,s)||this.isAfter(n,s)}}})})(PDe);var ODe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){return function(r,i){i.prototype.isSameOrBefore=function(n,s){return this.isSame(n,s)||this.isBefore(n,s)}}})})(ODe);var LDe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){return function(r,i,n){var s=i.prototype,a=function(c){return c&&(c.indexOf?c:c.s)},o=function(c,d,f,p,m){var g=c.name?c:c.$locale(),v=a(g[d]),y=a(g[f]),x=v||y.map(function(S){return S.slice(0,p)});if(!m)return x;var w=g.weekStart;return x.map(function(S,_){return x[(_+(w||0))%7]})},l=function(){return n.Ls[n.locale()]},u=function(c,d){return c.formats[d]||function(f){return f.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(p,m,g){return m||g.slice(1)})}(c.formats[d.toUpperCase()])},h=function(){var c=this;return{months:function(d){return d?d.format("MMMM"):o(c,"months")},monthsShort:function(d){return d?d.format("MMM"):o(c,"monthsShort","months",3)},firstDayOfWeek:function(){return c.$locale().weekStart||0},weekdays:function(d){return d?d.format("dddd"):o(c,"weekdays")},weekdaysMin:function(d){return d?d.format("dd"):o(c,"weekdaysMin","weekdays",2)},weekdaysShort:function(d){return d?d.format("ddd"):o(c,"weekdaysShort","weekdays",3)},longDateFormat:function(d){return u(c.$locale(),d)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};s.localeData=function(){return h.bind(this)()},n.localeData=function(){var c=l();return{firstDayOfWeek:function(){return c.weekStart||0},weekdays:function(){return n.weekdays()},weekdaysShort:function(){return n.weekdaysShort()},weekdaysMin:function(){return n.weekdaysMin()},months:function(){return n.months()},monthsShort:function(){return n.monthsShort()},longDateFormat:function(d){return u(c,d)},meridiem:c.meridiem,ordinal:c.ordinal}},n.months=function(){return o(l(),"months")},n.monthsShort=function(){return o(l(),"monthsShort","months",3)},n.weekdays=function(c){return o(l(),"weekdays",null,null,c)},n.weekdaysShort=function(c){return o(l(),"weekdaysShort","weekdays",3,c)},n.weekdaysMin=function(c){return o(l(),"weekdaysMin","weekdays",2,c)}}})})(LDe);var IDe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(i,n,s){var a=n.prototype,o=a.format;s.en.formats=r,a.format=function(l){l===void 0&&(l="YYYY-MM-DDTHH:mm:ssZ");var u=this.$locale().formats,h=function(c,d){return c.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(f,p,m){var g=m&&m.toUpperCase();return p||d[m]||r[m]||d[g].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(v,y,x){return y||x.slice(1)})})}(l,u===void 0?{}:u);return o.call(this,h)}}})})(IDe);var RDe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){return function(r,i,n){var s=function(a,o){if(!o||!o.length||o.length===1&&!o[0]||o.length===1&&Array.isArray(o[0])&&!o[0].length)return null;var l;o.length===1&&o[0].length>0&&(o=o[0]),l=(o=o.filter(function(h){return h}))[0];for(var u=1;u<o.length;u+=1)o[u].isValid()&&!o[u][a](l)||(l=o[u]);return l};n.max=function(){var a=[].slice.call(arguments,0);return s("isAfter",a)},n.min=function(){var a=[].slice.call(arguments,0);return s("isBefore",a)}}})})(RDe);var kDe={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(Hl,function(){var r="minute",i=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(s,a,o){var l=a.prototype;o.utc=function(m){var g={date:m,utc:!0,args:arguments};return new a(g)},l.utc=function(m){var g=o(this.toDate(),{locale:this.$L,utc:!0});return m?g.add(this.utcOffset(),r):g},l.local=function(){return o(this.toDate(),{locale:this.$L,utc:!1})};var u=l.parse;l.parse=function(m){m.utc&&(this.$u=!0),this.$utils().u(m.$offset)||(this.$offset=m.$offset),u.call(this,m)};var h=l.init;l.init=function(){if(this.$u){var m=this.$d;this.$y=m.getUTCFullYear(),this.$M=m.getUTCMonth(),this.$D=m.getUTCDate(),this.$W=m.getUTCDay(),this.$H=m.getUTCHours(),this.$m=m.getUTCMinutes(),this.$s=m.getUTCSeconds(),this.$ms=m.getUTCMilliseconds()}else h.call(this)};var c=l.utcOffset;l.utcOffset=function(m,g){var v=this.$utils().u;if(v(m))return this.$u?0:v(this.$offset)?c.call(this):this.$offset;if(typeof m=="string"&&(m=function(S){S===void 0&&(S="");var _=S.match(i);if(!_)return null;var A=(""+_[0]).match(n)||["-",0,0],M=A[0],T=60*+A[1]+ +A[2];return T===0?0:M==="+"?T:-T}(m),m===null))return this;var y=Math.abs(m)<=16?60*m:m,x=this;if(g)return x.$offset=y,x.$u=m===0,x;if(m!==0){var w=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(x=this.local().add(y+w,r)).$offset=y,x.$x.$localOffset=w}else x=this.utc();return x};var d=l.format;l.format=function(m){var g=m||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return d.call(this,g)},l.valueOf=function(){var m=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*m},l.isUTC=function(){return!!this.$u},l.toISOString=function(){return this.toDate().toISOString()},l.toString=function(){return this.toDate().toUTCString()};var f=l.toDate;l.toDate=function(m){return m==="s"&&this.$offset?o(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():f.call(this)};var p=l.diff;l.diff=function(m,g,v){if(m&&this.$u===m.$u)return p.call(this,m,g,v);var y=this.local(),x=o(m).local();return p.call(y,x,g,v)}}})})(kDe);function cl(e){return e.children}var Jn={PREVIOUS:"PREV",NEXT:"NEXT",TODAY:"TODAY",DATE:"DATE"},Sn={MONTH:"month",WEEK:"week",WORK_WEEK:"work_week",DAY:"day",AGENDA:"agenda"},cB=Object.keys(Sn).map(function(e){return Sn[e]});Ue.oneOfType([Ue.string,Ue.func]);Ue.any;Ue.func;Ue.oneOfType([Ue.arrayOf(Ue.oneOf(cB)),Ue.objectOf(function(e,t){var r=cB.indexOf(t)!==-1&&typeof e[t]=="boolean";if(r)return null;for(var i=arguments.length,n=new Array(i>2?i-2:0),s=2;s<i;s++)n[s-2]=arguments[s];return Ue.elementType.apply(Ue,[e,t].concat(n))})]);Ue.oneOfType([Ue.oneOf(["overlap","no-overlap"]),Ue.func]);function Nr(e,t){e&&e.apply(null,[].concat(t))}var hB={seconds:1e3,minutes:1e3*60,hours:1e3*60*60,day:1e3*60*60*24};function NW(e,t){var r=rs(e,"month");return rs(r,"week",t.startOfWeek())}function BW(e,t){var r=NT(e,"month");return NT(r,"week",t.startOfWeek())}function zDe(e,t){for(var r=NW(e,t),i=BW(e,t),n=[];qv(r,i,"day");)n.push(r),r=nc(r,1,"day");return n}function QT(e,t){var r=rs(e,t);return _b(r,e)?r:nc(r,1,t)}function NDe(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"day",i=e,n=[];qv(i,t,r);)n.push(i),i=nc(i,1,r);return n}function BDe(e,t){return t==null&&e==null?null:(t==null&&(t=new Date),e==null&&(e=new Date),e=rs(e,"day"),e=pw(e,pw(t)),e=dv(e,dv(t)),e=fw(e,fw(t)),dw(e,dw(t)))}function dB(e){return pw(e)===0&&dv(e)===0&&fw(e)===0&&dw(e)===0}function bv(e,t,r){return!r||r==="milliseconds"?Math.abs(+e-+t):Math.round(Math.abs(+rs(e,r)/hB[r]-+rs(t,r)/hB[r]))}var FDe=Ue.oneOfType([Ue.string,Ue.func]);function UDe(e,t,r,i,n){var s=typeof i=="function"?i(r,n,e):t.call(e,r,i,n);return cv(s==null||typeof s=="string","`localizer format(..)` must return a string, null, or undefined"),s}function jDe(e,t,r){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,t+r,0,0)}function gP(e,t){return e.getTimezoneOffset()-t.getTimezoneOffset()}function HDe(e,t){return bv(e,t,"minutes")+gP(e,t)}function VDe(e){var t=rs(e,"day");return bv(t,e,"minutes")+gP(t,e)}function WDe(e,t){return VV(e,t,"day")}function GDe(e,t,r){var i=_b(e,t,"minutes");return i?Sb(t,r,"minutes"):W2(t,r,"minutes")}function YDe(e){var t=e.evtA,r=t.start,i=t.end,n=t.allDay,s=e.evtB,a=s.start,o=s.end,l=s.allDay,u=+rs(r,"day")-+rs(a,"day"),h=bv(r,QT(i,"day"),"day"),c=bv(a,QT(o,"day"),"day");return u||Math.max(c,1)-Math.max(h,1)||!!l-!!n||+r-+a||+i-+o}function qDe(e){var t=e.event,r=t.start,i=t.end,n=e.range,s=n.start,a=n.end,o=rs(r,"day"),l=qv(o,a,"day"),u=HV(o,i,"minutes"),h=u?W2(i,s,"minutes"):Sb(i,s,"minutes");return l&&h}function XDe(e,t){return _b(e,t,"day")}function $De(e,t){return dB(e)&&dB(t)}var QDe=ji(function e(t){var r=this;Ui(this,e),cv(typeof t.format=="function","date localizer `format(..)` must be a function"),cv(typeof t.firstOfWeek=="function","date localizer `firstOfWeek(..)` must be a function"),this.propType=t.propType||FDe,this.formats=t.formats,this.format=function(){for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return UDe.apply(void 0,[r,t.format].concat(n))},this.startOfWeek=t.firstOfWeek,this.merge=t.merge||BDe,this.inRange=t.inRange||wbe,this.lt=t.lt||VV,this.lte=t.lte||qv,this.gt=t.gt||W2,this.gte=t.gte||Sb,this.eq=t.eq||_b,this.neq=t.neq||HV,this.startOf=t.startOf||rs,this.endOf=t.endOf||NT,this.add=t.add||nc,this.range=t.range||NDe,this.diff=t.diff||bv,this.ceil=t.ceil||QT,this.min=t.min||ybe,this.max=t.max||xbe,this.minutes=t.minutes||dv,this.firstVisibleDay=t.firstVisibleDay||NW,this.lastVisibleDay=t.lastVisibleDay||BW,this.visibleDays=t.visibleDays||zDe,this.getSlotDate=t.getSlotDate||jDe,this.getTimezoneOffset=t.getTimezoneOffset||function(i){return i.getTimezoneOffset()},this.getDstOffset=t.getDstOffset||gP,this.getTotalMin=t.getTotalMin||HDe,this.getMinutesFromMidnight=t.getMinutesFromMidnight||VDe,this.continuesPrior=t.continuesPrior||WDe,this.continuesAfter=t.continuesAfter||GDe,this.sortEvents=t.sortEvents||YDe,this.inEventRange=t.inEventRange||qDe,this.isSameDate=t.isSameDate||XDe,this.startAndEndAreDateOnly=t.startAndEndAreDateOnly||$De,this.segmentOffset=t.browserTZOffset?t.browserTZOffset():0});function KDe(e,t,r,i){var n=vr(vr({},e.formats),r);return vr(vr({},e),{},{messages:i,startOfWeek:function(){return e.startOfWeek(t)},format:function(a,o){return e.format(a,n[o]||o,t)}})}var ZDe={date:"Date",time:"Time",event:"Event",allDay:"All Day",week:"Week",work_week:"Work Week",day:"Day",month:"Month",previous:"Back",next:"Next",yesterday:"Yesterday",tomorrow:"Tomorrow",today:"Today",agenda:"Agenda",noEventsInRange:"There are no events in this range.",showMore:function(t){return"+".concat(t," more")}};function JDe(e){return vr(vr({},ZDe),e)}function e2e(e){var t=e.ref,r=e.callback;pe.useEffect(function(){var i=function(s){t.current&&!t.current.contains(s.target)&&r()};return document.addEventListener("mousedown",i),function(){document.removeEventListener("mousedown",i)}},[t,r])}var t2e=["style","className","event","selected","isAllDay","onSelect","onDoubleClick","onKeyPress","localizer","continuesPrior","continuesAfter","accessors","getters","children","components","slotStart","slotEnd"],FW=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.style,a=n.className,o=n.event,l=n.selected,u=n.isAllDay,h=n.onSelect,c=n.onDoubleClick,d=n.onKeyPress,f=n.localizer,p=n.continuesPrior,m=n.continuesAfter,g=n.accessors,v=n.getters,y=n.children,x=n.components,w=x.event,S=x.eventWrapper,_=n.slotStart,A=n.slotEnd,M=So(n,t2e);delete M.resizable;var T=g.title(o),C=g.tooltip(o),L=g.end(o),I=g.start(o),k=g.allDay(o),z=u||k||f.diff(I,f.ceil(L,"day"),"day")>1,V=v.eventProp(o,I,L,l),K=fe.createElement("div",{className:"rbc-event-content",title:C||void 0},w?fe.createElement(w,{event:o,continuesPrior:p,continuesAfter:m,title:T,isAllDay:k,localizer:f,slotStart:_,slotEnd:A}):T);return fe.createElement(S,Object.assign({},this.props,{type:"date"}),fe.createElement("div",Object.assign({},M,{tabIndex:0,style:vr(vr({},V.style),s),className:Ai("rbc-event",a,V.className,{"rbc-selected":l,"rbc-event-allday":z,"rbc-event-continues-prior":p,"rbc-event-continues-after":m}),onClick:function(O){return h&&h(o,O)},onDoubleClick:function(O){return c&&c(o,O)},onKeyPress:function(O){return d&&d(o,O)}}),typeof y=="function"?y(K):K))}}]),r}(fe.Component);function kb(e,t){return!e||t==null?!1:AAe(e,t)}function UW(e,t){var r=e.right-e.left,i=r/t;return i}function jW(e,t,r,i){var n=UW(e,i);return r?i-1-Math.floor((t-e.left)/n):Math.floor((t-e.left)/n)}function r2e(e,t){var r=t.x,i=t.y;return i>=e.top&&i<=e.bottom&&r>=e.left&&r<=e.right}function i2e(e,t,r,i,n){var s=-1,a=-1,o=i-1,l=UW(t,i),u=jW(t,r.x,n,i),h=t.top<r.y&&t.bottom>r.y,c=t.top<e.y&&t.bottom>e.y,d=e.y>t.bottom,f=t.top>e.y,p=r.top<t.top&&r.bottom>t.bottom;return p&&(s=0,a=o),h&&(f?(s=0,a=u):d&&(s=u,a=o)),c&&(s=a=n?o-Math.floor((e.x-t.left)/l):Math.floor((e.x-t.left)/l),h?u<s?s=u:a=u:e.y<r.y?a=o:s=0),{startIdx:s,endIdx:a}}function n2e(e){var t=e.target,r=e.offset,i=e.container,n=e.box,s=uh(t),a=s.top,o=s.left,l=s.width,u=s.height,h=uh(i),c=h.top,d=h.left,f=h.width,p=h.height,m=uh(n),g=m.width,v=m.height,y=c+p,x=d+f,w=a+v,S=o+g,_=r.x,A=r.y,M=w>y?a-v-A:a+A+u,T=S>x?o+_-g+l:o+_;return{topOffset:M,leftOffset:T}}function s2e(e){var t=e.containerRef,r=e.accessors,i=e.getters,n=e.selected,s=e.components,a=e.localizer,o=e.position,l=e.show,u=e.events,h=e.slotStart,c=e.slotEnd,d=e.onSelect,f=e.onDoubleClick,p=e.onKeyPress,m=e.handleDragStart,g=e.popperRef,v=e.target,y=e.offset;e2e({ref:g,callback:l}),pe.useLayoutEffect(function(){var S=n2e({target:v,offset:y,container:t.current,box:g.current}),_=S.topOffset,A=S.leftOffset;g.current.style.top="".concat(_,"px"),g.current.style.left="".concat(A,"px")},[y.x,y.y,v]);var x=o.width,w={minWidth:x+x/2};return fe.createElement("div",{style:w,className:"rbc-overlay",ref:g},fe.createElement("div",{className:"rbc-overlay-header"},a.format(h,"dayHeaderFormat")),u.map(function(S,_){return fe.createElement(FW,{key:_,type:"popup",localizer:a,event:S,getters:i,onSelect:d,accessors:r,components:s,onDoubleClick:f,onKeyPress:p,continuesPrior:a.lt(r.end(S),h,"day"),continuesAfter:a.gte(r.start(S),c,"day"),slotStart:h,slotEnd:c,selected:kb(S,n),draggable:!0,onDragStart:function(){return m(S)},onDragEnd:function(){return l()}})}))}var HW=fe.forwardRef(function(e,t){return fe.createElement(s2e,Object.assign({},e,{popperRef:t}))});HW.propTypes={accessors:Ue.object.isRequired,getters:Ue.object.isRequired,selected:Ue.object,components:Ue.object.isRequired,localizer:Ue.object.isRequired,position:Ue.object.isRequired,show:Ue.func.isRequired,events:Ue.array.isRequired,slotStart:Ue.instanceOf(Date).isRequired,slotEnd:Ue.instanceOf(Date),onSelect:Ue.func,onDoubleClick:Ue.func,onKeyPress:Ue.func,handleDragStart:Ue.func,style:Ue.object,offset:Ue.shape({x:Ue.number,y:Ue.number})};function a2e(e){var t=e.containerRef,r=e.popupOffset,i=r===void 0?5:r,n=e.overlay,s=e.accessors,a=e.localizer,o=e.components,l=e.getters,u=e.selected,h=e.handleSelectEvent,c=e.handleDoubleClickEvent,d=e.handleKeyPressEvent,f=e.handleDragStart,p=e.onHide,m=e.overlayDisplay,g=pe.useRef(null);if(!n.position)return null;var v=i;isNaN(i)||(v={x:i,y:i});var y=n.position,x=n.events,w=n.date,S=n.end;return fe.createElement(KSe,{rootClose:!0,flip:!0,show:!0,placement:"bottom",onHide:p,target:n.target},function(_){var A=_.props;return fe.createElement(HW,Object.assign({},A,{containerRef:t,ref:g,target:n.target,offset:v,accessors:s,getters:l,selected:u,components:o,localizer:a,position:y,show:m,events:x,slotStart:w,slotEnd:S,onSelect:h,onDoubleClick:c,onKeyPress:d,handleDragStart:f}))})}var vP=fe.forwardRef(function(e,t){return fe.createElement(a2e,Object.assign({},e,{containerRef:t}))});vP.propTypes={popupOffset:Ue.oneOfType([Ue.number,Ue.shape({x:Ue.number,y:Ue.number})]),overlay:Ue.shape({position:Ue.object,events:Ue.array,date:Ue.instanceOf(Date),end:Ue.instanceOf(Date)}),accessors:Ue.object.isRequired,localizer:Ue.object.isRequired,components:Ue.object.isRequired,getters:Ue.object.isRequired,selected:Ue.object,handleSelectEvent:Ue.func,handleDoubleClickEvent:Ue.func,handleKeyPressEvent:Ue.func,handleDragStart:Ue.func,onHide:Ue.func,overlayDisplay:Ue.func};function en(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:document;return $m(r,e,t,{passive:!1})}function o2e(e,t,r){return!e||pv(e,document.elementFromPoint(t,r))}function l2e(e,t){var r=t.clientX,i=t.clientY,n=document.elementFromPoint(r,i);return vW(n,".rbc-event",e)}function u2e(e,t){var r=t.clientX,i=t.clientY,n=document.elementFromPoint(r,i);return vW(n,".rbc-show-more",e)}function xw(e,t){return!!l2e(e,t)}function c2e(e,t){return!!u2e(e,t)}function Ad(e){var t=e;return e.touches&&e.touches.length&&(t=e.touches[0]),{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}}var fB=5,h2e=250,VW=function(){function e(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.global,n=i===void 0?!1:i,s=r.longPressThreshold,a=s===void 0?250:s,o=r.validContainers,l=o===void 0?[]:o;Ui(this,e),this.isDetached=!1,this.container=t,this.globalMouse=!t||n,this.longPressThreshold=a,this.validContainers=l,this._listeners=Object.create(null),this._handleInitialEvent=this._handleInitialEvent.bind(this),this._handleMoveEvent=this._handleMoveEvent.bind(this),this._handleTerminatingEvent=this._handleTerminatingEvent.bind(this),this._keyListener=this._keyListener.bind(this),this._dropFromOutsideListener=this._dropFromOutsideListener.bind(this),this._dragOverFromOutsideListener=this._dragOverFromOutsideListener.bind(this),this._removeTouchMoveWindowListener=en("touchmove",function(){},window),this._removeKeyDownListener=en("keydown",this._keyListener),this._removeKeyUpListener=en("keyup",this._keyListener),this._removeDropFromOutsideListener=en("drop",this._dropFromOutsideListener),this._removeDragOverFromOutsideListener=en("dragover",this._dragOverFromOutsideListener),this._addInitialEventListener()}return ji(e,[{key:"on",value:function(r,i){var n=this._listeners[r]||(this._listeners[r]=[]);return n.push(i),{remove:function(){var a=n.indexOf(i);a!==-1&&n.splice(a,1)}}}},{key:"emit",value:function(r){for(var i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var a,o=this._listeners[r]||[];return o.forEach(function(l){a===void 0&&(a=l.apply(void 0,n))}),a}},{key:"teardown",value:function(){this.isDetached=!0,this._listeners=Object.create(null),this._removeTouchMoveWindowListener&&this._removeTouchMoveWindowListener(),this._removeInitialEventListener&&this._removeInitialEventListener(),this._removeEndListener&&this._removeEndListener(),this._onEscListener&&this._onEscListener(),this._removeMoveListener&&this._removeMoveListener(),this._removeKeyUpListener&&this._removeKeyUpListener(),this._removeKeyDownListener&&this._removeKeyDownListener(),this._removeDropFromOutsideListener&&this._removeDropFromOutsideListener(),this._removeDragOverFromOutsideListener&&this._removeDragOverFromOutsideListener()}},{key:"isSelected",value:function(r){var i=this._selectRect;return!i||!this.selecting?!1:pB(i,Ch(r))}},{key:"filter",value:function(r){var i=this._selectRect;return!i||!this.selecting?[]:r.filter(this.isSelected,this)}},{key:"_addLongPressListener",value:function(r,i){var n=this,s=null,a=null,o=null,l=function(d){s=setTimeout(function(){h(),r(d)},n.longPressThreshold),a=en("touchmove",function(){return h()}),o=en("touchend",function(){return h()})},u=en("touchstart",l),h=function(){s&&clearTimeout(s),a&&a(),o&&o(),s=null,a=null,o=null};return i&&l(i),function(){h(),u()}}},{key:"_addInitialEventListener",value:function(){var r=this,i=en("mousedown",function(s){r._removeInitialEventListener(),r._handleInitialEvent(s),r._removeInitialEventListener=en("mousedown",r._handleInitialEvent)}),n=en("touchstart",function(s){r._removeInitialEventListener(),r._removeInitialEventListener=r._addLongPressListener(r._handleInitialEvent,s)});this._removeInitialEventListener=function(){i(),n()}}},{key:"_dropFromOutsideListener",value:function(r){var i=Ad(r),n=i.pageX,s=i.pageY,a=i.clientX,o=i.clientY;this.emit("dropFromOutside",{x:n,y:s,clientX:a,clientY:o}),r.preventDefault()}},{key:"_dragOverFromOutsideListener",value:function(r){var i=Ad(r),n=i.pageX,s=i.pageY,a=i.clientX,o=i.clientY;this.emit("dragOverFromOutside",{x:n,y:s,clientX:a,clientY:o}),r.preventDefault()}},{key:"_handleInitialEvent",value:function(r){if(!this.isDetached){var i=Ad(r),n=i.clientX,s=i.clientY,a=i.pageX,o=i.pageY,l=this.container(),u,h;if(!(r.which===3||r.button===2||!o2e(l,n,s))){if(!this.globalMouse&&l&&!pv(l,r.target)){var c=d2e(0),d=c.top,f=c.left,p=c.bottom,m=c.right;if(h=Ch(l),u=pB({top:h.top-d,left:h.left-f,bottom:h.bottom+p,right:h.right+m},{top:o,left:a}),!u)return}var g=this.emit("beforeSelect",this._initialEventData={isTouch:/^touch/.test(r.type),x:a,y:o,clientX:n,clientY:s});if(g!==!1)switch(r.type){case"mousedown":this._removeEndListener=en("mouseup",this._handleTerminatingEvent),this._onEscListener=en("keydown",this._handleTerminatingEvent),this._removeMoveListener=en("mousemove",this._handleMoveEvent);break;case"touchstart":this._handleMoveEvent(r),this._removeEndListener=en("touchend",this._handleTerminatingEvent),this._removeMoveListener=en("touchmove",this._handleMoveEvent);break}}}}},{key:"_isWithinValidContainer",value:function(r){var i=r.target,n=this.validContainers;return!n||!n.length||!i?!0:n.some(function(s){return!!i.closest(s)})}},{key:"_handleTerminatingEvent",value:function(r){var i=Ad(r),n=i.pageX,s=i.pageY;if(this.selecting=!1,this._removeEndListener&&this._removeEndListener(),this._removeMoveListener&&this._removeMoveListener(),!!this._initialEventData){var a=!this.container||pv(this.container(),r.target),o=this._isWithinValidContainer(r),l=this._selectRect,u=this.isClick(n,s);return this._initialEventData=null,r.key==="Escape"||!o?this.emit("reset"):u&&a?this._handleClickEvent(r):u?this.emit("reset"):this.emit("select",l)}}},{key:"_handleClickEvent",value:function(r){var i=Ad(r),n=i.pageX,s=i.pageY,a=i.clientX,o=i.clientY,l=new Date().getTime();return this._lastClickData&&l-this._lastClickData.timestamp<h2e?(this._lastClickData=null,this.emit("doubleClick",{x:n,y:s,clientX:a,clientY:o})):(this._lastClickData={timestamp:l},this.emit("click",{x:n,y:s,clientX:a,clientY:o}))}},{key:"_handleMoveEvent",value:function(r){if(!(this._initialEventData===null||this.isDetached)){var i=this._initialEventData,n=i.x,s=i.y,a=Ad(r),o=a.pageX,l=a.pageY,u=Math.abs(n-o),h=Math.abs(s-l),c=Math.min(o,n),d=Math.min(l,s),f=this.selecting;this.isClick(o,l)&&!f&&!(u||h)||(this.selecting=!0,this._selectRect={top:d,left:c,x:o,y:l,right:c+u,bottom:d+h},f||this.emit("selectStart",this._initialEventData),this.isClick(o,l)||this.emit("selecting",this._selectRect),r.preventDefault())}}},{key:"_keyListener",value:function(r){this.ctrl=r.metaKey||r.ctrlKey}},{key:"isClick",value:function(r,i){var n=this._initialEventData,s=n.x,a=n.y,o=n.isTouch;return!o&&Math.abs(r-s)<=fB&&Math.abs(i-a)<=fB}}]),e}();function d2e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return Bl(e)!=="object"&&(e={top:e,left:e,right:e,bottom:e}),e}function pB(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=Ch(e),n=i.top,s=i.left,a=i.right,o=a===void 0?s:a,l=i.bottom,u=l===void 0?n:l,h=Ch(t),c=h.top,d=h.left,f=h.right,p=f===void 0?d:f,m=h.bottom,g=m===void 0?c:m;return!(u-r<c||n+r>g||o-r<d||s+r>p)}function Ch(e){if(!e.getBoundingClientRect)return e;var t=e.getBoundingClientRect(),r=t.left+mB("left"),i=t.top+mB("top");return{top:i,left:r,right:(e.offsetWidth||0)+r,bottom:(e.offsetHeight||0)+i}}function mB(e){if(e==="left")return window.pageXOffset||document.body.scrollLeft||0;if(e==="top")return window.pageYOffset||document.body.scrollTop||0}var f2e=function(e){Ln(r,e);var t=In(r);function r(i,n){var s;return Ui(this,r),s=t.call(this,i,n),s.state={selecting:!1},s.containerRef=pe.createRef(),s}return ji(r,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable()}},{key:"componentDidUpdate",value:function(n){!n.selectable&&this.props.selectable&&this._selectable(),n.selectable&&!this.props.selectable&&this._teardownSelectable()}},{key:"render",value:function(){var n=this.props,s=n.range,a=n.getNow,o=n.getters,l=n.date,u=n.components.dateCellWrapper,h=n.localizer,c=this.state,d=c.selecting,f=c.startIdx,p=c.endIdx,m=a();return fe.createElement("div",{className:"rbc-row-bg",ref:this.containerRef},s.map(function(g,v){var y=d&&v>=f&&v<=p,x=o.dayProp(g),w=x.className,S=x.style;return fe.createElement(u,{key:v,value:g,range:s},fe.createElement("div",{style:S,className:Ai("rbc-day-bg",w,y&&"rbc-selected-cell",h.isSameDate(g,m)&&"rbc-today",l&&h.neq(l,g,"month")&&"rbc-off-range-bg")}))}))}},{key:"_selectable",value:function(){var n=this,s=this.containerRef.current,a=this._selector=new VW(this.props.container,{longPressThreshold:this.props.longPressThreshold}),o=function(u,h){if(!xw(s,u)&&!c2e(s,u)){var c=Ch(s),d=n.props,f=d.range,p=d.rtl;if(r2e(c,u)){var m=jW(c,u.x,p,f.length);n._selectSlot({startIdx:m,endIdx:m,action:h,box:u})}}n._initial={},n.setState({selecting:!1})};a.on("selecting",function(l){var u=n.props,h=u.range,c=u.rtl,d=-1,f=-1;if(n.state.selecting||(Nr(n.props.onSelectStart,[l]),n._initial={x:l.x,y:l.y}),a.isSelected(s)){var p=Ch(s),m=i2e(n._initial,p,l,h.length,c);d=m.startIdx,f=m.endIdx}n.setState({selecting:!0,startIdx:d,endIdx:f})}),a.on("beforeSelect",function(l){if(n.props.selectable==="ignoreEvents")return!xw(n.containerRef.current,l)}),a.on("click",function(l){return o(l,"click")}),a.on("doubleClick",function(l){return o(l,"doubleClick")}),a.on("select",function(l){n._selectSlot(vr(vr({},n.state),{},{action:"select",bounds:l})),n._initial={},n.setState({selecting:!1}),Nr(n.props.onSelectEnd,[n.state])})}},{key:"_teardownSelectable",value:function(){this._selector&&(this._selector.teardown(),this._selector=null)}},{key:"_selectSlot",value:function(n){var s=n.endIdx,a=n.startIdx,o=n.action,l=n.bounds,u=n.box;s!==-1&&a!==-1&&this.props.onSelectSlot&&this.props.onSelectSlot({start:a,end:s,action:o,bounds:l,box:u,resourceId:this.props.resourceId})}}]),r}(fe.Component),so={propTypes:{slotMetrics:Ue.object.isRequired,selected:Ue.object,isAllDay:Ue.bool,accessors:Ue.object.isRequired,localizer:Ue.object.isRequired,components:Ue.object.isRequired,getters:Ue.object.isRequired,onSelect:Ue.func,onDoubleClick:Ue.func,onKeyPress:Ue.func},defaultProps:{segments:[],selected:{}},renderEvent:function(t,r){var i=t.selected;t.isAllDay;var n=t.accessors,s=t.getters,a=t.onSelect,o=t.onDoubleClick,l=t.onKeyPress,u=t.localizer,h=t.slotMetrics,c=t.components,d=t.resizable,f=h.continuesPrior(r),p=h.continuesAfter(r);return fe.createElement(FW,{event:r,getters:s,localizer:u,accessors:n,components:c,onSelect:a,onDoubleClick:o,onKeyPress:l,continuesPrior:f,continuesAfter:p,slotStart:h.first,slotEnd:h.last,selected:kb(r,i),resizable:d})},renderSpan:function(t,r,i){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:" ",s=Math.abs(r)/t*100+"%";return fe.createElement("div",{key:i,className:"rbc-row-segment",style:{WebkitFlexBasis:s,flexBasis:s,maxWidth:s}},n)}},WW=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){var n=this,s=this.props,a=s.segments,o=s.slotMetrics.slots,l=s.className,u=1;return fe.createElement("div",{className:Ai(l,"rbc-row")},a.reduce(function(h,c,d){var f=c.event,p=c.left,m=c.right,g=c.span,v="_lvl_"+d,y=p-u,x=so.renderEvent(n.props,f);return y&&h.push(so.renderSpan(o,y,"".concat(v,"_gap"))),h.push(so.renderSpan(o,g,v,x)),u=m+1,h},[]))}}]),r}(fe.Component);WW.defaultProps=vr({},so.defaultProps);function GW(e){var t=e.dateRange,r=e.unit,i=r===void 0?"day":r,n=e.localizer;return{first:t[0],last:n.add(t[t.length-1],1,i)}}function p2e(e,t,r,i){var n=GW({dateRange:t,localizer:i}),s=n.first,a=n.last,o=i.diff(s,a,"day"),l=i.max(i.startOf(r.start(e),"day"),s),u=i.min(i.ceil(r.end(e),"day"),a),h=rTe(t,function(d){return i.isSameDate(d,l)}),c=i.diff(l,u,"day");return c=Math.min(c,o),c=Math.max(c-i.segmentOffset,1),{event:e,span:c,left:h+1,right:Math.max(h+c,1)}}function YW(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1/0,r,i,n,s=[],a=[];for(r=0;r<e.length;r++){for(n=e[r],i=0;i<s.length&&m2e(n,s[i]);i++);i>=t?a.push(n):(s[i]||(s[i]=[])).push(n)}for(r=0;r<s.length;r++)s[r].sort(function(o,l){return o.left-l.left});return{levels:s,extra:a}}function _v(e,t,r,i,n){var s={start:i.start(e),end:i.end(e)},a={start:t,end:r};return n.inEventRange({event:s,range:a})}function m2e(e,t){return t.some(function(r){return r.left<=e.right&&r.right>=e.left})}function qW(e,t,r,i){var n={start:r.start(e),end:r.end(e),allDay:r.allDay(e)},s={start:r.start(t),end:r.end(t),allDay:r.allDay(t)};return i.sortEvents({evtA:n,evtB:s})}var XW=function(t,r){return t.left<=r&&t.right>=r},gB=function(t,r){return t.filter(function(i){return XW(i,r)}).length},$W=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){for(var n=this.props,s=n.segments,a=n.slotMetrics.slots,o=YW(s).levels[0],l=1,u=1,h=[];l<=a;){var c="_lvl_"+l,d=o.filter(function(x){return XW(x,l)})[0]||{},f=d.event,p=d.left,m=d.right,g=d.span;if(!f){l++;continue}var v=Math.max(0,p-u);if(this.canRenderSlotEvent(p,g)){var y=so.renderEvent(this.props,f);v&&h.push(so.renderSpan(a,v,c+"_gap")),h.push(so.renderSpan(a,g,c,y)),u=l=m+1}else v&&h.push(so.renderSpan(a,v,c+"_gap")),h.push(so.renderSpan(a,1,c,this.renderShowMore(s,l))),u=l=l+1}return fe.createElement("div",{className:"rbc-row"},h)}},{key:"canRenderSlotEvent",value:function(n,s){var a=this.props.segments;return lTe(n,n+s).every(function(o){var l=gB(a,o);return l===1})}},{key:"renderShowMore",value:function(n,s){var a=this,o=this.props.localizer,l=gB(n,s);return l?fe.createElement("button",{type:"button",key:"sm_"+s,className:Ai("rbc-button-link","rbc-show-more"),onClick:function(h){return a.showMore(s,h)}},o.messages.showMore(l)):!1}},{key:"showMore",value:function(n,s){s.preventDefault(),s.stopPropagation(),this.props.onShowMore(n,s.target)}}]),r}(fe.Component);$W.defaultProps=vr({},so.defaultProps);var g2e=function(t){var r=t.children;return fe.createElement("div",{className:"rbc-row-content-scroll-container"},r)},v2e=function(t,r){return t.left<=r&&t.right>=r},y2e=function(t,r){return t[0].range===r[0].range&&t[0].events===r[0].events};function QW(){return bW(function(e){for(var t=e.range,r=e.events,i=e.maxRows,n=e.minRows,s=e.accessors,a=e.localizer,o=GW({dateRange:t,localizer:a}),l=o.first,u=o.last,h=r.map(function(m){return p2e(m,t,s,a)}),c=YW(h,Math.max(i-1,1)),d=c.levels,f=c.extra,p=f.length>0?n-1:n;d.length<p;)d.push([]);return{first:l,last:u,levels:d,extra:f,range:t,slots:t.length,clone:function(g){var v=QW();return v(vr(vr({},e),g))},getDateForSlot:function(g){return t[g]},getSlotForDate:function(g){return t.find(function(v){return a.isSameDate(v,g)})},getEventsForSlot:function(g){return h.filter(function(v){return v2e(v,g)}).map(function(v){return v.event})},continuesPrior:function(g){return a.continuesPrior(s.start(g),l)},continuesAfter:function(g){var v=s.start(g),y=s.end(g);return a.continuesAfter(v,y,u)}}},y2e)}var ww=function(e){Ln(r,e);var t=In(r);function r(){var i;Ui(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s)),i.handleSelectSlot=function(o){var l=i.props,u=l.range,h=l.onSelectSlot;h(u.slice(o.start,o.end+1),o)},i.handleShowMore=function(o,l){var u=i.props,h=u.range,c=u.onShowMore,d=i.slotMetrics(i.props),f=__e(i.containerRef.current,".rbc-row-bg")[0],p;f&&(p=f.children[o-1]);var m=d.getEventsForSlot(o);c(m,h[o-1],p,o,l)},i.getContainer=function(){var o=i.props.container;return o?o():i.containerRef.current},i.renderHeadingCell=function(o,l){var u=i.props,h=u.renderHeader,c=u.getNow,d=u.localizer;return h({date:o,key:"header_".concat(l),className:Ai("rbc-date-cell",d.isSameDate(o,c())&&"rbc-now")})},i.renderDummy=function(){var o=i.props,l=o.className,u=o.range,h=o.renderHeader,c=o.showAllEvents;return fe.createElement("div",{className:l,ref:i.containerRef},fe.createElement("div",{className:Ai("rbc-row-content",c&&"rbc-row-content-scrollable")},h&&fe.createElement("div",{className:"rbc-row",ref:i.headingRowRef},u.map(i.renderHeadingCell)),fe.createElement("div",{className:"rbc-row",ref:i.eventRowRef},fe.createElement("div",{className:"rbc-row-segment"},fe.createElement("div",{className:"rbc-event"},fe.createElement("div",{className:"rbc-event-content"}," "))))))},i.containerRef=pe.createRef(),i.headingRowRef=pe.createRef(),i.eventRowRef=pe.createRef(),i.slotMetrics=QW(),i}return ji(r,[{key:"getRowLimit",value:function(){var n,s=VM(this.eventRowRef.current),a=(n=this.headingRowRef)!==null&&n!==void 0&&n.current?VM(this.headingRowRef.current):0,o=VM(this.containerRef.current)-a;return Math.max(Math.floor(o/s),1)}},{key:"render",value:function(){var n=this.props,s=n.date,a=n.rtl,o=n.range,l=n.className,u=n.selected,h=n.selectable,c=n.renderForMeasure,d=n.accessors,f=n.getters,p=n.components,m=n.getNow,g=n.renderHeader,v=n.onSelect,y=n.localizer,x=n.onSelectStart,w=n.onSelectEnd,S=n.onDoubleClick,_=n.onKeyPress,A=n.resourceId,M=n.longPressThreshold,T=n.isAllDay,C=n.resizable,L=n.showAllEvents;if(c)return this.renderDummy();var I=this.slotMetrics(this.props),k=I.levels,z=I.extra,V=L?g2e:cl,K=p.weekWrapper,q={selected:u,accessors:d,getters:f,localizer:y,components:p,onSelect:v,onDoubleClick:S,onKeyPress:_,resourceId:A,slotMetrics:I,resizable:C};return fe.createElement("div",{className:l,role:"rowgroup",ref:this.containerRef},fe.createElement(f2e,{localizer:y,date:s,getNow:m,rtl:a,range:o,selectable:h,container:this.getContainer,getters:f,onSelectStart:x,onSelectEnd:w,onSelectSlot:this.handleSelectSlot,components:p,longPressThreshold:M,resourceId:A}),fe.createElement("div",{className:Ai("rbc-row-content",L&&"rbc-row-content-scrollable"),role:"row"},g&&fe.createElement("div",{className:"rbc-row ",ref:this.headingRowRef},o.map(this.renderHeadingCell)),fe.createElement(V,null,fe.createElement(K,Object.assign({isAllDay:T},q,{rtl:this.props.rtl}),k.map(function(O,W){return fe.createElement(WW,Object.assign({key:W,segments:O},q))}),!!z.length&&fe.createElement($W,Object.assign({segments:z,onShowMore:this.handleShowMore},q))))))}}]),r}(fe.Component);ww.defaultProps={minRows:0,maxRows:1/0};var KW=function(t){var r=t.label;return fe.createElement("span",{role:"columnheader","aria-sort":"none"},r)},x2e=function(t){var r=t.label,i=t.drilldownView,n=t.onDrillDown;return i?fe.createElement("button",{type:"button",className:"rbc-button-link",onClick:n,role:"cell"},r):fe.createElement("span",null,r)},w2e=["date","className"],b2e=function(t,r,i,n,s){return t.filter(function(a){return _v(a,r,i,n,s)})},zb=function(e){Ln(r,e);var t=In(r);function r(){var i;Ui(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s)),i.getContainer=function(){return i.containerRef.current},i.renderWeek=function(o,l){var u=i.props,h=u.events,c=u.components,d=u.selectable,f=u.getNow,p=u.selected,m=u.date,g=u.localizer,v=u.longPressThreshold,y=u.accessors,x=u.getters,w=u.showAllEvents,S=i.state,_=S.needLimitMeasure,A=S.rowLimit,M=b2e(Tbe(h),o[0],o[o.length-1],y,g);return M.sort(function(T,C){return qW(T,C,y,g)}),fe.createElement(ww,{key:l,ref:l===0?i.slotRowRef:void 0,container:i.getContainer,className:"rbc-month-row",getNow:f,date:m,range:o,events:M,maxRows:w?1/0:A,selected:p,selectable:d,components:c,accessors:y,getters:x,localizer:g,renderHeader:i.readerDateHeading,renderForMeasure:_,onShowMore:i.handleShowMore,onSelect:i.handleSelectEvent,onDoubleClick:i.handleDoubleClickEvent,onKeyPress:i.handleKeyPressEvent,onSelectSlot:i.handleSelectSlot,longPressThreshold:v,rtl:i.props.rtl,resizable:i.props.resizable,showAllEvents:w})},i.readerDateHeading=function(o){var l=o.date,u=o.className,h=So(o,w2e),c=i.props,d=c.date,f=c.getDrilldownView,p=c.localizer,m=p.neq(l,d,"month"),g=p.isSameDate(l,d),v=f(l),y=p.format(l,"dateFormat"),x=i.props.components.dateHeader||x2e;return fe.createElement("div",Object.assign({},h,{className:Ai(u,m&&"rbc-off-range",g&&"rbc-current"),role:"cell"}),fe.createElement(x,{label:y,date:l,drilldownView:v,isOffRange:m,onDrillDown:function(S){return i.handleHeadingClick(l,v,S)}}))},i.handleSelectSlot=function(o,l){i._pendingSelection=i._pendingSelection.concat(o),clearTimeout(i._selectTimer),i._selectTimer=setTimeout(function(){return i.selectDates(l)})},i.handleHeadingClick=function(o,l,u){u.preventDefault(),i.clearSelection(),Nr(i.props.onDrillDown,[o,l])},i.handleSelectEvent=function(){i.clearSelection();for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onSelectEvent,l)},i.handleDoubleClickEvent=function(){i.clearSelection();for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onDoubleClickEvent,l)},i.handleKeyPressEvent=function(){i.clearSelection();for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onKeyPressEvent,l)},i.handleShowMore=function(o,l,u,h,c){var d=i.props,f=d.popup,p=d.onDrillDown,m=d.onShowMore,g=d.getDrilldownView,v=d.doShowMoreDrillDown;if(i.clearSelection(),f){var y=ZV(u,i.containerRef.current);i.setState({overlay:{date:l,events:o,position:y,target:c}})}else v&&Nr(p,[l,g(l)||Sn.DAY]);Nr(m,[o,l,h])},i.overlayDisplay=function(){i.setState({overlay:null})},i.state={rowLimit:5,needLimitMeasure:!0,date:null},i.containerRef=pe.createRef(),i.slotRowRef=pe.createRef(),i._bgRows=[],i._pendingSelection=[],i}return ji(r,[{key:"componentDidMount",value:function(){var n=this,s;this.state.needLimitMeasure&&this.measureRowLimit(this.props),window.addEventListener("resize",this._resizeListener=function(){s||JV(function(){s=!1,n.setState({needLimitMeasure:!0})})},!1)}},{key:"componentDidUpdate",value:function(){this.state.needLimitMeasure&&this.measureRowLimit(this.props)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeListener,!1)}},{key:"render",value:function(){var n=this.props,s=n.date,a=n.localizer,o=n.className,l=a.visibleDays(s,a),u=a_e(l,7);return this._weekCount=u.length,fe.createElement("div",{className:Ai("rbc-month-view",o),role:"table","aria-label":"Month View",ref:this.containerRef},fe.createElement("div",{className:"rbc-row rbc-month-header",role:"row"},this.renderHeaders(u[0])),u.map(this.renderWeek),this.props.popup&&this.renderOverlay())}},{key:"renderHeaders",value:function(n){var s=this.props,a=s.localizer,o=s.components,l=n[0],u=n[n.length-1],h=o.header||KW;return a.range(l,u,"day").map(function(c,d){return fe.createElement("div",{key:"header_"+d,className:"rbc-header"},fe.createElement(h,{date:c,localizer:a,label:a.format(c,"weekdayFormat")}))})}},{key:"renderOverlay",value:function(){var n,s,a=this,o=(n=(s=this.state)===null||s===void 0?void 0:s.overlay)!==null&&n!==void 0?n:{},l=this.props,u=l.accessors,h=l.localizer,c=l.components,d=l.getters,f=l.selected,p=l.popupOffset,m=l.handleDragStart,g=function(){return a.setState({overlay:null})};return fe.createElement(vP,{overlay:o,accessors:u,localizer:h,components:c,getters:d,selected:f,popupOffset:p,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:m,show:!!o.position,overlayDisplay:this.overlayDisplay,onHide:g})}},{key:"measureRowLimit",value:function(){this.setState({needLimitMeasure:!1,rowLimit:this.slotRowRef.current.getRowLimit()})}},{key:"selectDates",value:function(n){var s=this._pendingSelection.slice();this._pendingSelection=[],s.sort(function(l,u){return+l-+u});var a=new Date(s[0]),o=new Date(s[s.length-1]);o.setDate(s[s.length-1].getDate()+1),Nr(this.props.onSelectSlot,{slots:s,start:a,end:o,action:n.action,bounds:n.bounds,box:n.box})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}}],[{key:"getDerivedStateFromProps",value:function(n,s){var a=n.date,o=n.localizer;return{date:a,needLimitMeasure:o.neq(a,s.date,"month")}}}]),r}(fe.Component);zb.range=function(e,t){var r=t.localizer,i=r.firstVisibleDay(e,r),n=r.lastVisibleDay(e,r);return{start:i,end:n}};zb.navigate=function(e,t,r){var i=r.localizer;switch(t){case Jn.PREVIOUS:return i.add(e,-1,"month");case Jn.NEXT:return i.add(e,1,"month");default:return e}};zb.title=function(e,t){var r=t.localizer;return r.format(e,"monthHeaderFormat")};var vB=function(t){var r=t.min,i=t.max,n=t.step,s=t.slots,a=t.localizer;return"".concat(+a.startOf(r,"minutes"))+"".concat(+a.startOf(i,"minutes"))+"".concat(n,"-").concat(s)};function yP(e){for(var t=e.min,r=e.max,i=e.step,n=e.timeslots,s=e.localizer,a=vB({start:t,end:r,step:i,timeslots:n,localizer:s}),o=1+s.getTotalMin(t,r),l=s.getMinutesFromMidnight(t),u=Math.ceil((o-1)/(i*n)),h=u*n,c=new Array(u),d=new Array(h),f=0;f<u;f++){c[f]=new Array(n);for(var p=0;p<n;p++){var m=f*n+p,g=m*i;d[m]=c[f][p]=s.getSlotDate(t,l,g)}}var v=d.length*i;d.push(s.getSlotDate(t,l,v));function y(x){var w=s.diff(t,x,"minutes")+s.getDstOffset(t,x);return Math.min(w,o)}return{groups:c,update:function(w){return vB(w)!==a?yP(w):this},dateIsInGroup:function(w,S){var _=c[S+1];return s.inRange(w,c[S][0],_?_[0]:r,"minutes")},nextSlot:function(w){var S=d[Math.min(d.indexOf(w)+1,d.length-1)];return S===w&&(S=s.add(w,i,"minutes")),S},closestSlotToPosition:function(w){var S=Math.min(d.length-1,Math.max(0,Math.floor(w*h)));return d[S]},closestSlotFromPoint:function(w,S){var _=Math.abs(S.top-S.bottom);return this.closestSlotToPosition((w.y-S.top)/_)},closestSlotFromDate:function(w){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(s.lt(w,t,"minutes"))return d[0];if(s.gt(w,r,"minutes"))return d[d.length-1];var _=s.diff(t,w,"minutes");return d[(_-_%i)/i+S]},startsBeforeDay:function(w){return s.lt(w,t,"day")},startsAfterDay:function(w){return s.gt(w,r,"day")},startsBefore:function(w){return s.lt(s.merge(t,w),t,"minutes")},startsAfter:function(w){return s.gt(s.merge(r,w),r,"minutes")},getRange:function(w,S,_,A){_||(w=s.min(r,s.max(t,w))),A||(S=s.min(r,s.max(t,S)));var M=y(w),T=y(S),C=T>i*h&&!s.eq(r,S)?(M-i)/(i*h)*100:M/(i*h)*100;return{top:C,height:T/(i*h)*100-C,start:y(w),startDate:w,end:y(S),endDate:S}},getCurrentTimePosition:function(w){var S=y(w),_=S/(i*h)*100;return _}}}var _2e=function(){function e(t,r){var i=r.accessors,n=r.slotMetrics;Ui(this,e);var s=n.getRange(i.start(t),i.end(t)),a=s.start,o=s.startDate,l=s.end,u=s.endDate,h=s.top,c=s.height;this.start=a,this.end=l,this.startMs=+o,this.endMs=+u,this.top=h,this.height=c,this.data=t}return ji(e,[{key:"_width",get:function(){if(this.rows){var r=this.rows.reduce(function(n,s){return Math.max(n,s.leaves.length+1)},0)+1;return 100/r}if(this.leaves){var i=100-this.container._width;return i/(this.leaves.length+1)}return this.row._width}},{key:"width",get:function(){var r=this._width,i=Math.min(100,this._width*1.7);if(this.rows)return i;if(this.leaves)return this.leaves.length>0?i:r;var n=this.row.leaves,s=n.indexOf(this);return s===n.length-1?r:i}},{key:"xOffset",get:function(){if(this.rows)return 0;if(this.leaves)return this.container._width;var r=this.row,i=r.leaves,n=r.xOffset,s=r._width,a=i.indexOf(this)+1;return n+a*s}}]),e}();function S2e(e,t,r){return Math.abs(t.start-e.start)<r||t.start>e.start&&t.start<e.end}function M2e(e){for(var t=RTe(e,["startMs",function(o){return-o.endMs}]),r=[];t.length>0;){var i=t.shift();r.push(i);for(var n=0;n<t.length;n++){var s=t[n];if(!(i.endMs>s.startMs)){if(n>0){var a=t.splice(n,1)[0];r.push(a)}break}}}return r}function ZW(e){for(var t=e.events,r=e.minimumStartDifference,i=e.slotMetrics,n=e.accessors,s=t.map(function(c){return new _2e(c,{slotMetrics:i,accessors:n})}),a=M2e(s),o=[],l=function(){var d=a[u],f=o.find(function(g){return g.end>d.start||Math.abs(d.start-g.start)<r});if(!f)return d.rows=[],o.push(d),"continue";d.container=f;for(var p=null,m=f.rows.length-1;!p&&m>=0;m--)S2e(f.rows[m],d,r)&&(p=f.rows[m]);p?(p.leaves.push(d),d.row=p):(d.leaves=[],f.rows.push(d))},u=0;u<a.length;u++)var h=l();return a.map(function(c){return{event:c.data,style:{top:c.top,height:c.height,width:c.width,xOffset:Math.max(0,c.xOffset)}}})}function JW(e,t,r){for(var i=0;i<e.friends.length;++i)if(!(r.indexOf(e.friends[i])>-1)){t=t>e.friends[i].idx?t:e.friends[i].idx,r.push(e.friends[i]);var n=JW(e.friends[i],t,r);t=t>n?t:n}return t}function E2e(e){var t=e.events,r=e.minimumStartDifference,i=e.slotMetrics,n=e.accessors,s=ZW({events:t,minimumStartDifference:r,slotMetrics:i,accessors:n});s.sort(function(V,K){return V=V.style,K=K.style,V.top!==K.top?V.top>K.top?1:-1:V.top+V.height<K.top+K.height?1:-1});for(var a=0;a<s.length;++a)s[a].friends=[],delete s[a].style.left,delete s[a].style.left,delete s[a].idx,delete s[a].size;for(var o=0;o<s.length-1;++o)for(var l=s[o],u=l.style.top,h=l.style.top+l.style.height,c=o+1;c<s.length;++c){var d=s[c],f=d.style.top,p=d.style.top+d.style.height;(f>=u&&p<=h||p>u&&p<=h||f>=u&&f<h)&&(l.friends.push(d),d.friends.push(l))}for(var m=0;m<s.length;++m){for(var g=s[m],v=[],y=0;y<100;++y)v.push(1);for(var x=0;x<g.friends.length;++x)g.friends[x].idx!==void 0&&(v[g.friends[x].idx]=0);g.idx=v.indexOf(1)}for(var w=0;w<s.length;++w){var S=0;if(!s[w].size){var _=[],A=JW(s[w],0,_);S=100/(A+1),s[w].size=S;for(var M=0;M<_.length;++M)_[M].size=S}}for(var T=0;T<s.length;++T){var C=s[T];C.style.left=C.idx*C.size;for(var L=0,I=0;I<C.friends.length;++I){var k=C.friends[I].idx;L=L>k?L:k}L<=C.idx&&(C.size=100-C.idx*C.size);var z=C.idx===0?0:3;C.style.width="calc(".concat(C.size,"% - ").concat(z,"px)"),C.style.height="calc(".concat(C.style.height,"% - 2px)"),C.style.xOffset="calc(".concat(C.style.left,"% + ").concat(z,"px)")}return s}var yB={overlap:ZW,"no-overlap":E2e};function A2e(e){return!!(e&&e.constructor&&e.call&&e.apply)}function T2e(e){e.events,e.minimumStartDifference,e.slotMetrics,e.accessors;var t=e.dayLayoutAlgorithm,r=t;return t in yB&&(r=yB[t]),A2e(r)?r.apply(this,arguments):[]}var e6=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.renderSlot,a=n.resource,o=n.group,l=n.getters,u=n.components,h=u===void 0?{}:u,c=h.timeSlotWrapper,d=c===void 0?cl:c,f=l?l.slotGroupProp(o):{};return fe.createElement("div",Object.assign({className:"rbc-timeslot-group"},f),o.map(function(p,m){var g=l?l.slotProp(p,a):{};return fe.createElement(d,{key:m,value:p,resource:a},fe.createElement("div",Object.assign({},g,{className:Ai("rbc-time-slot",g.className)}),s&&s(p,m)))}))}}]),r}(pe.Component);function Cc(e){return typeof e=="string"?e:e+"%"}function C2e(e){var t=e.style,r=e.className,i=e.event,n=e.accessors,s=e.rtl,a=e.selected,o=e.label,l=e.continuesPrior,u=e.continuesAfter,h=e.getters,c=e.onClick,d=e.onDoubleClick,f=e.isBackgroundEvent,p=e.onKeyPress,m=e.components,g=m.event,v=m.eventWrapper,y=n.title(i),x=n.tooltip(i),w=n.end(i),S=n.start(i),_=h.eventProp(i,S,w,a),A=t.height,M=t.top,T=t.width,C=t.xOffset,L=[fe.createElement("div",{key:"1",className:"rbc-event-label"},o),fe.createElement("div",{key:"2",className:"rbc-event-content"},g?fe.createElement(g,{event:i,title:y}):y)],I=f?vr(vr({},_.style),{},Eu({top:Cc(M),height:Cc(A),width:"calc(".concat(T," + 10px)")},s?"right":"left",Cc(Math.max(0,C)))):vr(vr({},_.style),{},Eu({top:Cc(M),width:Cc(T),height:Cc(A)},s?"right":"left",Cc(C)));return fe.createElement(v,Object.assign({type:"time"},e),fe.createElement("div",{onClick:c,onDoubleClick:d,style:I,onKeyPress:p,title:x?(typeof o=="string"?o+": ":"")+x:void 0,className:Ai(f?"rbc-background-event":"rbc-event",r,_.className,{"rbc-selected":a,"rbc-event-continues-earlier":l,"rbc-event-continues-later":u})},L))}var D2e=function(t){var r=t.children,i=t.className,n=t.style,s=t.innerRef;return fe.createElement("div",{className:i,style:n,ref:s},r)},P2e=fe.forwardRef(function(e,t){return fe.createElement(D2e,Object.assign({},e,{innerRef:t}))}),O2e=["dayProp"],L2e=["eventContainerWrapper"],t6=function(e){Ln(r,e);var t=In(r);function r(){var i;Ui(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s)),i.state={selecting:!1,timeIndicatorPosition:null},i.intervalTriggered=!1,i.renderEvents=function(o){var l=o.events,u=o.isBackgroundEvent,h=i.props,c=h.rtl,d=h.selected,f=h.accessors,p=h.localizer,m=h.getters,g=h.components,v=h.step,y=h.timeslots,x=h.dayLayoutAlgorithm,w=h.resizable,S=DV(i),_=S.slotMetrics,A=p.messages,M=T2e({events:l,accessors:f,slotMetrics:_,minimumStartDifference:Math.ceil(v*y/2),dayLayoutAlgorithm:x});return M.map(function(T,C){var L=T.event,I=T.style,k=f.end(L),z=f.start(L),V="eventTimeRangeFormat",K,q=_.startsBeforeDay(z),O=_.startsAfterDay(k);q?V="eventTimeRangeEndFormat":O&&(V="eventTimeRangeStartFormat"),q&&O?K=A.allDay:K=p.format({start:z,end:k},V);var W=q||_.startsBefore(z),N=O||_.startsAfter(k);return fe.createElement(C2e,{style:I,event:L,label:K,key:"evt_"+C,getters:m,rtl:c,components:g,continuesPrior:W,continuesAfter:N,accessors:f,resource:i.props.resource,selected:kb(L,d),onClick:function(j){return i._select(vr(vr({},L),{},{sourceResource:i.props.resource}),j)},onDoubleClick:function(j){return i._doubleClick(L,j)},isBackgroundEvent:u,onKeyPress:function(j){return i._keyPress(L,j)},resizable:w})})},i._selectable=function(){var o=i.containerRef.current,l=i.props,u=l.longPressThreshold,h=l.localizer,c=i._selector=new VW(function(){return o},{longPressThreshold:u}),d=function(g){var v=i.props.onSelecting,y=i.state||{},x=f(g),w=x.startDate,S=x.endDate;v&&(h.eq(y.startDate,w,"minutes")&&h.eq(y.endDate,S,"minutes")||v({start:w,end:S,resourceId:i.props.resource})===!1)||(i.state.start!==x.start||i.state.end!==x.end||i.state.selecting!==x.selecting)&&i.setState(x)},f=function(g){var v=i.slotMetrics.closestSlotFromPoint(g,Ch(o));i.state.selecting||(i._initialSlot=v);var y=i._initialSlot;h.lte(y,v)?v=i.slotMetrics.nextSlot(v):h.gt(y,v)&&(y=i.slotMetrics.nextSlot(y));var x=i.slotMetrics.getRange(h.min(y,v),h.max(y,v));return vr(vr({},x),{},{selecting:!0,top:"".concat(x.top,"%"),height:"".concat(x.height,"%")})},p=function(g,v){if(!xw(i.containerRef.current,g)){var y=f(g),x=y.startDate,w=y.endDate;i._selectSlot({startDate:x,endDate:w,action:v,box:g})}i.setState({selecting:!1})};c.on("selecting",d),c.on("selectStart",d),c.on("beforeSelect",function(m){if(i.props.selectable==="ignoreEvents")return!xw(i.containerRef.current,m)}),c.on("click",function(m){return p(m,"click")}),c.on("doubleClick",function(m){return p(m,"doubleClick")}),c.on("select",function(m){i.state.selecting&&(i._selectSlot(vr(vr({},i.state),{},{action:"select",bounds:m})),i.setState({selecting:!1}))}),c.on("reset",function(){i.state.selecting&&i.setState({selecting:!1})})},i._teardownSelectable=function(){i._selector&&(i._selector.teardown(),i._selector=null)},i._selectSlot=function(o){for(var l=o.startDate,u=o.endDate,h=o.action,c=o.bounds,d=o.box,f=l,p=[];i.props.localizer.lte(f,u);)p.push(f),f=new Date(+f+i.props.step*60*1e3);Nr(i.props.onSelectSlot,{slots:p,start:l,end:u,resourceId:i.props.resource,action:h,bounds:c,box:d})},i._select=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onSelectEvent,l)},i._doubleClick=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onDoubleClickEvent,l)},i._keyPress=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onKeyPressEvent,l)},i.slotMetrics=yP(i.props),i.containerRef=pe.createRef(),i}return ji(r,[{key:"componentDidMount",value:function(){this.props.selectable&&this._selectable(),this.props.isNow&&this.setTimeIndicatorPositionUpdateInterval()}},{key:"componentWillUnmount",value:function(){this._teardownSelectable(),this.clearTimeIndicatorInterval()}},{key:"UNSAFE_componentWillReceiveProps",value:function(n){n.selectable&&!this.props.selectable&&this._selectable(),!n.selectable&&this.props.selectable&&this._teardownSelectable(),this.slotMetrics=this.slotMetrics.update(n)}},{key:"componentDidUpdate",value:function(n,s){var a=this.props,o=a.getNow,l=a.isNow,u=a.localizer,h=a.date,c=a.min,d=a.max,f=u.neq(n.getNow(),o(),"minutes");if(n.isNow!==l||f){if(this.clearTimeIndicatorInterval(),l){var p=!f&&u.eq(n.date,h,"minutes")&&s.timeIndicatorPosition===this.state.timeIndicatorPosition;this.setTimeIndicatorPositionUpdateInterval(p)}}else l&&(u.neq(n.min,c,"minutes")||u.neq(n.max,d,"minutes"))&&this.positionTimeIndicator()}},{key:"setTimeIndicatorPositionUpdateInterval",value:function(){var n=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;!this.intervalTriggered&&!s&&this.positionTimeIndicator(),this._timeIndicatorTimeout=window.setTimeout(function(){n.intervalTriggered=!0,n.positionTimeIndicator(),n.setTimeIndicatorPositionUpdateInterval()},6e4)}},{key:"clearTimeIndicatorInterval",value:function(){this.intervalTriggered=!1,window.clearTimeout(this._timeIndicatorTimeout)}},{key:"positionTimeIndicator",value:function(){var n=this.props,s=n.min,a=n.max,o=n.getNow,l=o();if(l>=s&&l<=a){var u=this.slotMetrics.getCurrentTimePosition(l);this.intervalTriggered=!0,this.setState({timeIndicatorPosition:u})}else this.clearTimeIndicatorInterval()}},{key:"render",value:function(){var n=this.props,s=n.date,a=n.max,o=n.rtl,l=n.isNow,u=n.resource,h=n.accessors,c=n.localizer,d=n.getters,f=d.dayProp,p=So(d,O2e),m=n.components,g=m.eventContainerWrapper,v=So(m,L2e),y=this.slotMetrics,x=this.state,w=x.selecting,S=x.top,_=x.height,A=x.startDate,M=x.endDate,T={start:A,end:M},C=f(a),L=C.className,I=C.style,k=v.dayColumnWrapper||P2e;return fe.createElement(k,{ref:this.containerRef,date:s,style:I,className:Ai(L,"rbc-day-slot","rbc-time-column",l&&"rbc-now",l&&"rbc-today",w&&"rbc-slot-selecting"),slotMetrics:y},y.groups.map(function(z,V){return fe.createElement(e6,{key:V,group:z,resource:u,getters:p,components:v})}),fe.createElement(g,{localizer:c,resource:u,accessors:h,getters:p,components:v,slotMetrics:y},fe.createElement("div",{className:Ai("rbc-events-container",o&&"rtl")},this.renderEvents({events:this.props.backgroundEvents,isBackgroundEvent:!0}),this.renderEvents({events:this.props.events}))),w&&fe.createElement("div",{className:"rbc-slot-selection",style:{top:S,height:_}},fe.createElement("span",null,c.format(T,"selectRangeFormat"))),l&&this.intervalTriggered&&fe.createElement("div",{className:"rbc-current-time-indicator",style:{top:"".concat(this.state.timeIndicatorPosition,"%")}}))}}]),r}(fe.Component);t6.defaultProps={dragThroughEvents:!0,timeslots:2};function I2e(e){var t=e.min,r=e.max,i=e.localizer;return i.getTimezoneOffset(t)!==i.getTimezoneOffset(r)?{start:i.add(t,-1,"day"),end:i.add(r,-1,"day")}:{start:t,end:r}}var R2e=function(t){var r=t.min,i=t.max,n=t.timeslots,s=t.step,a=t.localizer,o=t.getNow,l=t.resource,u=t.components,h=t.getters,c=t.gutterRef,d=u.timeGutterWrapper,f=pe.useMemo(function(){return I2e({min:r,max:i,localizer:a})},[r==null?void 0:r.toISOString(),i==null?void 0:i.toISOString(),a]),p=f.start,m=f.end,g=pe.useState(yP({min:p,max:m,timeslots:n,step:s,localizer:a})),v=gl(g,2),y=v[0],x=v[1];pe.useEffect(function(){y&&x(y.update({min:p,max:m,timeslots:n,step:s,localizer:a}))},[p==null?void 0:p.toISOString(),m==null?void 0:m.toISOString(),n,s]);var w=pe.useCallback(function(S,_){if(_)return null;var A=y.dateIsInGroup(o(),_);return fe.createElement("span",{className:Ai("rbc-label",A&&"rbc-now")},a.format(S,"timeGutterFormat"))},[y,a,o]);return fe.createElement(d,{slotMetrics:y},fe.createElement("div",{className:"rbc-time-gutter rbc-time-column",ref:c},y.groups.map(function(S,_){return fe.createElement(e6,{key:_,group:S,resource:l,components:u,renderSlot:w,getters:h})})))},k2e=fe.forwardRef(function(e,t){return fe.createElement(R2e,Object.assign({gutterRef:t},e))}),z2e=function(t){var r=t.label;return fe.createElement(fe.Fragment,null,r)},N2e=function(e){Ln(r,e);var t=In(r);function r(){var i;Ui(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s)),i.handleHeaderClick=function(o,l,u){u.preventDefault(),Nr(i.props.onDrillDown,[o,l])},i.renderRow=function(o){var l=i.props,u=l.events,h=l.rtl,c=l.selectable,d=l.getNow,f=l.range,p=l.getters,m=l.localizer,g=l.accessors,v=l.components,y=l.resizable,x=g.resourceId(o),w=o?u.filter(function(S){return g.resource(S)===x}):u;return fe.createElement(ww,{isAllDay:!0,rtl:h,getNow:d,minRows:2,maxRows:i.props.allDayMaxRows+1,range:f,events:w,resourceId:x,className:"rbc-allday-cell",selectable:c,selected:i.props.selected,components:v,accessors:g,getters:p,localizer:m,onSelect:i.props.onSelectEvent,onShowMore:i.props.onShowMore,onDoubleClick:i.props.onDoubleClickEvent,onKeyPress:i.props.onKeyPressEvent,onSelectSlot:i.props.onSelectSlot,longPressThreshold:i.props.longPressThreshold,resizable:y})},i}return ji(r,[{key:"renderHeaderCells",value:function(n){var s=this,a=this.props,o=a.localizer,l=a.getDrilldownView,u=a.getNow,h=a.getters.dayProp,c=a.components.header,d=c===void 0?KW:c,f=u();return n.map(function(p,m){var g=l(p),v=o.format(p,"dayFormat"),y=h(p),x=y.className,w=y.style,S=fe.createElement(d,{date:p,label:v,localizer:o});return fe.createElement("div",{key:m,style:w,className:Ai("rbc-header",x,o.isSameDate(p,f)&&"rbc-today")},g?fe.createElement("button",{type:"button",className:"rbc-button-link",onClick:function(A){return s.handleHeaderClick(p,g,A)}},S):fe.createElement("span",null,S))})}},{key:"render",value:function(){var n=this,s=this.props,a=s.width,o=s.rtl,l=s.resources,u=s.range,h=s.events,c=s.getNow,d=s.accessors,f=s.selectable,p=s.components,m=s.getters,g=s.scrollRef,v=s.localizer,y=s.isOverflowing,x=s.components,w=x.timeGutterHeader,S=x.resourceHeader,_=S===void 0?z2e:S,A=s.resizable,M={};y&&(M[o?"marginLeft":"marginRight"]="".concat(lW()-1,"px"));var T=l.groupEvents(h);return fe.createElement("div",{style:M,ref:g,className:Ai("rbc-time-header",y&&"rbc-overflowing")},fe.createElement("div",{className:"rbc-label rbc-time-header-gutter",style:{width:a,minWidth:a,maxWidth:a}},w&&fe.createElement(w,null)),l.map(function(C,L){var I=gl(C,2),k=I[0],z=I[1];return fe.createElement("div",{className:"rbc-time-header-content",key:k||L},z&&fe.createElement("div",{className:"rbc-row rbc-row-resource",key:"resource_".concat(L)},fe.createElement("div",{className:"rbc-header"},fe.createElement(_,{index:L,label:d.resourceTitle(z),resource:z}))),fe.createElement("div",{className:"rbc-row rbc-time-header-cell".concat(u.length<=1?" rbc-time-header-cell-single-day":"")},n.renderHeaderCells(u)),fe.createElement(ww,{isAllDay:!0,rtl:o,getNow:c,minRows:2,maxRows:n.props.allDayMaxRows+1,range:u,events:T.get(k)||[],resourceId:z&&k,className:"rbc-allday-cell",selectable:f,selected:n.props.selected,components:p,accessors:d,getters:m,localizer:v,onSelect:n.props.onSelectEvent,onShowMore:n.props.onShowMore,onDoubleClick:n.props.onDoubleClickEvent,onKeyPress:n.props.onKeyPressEvent,onSelectSlot:n.props.onSelectSlot,longPressThreshold:n.props.longPressThreshold,resizable:A}))}))}}]),r}(fe.Component),WM={};function B2e(e,t){return{map:function(i){return e?e.map(function(n,s){return i([t.resourceId(n),n],s)}):[i([WM,null],0)]},groupEvents:function(i){var n=new Map;return e?(i.forEach(function(s){var a=t.resource(s)||WM;if(Array.isArray(a))a.forEach(function(l){var u=n.get(l)||[];u.push(s),n.set(l,u)});else{var o=n.get(a)||[];o.push(s),n.set(a,o)}}),n):(n.set(WM,i),n)}}}var Op=function(e){Ln(r,e);var t=In(r);function r(i){var n;return Ui(this,r),n=t.call(this,i),n.handleScroll=function(s){n.scrollRef.current&&(n.scrollRef.current.scrollLeft=s.target.scrollLeft)},n.handleResize=function(){yN(n.rafHandle),n.rafHandle=JV(n.checkOverflow)},n.handleKeyPressEvent=function(){n.clearSelection();for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];Nr(n.props.onKeyPressEvent,a)},n.handleSelectEvent=function(){n.clearSelection();for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];Nr(n.props.onSelectEvent,a)},n.handleDoubleClickEvent=function(){n.clearSelection();for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];Nr(n.props.onDoubleClickEvent,a)},n.handleShowMore=function(s,a,o,l,u){var h=n.props,c=h.popup,d=h.onDrillDown,f=h.onShowMore,p=h.getDrilldownView,m=h.doShowMoreDrillDown;if(n.clearSelection(),c){var g=ZV(o,n.containerRef.current);n.setState({overlay:{date:a,events:s,position:vr(vr({},g),{},{width:"200px"}),target:u}})}else m&&Nr(d,[a,p(a)||Sn.DAY]);Nr(f,[s,a,l])},n.handleSelectAllDaySlot=function(s,a){var o=n.props.onSelectSlot,l=new Date(s[0]),u=new Date(s[s.length-1]);u.setDate(s[s.length-1].getDate()+1),Nr(o,{slots:s,start:l,end:u,action:a.action,resourceId:a.resourceId})},n.overlayDisplay=function(){n.setState({overlay:null})},n.checkOverflow=function(){if(!n._updatingOverflow){var s=n.contentRef.current,a=s.scrollHeight>s.clientHeight;n.state.isOverflowing!==a&&(n._updatingOverflow=!0,n.setState({isOverflowing:a},function(){n._updatingOverflow=!1}))}},n.memoizedResources=bW(function(s,a){return B2e(s,a)}),n.state={gutterWidth:void 0,isOverflowing:null},n.scrollRef=fe.createRef(),n.contentRef=fe.createRef(),n.containerRef=fe.createRef(),n._scrollRatio=null,n.gutterRef=pe.createRef(),n}return ji(r,[{key:"getSnapshotBeforeUpdate",value:function(){return this.checkOverflow(),null}},{key:"componentDidMount",value:function(){this.props.width==null&&this.measureGutter(),this.calculateScroll(),this.applyScroll(),window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),yN(this.rafHandle),this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest)}},{key:"componentDidUpdate",value:function(){this.applyScroll()}},{key:"renderEvents",value:function(n,s,a,o){var l=this,u=this.props,h=u.min,c=u.max,d=u.components,f=u.accessors,p=u.localizer,m=u.dayLayoutAlgorithm,g=this.memoizedResources(this.props.resources,f),v=g.groupEvents(s),y=g.groupEvents(a);return g.map(function(x,w){var S=gl(x,2),_=S[0],A=S[1];return n.map(function(M,T){var C=(v.get(_)||[]).filter(function(I){return p.inRange(M,f.start(I),f.end(I),"day")}),L=(y.get(_)||[]).filter(function(I){return p.inRange(M,f.start(I),f.end(I),"day")});return fe.createElement(t6,Object.assign({},l.props,{localizer:p,min:p.merge(M,h),max:p.merge(M,c),resource:A&&_,components:d,isNow:p.isSameDate(M,o),key:w+"-"+T,date:M,events:C,backgroundEvents:L,dayLayoutAlgorithm:m}))})})}},{key:"render",value:function(){var n,s=this.props,a=s.events,o=s.backgroundEvents,l=s.range,u=s.width,h=s.rtl,c=s.selected,d=s.getNow,f=s.resources,p=s.components,m=s.accessors,g=s.getters,v=s.localizer,y=s.min,x=s.max,w=s.showMultiDayTimes,S=s.longPressThreshold,_=s.resizable;u=u||this.state.gutterWidth;var A=l[0],M=l[l.length-1];this.slots=l.length;var T=[],C=[],L=[];return a.forEach(function(I){if(_v(I,A,M,m,v)){var k=m.start(I),z=m.end(I);m.allDay(I)||v.startAndEndAreDateOnly(k,z)||!w&&!v.isSameDate(k,z)?T.push(I):C.push(I)}}),o.forEach(function(I){_v(I,A,M,m,v)&&L.push(I)}),T.sort(function(I,k){return qW(I,k,m,v)}),fe.createElement("div",{className:Ai("rbc-time-view",f&&"rbc-time-view-resources"),ref:this.containerRef},fe.createElement(N2e,{range:l,events:T,width:u,rtl:h,getNow:d,localizer:v,selected:c,allDayMaxRows:this.props.showAllEvents?1/0:(n=this.props.allDayMaxRows)!==null&&n!==void 0?n:1/0,resources:this.memoizedResources(f,m),selectable:this.props.selectable,accessors:m,getters:g,components:p,scrollRef:this.scrollRef,isOverflowing:this.state.isOverflowing,longPressThreshold:S,onSelectSlot:this.handleSelectAllDaySlot,onSelectEvent:this.handleSelectEvent,onShowMore:this.handleShowMore,onDoubleClickEvent:this.props.onDoubleClickEvent,onKeyPressEvent:this.props.onKeyPressEvent,onDrillDown:this.props.onDrillDown,getDrilldownView:this.props.getDrilldownView,resizable:_}),this.props.popup&&this.renderOverlay(),fe.createElement("div",{ref:this.contentRef,className:"rbc-time-content",onScroll:this.handleScroll},fe.createElement(k2e,{date:A,ref:this.gutterRef,localizer:v,min:v.merge(A,y),max:v.merge(A,x),step:this.props.step,getNow:this.props.getNow,timeslots:this.props.timeslots,components:p,className:"rbc-time-gutter",getters:g}),this.renderEvents(l,C,L,d())))}},{key:"renderOverlay",value:function(){var n,s,a=this,o=(n=(s=this.state)===null||s===void 0?void 0:s.overlay)!==null&&n!==void 0?n:{},l=this.props,u=l.accessors,h=l.localizer,c=l.components,d=l.getters,f=l.selected,p=l.popupOffset,m=l.handleDragStart,g=function(){return a.setState({overlay:null})};return fe.createElement(vP,{overlay:o,accessors:u,localizer:h,components:c,getters:d,selected:f,popupOffset:p,ref:this.containerRef,handleKeyPressEvent:this.handleKeyPressEvent,handleSelectEvent:this.handleSelectEvent,handleDoubleClickEvent:this.handleDoubleClickEvent,handleDragStart:m,show:!!o.position,overlayDisplay:this.overlayDisplay,onHide:g})}},{key:"clearSelection",value:function(){clearTimeout(this._selectTimer),this._pendingSelection=[]}},{key:"measureGutter",value:function(){var n=this;this.measureGutterAnimationFrameRequest&&window.cancelAnimationFrame(this.measureGutterAnimationFrameRequest),this.measureGutterAnimationFrameRequest=window.requestAnimationFrame(function(){var s,a=(s=n.gutterRef)!==null&&s!==void 0&&s.current?$T(n.gutterRef.current):void 0;a&&n.state.gutterWidth!==a&&n.setState({gutterWidth:a})})}},{key:"applyScroll",value:function(){if(this._scrollRatio!=null&&this.props.enableAutoScroll===!0){var n=this.contentRef.current;n.scrollTop=n.scrollHeight*this._scrollRatio,this._scrollRatio=null}}},{key:"calculateScroll",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props,s=n.min,a=n.max,o=n.scrollToTime,l=n.localizer,u=l.diff(l.merge(o,s),o,"milliseconds"),h=l.diff(s,a,"milliseconds");this._scrollRatio=u/h}}]),r}(pe.Component);Op.defaultProps={step:30,timeslots:2};var F2e=["date","localizer","min","max","scrollToTime","enableAutoScroll"],Nb=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.date,a=n.localizer,o=n.min,l=o===void 0?a.startOf(new Date,"day"):o,u=n.max,h=u===void 0?a.endOf(new Date,"day"):u,c=n.scrollToTime,d=c===void 0?a.startOf(new Date,"day"):c,f=n.enableAutoScroll,p=f===void 0?!0:f,m=So(n,F2e),g=r.range(s,{localizer:a});return fe.createElement(Op,Object.assign({},m,{range:g,eventOffset:10,localizer:a,min:l,max:h,scrollToTime:d,enableAutoScroll:p}))}}]),r}(fe.Component);Nb.range=function(e,t){var r=t.localizer;return[r.startOf(e,"day")]};Nb.navigate=function(e,t,r){var i=r.localizer;switch(t){case Jn.PREVIOUS:return i.add(e,-1,"day");case Jn.NEXT:return i.add(e,1,"day");default:return e}};Nb.title=function(e,t){var r=t.localizer;return r.format(e,"dayHeaderFormat")};var U2e=["date","localizer","min","max","scrollToTime","enableAutoScroll"],ac=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.date,a=n.localizer,o=n.min,l=o===void 0?a.startOf(new Date,"day"):o,u=n.max,h=u===void 0?a.endOf(new Date,"day"):u,c=n.scrollToTime,d=c===void 0?a.startOf(new Date,"day"):c,f=n.enableAutoScroll,p=f===void 0?!0:f,m=So(n,U2e),g=r.range(s,this.props);return fe.createElement(Op,Object.assign({},m,{range:g,eventOffset:15,localizer:a,min:l,max:h,scrollToTime:d,enableAutoScroll:p}))}}]),r}(fe.Component);ac.defaultProps=Op.defaultProps;ac.navigate=function(e,t,r){var i=r.localizer;switch(t){case Jn.PREVIOUS:return i.add(e,-1,"week");case Jn.NEXT:return i.add(e,1,"week");default:return e}};ac.range=function(e,t){var r=t.localizer,i=r.startOfWeek(),n=r.startOf(e,"week",i),s=r.endOf(e,"week",i);return r.range(n,s)};ac.title=function(e,t){var r=t.localizer,i=ac.range(e,{localizer:r}),n=EW(i),s=n[0],a=n.slice(1);return r.format({start:s,end:a.pop()},"dayRangeHeaderFormat")};var j2e=["date","localizer","min","max","scrollToTime","enableAutoScroll"];function xP(e,t){return ac.range(e,t).filter(function(r){return[6,0].indexOf(r.getDay())===-1})}var r0=function(e){Ln(r,e);var t=In(r);function r(){return Ui(this,r),t.apply(this,arguments)}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.date,a=n.localizer,o=n.min,l=o===void 0?a.startOf(new Date,"day"):o,u=n.max,h=u===void 0?a.endOf(new Date,"day"):u,c=n.scrollToTime,d=c===void 0?a.startOf(new Date,"day"):c,f=n.enableAutoScroll,p=f===void 0?!0:f,m=So(n,j2e),g=xP(s,this.props);return fe.createElement(Op,Object.assign({},m,{range:g,eventOffset:15,localizer:a,min:l,max:h,scrollToTime:d,enableAutoScroll:p}))}}]),r}(fe.Component);r0.defaultProps=Op.defaultProps;r0.range=xP;r0.navigate=ac.navigate;r0.title=function(e,t){var r=t.localizer,i=xP(e,{localizer:r}),n=EW(i),s=n[0],a=n.slice(1);return r.format({start:s,end:a.pop()},"dayRangeHeaderFormat")};function oc(e){var t=e.accessors,r=e.components,i=e.date,n=e.events,s=e.getters,a=e.length,o=e.localizer,l=e.onDoubleClickEvent,u=e.onSelectEvent,h=e.selected,c=pe.useRef(null),d=pe.useRef(null),f=pe.useRef(null),p=pe.useRef(null),m=pe.useRef(null);pe.useEffect(function(){y()});var g=function(A,M,T){var C=r.event,L=r.date;return M=M.filter(function(I){return _v(I,o.startOf(A,"day"),o.endOf(A,"day"),t,o)}),M.map(function(I,k){var z=t.title(I),V=t.end(I),K=t.start(I),q=s.eventProp(I,K,V,kb(I,h)),O=k===0&&o.format(A,"agendaDateFormat"),W=k===0?fe.createElement("td",{rowSpan:M.length,className:"rbc-agenda-date-cell"},L?fe.createElement(L,{day:A,label:O}):O):!1;return fe.createElement("tr",{key:T+"_"+k,className:q.className,style:q.style},W,fe.createElement("td",{className:"rbc-agenda-time-cell"},v(A,I)),fe.createElement("td",{className:"rbc-agenda-event-cell",onClick:function(B){return u&&u(I,B)},onDoubleClick:function(B){return l&&l(I,B)}},C?fe.createElement(C,{event:I,title:z}):z))},[])},v=function(A,M){var T="",C=r.time,L=o.messages.allDay,I=t.end(M),k=t.start(M);return t.allDay(M)||(o.eq(k,I)?L=o.format(k,"agendaTimeFormat"):o.isSameDate(k,I)?L=o.format({start:k,end:I},"agendaTimeRangeFormat"):o.isSameDate(A,k)?L=o.format(k,"agendaTimeFormat"):o.isSameDate(A,I)&&(L=o.format(I,"agendaTimeFormat"))),o.gt(A,k,"day")&&(T="rbc-continues-prior"),o.lt(A,I,"day")&&(T+=" rbc-continues-after"),fe.createElement("span",{className:T.trim()},C?fe.createElement(C,{event:M,day:A,label:L}):L)},y=function(){if(m.current){var A=c.current,M=m.current.firstChild;if(M){var T=p.current.scrollHeight>p.current.clientHeight,C=[],L=C;C=[$T(M.children[0]),$T(M.children[1])],(L[0]!==C[0]||L[1]!==C[1])&&(d.current.style.width=C[0]+"px",f.current.style.width=C[1]+"px"),T?(qSe(A,"rbc-header-overflowing"),A.style.marginRight=lW()+"px"):XSe(A,"rbc-header-overflowing")}}},x=o.messages,w=o.add(i,a,"day"),S=o.range(i,w,"day");return n=n.filter(function(_){return _v(_,o.startOf(i,"day"),o.endOf(w,"day"),t,o)}),n.sort(function(_,A){return+t.start(_)-+t.start(A)}),fe.createElement("div",{className:"rbc-agenda-view"},n.length!==0?fe.createElement(fe.Fragment,null,fe.createElement("table",{ref:c,className:"rbc-agenda-table"},fe.createElement("thead",null,fe.createElement("tr",null,fe.createElement("th",{className:"rbc-header",ref:d},x.date),fe.createElement("th",{className:"rbc-header",ref:f},x.time),fe.createElement("th",{className:"rbc-header"},x.event)))),fe.createElement("div",{className:"rbc-agenda-content",ref:p},fe.createElement("table",{className:"rbc-agenda-table"},fe.createElement("tbody",{ref:m},S.map(function(_,A){return g(_,n,A)}))))):fe.createElement("span",{className:"rbc-agenda-empty"},x.noEventsInRange))}oc.defaultProps={length:30};oc.range=function(e,t){var r=t.length,i=r===void 0?oc.defaultProps.length:r,n=t.localizer,s=n.add(e,i,"day");return{start:e,end:s}};oc.navigate=function(e,t,r){var i=r.length,n=i===void 0?oc.defaultProps.length:i,s=r.localizer;switch(t){case Jn.PREVIOUS:return s.add(e,-n,"day");case Jn.NEXT:return s.add(e,n,"day");default:return e}};oc.title=function(e,t){var r=t.length,i=r===void 0?oc.defaultProps.length:r,n=t.localizer,s=n.add(e,i,"day");return n.format({start:e,end:s},"agendaHeaderFormat")};var Dc,R1=(Dc={},Eu(Dc,Sn.MONTH,zb),Eu(Dc,Sn.WEEK,ac),Eu(Dc,Sn.WORK_WEEK,r0),Eu(Dc,Sn.DAY,Nb),Eu(Dc,Sn.AGENDA,oc),Dc),H2e=["action","date","today"];function V2e(e,t){var r=t.action,i=t.date,n=t.today,s=So(t,H2e);switch(e=typeof e=="string"?R1[e]:e,r){case Jn.TODAY:i=n||new Date;break;case Jn.DATE:break;default:cv(e&&typeof e.navigate=="function","Calendar View components must implement a static `.navigate(date, action)` method.s"),i=e.navigate(i,r,s)}return i}var W2e=function(e){Ln(r,e);var t=In(r);function r(){var i;Ui(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s)),i.navigate=function(o){i.props.onNavigate(o)},i.view=function(o){i.props.onView(o)},i}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.localizer.messages,a=n.label;return fe.createElement("div",{className:"rbc-toolbar"},fe.createElement("span",{className:"rbc-btn-group"},fe.createElement("button",{type:"button",onClick:this.navigate.bind(null,Jn.TODAY)},s.today),fe.createElement("button",{type:"button",onClick:this.navigate.bind(null,Jn.PREVIOUS)},s.previous),fe.createElement("button",{type:"button",onClick:this.navigate.bind(null,Jn.NEXT)},s.next)),fe.createElement("span",{className:"rbc-toolbar-label"},a),fe.createElement("span",{className:"rbc-btn-group"},this.viewNamesGroup(s)))}},{key:"viewNamesGroup",value:function(n){var s=this,a=this.props.views,o=this.props.view;if(a.length>1)return a.map(function(l){return fe.createElement("button",{type:"button",key:l,className:Ai({"rbc-active":o===l}),onClick:s.view.bind(null,l)},n[l])})}}]),r}(fe.Component);function G2e(e,t){var r=null;return typeof t=="function"?r=t(e):typeof t=="string"&&Bl(e)==="object"&&e!=null&&t in e&&(r=e[t]),r}var mu=function(t){return function(r){return G2e(r,t)}},Y2e=["view","date","getNow","onNavigate"],q2e=["view","toolbar","events","backgroundEvents","style","className","elementProps","date","getNow","length","showMultiDayTimes","onShowMore","doShowMoreDrillDown","components","formats","messages","culture"];function r6(e){if(Array.isArray(e))return e;for(var t=[],r=0,i=Object.entries(e);r<i.length;r++){var n=gl(i[r],2),s=n[0],a=n[1];a&&t.push(s)}return t}function X2e(e,t){var r=t.views,i=r6(r);return i.indexOf(e)!==-1}var i6=function(e){Ln(r,e);var t=In(r);function r(){var i;Ui(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s)),i.getViews=function(){var o=i.props.views;return Array.isArray(o)?TDe(o,function(l,u){return l[u]=R1[u]},{}):Bl(o)==="object"?CDe(o,function(l,u){return l===!0?R1[u]:l}):R1},i.getView=function(){var o=i.getViews();return o[i.props.view]},i.getDrilldownView=function(o){var l=i.props,u=l.view,h=l.drilldownView,c=l.getDrilldownView;return c?c(o,u,Object.keys(i.getViews())):h},i.handleRangeChange=function(o,l,u){var h=i.props,c=h.onRangeChange,d=h.localizer;c&&l.range&&c(l.range(o,{localizer:d}),u)},i.handleNavigate=function(o,l){var u=i.props,h=u.view,c=u.date,d=u.getNow,f=u.onNavigate,p=So(u,Y2e),m=i.getView(),g=d();c=V2e(m,vr(vr({},p),{},{action:o,date:l||c||g,today:g})),f(c,h,o),i.handleRangeChange(c,m)},i.handleViewChange=function(o){o!==i.props.view&&X2e(o,i.props)&&i.props.onView(o);var l=i.getViews();i.handleRangeChange(i.props.date||i.props.getNow(),l[o],o)},i.handleSelectEvent=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onSelectEvent,l)},i.handleDoubleClickEvent=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onDoubleClickEvent,l)},i.handleKeyPressEvent=function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];Nr(i.props.onKeyPressEvent,l)},i.handleSelectSlot=function(o){Nr(i.props.onSelectSlot,o)},i.handleDrillDown=function(o,l){var u=i.props.onDrillDown;if(u){u(o,l,i.drilldownView);return}l&&i.handleViewChange(l),i.handleNavigate(Jn.DATE,o)},i.state={context:r.getContext(i.props)},i}return ji(r,[{key:"render",value:function(){var n=this.props,s=n.view,a=n.toolbar,o=n.events,l=n.backgroundEvents,u=n.style,h=n.className,c=n.elementProps,d=n.date,f=n.getNow,p=n.length,m=n.showMultiDayTimes,g=n.onShowMore,v=n.doShowMoreDrillDown;n.components,n.formats,n.messages,n.culture;var y=So(n,q2e);d=d||f();var x=this.getView(),w=this.state.context,S=w.accessors,_=w.components,A=w.getters,M=w.localizer,T=w.viewNames,C=_.toolbar||W2e,L=x.title(d,{localizer:M,length:p});return fe.createElement("div",Object.assign({},c,{className:Ai(h,"rbc-calendar",y.rtl&&"rbc-rtl"),style:u}),a&&fe.createElement(C,{date:d,view:s,views:T,label:L,onView:this.handleViewChange,onNavigate:this.handleNavigate,localizer:M}),fe.createElement(x,Object.assign({},y,{events:o,backgroundEvents:l,date:d,getNow:f,length:p,localizer:M,getters:A,components:_,accessors:S,showMultiDayTimes:m,getDrilldownView:this.getDrilldownView,onNavigate:this.handleNavigate,onDrillDown:this.handleDrillDown,onSelectEvent:this.handleSelectEvent,onDoubleClickEvent:this.handleDoubleClickEvent,onKeyPressEvent:this.handleKeyPressEvent,onSelectSlot:this.handleSelectSlot,onShowMore:g,doShowMoreDrillDown:v})))}}],[{key:"getDerivedStateFromProps",value:function(n){return{context:r.getContext(n)}}},{key:"getContext",value:function(n){var s=n.startAccessor,a=n.endAccessor,o=n.allDayAccessor,l=n.tooltipAccessor,u=n.titleAccessor,h=n.resourceAccessor,c=n.resourceIdAccessor,d=n.resourceTitleAccessor,f=n.eventPropGetter,p=n.backgroundEventPropGetter,m=n.slotPropGetter,g=n.slotGroupPropGetter,v=n.dayPropGetter,y=n.view,x=n.views,w=n.localizer,S=n.culture,_=n.messages,A=_===void 0?{}:_,M=n.components,T=M===void 0?{}:M,C=n.formats,L=C===void 0?{}:C,I=r6(x),k=JDe(A);return{viewNames:I,localizer:KDe(w,S,L,k),getters:{eventProp:function(){return f&&f.apply(void 0,arguments)||{}},backgroundEventProp:function(){return p&&p.apply(void 0,arguments)||{}},slotProp:function(){return m&&m.apply(void 0,arguments)||{}},slotGroupProp:function(){return g&&g.apply(void 0,arguments)||{}},dayProp:function(){return v&&v.apply(void 0,arguments)||{}}},components:ADe(T[y]||{},SDe(T,I),{eventWrapper:cl,backgroundEventWrapper:cl,eventContainerWrapper:cl,dateCellWrapper:cl,weekWrapper:cl,timeSlotWrapper:cl,timeGutterWrapper:cl}),accessors:{start:mu(s),end:mu(a),allDay:mu(o),tooltip:mu(l),title:mu(u),resource:mu(h),resourceId:mu(c),resourceTitle:mu(d)}}}}]),r}(fe.Component);i6.defaultProps={events:[],backgroundEvents:[],elementProps:{},popup:!1,toolbar:!0,view:Sn.MONTH,views:[Sn.MONTH,Sn.WEEK,Sn.DAY,Sn.AGENDA],step:30,length:30,allDayMaxRows:1/0,doShowMoreDrillDown:!0,drilldownView:Sn.DAY,titleAccessor:"title",tooltipAccessor:"title",allDayAccessor:"allDay",startAccessor:"start",endAccessor:"end",resourceAccessor:"resourceId",resourceIdAccessor:"id",resourceTitleAccessor:"title",longPressThreshold:250,getNow:function(){return new Date},dayLayoutAlgorithm:"overlap"};var $2e=kV(i6,{view:"onView",date:"onNavigate",selected:"onSelectEvent"}),Q2e=function(t,r,i){var n=t.start,s=t.end;return i.format(n,"MMMM DD",r)+" – "+i.format(s,i.eq(n,s,"month")?"DD":"MMMM DD",r)},K2e=function(t,r,i){var n=t.start,s=t.end;return i.format(n,"L",r)+" – "+i.format(s,"L",r)},GM=function(t,r,i){var n=t.start,s=t.end;return i.format(n,"LT",r)+" – "+i.format(s,"LT",r)},Z2e=function(t,r,i){var n=t.start;return i.format(n,"LT",r)+" – "},J2e=function(t,r,i){var n=t.end;return" – "+i.format(n,"LT",r)},ePe={dateFormat:"DD",dayFormat:"DD ddd",weekdayFormat:"ddd",selectRangeFormat:GM,eventTimeRangeFormat:GM,eventTimeRangeStartFormat:Z2e,eventTimeRangeEndFormat:J2e,timeGutterFormat:"LT",monthHeaderFormat:"MMMM YYYY",dayHeaderFormat:"dddd MMM DD",dayRangeHeaderFormat:Q2e,agendaHeaderFormat:K2e,agendaDateFormat:"ddd MMM DD",agendaTimeFormat:"LT",agendaTimeRangeFormat:GM};function gu(e){var t=e&&e.toLowerCase();return t==="FullYear"?t="year":t||(t=void 0),t}function tPe(e){var t=function(B,j){return j?B.locale(j):B};function r(N){return e(N).toDate().getTimezoneOffset()}function i(N,B){var j,Q,H=e(N).local(),G=e(B).local();if(!e.tz)return H.toDate().getTimezoneOffset()-G.toDate().getTimezoneOffset();var $=(j=H==null||(Q=H._z)===null||Q===void 0?void 0:Q.name)!==null&&j!==void 0?j:e.tz.guess(),se=e.tz.zone($).utcOffset(+H),re=e.tz.zone($).utcOffset(+G);return se-re}function n(N){var B=e(N).startOf("day");return i(B,N)}function s(N,B,j){var Q=gu(j),H=Q?e(N).startOf(Q):e(N),G=Q?e(B).startOf(Q):e(B);return[H,G,Q]}function a(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,B=arguments.length>1?arguments[1]:void 0,j=gu(B);return j?e(N).startOf(j).toDate():e(N).toDate()}function o(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,B=arguments.length>1?arguments[1]:void 0,j=gu(B);return j?e(N).endOf(j).toDate():e(N).toDate()}function l(N,B,j){var Q=s(N,B,j),H=gl(Q,3),G=H[0],$=H[1],se=H[2];return G.isSame($,se)}function u(N,B,j){return!l(N,B,j)}function h(N,B,j){var Q=s(N,B,j),H=gl(Q,3),G=H[0],$=H[1],se=H[2];return G.isAfter($,se)}function c(N,B,j){var Q=s(N,B,j),H=gl(Q,3),G=H[0],$=H[1],se=H[2];return G.isBefore($,se)}function d(N,B,j){var Q=s(N,B,j),H=gl(Q,3),G=H[0],$=H[1],se=H[2];return G.isSameOrBefore($,se)}function f(N,B,j){var Q=s(N,B,j),H=gl(Q,3),G=H[0],$=H[1],se=H[2];return G.isSameOrBefore($,se)}function p(N,B,j){var Q=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"day",H=gu(Q),G=e(N),$=e(B),se=e(j);return G.isBetween($,se,H,"[]")}function m(N,B){var j=e(N),Q=e(B),H=e.min(j,Q);return H.toDate()}function g(N,B){var j=e(N),Q=e(B),H=e.max(j,Q);return H.toDate()}function v(N,B){if(!N&&!B)return null;var j=e(B).format("HH:mm:ss"),Q=e(N).startOf("day").format("MM/DD/YYYY");return e("".concat(Q," ").concat(j),"MM/DD/YYYY HH:mm:ss").toDate()}function y(N,B,j){var Q=gu(j);return e(N).add(B,Q).toDate()}function x(N,B){for(var j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"day",Q=gu(j),H=e(N).toDate(),G=[];f(H,B);)G.push(H),H=y(H,1,Q);return G}function w(N,B){var j=gu(B),Q=a(N,j);return l(Q,N)?Q:y(Q,1,j)}function S(N,B){var j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"day",Q=gu(j),H=e(N),G=e(B);return G.diff(H,Q)}function _(N){var B=e(N);return B.minutes()}function A(N){var B=N?e.localeData(N):e.localeData();return B?B.firstDayOfWeek():0}function M(N){return e(N).startOf("month").startOf("week").toDate()}function T(N){return e(N).endOf("month").endOf("week").toDate()}function C(N){for(var B=M(N),j=T(N),Q=[];f(B,j);)Q.push(B),B=y(B,1,"d");return Q}function L(N,B,j){return e(N).startOf("day").minute(B+j).toDate()}function I(N,B){return S(N,B,"minutes")}function k(N){var B=e(N).startOf("day"),j=e(N);return j.diff(B,"minutes")+n(N)}function z(N,B){var j=e(N),Q=e(B);return j.isBefore(Q,"day")}function V(N,B,j){var Q=e(B),H=e(j);return Q.isSameOrAfter(H,"minutes")}function K(N){var B=N.evtA,j=B.start,Q=B.end,H=B.allDay,G=N.evtB,$=G.start,se=G.end,re=G.allDay,ae=+a(j,"day")-+a($,"day"),ce=S(j,w(Q,"day"),"day"),me=S($,w(se,"day"),"day");return ae||Math.max(me,1)-Math.max(ce,1)||!!re-!!H||+j-+$||+Q-+se}function q(N){var B=N.event,j=B.start,Q=B.end,H=N.range,G=H.start,$=H.end,se=e(j).startOf("day"),re=e(Q),ae=e(G),ce=e($),me=se.isSameOrBefore(ce,"day"),be=!se.isSame(re,"minutes"),Ae=be?re.isAfter(ae,"minutes"):re.isSameOrAfter(ae,"minutes");return me&&Ae}function O(N,B){var j=e(N),Q=e(B);return j.isSame(Q,"day")}function W(){var N=new Date,B=/-/.test(N.toString())?"-":"",j=N.getTimezoneOffset(),Q=Number("".concat(B).concat(Math.abs(j))),H=e().utcOffset();return H>Q?1:0}return new QDe({formats:ePe,firstOfWeek:A,firstVisibleDay:M,lastVisibleDay:T,visibleDays:C,format:function(B,j,Q){return t(e(B),Q).format(j)},lt:c,lte:f,gt:h,gte:d,eq:l,neq:u,merge:v,inRange:p,startOf:a,endOf:o,range:x,add:y,diff:S,ceil:w,min:m,max:g,minutes:_,getSlotDate:L,getTimezoneOffset:r,getDstOffset:i,getTotalMin:I,getMinutesFromMidnight:k,continuesPrior:z,continuesAfter:V,sortEvents:K,inEventRange:q,isSameDate:O,browserTZOffset:W})}//! moment.js
//! version : 2.29.4
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var n6;function Ke(){return n6.apply(null,arguments)}function rPe(e){n6=e}function Pa(e){return e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"}function hh(e){return e!=null&&Object.prototype.toString.call(e)==="[object Object]"}function rr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function wP(e){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(e).length===0;var t;for(t in e)if(rr(e,t))return!1;return!0}function Rn(e){return e===void 0}function jl(e){return typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]"}function i0(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"}function s6(e,t){var r=[],i,n=e.length;for(i=0;i<n;++i)r.push(t(e[i],i));return r}function zu(e,t){for(var r in t)rr(t,r)&&(e[r]=t[r]);return rr(t,"toString")&&(e.toString=t.toString),rr(t,"valueOf")&&(e.valueOf=t.valueOf),e}function Io(e,t,r,i){return D6(e,t,r,i,!0).utc()}function iPe(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function Ft(e){return e._pf==null&&(e._pf=iPe()),e._pf}var KT;Array.prototype.some?KT=Array.prototype.some:KT=function(e){var t=Object(this),r=t.length>>>0,i;for(i=0;i<r;i++)if(i in t&&e.call(this,t[i],i,t))return!0;return!1};function bP(e){if(e._isValid==null){var t=Ft(e),r=KT.call(t.parsedDateParts,function(n){return n!=null}),i=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r);if(e._strict&&(i=i&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(e))e._isValid=i;else return i}return e._isValid}function Bb(e){var t=Io(NaN);return e!=null?zu(Ft(t),e):Ft(t).userInvalidated=!0,t}var xB=Ke.momentProperties=[],YM=!1;function _P(e,t){var r,i,n,s=xB.length;if(Rn(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),Rn(t._i)||(e._i=t._i),Rn(t._f)||(e._f=t._f),Rn(t._l)||(e._l=t._l),Rn(t._strict)||(e._strict=t._strict),Rn(t._tzm)||(e._tzm=t._tzm),Rn(t._isUTC)||(e._isUTC=t._isUTC),Rn(t._offset)||(e._offset=t._offset),Rn(t._pf)||(e._pf=Ft(t)),Rn(t._locale)||(e._locale=t._locale),s>0)for(r=0;r<s;r++)i=xB[r],n=t[i],Rn(n)||(e[i]=n);return e}function n0(e){_P(this,e),this._d=new Date(e._d!=null?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),YM===!1&&(YM=!0,Ke.updateOffset(this),YM=!1)}function Oa(e){return e instanceof n0||e!=null&&e._isAMomentObject!=null}function a6(e){Ke.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+e)}function ea(e,t){var r=!0;return zu(function(){if(Ke.deprecationHandler!=null&&Ke.deprecationHandler(null,e),r){var i=[],n,s,a,o=arguments.length;for(s=0;s<o;s++){if(n="",typeof arguments[s]=="object"){n+=`
[`+s+"] ";for(a in arguments[0])rr(arguments[0],a)&&(n+=a+": "+arguments[0][a]+", ");n=n.slice(0,-2)}else n=arguments[s];i.push(n)}a6(e+`
Arguments: `+Array.prototype.slice.call(i).join("")+`
`+new Error().stack),r=!1}return t.apply(this,arguments)},t)}var wB={};function o6(e,t){Ke.deprecationHandler!=null&&Ke.deprecationHandler(e,t),wB[e]||(a6(t),wB[e]=!0)}Ke.suppressDeprecationWarnings=!1;Ke.deprecationHandler=null;function Ro(e){return typeof Function<"u"&&e instanceof Function||Object.prototype.toString.call(e)==="[object Function]"}function nPe(e){var t,r;for(r in e)rr(e,r)&&(t=e[r],Ro(t)?this[r]=t:this["_"+r]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function ZT(e,t){var r=zu({},e),i;for(i in t)rr(t,i)&&(hh(e[i])&&hh(t[i])?(r[i]={},zu(r[i],e[i]),zu(r[i],t[i])):t[i]!=null?r[i]=t[i]:delete r[i]);for(i in e)rr(e,i)&&!rr(t,i)&&hh(e[i])&&(r[i]=zu({},r[i]));return r}function SP(e){e!=null&&this.set(e)}var JT;Object.keys?JT=Object.keys:JT=function(e){var t,r=[];for(t in e)rr(e,t)&&r.push(t);return r};var sPe={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function aPe(e,t,r){var i=this._calendar[e]||this._calendar.sameElse;return Ro(i)?i.call(t,r):i}function Eo(e,t,r){var i=""+Math.abs(e),n=t-i.length,s=e>=0;return(s?r?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+i}var MP=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,n1=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,qM={},Cf={};function ft(e,t,r,i){var n=i;typeof i=="string"&&(n=function(){return this[i]()}),e&&(Cf[e]=n),t&&(Cf[t[0]]=function(){return Eo(n.apply(this,arguments),t[1],t[2])}),r&&(Cf[r]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)})}function oPe(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function lPe(e){var t=e.match(MP),r,i;for(r=0,i=t.length;r<i;r++)Cf[t[r]]?t[r]=Cf[t[r]]:t[r]=oPe(t[r]);return function(n){var s="",a;for(a=0;a<i;a++)s+=Ro(t[a])?t[a].call(n,e):t[a];return s}}function k1(e,t){return e.isValid()?(t=l6(t,e.localeData()),qM[t]=qM[t]||lPe(t),qM[t](e)):e.localeData().invalidDate()}function l6(e,t){var r=5;function i(n){return t.longDateFormat(n)||n}for(n1.lastIndex=0;r>=0&&n1.test(e);)e=e.replace(n1,i),n1.lastIndex=0,r-=1;return e}var uPe={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function cPe(e){var t=this._longDateFormat[e],r=this._longDateFormat[e.toUpperCase()];return t||!r?t:(this._longDateFormat[e]=r.match(MP).map(function(i){return i==="MMMM"||i==="MM"||i==="DD"||i==="dddd"?i.slice(1):i}).join(""),this._longDateFormat[e])}var hPe="Invalid date";function dPe(){return this._invalidDate}var fPe="%d",pPe=/\d{1,2}/;function mPe(e){return this._ordinal.replace("%d",e)}var gPe={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function vPe(e,t,r,i){var n=this._relativeTime[r];return Ro(n)?n(e,t,r,i):n.replace(/%d/i,e)}function yPe(e,t){var r=this._relativeTime[e>0?"future":"past"];return Ro(r)?r(t):r.replace(/%s/i,t)}var Ag={};function hn(e,t){var r=e.toLowerCase();Ag[r]=Ag[r+"s"]=Ag[t]=e}function ta(e){return typeof e=="string"?Ag[e]||Ag[e.toLowerCase()]:void 0}function EP(e){var t={},r,i;for(i in e)rr(e,i)&&(r=ta(i),r&&(t[r]=e[i]));return t}var u6={};function dn(e,t){u6[e]=t}function xPe(e){var t=[],r;for(r in e)rr(e,r)&&t.push({unit:r,priority:u6[r]});return t.sort(function(i,n){return i.priority-n.priority}),t}function Fb(e){return e%4===0&&e%100!==0||e%400===0}function Fs(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function Gt(e){var t=+e,r=0;return t!==0&&isFinite(t)&&(r=Fs(t)),r}function Lp(e,t){return function(r){return r!=null?(c6(this,e,r),Ke.updateOffset(this,t),this):bw(this,e)}}function bw(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function c6(e,t,r){e.isValid()&&!isNaN(r)&&(t==="FullYear"&&Fb(e.year())&&e.month()===1&&e.date()===29?(r=Gt(r),e._d["set"+(e._isUTC?"UTC":"")+t](r,e.month(),Gb(r,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](r))}function wPe(e){return e=ta(e),Ro(this[e])?this[e]():this}function bPe(e,t){if(typeof e=="object"){e=EP(e);var r=xPe(e),i,n=r.length;for(i=0;i<n;i++)this[r[i].unit](e[r[i].unit])}else if(e=ta(e),Ro(this[e]))return this[e](t);return this}var h6=/\d/,Ms=/\d\d/,d6=/\d{3}/,AP=/\d{4}/,Ub=/[+-]?\d{6}/,Lr=/\d\d?/,f6=/\d\d\d\d?/,p6=/\d\d\d\d\d\d?/,jb=/\d{1,3}/,TP=/\d{1,4}/,Hb=/[+-]?\d{1,6}/,Ip=/\d+/,Vb=/[+-]?\d+/,_Pe=/Z|[+-]\d\d:?\d\d/gi,Wb=/Z|[+-]\d\d(?::?\d\d)?/gi,SPe=/[+-]?\d+(\.\d{1,3})?/,s0=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,_w;_w={};function st(e,t,r){_w[e]=Ro(t)?t:function(i,n){return i&&r?r:t}}function MPe(e,t){return rr(_w,e)?_w[e](t._strict,t._locale):new RegExp(EPe(e))}function EPe(e){return cs(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,r,i,n,s){return r||i||n||s}))}function cs(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var eC={};function yr(e,t){var r,i=t,n;for(typeof e=="string"&&(e=[e]),jl(t)&&(i=function(s,a){a[t]=Gt(s)}),n=e.length,r=0;r<n;r++)eC[e[r]]=i}function a0(e,t){yr(e,function(r,i,n,s){n._w=n._w||{},t(r,n._w,n,s)})}function APe(e,t,r){t!=null&&rr(eC,e)&&eC[e](t,r._a,r,e)}var ln=0,_l=1,ao=2,Si=3,Sa=4,Sl=5,Jc=6,TPe=7,CPe=8;function DPe(e,t){return(e%t+t)%t}var ei;Array.prototype.indexOf?ei=Array.prototype.indexOf:ei=function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1};function Gb(e,t){if(isNaN(e)||isNaN(t))return NaN;var r=DPe(t,12);return e+=(t-r)/12,r===1?Fb(e)?29:28:31-r%7%2}ft("M",["MM",2],"Mo",function(){return this.month()+1});ft("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)});ft("MMMM",0,0,function(e){return this.localeData().months(this,e)});hn("month","M");dn("month",8);st("M",Lr);st("MM",Lr,Ms);st("MMM",function(e,t){return t.monthsShortRegex(e)});st("MMMM",function(e,t){return t.monthsRegex(e)});yr(["M","MM"],function(e,t){t[_l]=Gt(e)-1});yr(["MMM","MMMM"],function(e,t,r,i){var n=r._locale.monthsParse(e,i,r._strict);n!=null?t[_l]=n:Ft(r).invalidMonth=e});var PPe="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),m6="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),g6=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,OPe=s0,LPe=s0;function IPe(e,t){return e?Pa(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||g6).test(t)?"format":"standalone"][e.month()]:Pa(this._months)?this._months:this._months.standalone}function RPe(e,t){return e?Pa(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[g6.test(t)?"format":"standalone"][e.month()]:Pa(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function kPe(e,t,r){var i,n,s,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)s=Io([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(s,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(s,"").toLocaleLowerCase();return r?t==="MMM"?(n=ei.call(this._shortMonthsParse,a),n!==-1?n:null):(n=ei.call(this._longMonthsParse,a),n!==-1?n:null):t==="MMM"?(n=ei.call(this._shortMonthsParse,a),n!==-1?n:(n=ei.call(this._longMonthsParse,a),n!==-1?n:null)):(n=ei.call(this._longMonthsParse,a),n!==-1?n:(n=ei.call(this._shortMonthsParse,a),n!==-1?n:null))}function zPe(e,t,r){var i,n,s;if(this._monthsParseExact)return kPe.call(this,e,t,r);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(n=Io([2e3,i]),r&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),!r&&!this._monthsParse[i]&&(s="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[i]=new RegExp(s.replace(".",""),"i")),r&&t==="MMMM"&&this._longMonthsParse[i].test(e))return i;if(r&&t==="MMM"&&this._shortMonthsParse[i].test(e))return i;if(!r&&this._monthsParse[i].test(e))return i}}function v6(e,t){var r;if(!e.isValid())return e;if(typeof t=="string"){if(/^\d+$/.test(t))t=Gt(t);else if(t=e.localeData().monthsParse(t),!jl(t))return e}return r=Math.min(e.date(),Gb(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,r),e}function y6(e){return e!=null?(v6(this,e),Ke.updateOffset(this,!0),this):bw(this,"Month")}function NPe(){return Gb(this.year(),this.month())}function BPe(e){return this._monthsParseExact?(rr(this,"_monthsRegex")||x6.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(rr(this,"_monthsShortRegex")||(this._monthsShortRegex=OPe),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)}function FPe(e){return this._monthsParseExact?(rr(this,"_monthsRegex")||x6.call(this),e?this._monthsStrictRegex:this._monthsRegex):(rr(this,"_monthsRegex")||(this._monthsRegex=LPe),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)}function x6(){function e(a,o){return o.length-a.length}var t=[],r=[],i=[],n,s;for(n=0;n<12;n++)s=Io([2e3,n]),t.push(this.monthsShort(s,"")),r.push(this.months(s,"")),i.push(this.months(s,"")),i.push(this.monthsShort(s,""));for(t.sort(e),r.sort(e),i.sort(e),n=0;n<12;n++)t[n]=cs(t[n]),r[n]=cs(r[n]);for(n=0;n<24;n++)i[n]=cs(i[n]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}ft("Y",0,0,function(){var e=this.year();return e<=9999?Eo(e,4):"+"+e});ft(0,["YY",2],0,function(){return this.year()%100});ft(0,["YYYY",4],0,"year");ft(0,["YYYYY",5],0,"year");ft(0,["YYYYYY",6,!0],0,"year");hn("year","y");dn("year",1);st("Y",Vb);st("YY",Lr,Ms);st("YYYY",TP,AP);st("YYYYY",Hb,Ub);st("YYYYYY",Hb,Ub);yr(["YYYYY","YYYYYY"],ln);yr("YYYY",function(e,t){t[ln]=e.length===2?Ke.parseTwoDigitYear(e):Gt(e)});yr("YY",function(e,t){t[ln]=Ke.parseTwoDigitYear(e)});yr("Y",function(e,t){t[ln]=parseInt(e,10)});function Tg(e){return Fb(e)?366:365}Ke.parseTwoDigitYear=function(e){return Gt(e)+(Gt(e)>68?1900:2e3)};var w6=Lp("FullYear",!0);function UPe(){return Fb(this.year())}function jPe(e,t,r,i,n,s,a){var o;return e<100&&e>=0?(o=new Date(e+400,t,r,i,n,s,a),isFinite(o.getFullYear())&&o.setFullYear(e)):o=new Date(e,t,r,i,n,s,a),o}function Sv(e){var t,r;return e<100&&e>=0?(r=Array.prototype.slice.call(arguments),r[0]=e+400,t=new Date(Date.UTC.apply(null,r)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function Sw(e,t,r){var i=7+t-r,n=(7+Sv(e,0,i).getUTCDay()-t)%7;return-n+i-1}function b6(e,t,r,i,n){var s=(7+r-i)%7,a=Sw(e,i,n),o=1+7*(t-1)+s+a,l,u;return o<=0?(l=e-1,u=Tg(l)+o):o>Tg(e)?(l=e+1,u=o-Tg(e)):(l=e,u=o),{year:l,dayOfYear:u}}function Mv(e,t,r){var i=Sw(e.year(),t,r),n=Math.floor((e.dayOfYear()-i-1)/7)+1,s,a;return n<1?(a=e.year()-1,s=n+Pl(a,t,r)):n>Pl(e.year(),t,r)?(s=n-Pl(e.year(),t,r),a=e.year()+1):(a=e.year(),s=n),{week:s,year:a}}function Pl(e,t,r){var i=Sw(e,t,r),n=Sw(e+1,t,r);return(Tg(e)-i+n)/7}ft("w",["ww",2],"wo","week");ft("W",["WW",2],"Wo","isoWeek");hn("week","w");hn("isoWeek","W");dn("week",5);dn("isoWeek",5);st("w",Lr);st("ww",Lr,Ms);st("W",Lr);st("WW",Lr,Ms);a0(["w","ww","W","WW"],function(e,t,r,i){t[i.substr(0,1)]=Gt(e)});function HPe(e){return Mv(e,this._week.dow,this._week.doy).week}var VPe={dow:0,doy:6};function WPe(){return this._week.dow}function GPe(){return this._week.doy}function YPe(e){var t=this.localeData().week(this);return e==null?t:this.add((e-t)*7,"d")}function qPe(e){var t=Mv(this,1,4).week;return e==null?t:this.add((e-t)*7,"d")}ft("d",0,"do","day");ft("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)});ft("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)});ft("dddd",0,0,function(e){return this.localeData().weekdays(this,e)});ft("e",0,0,"weekday");ft("E",0,0,"isoWeekday");hn("day","d");hn("weekday","e");hn("isoWeekday","E");dn("day",11);dn("weekday",11);dn("isoWeekday",11);st("d",Lr);st("e",Lr);st("E",Lr);st("dd",function(e,t){return t.weekdaysMinRegex(e)});st("ddd",function(e,t){return t.weekdaysShortRegex(e)});st("dddd",function(e,t){return t.weekdaysRegex(e)});a0(["dd","ddd","dddd"],function(e,t,r,i){var n=r._locale.weekdaysParse(e,i,r._strict);n!=null?t.d=n:Ft(r).invalidWeekday=e});a0(["d","e","E"],function(e,t,r,i){t[i]=Gt(e)});function XPe(e,t){return typeof e!="string"?e:isNaN(e)?(e=t.weekdaysParse(e),typeof e=="number"?e:null):parseInt(e,10)}function $Pe(e,t){return typeof e=="string"?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function CP(e,t){return e.slice(t,7).concat(e.slice(0,t))}var QPe="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),_6="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),KPe="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),ZPe=s0,JPe=s0,eOe=s0;function tOe(e,t){var r=Pa(this._weekdays)?this._weekdays:this._weekdays[e&&e!==!0&&this._weekdays.isFormat.test(t)?"format":"standalone"];return e===!0?CP(r,this._week.dow):e?r[e.day()]:r}function rOe(e){return e===!0?CP(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}function iOe(e){return e===!0?CP(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function nOe(e,t,r){var i,n,s,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)s=Io([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(s,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(s,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(s,"").toLocaleLowerCase();return r?t==="dddd"?(n=ei.call(this._weekdaysParse,a),n!==-1?n:null):t==="ddd"?(n=ei.call(this._shortWeekdaysParse,a),n!==-1?n:null):(n=ei.call(this._minWeekdaysParse,a),n!==-1?n:null):t==="dddd"?(n=ei.call(this._weekdaysParse,a),n!==-1||(n=ei.call(this._shortWeekdaysParse,a),n!==-1)?n:(n=ei.call(this._minWeekdaysParse,a),n!==-1?n:null)):t==="ddd"?(n=ei.call(this._shortWeekdaysParse,a),n!==-1||(n=ei.call(this._weekdaysParse,a),n!==-1)?n:(n=ei.call(this._minWeekdaysParse,a),n!==-1?n:null)):(n=ei.call(this._minWeekdaysParse,a),n!==-1||(n=ei.call(this._weekdaysParse,a),n!==-1)?n:(n=ei.call(this._shortWeekdaysParse,a),n!==-1?n:null))}function sOe(e,t,r){var i,n,s;if(this._weekdaysParseExact)return nOe.call(this,e,t,r);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(n=Io([2e3,1]).day(i),r&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(n,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(n,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(n,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[i]||(s="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[i]=new RegExp(s.replace(".",""),"i")),r&&t==="dddd"&&this._fullWeekdaysParse[i].test(e))return i;if(r&&t==="ddd"&&this._shortWeekdaysParse[i].test(e))return i;if(r&&t==="dd"&&this._minWeekdaysParse[i].test(e))return i;if(!r&&this._weekdaysParse[i].test(e))return i}}function aOe(e){if(!this.isValid())return e!=null?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e!=null?(e=XPe(e,this.localeData()),this.add(e-t,"d")):t}function oOe(e){if(!this.isValid())return e!=null?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return e==null?t:this.add(e-t,"d")}function lOe(e){if(!this.isValid())return e!=null?this:NaN;if(e!=null){var t=$Pe(e,this.localeData());return this.day(this.day()%7?t:t-7)}else return this.day()||7}function uOe(e){return this._weekdaysParseExact?(rr(this,"_weekdaysRegex")||DP.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(rr(this,"_weekdaysRegex")||(this._weekdaysRegex=ZPe),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)}function cOe(e){return this._weekdaysParseExact?(rr(this,"_weekdaysRegex")||DP.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(rr(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=JPe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function hOe(e){return this._weekdaysParseExact?(rr(this,"_weekdaysRegex")||DP.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(rr(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=eOe),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function DP(){function e(h,c){return c.length-h.length}var t=[],r=[],i=[],n=[],s,a,o,l,u;for(s=0;s<7;s++)a=Io([2e3,1]).day(s),o=cs(this.weekdaysMin(a,"")),l=cs(this.weekdaysShort(a,"")),u=cs(this.weekdays(a,"")),t.push(o),r.push(l),i.push(u),n.push(o),n.push(l),n.push(u);t.sort(e),r.sort(e),i.sort(e),n.sort(e),this._weekdaysRegex=new RegExp("^("+n.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function PP(){return this.hours()%12||12}function dOe(){return this.hours()||24}ft("H",["HH",2],0,"hour");ft("h",["hh",2],0,PP);ft("k",["kk",2],0,dOe);ft("hmm",0,0,function(){return""+PP.apply(this)+Eo(this.minutes(),2)});ft("hmmss",0,0,function(){return""+PP.apply(this)+Eo(this.minutes(),2)+Eo(this.seconds(),2)});ft("Hmm",0,0,function(){return""+this.hours()+Eo(this.minutes(),2)});ft("Hmmss",0,0,function(){return""+this.hours()+Eo(this.minutes(),2)+Eo(this.seconds(),2)});function S6(e,t){ft(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}S6("a",!0);S6("A",!1);hn("hour","h");dn("hour",13);function M6(e,t){return t._meridiemParse}st("a",M6);st("A",M6);st("H",Lr);st("h",Lr);st("k",Lr);st("HH",Lr,Ms);st("hh",Lr,Ms);st("kk",Lr,Ms);st("hmm",f6);st("hmmss",p6);st("Hmm",f6);st("Hmmss",p6);yr(["H","HH"],Si);yr(["k","kk"],function(e,t,r){var i=Gt(e);t[Si]=i===24?0:i});yr(["a","A"],function(e,t,r){r._isPm=r._locale.isPM(e),r._meridiem=e});yr(["h","hh"],function(e,t,r){t[Si]=Gt(e),Ft(r).bigHour=!0});yr("hmm",function(e,t,r){var i=e.length-2;t[Si]=Gt(e.substr(0,i)),t[Sa]=Gt(e.substr(i)),Ft(r).bigHour=!0});yr("hmmss",function(e,t,r){var i=e.length-4,n=e.length-2;t[Si]=Gt(e.substr(0,i)),t[Sa]=Gt(e.substr(i,2)),t[Sl]=Gt(e.substr(n)),Ft(r).bigHour=!0});yr("Hmm",function(e,t,r){var i=e.length-2;t[Si]=Gt(e.substr(0,i)),t[Sa]=Gt(e.substr(i))});yr("Hmmss",function(e,t,r){var i=e.length-4,n=e.length-2;t[Si]=Gt(e.substr(0,i)),t[Sa]=Gt(e.substr(i,2)),t[Sl]=Gt(e.substr(n))});function fOe(e){return(e+"").toLowerCase().charAt(0)==="p"}var pOe=/[ap]\.?m?\.?/i,mOe=Lp("Hours",!0);function gOe(e,t,r){return e>11?r?"pm":"PM":r?"am":"AM"}var E6={calendar:sPe,longDateFormat:uPe,invalidDate:hPe,ordinal:fPe,dayOfMonthOrdinalParse:pPe,relativeTime:gPe,months:PPe,monthsShort:m6,week:VPe,weekdays:QPe,weekdaysMin:KPe,weekdaysShort:_6,meridiemParse:pOe},kr={},Rm={},Ev;function vOe(e,t){var r,i=Math.min(e.length,t.length);for(r=0;r<i;r+=1)if(e[r]!==t[r])return r;return i}function bB(e){return e&&e.toLowerCase().replace("_","-")}function yOe(e){for(var t=0,r,i,n,s;t<e.length;){for(s=bB(e[t]).split("-"),r=s.length,i=bB(e[t+1]),i=i?i.split("-"):null;r>0;){if(n=Yb(s.slice(0,r).join("-")),n)return n;if(i&&i.length>=r&&vOe(s,i)>=r-1)break;r--}t++}return Ev}function xOe(e){return e.match("^[^/\\\\]*$")!=null}function Yb(e){var t=null,r;if(kr[e]===void 0&&typeof module<"u"&&module&&module.exports&&xOe(e))try{t=Ev._abbr,r=require,r("./locale/"+e),Zu(t)}catch{kr[e]=null}return kr[e]}function Zu(e,t){var r;return e&&(Rn(t)?r=Xl(e):r=OP(e,t),r?Ev=r:typeof console<"u"&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Ev._abbr}function OP(e,t){if(t!==null){var r,i=E6;if(t.abbr=e,kr[e]!=null)o6("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),i=kr[e]._config;else if(t.parentLocale!=null)if(kr[t.parentLocale]!=null)i=kr[t.parentLocale]._config;else if(r=Yb(t.parentLocale),r!=null)i=r._config;else return Rm[t.parentLocale]||(Rm[t.parentLocale]=[]),Rm[t.parentLocale].push({name:e,config:t}),null;return kr[e]=new SP(ZT(i,t)),Rm[e]&&Rm[e].forEach(function(n){OP(n.name,n.config)}),Zu(e),kr[e]}else return delete kr[e],null}function wOe(e,t){if(t!=null){var r,i,n=E6;kr[e]!=null&&kr[e].parentLocale!=null?kr[e].set(ZT(kr[e]._config,t)):(i=Yb(e),i!=null&&(n=i._config),t=ZT(n,t),i==null&&(t.abbr=e),r=new SP(t),r.parentLocale=kr[e],kr[e]=r),Zu(e)}else kr[e]!=null&&(kr[e].parentLocale!=null?(kr[e]=kr[e].parentLocale,e===Zu()&&Zu(e)):kr[e]!=null&&delete kr[e]);return kr[e]}function Xl(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Ev;if(!Pa(e)){if(t=Yb(e),t)return t;e=[e]}return yOe(e)}function bOe(){return JT(kr)}function LP(e){var t,r=e._a;return r&&Ft(e).overflow===-2&&(t=r[_l]<0||r[_l]>11?_l:r[ao]<1||r[ao]>Gb(r[ln],r[_l])?ao:r[Si]<0||r[Si]>24||r[Si]===24&&(r[Sa]!==0||r[Sl]!==0||r[Jc]!==0)?Si:r[Sa]<0||r[Sa]>59?Sa:r[Sl]<0||r[Sl]>59?Sl:r[Jc]<0||r[Jc]>999?Jc:-1,Ft(e)._overflowDayOfYear&&(t<ln||t>ao)&&(t=ao),Ft(e)._overflowWeeks&&t===-1&&(t=TPe),Ft(e)._overflowWeekday&&t===-1&&(t=CPe),Ft(e).overflow=t),e}var _Oe=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,SOe=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,MOe=/Z|[+-]\d\d(?::?\d\d)?/,s1=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],XM=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],EOe=/^\/?Date\((-?\d+)/i,AOe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,TOe={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function A6(e){var t,r,i=e._i,n=_Oe.exec(i)||SOe.exec(i),s,a,o,l,u=s1.length,h=XM.length;if(n){for(Ft(e).iso=!0,t=0,r=u;t<r;t++)if(s1[t][1].exec(n[1])){a=s1[t][0],s=s1[t][2]!==!1;break}if(a==null){e._isValid=!1;return}if(n[3]){for(t=0,r=h;t<r;t++)if(XM[t][1].exec(n[3])){o=(n[2]||" ")+XM[t][0];break}if(o==null){e._isValid=!1;return}}if(!s&&o!=null){e._isValid=!1;return}if(n[4])if(MOe.exec(n[4]))l="Z";else{e._isValid=!1;return}e._f=a+(o||"")+(l||""),RP(e)}else e._isValid=!1}function COe(e,t,r,i,n,s){var a=[DOe(e),m6.indexOf(t),parseInt(r,10),parseInt(i,10),parseInt(n,10)];return s&&a.push(parseInt(s,10)),a}function DOe(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function POe(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function OOe(e,t,r){if(e){var i=_6.indexOf(e),n=new Date(t[0],t[1],t[2]).getDay();if(i!==n)return Ft(r).weekdayMismatch=!0,r._isValid=!1,!1}return!0}function LOe(e,t,r){if(e)return TOe[e];if(t)return 0;var i=parseInt(r,10),n=i%100,s=(i-n)/100;return s*60+n}function T6(e){var t=AOe.exec(POe(e._i)),r;if(t){if(r=COe(t[4],t[3],t[2],t[5],t[6],t[7]),!OOe(t[1],r,e))return;e._a=r,e._tzm=LOe(t[8],t[9],t[10]),e._d=Sv.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),Ft(e).rfc2822=!0}else e._isValid=!1}function IOe(e){var t=EOe.exec(e._i);if(t!==null){e._d=new Date(+t[1]);return}if(A6(e),e._isValid===!1)delete e._isValid;else return;if(T6(e),e._isValid===!1)delete e._isValid;else return;e._strict?e._isValid=!1:Ke.createFromInputFallback(e)}Ke.createFromInputFallback=ea("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))});function kd(e,t,r){return e??t??r}function ROe(e){var t=new Date(Ke.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function IP(e){var t,r,i=[],n,s,a;if(!e._d){for(n=ROe(e),e._w&&e._a[ao]==null&&e._a[_l]==null&&kOe(e),e._dayOfYear!=null&&(a=kd(e._a[ln],n[ln]),(e._dayOfYear>Tg(a)||e._dayOfYear===0)&&(Ft(e)._overflowDayOfYear=!0),r=Sv(a,0,e._dayOfYear),e._a[_l]=r.getUTCMonth(),e._a[ao]=r.getUTCDate()),t=0;t<3&&e._a[t]==null;++t)e._a[t]=i[t]=n[t];for(;t<7;t++)e._a[t]=i[t]=e._a[t]==null?t===2?1:0:e._a[t];e._a[Si]===24&&e._a[Sa]===0&&e._a[Sl]===0&&e._a[Jc]===0&&(e._nextDay=!0,e._a[Si]=0),e._d=(e._useUTC?Sv:jPe).apply(null,i),s=e._useUTC?e._d.getUTCDay():e._d.getDay(),e._tzm!=null&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Si]=24),e._w&&typeof e._w.d<"u"&&e._w.d!==s&&(Ft(e).weekdayMismatch=!0)}}function kOe(e){var t,r,i,n,s,a,o,l,u;t=e._w,t.GG!=null||t.W!=null||t.E!=null?(s=1,a=4,r=kd(t.GG,e._a[ln],Mv(Or(),1,4).year),i=kd(t.W,1),n=kd(t.E,1),(n<1||n>7)&&(l=!0)):(s=e._locale._week.dow,a=e._locale._week.doy,u=Mv(Or(),s,a),r=kd(t.gg,e._a[ln],u.year),i=kd(t.w,u.week),t.d!=null?(n=t.d,(n<0||n>6)&&(l=!0)):t.e!=null?(n=t.e+s,(t.e<0||t.e>6)&&(l=!0)):n=s),i<1||i>Pl(r,s,a)?Ft(e)._overflowWeeks=!0:l!=null?Ft(e)._overflowWeekday=!0:(o=b6(r,i,n,s,a),e._a[ln]=o.year,e._dayOfYear=o.dayOfYear)}Ke.ISO_8601=function(){};Ke.RFC_2822=function(){};function RP(e){if(e._f===Ke.ISO_8601){A6(e);return}if(e._f===Ke.RFC_2822){T6(e);return}e._a=[],Ft(e).empty=!0;var t=""+e._i,r,i,n,s,a,o=t.length,l=0,u,h;for(n=l6(e._f,e._locale).match(MP)||[],h=n.length,r=0;r<h;r++)s=n[r],i=(t.match(MPe(s,e))||[])[0],i&&(a=t.substr(0,t.indexOf(i)),a.length>0&&Ft(e).unusedInput.push(a),t=t.slice(t.indexOf(i)+i.length),l+=i.length),Cf[s]?(i?Ft(e).empty=!1:Ft(e).unusedTokens.push(s),APe(s,i,e)):e._strict&&!i&&Ft(e).unusedTokens.push(s);Ft(e).charsLeftOver=o-l,t.length>0&&Ft(e).unusedInput.push(t),e._a[Si]<=12&&Ft(e).bigHour===!0&&e._a[Si]>0&&(Ft(e).bigHour=void 0),Ft(e).parsedDateParts=e._a.slice(0),Ft(e).meridiem=e._meridiem,e._a[Si]=zOe(e._locale,e._a[Si],e._meridiem),u=Ft(e).era,u!==null&&(e._a[ln]=e._locale.erasConvertYear(u,e._a[ln])),IP(e),LP(e)}function zOe(e,t,r){var i;return r==null?t:e.meridiemHour!=null?e.meridiemHour(t,r):(e.isPM!=null&&(i=e.isPM(r),i&&t<12&&(t+=12),!i&&t===12&&(t=0)),t)}function NOe(e){var t,r,i,n,s,a,o=!1,l=e._f.length;if(l===0){Ft(e).invalidFormat=!0,e._d=new Date(NaN);return}for(n=0;n<l;n++)s=0,a=!1,t=_P({},e),e._useUTC!=null&&(t._useUTC=e._useUTC),t._f=e._f[n],RP(t),bP(t)&&(a=!0),s+=Ft(t).charsLeftOver,s+=Ft(t).unusedTokens.length*10,Ft(t).score=s,o?s<i&&(i=s,r=t):(i==null||s<i||a)&&(i=s,r=t,a&&(o=!0));zu(e,r||t)}function BOe(e){if(!e._d){var t=EP(e._i),r=t.day===void 0?t.date:t.day;e._a=s6([t.year,t.month,r,t.hour,t.minute,t.second,t.millisecond],function(i){return i&&parseInt(i,10)}),IP(e)}}function FOe(e){var t=new n0(LP(C6(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function C6(e){var t=e._i,r=e._f;return e._locale=e._locale||Xl(e._l),t===null||r===void 0&&t===""?Bb({nullInput:!0}):(typeof t=="string"&&(e._i=t=e._locale.preparse(t)),Oa(t)?new n0(LP(t)):(i0(t)?e._d=t:Pa(r)?NOe(e):r?RP(e):UOe(e),bP(e)||(e._d=null),e))}function UOe(e){var t=e._i;Rn(t)?e._d=new Date(Ke.now()):i0(t)?e._d=new Date(t.valueOf()):typeof t=="string"?IOe(e):Pa(t)?(e._a=s6(t.slice(0),function(r){return parseInt(r,10)}),IP(e)):hh(t)?BOe(e):jl(t)?e._d=new Date(t):Ke.createFromInputFallback(e)}function D6(e,t,r,i,n){var s={};return(t===!0||t===!1)&&(i=t,t=void 0),(r===!0||r===!1)&&(i=r,r=void 0),(hh(e)&&wP(e)||Pa(e)&&e.length===0)&&(e=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=n,s._l=r,s._i=e,s._f=t,s._strict=i,FOe(s)}function Or(e,t,r,i){return D6(e,t,r,i,!1)}var jOe=ea("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Or.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:Bb()}),HOe=ea("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Or.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:Bb()});function P6(e,t){var r,i;if(t.length===1&&Pa(t[0])&&(t=t[0]),!t.length)return Or();for(r=t[0],i=1;i<t.length;++i)(!t[i].isValid()||t[i][e](r))&&(r=t[i]);return r}function VOe(){var e=[].slice.call(arguments,0);return P6("isBefore",e)}function WOe(){var e=[].slice.call(arguments,0);return P6("isAfter",e)}var GOe=function(){return Date.now?Date.now():+new Date},km=["year","quarter","month","week","day","hour","minute","second","millisecond"];function YOe(e){var t,r=!1,i,n=km.length;for(t in e)if(rr(e,t)&&!(ei.call(km,t)!==-1&&(e[t]==null||!isNaN(e[t]))))return!1;for(i=0;i<n;++i)if(e[km[i]]){if(r)return!1;parseFloat(e[km[i]])!==Gt(e[km[i]])&&(r=!0)}return!0}function qOe(){return this._isValid}function XOe(){return Ra(NaN)}function qb(e){var t=EP(e),r=t.year||0,i=t.quarter||0,n=t.month||0,s=t.week||t.isoWeek||0,a=t.day||0,o=t.hour||0,l=t.minute||0,u=t.second||0,h=t.millisecond||0;this._isValid=YOe(t),this._milliseconds=+h+u*1e3+l*6e4+o*1e3*60*60,this._days=+a+s*7,this._months=+n+i*3+r*12,this._data={},this._locale=Xl(),this._bubble()}function z1(e){return e instanceof qb}function tC(e){return e<0?Math.round(-1*e)*-1:Math.round(e)}function $Oe(e,t,r){var i=Math.min(e.length,t.length),n=Math.abs(e.length-t.length),s=0,a;for(a=0;a<i;a++)(r&&e[a]!==t[a]||!r&&Gt(e[a])!==Gt(t[a]))&&s++;return s+n}function O6(e,t){ft(e,0,0,function(){var r=this.utcOffset(),i="+";return r<0&&(r=-r,i="-"),i+Eo(~~(r/60),2)+t+Eo(~~r%60,2)})}O6("Z",":");O6("ZZ","");st("Z",Wb);st("ZZ",Wb);yr(["Z","ZZ"],function(e,t,r){r._useUTC=!0,r._tzm=kP(Wb,e)});var QOe=/([\+\-]|\d\d)/gi;function kP(e,t){var r=(t||"").match(e),i,n,s;return r===null?null:(i=r[r.length-1]||[],n=(i+"").match(QOe)||["-",0,0],s=+(n[1]*60)+Gt(n[2]),s===0?0:n[0]==="+"?s:-s)}function zP(e,t){var r,i;return t._isUTC?(r=t.clone(),i=(Oa(e)||i0(e)?e.valueOf():Or(e).valueOf())-r.valueOf(),r._d.setTime(r._d.valueOf()+i),Ke.updateOffset(r,!1),r):Or(e).local()}function rC(e){return-Math.round(e._d.getTimezoneOffset())}Ke.updateOffset=function(){};function KOe(e,t,r){var i=this._offset||0,n;if(!this.isValid())return e!=null?this:NaN;if(e!=null){if(typeof e=="string"){if(e=kP(Wb,e),e===null)return this}else Math.abs(e)<16&&!r&&(e=e*60);return!this._isUTC&&t&&(n=rC(this)),this._offset=e,this._isUTC=!0,n!=null&&this.add(n,"m"),i!==e&&(!t||this._changeInProgress?R6(this,Ra(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,Ke.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?i:rC(this)}function ZOe(e,t){return e!=null?(typeof e!="string"&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function JOe(e){return this.utcOffset(0,e)}function e3e(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(rC(this),"m")),this}function t3e(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var e=kP(_Pe,this._i);e!=null?this.utcOffset(e):this.utcOffset(0,!0)}return this}function r3e(e){return this.isValid()?(e=e?Or(e).utcOffset():0,(this.utcOffset()-e)%60===0):!1}function i3e(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function n3e(){if(!Rn(this._isDSTShifted))return this._isDSTShifted;var e={},t;return _P(e,this),e=C6(e),e._a?(t=e._isUTC?Io(e._a):Or(e._a),this._isDSTShifted=this.isValid()&&$Oe(e._a,t.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function s3e(){return this.isValid()?!this._isUTC:!1}function a3e(){return this.isValid()?this._isUTC:!1}function L6(){return this.isValid()?this._isUTC&&this._offset===0:!1}var o3e=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,l3e=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Ra(e,t){var r=e,i=null,n,s,a;return z1(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:jl(e)||!isNaN(+e)?(r={},t?r[t]=+e:r.milliseconds=+e):(i=o3e.exec(e))?(n=i[1]==="-"?-1:1,r={y:0,d:Gt(i[ao])*n,h:Gt(i[Si])*n,m:Gt(i[Sa])*n,s:Gt(i[Sl])*n,ms:Gt(tC(i[Jc]*1e3))*n}):(i=l3e.exec(e))?(n=i[1]==="-"?-1:1,r={y:Pc(i[2],n),M:Pc(i[3],n),w:Pc(i[4],n),d:Pc(i[5],n),h:Pc(i[6],n),m:Pc(i[7],n),s:Pc(i[8],n)}):r==null?r={}:typeof r=="object"&&("from"in r||"to"in r)&&(a=u3e(Or(r.from),Or(r.to)),r={},r.ms=a.milliseconds,r.M=a.months),s=new qb(r),z1(e)&&rr(e,"_locale")&&(s._locale=e._locale),z1(e)&&rr(e,"_isValid")&&(s._isValid=e._isValid),s}Ra.fn=qb.prototype;Ra.invalid=XOe;function Pc(e,t){var r=e&&parseFloat(e.replace(",","."));return(isNaN(r)?0:r)*t}function _B(e,t){var r={};return r.months=t.month()-e.month()+(t.year()-e.year())*12,e.clone().add(r.months,"M").isAfter(t)&&--r.months,r.milliseconds=+t-+e.clone().add(r.months,"M"),r}function u3e(e,t){var r;return e.isValid()&&t.isValid()?(t=zP(t,e),e.isBefore(t)?r=_B(e,t):(r=_B(t,e),r.milliseconds=-r.milliseconds,r.months=-r.months),r):{milliseconds:0,months:0}}function I6(e,t){return function(r,i){var n,s;return i!==null&&!isNaN(+i)&&(o6(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=r,r=i,i=s),n=Ra(r,i),R6(this,n,e),this}}function R6(e,t,r,i){var n=t._milliseconds,s=tC(t._days),a=tC(t._months);e.isValid()&&(i=i??!0,a&&v6(e,bw(e,"Month")+a*r),s&&c6(e,"Date",bw(e,"Date")+s*r),n&&e._d.setTime(e._d.valueOf()+n*r),i&&Ke.updateOffset(e,s||a))}var c3e=I6(1,"add"),h3e=I6(-1,"subtract");function k6(e){return typeof e=="string"||e instanceof String}function d3e(e){return Oa(e)||i0(e)||k6(e)||jl(e)||p3e(e)||f3e(e)||e===null||e===void 0}function f3e(e){var t=hh(e)&&!wP(e),r=!1,i=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],n,s,a=i.length;for(n=0;n<a;n+=1)s=i[n],r=r||rr(e,s);return t&&r}function p3e(e){var t=Pa(e),r=!1;return t&&(r=e.filter(function(i){return!jl(i)&&k6(e)}).length===0),t&&r}function m3e(e){var t=hh(e)&&!wP(e),r=!1,i=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],n,s;for(n=0;n<i.length;n+=1)s=i[n],r=r||rr(e,s);return t&&r}function g3e(e,t){var r=e.diff(t,"days",!0);return r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse"}function v3e(e,t){arguments.length===1&&(arguments[0]?d3e(arguments[0])?(e=arguments[0],t=void 0):m3e(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var r=e||Or(),i=zP(r,this).startOf("day"),n=Ke.calendarFormat(this,i)||"sameElse",s=t&&(Ro(t[n])?t[n].call(this,r):t[n]);return this.format(s||this.localeData().calendar(n,this,Or(r)))}function y3e(){return new n0(this)}function x3e(e,t){var r=Oa(e)?e:Or(e);return this.isValid()&&r.isValid()?(t=ta(t)||"millisecond",t==="millisecond"?this.valueOf()>r.valueOf():r.valueOf()<this.clone().startOf(t).valueOf()):!1}function w3e(e,t){var r=Oa(e)?e:Or(e);return this.isValid()&&r.isValid()?(t=ta(t)||"millisecond",t==="millisecond"?this.valueOf()<r.valueOf():this.clone().endOf(t).valueOf()<r.valueOf()):!1}function b3e(e,t,r,i){var n=Oa(e)?e:Or(e),s=Oa(t)?t:Or(t);return this.isValid()&&n.isValid()&&s.isValid()?(i=i||"()",(i[0]==="("?this.isAfter(n,r):!this.isBefore(n,r))&&(i[1]===")"?this.isBefore(s,r):!this.isAfter(s,r))):!1}function _3e(e,t){var r=Oa(e)?e:Or(e),i;return this.isValid()&&r.isValid()?(t=ta(t)||"millisecond",t==="millisecond"?this.valueOf()===r.valueOf():(i=r.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf())):!1}function S3e(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function M3e(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function E3e(e,t,r){var i,n,s;if(!this.isValid())return NaN;if(i=zP(e,this),!i.isValid())return NaN;switch(n=(i.utcOffset()-this.utcOffset())*6e4,t=ta(t),t){case"year":s=N1(this,i)/12;break;case"month":s=N1(this,i);break;case"quarter":s=N1(this,i)/3;break;case"second":s=(this-i)/1e3;break;case"minute":s=(this-i)/6e4;break;case"hour":s=(this-i)/36e5;break;case"day":s=(this-i-n)/864e5;break;case"week":s=(this-i-n)/6048e5;break;default:s=this-i}return r?s:Fs(s)}function N1(e,t){if(e.date()<t.date())return-N1(t,e);var r=(t.year()-e.year())*12+(t.month()-e.month()),i=e.clone().add(r,"months"),n,s;return t-i<0?(n=e.clone().add(r-1,"months"),s=(t-i)/(i-n)):(n=e.clone().add(r+1,"months"),s=(t-i)/(n-i)),-(r+s)||0}Ke.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";Ke.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function A3e(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function T3e(e){if(!this.isValid())return null;var t=e!==!0,r=t?this.clone().utc():this;return r.year()<0||r.year()>9999?k1(r,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):Ro(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",k1(r,"Z")):k1(r,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function C3e(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="",r,i,n,s;return this.isLocal()||(e=this.utcOffset()===0?"moment.utc":"moment.parseZone",t="Z"),r="["+e+'("]',i=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n="-MM-DD[T]HH:mm:ss.SSS",s=t+'[")]',this.format(r+i+n+s)}function D3e(e){e||(e=this.isUtc()?Ke.defaultFormatUtc:Ke.defaultFormat);var t=k1(this,e);return this.localeData().postformat(t)}function P3e(e,t){return this.isValid()&&(Oa(e)&&e.isValid()||Or(e).isValid())?Ra({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function O3e(e){return this.from(Or(),e)}function L3e(e,t){return this.isValid()&&(Oa(e)&&e.isValid()||Or(e).isValid())?Ra({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function I3e(e){return this.to(Or(),e)}function z6(e){var t;return e===void 0?this._locale._abbr:(t=Xl(e),t!=null&&(this._locale=t),this)}var N6=ea("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return e===void 0?this.localeData():this.locale(e)});function B6(){return this._locale}var Mw=1e3,Df=60*Mw,Ew=60*Df,F6=(365*400+97)*24*Ew;function Pf(e,t){return(e%t+t)%t}function U6(e,t,r){return e<100&&e>=0?new Date(e+400,t,r)-F6:new Date(e,t,r).valueOf()}function j6(e,t,r){return e<100&&e>=0?Date.UTC(e+400,t,r)-F6:Date.UTC(e,t,r)}function R3e(e){var t,r;if(e=ta(e),e===void 0||e==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?j6:U6,e){case"year":t=r(this.year(),0,1);break;case"quarter":t=r(this.year(),this.month()-this.month()%3,1);break;case"month":t=r(this.year(),this.month(),1);break;case"week":t=r(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=r(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=Pf(t+(this._isUTC?0:this.utcOffset()*Df),Ew);break;case"minute":t=this._d.valueOf(),t-=Pf(t,Df);break;case"second":t=this._d.valueOf(),t-=Pf(t,Mw);break}return this._d.setTime(t),Ke.updateOffset(this,!0),this}function k3e(e){var t,r;if(e=ta(e),e===void 0||e==="millisecond"||!this.isValid())return this;switch(r=this._isUTC?j6:U6,e){case"year":t=r(this.year()+1,0,1)-1;break;case"quarter":t=r(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=r(this.year(),this.month()+1,1)-1;break;case"week":t=r(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=r(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=Ew-Pf(t+(this._isUTC?0:this.utcOffset()*Df),Ew)-1;break;case"minute":t=this._d.valueOf(),t+=Df-Pf(t,Df)-1;break;case"second":t=this._d.valueOf(),t+=Mw-Pf(t,Mw)-1;break}return this._d.setTime(t),Ke.updateOffset(this,!0),this}function z3e(){return this._d.valueOf()-(this._offset||0)*6e4}function N3e(){return Math.floor(this.valueOf()/1e3)}function B3e(){return new Date(this.valueOf())}function F3e(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function U3e(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function j3e(){return this.isValid()?this.toISOString():null}function H3e(){return bP(this)}function V3e(){return zu({},Ft(this))}function W3e(){return Ft(this).overflow}function G3e(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}ft("N",0,0,"eraAbbr");ft("NN",0,0,"eraAbbr");ft("NNN",0,0,"eraAbbr");ft("NNNN",0,0,"eraName");ft("NNNNN",0,0,"eraNarrow");ft("y",["y",1],"yo","eraYear");ft("y",["yy",2],0,"eraYear");ft("y",["yyy",3],0,"eraYear");ft("y",["yyyy",4],0,"eraYear");st("N",NP);st("NN",NP);st("NNN",NP);st("NNNN",rLe);st("NNNNN",iLe);yr(["N","NN","NNN","NNNN","NNNNN"],function(e,t,r,i){var n=r._locale.erasParse(e,i,r._strict);n?Ft(r).era=n:Ft(r).invalidEra=e});st("y",Ip);st("yy",Ip);st("yyy",Ip);st("yyyy",Ip);st("yo",nLe);yr(["y","yy","yyy","yyyy"],ln);yr(["yo"],function(e,t,r,i){var n;r._locale._eraYearOrdinalRegex&&(n=e.match(r._locale._eraYearOrdinalRegex)),r._locale.eraYearOrdinalParse?t[ln]=r._locale.eraYearOrdinalParse(e,n):t[ln]=parseInt(e,10)});function Y3e(e,t){var r,i,n,s=this._eras||Xl("en")._eras;for(r=0,i=s.length;r<i;++r){switch(typeof s[r].since){case"string":n=Ke(s[r].since).startOf("day"),s[r].since=n.valueOf();break}switch(typeof s[r].until){case"undefined":s[r].until=1/0;break;case"string":n=Ke(s[r].until).startOf("day").valueOf(),s[r].until=n.valueOf();break}}return s}function q3e(e,t,r){var i,n,s=this.eras(),a,o,l;for(e=e.toUpperCase(),i=0,n=s.length;i<n;++i)if(a=s[i].name.toUpperCase(),o=s[i].abbr.toUpperCase(),l=s[i].narrow.toUpperCase(),r)switch(t){case"N":case"NN":case"NNN":if(o===e)return s[i];break;case"NNNN":if(a===e)return s[i];break;case"NNNNN":if(l===e)return s[i];break}else if([a,o,l].indexOf(e)>=0)return s[i]}function X3e(e,t){var r=e.since<=e.until?1:-1;return t===void 0?Ke(e.since).year():Ke(e.since).year()+(t-e.offset)*r}function $3e(){var e,t,r,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e)if(r=this.clone().startOf("day").valueOf(),i[e].since<=r&&r<=i[e].until||i[e].until<=r&&r<=i[e].since)return i[e].name;return""}function Q3e(){var e,t,r,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e)if(r=this.clone().startOf("day").valueOf(),i[e].since<=r&&r<=i[e].until||i[e].until<=r&&r<=i[e].since)return i[e].narrow;return""}function K3e(){var e,t,r,i=this.localeData().eras();for(e=0,t=i.length;e<t;++e)if(r=this.clone().startOf("day").valueOf(),i[e].since<=r&&r<=i[e].until||i[e].until<=r&&r<=i[e].since)return i[e].abbr;return""}function Z3e(){var e,t,r,i,n=this.localeData().eras();for(e=0,t=n.length;e<t;++e)if(r=n[e].since<=n[e].until?1:-1,i=this.clone().startOf("day").valueOf(),n[e].since<=i&&i<=n[e].until||n[e].until<=i&&i<=n[e].since)return(this.year()-Ke(n[e].since).year())*r+n[e].offset;return this.year()}function J3e(e){return rr(this,"_erasNameRegex")||BP.call(this),e?this._erasNameRegex:this._erasRegex}function eLe(e){return rr(this,"_erasAbbrRegex")||BP.call(this),e?this._erasAbbrRegex:this._erasRegex}function tLe(e){return rr(this,"_erasNarrowRegex")||BP.call(this),e?this._erasNarrowRegex:this._erasRegex}function NP(e,t){return t.erasAbbrRegex(e)}function rLe(e,t){return t.erasNameRegex(e)}function iLe(e,t){return t.erasNarrowRegex(e)}function nLe(e,t){return t._eraYearOrdinalRegex||Ip}function BP(){var e=[],t=[],r=[],i=[],n,s,a=this.eras();for(n=0,s=a.length;n<s;++n)t.push(cs(a[n].name)),e.push(cs(a[n].abbr)),r.push(cs(a[n].narrow)),i.push(cs(a[n].name)),i.push(cs(a[n].abbr)),i.push(cs(a[n].narrow));this._erasRegex=new RegExp("^("+i.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+r.join("|")+")","i")}ft(0,["gg",2],0,function(){return this.weekYear()%100});ft(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Xb(e,t){ft(0,[e,e.length],0,t)}Xb("gggg","weekYear");Xb("ggggg","weekYear");Xb("GGGG","isoWeekYear");Xb("GGGGG","isoWeekYear");hn("weekYear","gg");hn("isoWeekYear","GG");dn("weekYear",1);dn("isoWeekYear",1);st("G",Vb);st("g",Vb);st("GG",Lr,Ms);st("gg",Lr,Ms);st("GGGG",TP,AP);st("gggg",TP,AP);st("GGGGG",Hb,Ub);st("ggggg",Hb,Ub);a0(["gggg","ggggg","GGGG","GGGGG"],function(e,t,r,i){t[i.substr(0,2)]=Gt(e)});a0(["gg","GG"],function(e,t,r,i){t[i]=Ke.parseTwoDigitYear(e)});function sLe(e){return H6.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function aLe(e){return H6.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function oLe(){return Pl(this.year(),1,4)}function lLe(){return Pl(this.isoWeekYear(),1,4)}function uLe(){var e=this.localeData()._week;return Pl(this.year(),e.dow,e.doy)}function cLe(){var e=this.localeData()._week;return Pl(this.weekYear(),e.dow,e.doy)}function H6(e,t,r,i,n){var s;return e==null?Mv(this,i,n).year:(s=Pl(e,i,n),t>s&&(t=s),hLe.call(this,e,t,r,i,n))}function hLe(e,t,r,i,n){var s=b6(e,t,r,i,n),a=Sv(s.year,0,s.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}ft("Q",0,"Qo","quarter");hn("quarter","Q");dn("quarter",7);st("Q",h6);yr("Q",function(e,t){t[_l]=(Gt(e)-1)*3});function dLe(e){return e==null?Math.ceil((this.month()+1)/3):this.month((e-1)*3+this.month()%3)}ft("D",["DD",2],"Do","date");hn("date","D");dn("date",9);st("D",Lr);st("DD",Lr,Ms);st("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient});yr(["D","DD"],ao);yr("Do",function(e,t){t[ao]=Gt(e.match(Lr)[0])});var V6=Lp("Date",!0);ft("DDD",["DDDD",3],"DDDo","dayOfYear");hn("dayOfYear","DDD");dn("dayOfYear",4);st("DDD",jb);st("DDDD",d6);yr(["DDD","DDDD"],function(e,t,r){r._dayOfYear=Gt(e)});function fLe(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return e==null?t:this.add(e-t,"d")}ft("m",["mm",2],0,"minute");hn("minute","m");dn("minute",14);st("m",Lr);st("mm",Lr,Ms);yr(["m","mm"],Sa);var pLe=Lp("Minutes",!1);ft("s",["ss",2],0,"second");hn("second","s");dn("second",15);st("s",Lr);st("ss",Lr,Ms);yr(["s","ss"],Sl);var mLe=Lp("Seconds",!1);ft("S",0,0,function(){return~~(this.millisecond()/100)});ft(0,["SS",2],0,function(){return~~(this.millisecond()/10)});ft(0,["SSS",3],0,"millisecond");ft(0,["SSSS",4],0,function(){return this.millisecond()*10});ft(0,["SSSSS",5],0,function(){return this.millisecond()*100});ft(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});ft(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});ft(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});ft(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});hn("millisecond","ms");dn("millisecond",16);st("S",jb,h6);st("SS",jb,Ms);st("SSS",jb,d6);var Nu,W6;for(Nu="SSSS";Nu.length<=9;Nu+="S")st(Nu,Ip);function gLe(e,t){t[Jc]=Gt(("0."+e)*1e3)}for(Nu="S";Nu.length<=9;Nu+="S")yr(Nu,gLe);W6=Lp("Milliseconds",!1);ft("z",0,0,"zoneAbbr");ft("zz",0,0,"zoneName");function vLe(){return this._isUTC?"UTC":""}function yLe(){return this._isUTC?"Coordinated Universal Time":""}var Fe=n0.prototype;Fe.add=c3e;Fe.calendar=v3e;Fe.clone=y3e;Fe.diff=E3e;Fe.endOf=k3e;Fe.format=D3e;Fe.from=P3e;Fe.fromNow=O3e;Fe.to=L3e;Fe.toNow=I3e;Fe.get=wPe;Fe.invalidAt=W3e;Fe.isAfter=x3e;Fe.isBefore=w3e;Fe.isBetween=b3e;Fe.isSame=_3e;Fe.isSameOrAfter=S3e;Fe.isSameOrBefore=M3e;Fe.isValid=H3e;Fe.lang=N6;Fe.locale=z6;Fe.localeData=B6;Fe.max=HOe;Fe.min=jOe;Fe.parsingFlags=V3e;Fe.set=bPe;Fe.startOf=R3e;Fe.subtract=h3e;Fe.toArray=F3e;Fe.toObject=U3e;Fe.toDate=B3e;Fe.toISOString=T3e;Fe.inspect=C3e;typeof Symbol<"u"&&Symbol.for!=null&&(Fe[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});Fe.toJSON=j3e;Fe.toString=A3e;Fe.unix=N3e;Fe.valueOf=z3e;Fe.creationData=G3e;Fe.eraName=$3e;Fe.eraNarrow=Q3e;Fe.eraAbbr=K3e;Fe.eraYear=Z3e;Fe.year=w6;Fe.isLeapYear=UPe;Fe.weekYear=sLe;Fe.isoWeekYear=aLe;Fe.quarter=Fe.quarters=dLe;Fe.month=y6;Fe.daysInMonth=NPe;Fe.week=Fe.weeks=YPe;Fe.isoWeek=Fe.isoWeeks=qPe;Fe.weeksInYear=uLe;Fe.weeksInWeekYear=cLe;Fe.isoWeeksInYear=oLe;Fe.isoWeeksInISOWeekYear=lLe;Fe.date=V6;Fe.day=Fe.days=aOe;Fe.weekday=oOe;Fe.isoWeekday=lOe;Fe.dayOfYear=fLe;Fe.hour=Fe.hours=mOe;Fe.minute=Fe.minutes=pLe;Fe.second=Fe.seconds=mLe;Fe.millisecond=Fe.milliseconds=W6;Fe.utcOffset=KOe;Fe.utc=JOe;Fe.local=e3e;Fe.parseZone=t3e;Fe.hasAlignedHourOffset=r3e;Fe.isDST=i3e;Fe.isLocal=s3e;Fe.isUtcOffset=a3e;Fe.isUtc=L6;Fe.isUTC=L6;Fe.zoneAbbr=vLe;Fe.zoneName=yLe;Fe.dates=ea("dates accessor is deprecated. Use date instead.",V6);Fe.months=ea("months accessor is deprecated. Use month instead",y6);Fe.years=ea("years accessor is deprecated. Use year instead",w6);Fe.zone=ea("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",ZOe);Fe.isDSTShifted=ea("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",n3e);function xLe(e){return Or(e*1e3)}function wLe(){return Or.apply(null,arguments).parseZone()}function G6(e){return e}var ir=SP.prototype;ir.calendar=aPe;ir.longDateFormat=cPe;ir.invalidDate=dPe;ir.ordinal=mPe;ir.preparse=G6;ir.postformat=G6;ir.relativeTime=vPe;ir.pastFuture=yPe;ir.set=nPe;ir.eras=Y3e;ir.erasParse=q3e;ir.erasConvertYear=X3e;ir.erasAbbrRegex=eLe;ir.erasNameRegex=J3e;ir.erasNarrowRegex=tLe;ir.months=IPe;ir.monthsShort=RPe;ir.monthsParse=zPe;ir.monthsRegex=FPe;ir.monthsShortRegex=BPe;ir.week=HPe;ir.firstDayOfYear=GPe;ir.firstDayOfWeek=WPe;ir.weekdays=tOe;ir.weekdaysMin=iOe;ir.weekdaysShort=rOe;ir.weekdaysParse=sOe;ir.weekdaysRegex=uOe;ir.weekdaysShortRegex=cOe;ir.weekdaysMinRegex=hOe;ir.isPM=fOe;ir.meridiem=gOe;function Aw(e,t,r,i){var n=Xl(),s=Io().set(i,t);return n[r](s,e)}function Y6(e,t,r){if(jl(e)&&(t=e,e=void 0),e=e||"",t!=null)return Aw(e,t,r,"month");var i,n=[];for(i=0;i<12;i++)n[i]=Aw(e,i,r,"month");return n}function FP(e,t,r,i){typeof e=="boolean"?(jl(t)&&(r=t,t=void 0),t=t||""):(t=e,r=t,e=!1,jl(t)&&(r=t,t=void 0),t=t||"");var n=Xl(),s=e?n._week.dow:0,a,o=[];if(r!=null)return Aw(t,(r+s)%7,i,"day");for(a=0;a<7;a++)o[a]=Aw(t,(a+s)%7,i,"day");return o}function bLe(e,t){return Y6(e,t,"months")}function _Le(e,t){return Y6(e,t,"monthsShort")}function SLe(e,t,r){return FP(e,t,r,"weekdays")}function MLe(e,t,r){return FP(e,t,r,"weekdaysShort")}function ELe(e,t,r){return FP(e,t,r,"weekdaysMin")}Zu("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,r=Gt(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+r}});Ke.lang=ea("moment.lang is deprecated. Use moment.locale instead.",Zu);Ke.langData=ea("moment.langData is deprecated. Use moment.localeData instead.",Xl);var tl=Math.abs;function ALe(){var e=this._data;return this._milliseconds=tl(this._milliseconds),this._days=tl(this._days),this._months=tl(this._months),e.milliseconds=tl(e.milliseconds),e.seconds=tl(e.seconds),e.minutes=tl(e.minutes),e.hours=tl(e.hours),e.months=tl(e.months),e.years=tl(e.years),this}function q6(e,t,r,i){var n=Ra(t,r);return e._milliseconds+=i*n._milliseconds,e._days+=i*n._days,e._months+=i*n._months,e._bubble()}function TLe(e,t){return q6(this,e,t,1)}function CLe(e,t){return q6(this,e,t,-1)}function SB(e){return e<0?Math.floor(e):Math.ceil(e)}function DLe(){var e=this._milliseconds,t=this._days,r=this._months,i=this._data,n,s,a,o,l;return e>=0&&t>=0&&r>=0||e<=0&&t<=0&&r<=0||(e+=SB(iC(r)+t)*864e5,t=0,r=0),i.milliseconds=e%1e3,n=Fs(e/1e3),i.seconds=n%60,s=Fs(n/60),i.minutes=s%60,a=Fs(s/60),i.hours=a%24,t+=Fs(a/24),l=Fs(X6(t)),r+=l,t-=SB(iC(l)),o=Fs(r/12),r%=12,i.days=t,i.months=r,i.years=o,this}function X6(e){return e*4800/146097}function iC(e){return e*146097/4800}function PLe(e){if(!this.isValid())return NaN;var t,r,i=this._milliseconds;if(e=ta(e),e==="month"||e==="quarter"||e==="year")switch(t=this._days+i/864e5,r=this._months+X6(t),e){case"month":return r;case"quarter":return r/3;case"year":return r/12}else switch(t=this._days+Math.round(iC(this._months)),e){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return t*24+i/36e5;case"minute":return t*1440+i/6e4;case"second":return t*86400+i/1e3;case"millisecond":return Math.floor(t*864e5)+i;default:throw new Error("Unknown unit "+e)}}function OLe(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+Gt(this._months/12)*31536e6:NaN}function $l(e){return function(){return this.as(e)}}var LLe=$l("ms"),ILe=$l("s"),RLe=$l("m"),kLe=$l("h"),zLe=$l("d"),NLe=$l("w"),BLe=$l("M"),FLe=$l("Q"),ULe=$l("y");function jLe(){return Ra(this)}function HLe(e){return e=ta(e),this.isValid()?this[e+"s"]():NaN}function Uh(e){return function(){return this.isValid()?this._data[e]:NaN}}var VLe=Uh("milliseconds"),WLe=Uh("seconds"),GLe=Uh("minutes"),YLe=Uh("hours"),qLe=Uh("days"),XLe=Uh("months"),$Le=Uh("years");function QLe(){return Fs(this.days()/7)}var hl=Math.round,sf={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function KLe(e,t,r,i,n){return n.relativeTime(t||1,!!r,e,i)}function ZLe(e,t,r,i){var n=Ra(e).abs(),s=hl(n.as("s")),a=hl(n.as("m")),o=hl(n.as("h")),l=hl(n.as("d")),u=hl(n.as("M")),h=hl(n.as("w")),c=hl(n.as("y")),d=s<=r.ss&&["s",s]||s<r.s&&["ss",s]||a<=1&&["m"]||a<r.m&&["mm",a]||o<=1&&["h"]||o<r.h&&["hh",o]||l<=1&&["d"]||l<r.d&&["dd",l];return r.w!=null&&(d=d||h<=1&&["w"]||h<r.w&&["ww",h]),d=d||u<=1&&["M"]||u<r.M&&["MM",u]||c<=1&&["y"]||["yy",c],d[2]=t,d[3]=+e>0,d[4]=i,KLe.apply(null,d)}function JLe(e){return e===void 0?hl:typeof e=="function"?(hl=e,!0):!1}function eIe(e,t){return sf[e]===void 0?!1:t===void 0?sf[e]:(sf[e]=t,e==="s"&&(sf.ss=t-1),!0)}function tIe(e,t){if(!this.isValid())return this.localeData().invalidDate();var r=!1,i=sf,n,s;return typeof e=="object"&&(t=e,e=!1),typeof e=="boolean"&&(r=e),typeof t=="object"&&(i=Object.assign({},sf,t),t.s!=null&&t.ss==null&&(i.ss=t.s-1)),n=this.localeData(),s=ZLe(this,!r,i,n),r&&(s=n.pastFuture(+this,s)),n.postformat(s)}var $M=Math.abs;function Td(e){return(e>0)-(e<0)||+e}function $b(){if(!this.isValid())return this.localeData().invalidDate();var e=$M(this._milliseconds)/1e3,t=$M(this._days),r=$M(this._months),i,n,s,a,o=this.asSeconds(),l,u,h,c;return o?(i=Fs(e/60),n=Fs(i/60),e%=60,i%=60,s=Fs(r/12),r%=12,a=e?e.toFixed(3).replace(/\.?0+$/,""):"",l=o<0?"-":"",u=Td(this._months)!==Td(o)?"-":"",h=Td(this._days)!==Td(o)?"-":"",c=Td(this._milliseconds)!==Td(o)?"-":"",l+"P"+(s?u+s+"Y":"")+(r?u+r+"M":"")+(t?h+t+"D":"")+(n||i||e?"T":"")+(n?c+n+"H":"")+(i?c+i+"M":"")+(e?c+a+"S":"")):"P0D"}var Zt=qb.prototype;Zt.isValid=qOe;Zt.abs=ALe;Zt.add=TLe;Zt.subtract=CLe;Zt.as=PLe;Zt.asMilliseconds=LLe;Zt.asSeconds=ILe;Zt.asMinutes=RLe;Zt.asHours=kLe;Zt.asDays=zLe;Zt.asWeeks=NLe;Zt.asMonths=BLe;Zt.asQuarters=FLe;Zt.asYears=ULe;Zt.valueOf=OLe;Zt._bubble=DLe;Zt.clone=jLe;Zt.get=HLe;Zt.milliseconds=VLe;Zt.seconds=WLe;Zt.minutes=GLe;Zt.hours=YLe;Zt.days=qLe;Zt.weeks=QLe;Zt.months=XLe;Zt.years=$Le;Zt.humanize=tIe;Zt.toISOString=$b;Zt.toString=$b;Zt.toJSON=$b;Zt.locale=z6;Zt.localeData=B6;Zt.toIsoString=ea("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",$b);Zt.lang=N6;ft("X",0,0,"unix");ft("x",0,0,"valueOf");st("x",Vb);st("X",SPe);yr("X",function(e,t,r){r._d=new Date(parseFloat(e)*1e3)});yr("x",function(e,t,r){r._d=new Date(Gt(e))});//! moment.js
Ke.version="2.29.4";rPe(Or);Ke.fn=Fe;Ke.min=VOe;Ke.max=WOe;Ke.now=GOe;Ke.utc=Io;Ke.unix=xLe;Ke.months=bLe;Ke.isDate=i0;Ke.locale=Zu;Ke.invalid=Bb;Ke.duration=Ra;Ke.isMoment=Oa;Ke.weekdays=SLe;Ke.parseZone=wLe;Ke.localeData=Xl;Ke.isDuration=z1;Ke.monthsShort=_Le;Ke.weekdaysMin=ELe;Ke.defineLocale=OP;Ke.updateLocale=wOe;Ke.locales=bOe;Ke.weekdaysShort=MLe;Ke.normalizeUnits=ta;Ke.relativeTimeRounding=JLe;Ke.relativeTimeThreshold=eIe;Ke.calendarFormat=g3e;Ke.prototype=Fe;Ke.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};function $6(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var QM={exports:{}},MB;function rIe(){return MB||(MB=1,function(e,t){(function(r,i){e.exports=i()})(Hl,function(){var r;function i(){return r.apply(null,arguments)}function n(b){r=b}function s(b){return b instanceof Array||Object.prototype.toString.call(b)==="[object Array]"}function a(b){return b!=null&&Object.prototype.toString.call(b)==="[object Object]"}function o(b,E){return Object.prototype.hasOwnProperty.call(b,E)}function l(b){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(b).length===0;var E;for(E in b)if(o(b,E))return!1;return!0}function u(b){return b===void 0}function h(b){return typeof b=="number"||Object.prototype.toString.call(b)==="[object Number]"}function c(b){return b instanceof Date||Object.prototype.toString.call(b)==="[object Date]"}function d(b,E){var D=[],R,F=b.length;for(R=0;R<F;++R)D.push(E(b[R],R));return D}function f(b,E){for(var D in E)o(E,D)&&(b[D]=E[D]);return o(E,"toString")&&(b.toString=E.toString),o(E,"valueOf")&&(b.valueOf=E.valueOf),b}function p(b,E,D,R){return KP(b,E,D,R,!0).utc()}function m(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function g(b){return b._pf==null&&(b._pf=m()),b._pf}var v;Array.prototype.some?v=Array.prototype.some:v=function(b){var E=Object(this),D=E.length>>>0,R;for(R=0;R<D;R++)if(R in E&&b.call(this,E[R],R,E))return!0;return!1};function y(b){if(b._isValid==null){var E=g(b),D=v.call(E.parsedDateParts,function(F){return F!=null}),R=!isNaN(b._d.getTime())&&E.overflow<0&&!E.empty&&!E.invalidEra&&!E.invalidMonth&&!E.invalidWeekday&&!E.weekdayMismatch&&!E.nullInput&&!E.invalidFormat&&!E.userInvalidated&&(!E.meridiem||E.meridiem&&D);if(b._strict&&(R=R&&E.charsLeftOver===0&&E.unusedTokens.length===0&&E.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(b))b._isValid=R;else return R}return b._isValid}function x(b){var E=p(NaN);return b!=null?f(g(E),b):g(E).userInvalidated=!0,E}var w=i.momentProperties=[],S=!1;function _(b,E){var D,R,F,te=w.length;if(u(E._isAMomentObject)||(b._isAMomentObject=E._isAMomentObject),u(E._i)||(b._i=E._i),u(E._f)||(b._f=E._f),u(E._l)||(b._l=E._l),u(E._strict)||(b._strict=E._strict),u(E._tzm)||(b._tzm=E._tzm),u(E._isUTC)||(b._isUTC=E._isUTC),u(E._offset)||(b._offset=E._offset),u(E._pf)||(b._pf=g(E)),u(E._locale)||(b._locale=E._locale),te>0)for(D=0;D<te;D++)R=w[D],F=E[R],u(F)||(b[R]=F);return b}function A(b){_(this,b),this._d=new Date(b._d!=null?b._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),S===!1&&(S=!0,i.updateOffset(this),S=!1)}function M(b){return b instanceof A||b!=null&&b._isAMomentObject!=null}function T(b){i.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+b)}function C(b,E){var D=!0;return f(function(){if(i.deprecationHandler!=null&&i.deprecationHandler(null,b),D){var R=[],F,te,Se,dt=arguments.length;for(te=0;te<dt;te++){if(F="",typeof arguments[te]=="object"){F+=`
[`+te+"] ";for(Se in arguments[0])o(arguments[0],Se)&&(F+=Se+": "+arguments[0][Se]+", ");F=F.slice(0,-2)}else F=arguments[te];R.push(F)}T(b+`
Arguments: `+Array.prototype.slice.call(R).join("")+`
`+new Error().stack),D=!1}return E.apply(this,arguments)},E)}var L={};function I(b,E){i.deprecationHandler!=null&&i.deprecationHandler(b,E),L[b]||(T(E),L[b]=!0)}i.suppressDeprecationWarnings=!1,i.deprecationHandler=null;function k(b){return typeof Function<"u"&&b instanceof Function||Object.prototype.toString.call(b)==="[object Function]"}function z(b){var E,D;for(D in b)o(b,D)&&(E=b[D],k(E)?this[D]=E:this["_"+D]=E);this._config=b,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function V(b,E){var D=f({},b),R;for(R in E)o(E,R)&&(a(b[R])&&a(E[R])?(D[R]={},f(D[R],b[R]),f(D[R],E[R])):E[R]!=null?D[R]=E[R]:delete D[R]);for(R in b)o(b,R)&&!o(E,R)&&a(b[R])&&(D[R]=f({},D[R]));return D}function K(b){b!=null&&this.set(b)}var q;Object.keys?q=Object.keys:q=function(b){var E,D=[];for(E in b)o(b,E)&&D.push(E);return D};var O={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function W(b,E,D){var R=this._calendar[b]||this._calendar.sameElse;return k(R)?R.call(E,D):R}function N(b,E,D){var R=""+Math.abs(b),F=E-R.length,te=b>=0;return(te?D?"+":"":"-")+Math.pow(10,Math.max(0,F)).toString().substr(1)+R}var B=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,j=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Q={},H={};function G(b,E,D,R){var F=R;typeof R=="string"&&(F=function(){return this[R]()}),b&&(H[b]=F),E&&(H[E[0]]=function(){return N(F.apply(this,arguments),E[1],E[2])}),D&&(H[D]=function(){return this.localeData().ordinal(F.apply(this,arguments),b)})}function $(b){return b.match(/\[[\s\S]/)?b.replace(/^\[|\]$/g,""):b.replace(/\\/g,"")}function se(b){var E=b.match(B),D,R;for(D=0,R=E.length;D<R;D++)H[E[D]]?E[D]=H[E[D]]:E[D]=$(E[D]);return function(F){var te="",Se;for(Se=0;Se<R;Se++)te+=k(E[Se])?E[Se].call(F,b):E[Se];return te}}function re(b,E){return b.isValid()?(E=ae(E,b.localeData()),Q[E]=Q[E]||se(E),Q[E](b)):b.localeData().invalidDate()}function ae(b,E){var D=5;function R(F){return E.longDateFormat(F)||F}for(j.lastIndex=0;D>=0&&j.test(b);)b=b.replace(j,R),j.lastIndex=0,D-=1;return b}var ce={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function me(b){var E=this._longDateFormat[b],D=this._longDateFormat[b.toUpperCase()];return E||!D?E:(this._longDateFormat[b]=D.match(B).map(function(R){return R==="MMMM"||R==="MM"||R==="DD"||R==="dddd"?R.slice(1):R}).join(""),this._longDateFormat[b])}var be="Invalid date";function Ae(){return this._invalidDate}var $e="%d",Le=/\d{1,2}/;function Qe(b){return this._ordinal.replace("%d",b)}var Xe={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Re(b,E,D,R){var F=this._relativeTime[D];return k(F)?F(b,E,D,R):F.replace(/%d/i,b)}function Ie(b,E){var D=this._relativeTime[b>0?"future":"past"];return k(D)?D(E):D.replace(/%s/i,E)}var Ge={};function He(b,E){var D=b.toLowerCase();Ge[D]=Ge[D+"s"]=Ge[E]=b}function Y(b){return typeof b=="string"?Ge[b]||Ge[b.toLowerCase()]:void 0}function U(b){var E={},D,R;for(R in b)o(b,R)&&(D=Y(R),D&&(E[D]=b[R]));return E}var he={};function Ee(b,E){he[b]=E}function Ce(b){var E=[],D;for(D in b)o(b,D)&&E.push({unit:D,priority:he[D]});return E.sort(function(R,F){return R.priority-F.priority}),E}function ke(b){return b%4===0&&b%100!==0||b%400===0}function Ye(b){return b<0?Math.ceil(b)||0:Math.floor(b)}function De(b){var E=+b,D=0;return E!==0&&isFinite(E)&&(D=Ye(E)),D}function xe(b,E){return function(D){return D!=null?(ot(this,b,D),i.updateOffset(this,E),this):et(this,b)}}function et(b,E){return b.isValid()?b._d["get"+(b._isUTC?"UTC":"")+E]():NaN}function ot(b,E,D){b.isValid()&&!isNaN(D)&&(E==="FullYear"&&ke(b.year())&&b.month()===1&&b.date()===29?(D=De(D),b._d["set"+(b._isUTC?"UTC":"")+E](D,b.month(),Ht(D,b.month()))):b._d["set"+(b._isUTC?"UTC":"")+E](D))}function ut(b){return b=Y(b),k(this[b])?this[b]():this}function ne(b,E){if(typeof b=="object"){b=U(b);var D=Ce(b),R,F=D.length;for(R=0;R<F;R++)this[D[R].unit](b[D[R].unit])}else if(b=Y(b),k(this[b]))return this[b](E);return this}var oe=/\d/,ve=/\d\d/,ze=/\d{3}/,rt=/\d{4}/,Z=/[+-]?\d{6}/,ie=/\d\d?/,de=/\d\d\d\d?/,_e=/\d\d\d\d\d\d?/,Ve=/\d{1,3}/,ct=/\d{1,4}/,yt=/[+-]?\d{1,6}/,Dt=/\d+/,nr=/[+-]?\d+/,Qt=/Z|[+-]\d\d:?\d\d/gi,Vr=/Z|[+-]\d\d(?::?\d\d)?/gi,oi=/[+-]?\d+(\.\d{1,3})?/,Es=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,$i;$i={};function qe(b,E,D){$i[b]=k(E)?E:function(R,F){return R&&D?D:E}}function Ql(b,E){return o($i,b)?$i[b](E._strict,E._locale):new RegExp(X(b))}function X(b){return le(b.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(E,D,R,F,te){return D||R||F||te}))}function le(b){return b.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var Me={};function ee(b,E){var D,R=E,F;for(typeof b=="string"&&(b=[b]),h(E)&&(R=function(te,Se){Se[E]=De(te)}),F=b.length,D=0;D<F;D++)Me[b[D]]=R}function we(b,E){ee(b,function(D,R,F,te){F._w=F._w||{},E(D,F._w,F,te)})}function tt(b,E,D){E!=null&&o(Me,b)&&Me[b](E,D._a,D,b)}var lt=0,it=1,vt=2,Et=3,Tt=4,It=5,Ir=6,fn=7,ra=8;function ko(b,E){return(b%E+E)%E}var Nt;Array.prototype.indexOf?Nt=Array.prototype.indexOf:Nt=function(b){var E;for(E=0;E<this.length;++E)if(this[E]===b)return E;return-1};function Ht(b,E){if(isNaN(b)||isNaN(E))return NaN;var D=ko(E,12);return b+=(E-D)/12,D===1?ke(b)?29:28:31-D%7%2}G("M",["MM",2],"Mo",function(){return this.month()+1}),G("MMM",0,0,function(b){return this.localeData().monthsShort(this,b)}),G("MMMM",0,0,function(b){return this.localeData().months(this,b)}),He("month","M"),Ee("month",8),qe("M",ie),qe("MM",ie,ve),qe("MMM",function(b,E){return E.monthsShortRegex(b)}),qe("MMMM",function(b,E){return E.monthsRegex(b)}),ee(["M","MM"],function(b,E){E[it]=De(b)-1}),ee(["MMM","MMMM"],function(b,E,D,R){var F=D._locale.monthsParse(b,R,D._strict);F!=null?E[it]=F:g(D).invalidMonth=b});var Rp="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),jh="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),ka=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,o0=Es,vc=Es;function kp(b,E){return b?s(this._months)?this._months[b.month()]:this._months[(this._months.isFormat||ka).test(E)?"format":"standalone"][b.month()]:s(this._months)?this._months:this._months.standalone}function mi(b,E){return b?s(this._monthsShort)?this._monthsShort[b.month()]:this._monthsShort[ka.test(E)?"format":"standalone"][b.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function zo(b,E,D){var R,F,te,Se=b.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],R=0;R<12;++R)te=p([2e3,R]),this._shortMonthsParse[R]=this.monthsShort(te,"").toLocaleLowerCase(),this._longMonthsParse[R]=this.months(te,"").toLocaleLowerCase();return D?E==="MMM"?(F=Nt.call(this._shortMonthsParse,Se),F!==-1?F:null):(F=Nt.call(this._longMonthsParse,Se),F!==-1?F:null):E==="MMM"?(F=Nt.call(this._shortMonthsParse,Se),F!==-1?F:(F=Nt.call(this._longMonthsParse,Se),F!==-1?F:null)):(F=Nt.call(this._longMonthsParse,Se),F!==-1?F:(F=Nt.call(this._shortMonthsParse,Se),F!==-1?F:null))}function zp(b,E,D){var R,F,te;if(this._monthsParseExact)return zo.call(this,b,E,D);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),R=0;R<12;R++){if(F=p([2e3,R]),D&&!this._longMonthsParse[R]&&(this._longMonthsParse[R]=new RegExp("^"+this.months(F,"").replace(".","")+"$","i"),this._shortMonthsParse[R]=new RegExp("^"+this.monthsShort(F,"").replace(".","")+"$","i")),!D&&!this._monthsParse[R]&&(te="^"+this.months(F,"")+"|^"+this.monthsShort(F,""),this._monthsParse[R]=new RegExp(te.replace(".",""),"i")),D&&E==="MMMM"&&this._longMonthsParse[R].test(b))return R;if(D&&E==="MMM"&&this._shortMonthsParse[R].test(b))return R;if(!D&&this._monthsParse[R].test(b))return R}}function Qi(b,E){var D;if(!b.isValid())return b;if(typeof E=="string"){if(/^\d+$/.test(E))E=De(E);else if(E=b.localeData().monthsParse(E),!h(E))return b}return D=Math.min(b.date(),Ht(b.year(),E)),b._d["set"+(b._isUTC?"UTC":"")+"Month"](E,D),b}function Hh(b){return b!=null?(Qi(this,b),i.updateOffset(this,!0),this):et(this,"Month")}function Qb(){return Ht(this.year(),this.month())}function l0(b){return this._monthsParseExact?(o(this,"_monthsRegex")||UP.call(this),b?this._monthsShortStrictRegex:this._monthsShortRegex):(o(this,"_monthsShortRegex")||(this._monthsShortRegex=o0),this._monthsShortStrictRegex&&b?this._monthsShortStrictRegex:this._monthsShortRegex)}function K6(b){return this._monthsParseExact?(o(this,"_monthsRegex")||UP.call(this),b?this._monthsStrictRegex:this._monthsRegex):(o(this,"_monthsRegex")||(this._monthsRegex=vc),this._monthsStrictRegex&&b?this._monthsStrictRegex:this._monthsRegex)}function UP(){function b(Se,dt){return dt.length-Se.length}var E=[],D=[],R=[],F,te;for(F=0;F<12;F++)te=p([2e3,F]),E.push(this.monthsShort(te,"")),D.push(this.months(te,"")),R.push(this.months(te,"")),R.push(this.monthsShort(te,""));for(E.sort(b),D.sort(b),R.sort(b),F=0;F<12;F++)E[F]=le(E[F]),D[F]=le(D[F]);for(F=0;F<24;F++)R[F]=le(R[F]);this._monthsRegex=new RegExp("^("+R.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+D.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+E.join("|")+")","i")}G("Y",0,0,function(){var b=this.year();return b<=9999?N(b,4):"+"+b}),G(0,["YY",2],0,function(){return this.year()%100}),G(0,["YYYY",4],0,"year"),G(0,["YYYYY",5],0,"year"),G(0,["YYYYYY",6,!0],0,"year"),He("year","y"),Ee("year",1),qe("Y",nr),qe("YY",ie,ve),qe("YYYY",ct,rt),qe("YYYYY",yt,Z),qe("YYYYYY",yt,Z),ee(["YYYYY","YYYYYY"],lt),ee("YYYY",function(b,E){E[lt]=b.length===2?i.parseTwoDigitYear(b):De(b)}),ee("YY",function(b,E){E[lt]=i.parseTwoDigitYear(b)}),ee("Y",function(b,E){E[lt]=parseInt(b,10)});function Np(b){return ke(b)?366:365}i.parseTwoDigitYear=function(b){return De(b)+(De(b)>68?1900:2e3)};var jP=xe("FullYear",!0);function Z6(){return ke(this.year())}function J6(b,E,D,R,F,te,Se){var dt;return b<100&&b>=0?(dt=new Date(b+400,E,D,R,F,te,Se),isFinite(dt.getFullYear())&&dt.setFullYear(b)):dt=new Date(b,E,D,R,F,te,Se),dt}function Bp(b){var E,D;return b<100&&b>=0?(D=Array.prototype.slice.call(arguments),D[0]=b+400,E=new Date(Date.UTC.apply(null,D)),isFinite(E.getUTCFullYear())&&E.setUTCFullYear(b)):E=new Date(Date.UTC.apply(null,arguments)),E}function u0(b,E,D){var R=7+E-D,F=(7+Bp(b,0,R).getUTCDay()-E)%7;return-F+R-1}function HP(b,E,D,R,F){var te=(7+D-R)%7,Se=u0(b,R,F),dt=1+7*(E-1)+te+Se,Ut,pr;return dt<=0?(Ut=b-1,pr=Np(Ut)+dt):dt>Np(b)?(Ut=b+1,pr=dt-Np(b)):(Ut=b,pr=dt),{year:Ut,dayOfYear:pr}}function Fp(b,E,D){var R=u0(b.year(),E,D),F=Math.floor((b.dayOfYear()-R-1)/7)+1,te,Se;return F<1?(Se=b.year()-1,te=F+No(Se,E,D)):F>No(b.year(),E,D)?(te=F-No(b.year(),E,D),Se=b.year()+1):(Se=b.year(),te=F),{week:te,year:Se}}function No(b,E,D){var R=u0(b,E,D),F=u0(b+1,E,D);return(Np(b)-R+F)/7}G("w",["ww",2],"wo","week"),G("W",["WW",2],"Wo","isoWeek"),He("week","w"),He("isoWeek","W"),Ee("week",5),Ee("isoWeek",5),qe("w",ie),qe("ww",ie,ve),qe("W",ie),qe("WW",ie,ve),we(["w","ww","W","WW"],function(b,E,D,R){E[R.substr(0,1)]=De(b)});function eG(b){return Fp(b,this._week.dow,this._week.doy).week}var tG={dow:0,doy:6};function rG(){return this._week.dow}function iG(){return this._week.doy}function nG(b){var E=this.localeData().week(this);return b==null?E:this.add((b-E)*7,"d")}function sG(b){var E=Fp(this,1,4).week;return b==null?E:this.add((b-E)*7,"d")}G("d",0,"do","day"),G("dd",0,0,function(b){return this.localeData().weekdaysMin(this,b)}),G("ddd",0,0,function(b){return this.localeData().weekdaysShort(this,b)}),G("dddd",0,0,function(b){return this.localeData().weekdays(this,b)}),G("e",0,0,"weekday"),G("E",0,0,"isoWeekday"),He("day","d"),He("weekday","e"),He("isoWeekday","E"),Ee("day",11),Ee("weekday",11),Ee("isoWeekday",11),qe("d",ie),qe("e",ie),qe("E",ie),qe("dd",function(b,E){return E.weekdaysMinRegex(b)}),qe("ddd",function(b,E){return E.weekdaysShortRegex(b)}),qe("dddd",function(b,E){return E.weekdaysRegex(b)}),we(["dd","ddd","dddd"],function(b,E,D,R){var F=D._locale.weekdaysParse(b,R,D._strict);F!=null?E.d=F:g(D).invalidWeekday=b}),we(["d","e","E"],function(b,E,D,R){E[R]=De(b)});function aG(b,E){return typeof b!="string"?b:isNaN(b)?(b=E.weekdaysParse(b),typeof b=="number"?b:null):parseInt(b,10)}function oG(b,E){return typeof b=="string"?E.weekdaysParse(b)%7||7:isNaN(b)?null:b}function Kb(b,E){return b.slice(E,7).concat(b.slice(0,E))}var lG="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),VP="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),uG="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),cG=Es,hG=Es,dG=Es;function fG(b,E){var D=s(this._weekdays)?this._weekdays:this._weekdays[b&&b!==!0&&this._weekdays.isFormat.test(E)?"format":"standalone"];return b===!0?Kb(D,this._week.dow):b?D[b.day()]:D}function pG(b){return b===!0?Kb(this._weekdaysShort,this._week.dow):b?this._weekdaysShort[b.day()]:this._weekdaysShort}function mG(b){return b===!0?Kb(this._weekdaysMin,this._week.dow):b?this._weekdaysMin[b.day()]:this._weekdaysMin}function gG(b,E,D){var R,F,te,Se=b.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],R=0;R<7;++R)te=p([2e3,1]).day(R),this._minWeekdaysParse[R]=this.weekdaysMin(te,"").toLocaleLowerCase(),this._shortWeekdaysParse[R]=this.weekdaysShort(te,"").toLocaleLowerCase(),this._weekdaysParse[R]=this.weekdays(te,"").toLocaleLowerCase();return D?E==="dddd"?(F=Nt.call(this._weekdaysParse,Se),F!==-1?F:null):E==="ddd"?(F=Nt.call(this._shortWeekdaysParse,Se),F!==-1?F:null):(F=Nt.call(this._minWeekdaysParse,Se),F!==-1?F:null):E==="dddd"?(F=Nt.call(this._weekdaysParse,Se),F!==-1||(F=Nt.call(this._shortWeekdaysParse,Se),F!==-1)?F:(F=Nt.call(this._minWeekdaysParse,Se),F!==-1?F:null)):E==="ddd"?(F=Nt.call(this._shortWeekdaysParse,Se),F!==-1||(F=Nt.call(this._weekdaysParse,Se),F!==-1)?F:(F=Nt.call(this._minWeekdaysParse,Se),F!==-1?F:null)):(F=Nt.call(this._minWeekdaysParse,Se),F!==-1||(F=Nt.call(this._weekdaysParse,Se),F!==-1)?F:(F=Nt.call(this._shortWeekdaysParse,Se),F!==-1?F:null))}function vG(b,E,D){var R,F,te;if(this._weekdaysParseExact)return gG.call(this,b,E,D);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),R=0;R<7;R++){if(F=p([2e3,1]).day(R),D&&!this._fullWeekdaysParse[R]&&(this._fullWeekdaysParse[R]=new RegExp("^"+this.weekdays(F,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[R]=new RegExp("^"+this.weekdaysShort(F,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[R]=new RegExp("^"+this.weekdaysMin(F,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[R]||(te="^"+this.weekdays(F,"")+"|^"+this.weekdaysShort(F,"")+"|^"+this.weekdaysMin(F,""),this._weekdaysParse[R]=new RegExp(te.replace(".",""),"i")),D&&E==="dddd"&&this._fullWeekdaysParse[R].test(b))return R;if(D&&E==="ddd"&&this._shortWeekdaysParse[R].test(b))return R;if(D&&E==="dd"&&this._minWeekdaysParse[R].test(b))return R;if(!D&&this._weekdaysParse[R].test(b))return R}}function yG(b){if(!this.isValid())return b!=null?this:NaN;var E=this._isUTC?this._d.getUTCDay():this._d.getDay();return b!=null?(b=aG(b,this.localeData()),this.add(b-E,"d")):E}function xG(b){if(!this.isValid())return b!=null?this:NaN;var E=(this.day()+7-this.localeData()._week.dow)%7;return b==null?E:this.add(b-E,"d")}function wG(b){if(!this.isValid())return b!=null?this:NaN;if(b!=null){var E=oG(b,this.localeData());return this.day(this.day()%7?E:E-7)}else return this.day()||7}function bG(b){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Zb.call(this),b?this._weekdaysStrictRegex:this._weekdaysRegex):(o(this,"_weekdaysRegex")||(this._weekdaysRegex=cG),this._weekdaysStrictRegex&&b?this._weekdaysStrictRegex:this._weekdaysRegex)}function _G(b){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Zb.call(this),b?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(o(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=hG),this._weekdaysShortStrictRegex&&b?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function SG(b){return this._weekdaysParseExact?(o(this,"_weekdaysRegex")||Zb.call(this),b?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(o(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=dG),this._weekdaysMinStrictRegex&&b?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Zb(){function b(pn,Ho){return Ho.length-pn.length}var E=[],D=[],R=[],F=[],te,Se,dt,Ut,pr;for(te=0;te<7;te++)Se=p([2e3,1]).day(te),dt=le(this.weekdaysMin(Se,"")),Ut=le(this.weekdaysShort(Se,"")),pr=le(this.weekdays(Se,"")),E.push(dt),D.push(Ut),R.push(pr),F.push(dt),F.push(Ut),F.push(pr);E.sort(b),D.sort(b),R.sort(b),F.sort(b),this._weekdaysRegex=new RegExp("^("+F.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+R.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+D.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+E.join("|")+")","i")}function Jb(){return this.hours()%12||12}function MG(){return this.hours()||24}G("H",["HH",2],0,"hour"),G("h",["hh",2],0,Jb),G("k",["kk",2],0,MG),G("hmm",0,0,function(){return""+Jb.apply(this)+N(this.minutes(),2)}),G("hmmss",0,0,function(){return""+Jb.apply(this)+N(this.minutes(),2)+N(this.seconds(),2)}),G("Hmm",0,0,function(){return""+this.hours()+N(this.minutes(),2)}),G("Hmmss",0,0,function(){return""+this.hours()+N(this.minutes(),2)+N(this.seconds(),2)});function WP(b,E){G(b,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),E)})}WP("a",!0),WP("A",!1),He("hour","h"),Ee("hour",13);function GP(b,E){return E._meridiemParse}qe("a",GP),qe("A",GP),qe("H",ie),qe("h",ie),qe("k",ie),qe("HH",ie,ve),qe("hh",ie,ve),qe("kk",ie,ve),qe("hmm",de),qe("hmmss",_e),qe("Hmm",de),qe("Hmmss",_e),ee(["H","HH"],Et),ee(["k","kk"],function(b,E,D){var R=De(b);E[Et]=R===24?0:R}),ee(["a","A"],function(b,E,D){D._isPm=D._locale.isPM(b),D._meridiem=b}),ee(["h","hh"],function(b,E,D){E[Et]=De(b),g(D).bigHour=!0}),ee("hmm",function(b,E,D){var R=b.length-2;E[Et]=De(b.substr(0,R)),E[Tt]=De(b.substr(R)),g(D).bigHour=!0}),ee("hmmss",function(b,E,D){var R=b.length-4,F=b.length-2;E[Et]=De(b.substr(0,R)),E[Tt]=De(b.substr(R,2)),E[It]=De(b.substr(F)),g(D).bigHour=!0}),ee("Hmm",function(b,E,D){var R=b.length-2;E[Et]=De(b.substr(0,R)),E[Tt]=De(b.substr(R))}),ee("Hmmss",function(b,E,D){var R=b.length-4,F=b.length-2;E[Et]=De(b.substr(0,R)),E[Tt]=De(b.substr(R,2)),E[It]=De(b.substr(F))});function EG(b){return(b+"").toLowerCase().charAt(0)==="p"}var AG=/[ap]\.?m?\.?/i,TG=xe("Hours",!0);function CG(b,E,D){return b>11?D?"pm":"PM":D?"am":"AM"}var YP={calendar:O,longDateFormat:ce,invalidDate:be,ordinal:$e,dayOfMonthOrdinalParse:Le,relativeTime:Xe,months:Rp,monthsShort:jh,week:tG,weekdays:lG,weekdaysMin:uG,weekdaysShort:VP,meridiemParse:AG},Rr={},Up={},jp;function DG(b,E){var D,R=Math.min(b.length,E.length);for(D=0;D<R;D+=1)if(b[D]!==E[D])return D;return R}function qP(b){return b&&b.toLowerCase().replace("_","-")}function PG(b){for(var E=0,D,R,F,te;E<b.length;){for(te=qP(b[E]).split("-"),D=te.length,R=qP(b[E+1]),R=R?R.split("-"):null;D>0;){if(F=c0(te.slice(0,D).join("-")),F)return F;if(R&&R.length>=D&&DG(te,R)>=D-1)break;D--}E++}return jp}function OG(b){return b.match("^[^/\\\\]*$")!=null}function c0(b){var E=null,D;if(Rr[b]===void 0&&e&&e.exports&&OG(b))try{E=jp._abbr,D=$6,D("./locale/"+b),Kl(E)}catch{Rr[b]=null}return Rr[b]}function Kl(b,E){var D;return b&&(u(E)?D=Bo(b):D=e_(b,E),D?jp=D:typeof console<"u"&&console.warn&&console.warn("Locale "+b+" not found. Did you forget to load it?")),jp._abbr}function e_(b,E){if(E!==null){var D,R=YP;if(E.abbr=b,Rr[b]!=null)I("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),R=Rr[b]._config;else if(E.parentLocale!=null)if(Rr[E.parentLocale]!=null)R=Rr[E.parentLocale]._config;else if(D=c0(E.parentLocale),D!=null)R=D._config;else return Up[E.parentLocale]||(Up[E.parentLocale]=[]),Up[E.parentLocale].push({name:b,config:E}),null;return Rr[b]=new K(V(R,E)),Up[b]&&Up[b].forEach(function(F){e_(F.name,F.config)}),Kl(b),Rr[b]}else return delete Rr[b],null}function LG(b,E){if(E!=null){var D,R,F=YP;Rr[b]!=null&&Rr[b].parentLocale!=null?Rr[b].set(V(Rr[b]._config,E)):(R=c0(b),R!=null&&(F=R._config),E=V(F,E),R==null&&(E.abbr=b),D=new K(E),D.parentLocale=Rr[b],Rr[b]=D),Kl(b)}else Rr[b]!=null&&(Rr[b].parentLocale!=null?(Rr[b]=Rr[b].parentLocale,b===Kl()&&Kl(b)):Rr[b]!=null&&delete Rr[b]);return Rr[b]}function Bo(b){var E;if(b&&b._locale&&b._locale._abbr&&(b=b._locale._abbr),!b)return jp;if(!s(b)){if(E=c0(b),E)return E;b=[b]}return PG(b)}function IG(){return q(Rr)}function t_(b){var E,D=b._a;return D&&g(b).overflow===-2&&(E=D[it]<0||D[it]>11?it:D[vt]<1||D[vt]>Ht(D[lt],D[it])?vt:D[Et]<0||D[Et]>24||D[Et]===24&&(D[Tt]!==0||D[It]!==0||D[Ir]!==0)?Et:D[Tt]<0||D[Tt]>59?Tt:D[It]<0||D[It]>59?It:D[Ir]<0||D[Ir]>999?Ir:-1,g(b)._overflowDayOfYear&&(E<lt||E>vt)&&(E=vt),g(b)._overflowWeeks&&E===-1&&(E=fn),g(b)._overflowWeekday&&E===-1&&(E=ra),g(b).overflow=E),b}var RG=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,kG=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,zG=/Z|[+-]\d\d(?::?\d\d)?/,h0=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],r_=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],NG=/^\/?Date\((-?\d+)/i,BG=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,FG={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function XP(b){var E,D,R=b._i,F=RG.exec(R)||kG.exec(R),te,Se,dt,Ut,pr=h0.length,pn=r_.length;if(F){for(g(b).iso=!0,E=0,D=pr;E<D;E++)if(h0[E][1].exec(F[1])){Se=h0[E][0],te=h0[E][2]!==!1;break}if(Se==null){b._isValid=!1;return}if(F[3]){for(E=0,D=pn;E<D;E++)if(r_[E][1].exec(F[3])){dt=(F[2]||" ")+r_[E][0];break}if(dt==null){b._isValid=!1;return}}if(!te&&dt!=null){b._isValid=!1;return}if(F[4])if(zG.exec(F[4]))Ut="Z";else{b._isValid=!1;return}b._f=Se+(dt||"")+(Ut||""),n_(b)}else b._isValid=!1}function UG(b,E,D,R,F,te){var Se=[jG(b),jh.indexOf(E),parseInt(D,10),parseInt(R,10),parseInt(F,10)];return te&&Se.push(parseInt(te,10)),Se}function jG(b){var E=parseInt(b,10);return E<=49?2e3+E:E<=999?1900+E:E}function HG(b){return b.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function VG(b,E,D){if(b){var R=VP.indexOf(b),F=new Date(E[0],E[1],E[2]).getDay();if(R!==F)return g(D).weekdayMismatch=!0,D._isValid=!1,!1}return!0}function WG(b,E,D){if(b)return FG[b];if(E)return 0;var R=parseInt(D,10),F=R%100,te=(R-F)/100;return te*60+F}function $P(b){var E=BG.exec(HG(b._i)),D;if(E){if(D=UG(E[4],E[3],E[2],E[5],E[6],E[7]),!VG(E[1],D,b))return;b._a=D,b._tzm=WG(E[8],E[9],E[10]),b._d=Bp.apply(null,b._a),b._d.setUTCMinutes(b._d.getUTCMinutes()-b._tzm),g(b).rfc2822=!0}else b._isValid=!1}function GG(b){var E=NG.exec(b._i);if(E!==null){b._d=new Date(+E[1]);return}if(XP(b),b._isValid===!1)delete b._isValid;else return;if($P(b),b._isValid===!1)delete b._isValid;else return;b._strict?b._isValid=!1:i.createFromInputFallback(b)}i.createFromInputFallback=C("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(b){b._d=new Date(b._i+(b._useUTC?" UTC":""))});function Vh(b,E,D){return b??E??D}function YG(b){var E=new Date(i.now());return b._useUTC?[E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()]:[E.getFullYear(),E.getMonth(),E.getDate()]}function i_(b){var E,D,R=[],F,te,Se;if(!b._d){for(F=YG(b),b._w&&b._a[vt]==null&&b._a[it]==null&&qG(b),b._dayOfYear!=null&&(Se=Vh(b._a[lt],F[lt]),(b._dayOfYear>Np(Se)||b._dayOfYear===0)&&(g(b)._overflowDayOfYear=!0),D=Bp(Se,0,b._dayOfYear),b._a[it]=D.getUTCMonth(),b._a[vt]=D.getUTCDate()),E=0;E<3&&b._a[E]==null;++E)b._a[E]=R[E]=F[E];for(;E<7;E++)b._a[E]=R[E]=b._a[E]==null?E===2?1:0:b._a[E];b._a[Et]===24&&b._a[Tt]===0&&b._a[It]===0&&b._a[Ir]===0&&(b._nextDay=!0,b._a[Et]=0),b._d=(b._useUTC?Bp:J6).apply(null,R),te=b._useUTC?b._d.getUTCDay():b._d.getDay(),b._tzm!=null&&b._d.setUTCMinutes(b._d.getUTCMinutes()-b._tzm),b._nextDay&&(b._a[Et]=24),b._w&&typeof b._w.d<"u"&&b._w.d!==te&&(g(b).weekdayMismatch=!0)}}function qG(b){var E,D,R,F,te,Se,dt,Ut,pr;E=b._w,E.GG!=null||E.W!=null||E.E!=null?(te=1,Se=4,D=Vh(E.GG,b._a[lt],Fp(Ar(),1,4).year),R=Vh(E.W,1),F=Vh(E.E,1),(F<1||F>7)&&(Ut=!0)):(te=b._locale._week.dow,Se=b._locale._week.doy,pr=Fp(Ar(),te,Se),D=Vh(E.gg,b._a[lt],pr.year),R=Vh(E.w,pr.week),E.d!=null?(F=E.d,(F<0||F>6)&&(Ut=!0)):E.e!=null?(F=E.e+te,(E.e<0||E.e>6)&&(Ut=!0)):F=te),R<1||R>No(D,te,Se)?g(b)._overflowWeeks=!0:Ut!=null?g(b)._overflowWeekday=!0:(dt=HP(D,R,F,te,Se),b._a[lt]=dt.year,b._dayOfYear=dt.dayOfYear)}i.ISO_8601=function(){},i.RFC_2822=function(){};function n_(b){if(b._f===i.ISO_8601){XP(b);return}if(b._f===i.RFC_2822){$P(b);return}b._a=[],g(b).empty=!0;var E=""+b._i,D,R,F,te,Se,dt=E.length,Ut=0,pr,pn;for(F=ae(b._f,b._locale).match(B)||[],pn=F.length,D=0;D<pn;D++)te=F[D],R=(E.match(Ql(te,b))||[])[0],R&&(Se=E.substr(0,E.indexOf(R)),Se.length>0&&g(b).unusedInput.push(Se),E=E.slice(E.indexOf(R)+R.length),Ut+=R.length),H[te]?(R?g(b).empty=!1:g(b).unusedTokens.push(te),tt(te,R,b)):b._strict&&!R&&g(b).unusedTokens.push(te);g(b).charsLeftOver=dt-Ut,E.length>0&&g(b).unusedInput.push(E),b._a[Et]<=12&&g(b).bigHour===!0&&b._a[Et]>0&&(g(b).bigHour=void 0),g(b).parsedDateParts=b._a.slice(0),g(b).meridiem=b._meridiem,b._a[Et]=XG(b._locale,b._a[Et],b._meridiem),pr=g(b).era,pr!==null&&(b._a[lt]=b._locale.erasConvertYear(pr,b._a[lt])),i_(b),t_(b)}function XG(b,E,D){var R;return D==null?E:b.meridiemHour!=null?b.meridiemHour(E,D):(b.isPM!=null&&(R=b.isPM(D),R&&E<12&&(E+=12),!R&&E===12&&(E=0)),E)}function $G(b){var E,D,R,F,te,Se,dt=!1,Ut=b._f.length;if(Ut===0){g(b).invalidFormat=!0,b._d=new Date(NaN);return}for(F=0;F<Ut;F++)te=0,Se=!1,E=_({},b),b._useUTC!=null&&(E._useUTC=b._useUTC),E._f=b._f[F],n_(E),y(E)&&(Se=!0),te+=g(E).charsLeftOver,te+=g(E).unusedTokens.length*10,g(E).score=te,dt?te<R&&(R=te,D=E):(R==null||te<R||Se)&&(R=te,D=E,Se&&(dt=!0));f(b,D||E)}function QG(b){if(!b._d){var E=U(b._i),D=E.day===void 0?E.date:E.day;b._a=d([E.year,E.month,D,E.hour,E.minute,E.second,E.millisecond],function(R){return R&&parseInt(R,10)}),i_(b)}}function KG(b){var E=new A(t_(QP(b)));return E._nextDay&&(E.add(1,"d"),E._nextDay=void 0),E}function QP(b){var E=b._i,D=b._f;return b._locale=b._locale||Bo(b._l),E===null||D===void 0&&E===""?x({nullInput:!0}):(typeof E=="string"&&(b._i=E=b._locale.preparse(E)),M(E)?new A(t_(E)):(c(E)?b._d=E:s(D)?$G(b):D?n_(b):ZG(b),y(b)||(b._d=null),b))}function ZG(b){var E=b._i;u(E)?b._d=new Date(i.now()):c(E)?b._d=new Date(E.valueOf()):typeof E=="string"?GG(b):s(E)?(b._a=d(E.slice(0),function(D){return parseInt(D,10)}),i_(b)):a(E)?QG(b):h(E)?b._d=new Date(E):i.createFromInputFallback(b)}function KP(b,E,D,R,F){var te={};return(E===!0||E===!1)&&(R=E,E=void 0),(D===!0||D===!1)&&(R=D,D=void 0),(a(b)&&l(b)||s(b)&&b.length===0)&&(b=void 0),te._isAMomentObject=!0,te._useUTC=te._isUTC=F,te._l=D,te._i=b,te._f=E,te._strict=R,KG(te)}function Ar(b,E,D,R){return KP(b,E,D,R,!1)}var JG=C("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var b=Ar.apply(null,arguments);return this.isValid()&&b.isValid()?b<this?this:b:x()}),eY=C("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var b=Ar.apply(null,arguments);return this.isValid()&&b.isValid()?b>this?this:b:x()});function ZP(b,E){var D,R;if(E.length===1&&s(E[0])&&(E=E[0]),!E.length)return Ar();for(D=E[0],R=1;R<E.length;++R)(!E[R].isValid()||E[R][b](D))&&(D=E[R]);return D}function tY(){var b=[].slice.call(arguments,0);return ZP("isBefore",b)}function rY(){var b=[].slice.call(arguments,0);return ZP("isAfter",b)}var iY=function(){return Date.now?Date.now():+new Date},Hp=["year","quarter","month","week","day","hour","minute","second","millisecond"];function nY(b){var E,D=!1,R,F=Hp.length;for(E in b)if(o(b,E)&&!(Nt.call(Hp,E)!==-1&&(b[E]==null||!isNaN(b[E]))))return!1;for(R=0;R<F;++R)if(b[Hp[R]]){if(D)return!1;parseFloat(b[Hp[R]])!==De(b[Hp[R]])&&(D=!0)}return!0}function sY(){return this._isValid}function aY(){return ia(NaN)}function d0(b){var E=U(b),D=E.year||0,R=E.quarter||0,F=E.month||0,te=E.week||E.isoWeek||0,Se=E.day||0,dt=E.hour||0,Ut=E.minute||0,pr=E.second||0,pn=E.millisecond||0;this._isValid=nY(E),this._milliseconds=+pn+pr*1e3+Ut*6e4+dt*1e3*60*60,this._days=+Se+te*7,this._months=+F+R*3+D*12,this._data={},this._locale=Bo(),this._bubble()}function f0(b){return b instanceof d0}function s_(b){return b<0?Math.round(-1*b)*-1:Math.round(b)}function oY(b,E,D){var R=Math.min(b.length,E.length),F=Math.abs(b.length-E.length),te=0,Se;for(Se=0;Se<R;Se++)(D&&b[Se]!==E[Se]||!D&&De(b[Se])!==De(E[Se]))&&te++;return te+F}function JP(b,E){G(b,0,0,function(){var D=this.utcOffset(),R="+";return D<0&&(D=-D,R="-"),R+N(~~(D/60),2)+E+N(~~D%60,2)})}JP("Z",":"),JP("ZZ",""),qe("Z",Vr),qe("ZZ",Vr),ee(["Z","ZZ"],function(b,E,D){D._useUTC=!0,D._tzm=a_(Vr,b)});var lY=/([\+\-]|\d\d)/gi;function a_(b,E){var D=(E||"").match(b),R,F,te;return D===null?null:(R=D[D.length-1]||[],F=(R+"").match(lY)||["-",0,0],te=+(F[1]*60)+De(F[2]),te===0?0:F[0]==="+"?te:-te)}function o_(b,E){var D,R;return E._isUTC?(D=E.clone(),R=(M(b)||c(b)?b.valueOf():Ar(b).valueOf())-D.valueOf(),D._d.setTime(D._d.valueOf()+R),i.updateOffset(D,!1),D):Ar(b).local()}function l_(b){return-Math.round(b._d.getTimezoneOffset())}i.updateOffset=function(){};function uY(b,E,D){var R=this._offset||0,F;if(!this.isValid())return b!=null?this:NaN;if(b!=null){if(typeof b=="string"){if(b=a_(Vr,b),b===null)return this}else Math.abs(b)<16&&!D&&(b=b*60);return!this._isUTC&&E&&(F=l_(this)),this._offset=b,this._isUTC=!0,F!=null&&this.add(F,"m"),R!==b&&(!E||this._changeInProgress?iO(this,ia(b-R,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,i.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?R:l_(this)}function cY(b,E){return b!=null?(typeof b!="string"&&(b=-b),this.utcOffset(b,E),this):-this.utcOffset()}function hY(b){return this.utcOffset(0,b)}function dY(b){return this._isUTC&&(this.utcOffset(0,b),this._isUTC=!1,b&&this.subtract(l_(this),"m")),this}function fY(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var b=a_(Qt,this._i);b!=null?this.utcOffset(b):this.utcOffset(0,!0)}return this}function pY(b){return this.isValid()?(b=b?Ar(b).utcOffset():0,(this.utcOffset()-b)%60===0):!1}function mY(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function gY(){if(!u(this._isDSTShifted))return this._isDSTShifted;var b={},E;return _(b,this),b=QP(b),b._a?(E=b._isUTC?p(b._a):Ar(b._a),this._isDSTShifted=this.isValid()&&oY(b._a,E.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function vY(){return this.isValid()?!this._isUTC:!1}function yY(){return this.isValid()?this._isUTC:!1}function eO(){return this.isValid()?this._isUTC&&this._offset===0:!1}var xY=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,wY=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function ia(b,E){var D=b,R=null,F,te,Se;return f0(b)?D={ms:b._milliseconds,d:b._days,M:b._months}:h(b)||!isNaN(+b)?(D={},E?D[E]=+b:D.milliseconds=+b):(R=xY.exec(b))?(F=R[1]==="-"?-1:1,D={y:0,d:De(R[vt])*F,h:De(R[Et])*F,m:De(R[Tt])*F,s:De(R[It])*F,ms:De(s_(R[Ir]*1e3))*F}):(R=wY.exec(b))?(F=R[1]==="-"?-1:1,D={y:yc(R[2],F),M:yc(R[3],F),w:yc(R[4],F),d:yc(R[5],F),h:yc(R[6],F),m:yc(R[7],F),s:yc(R[8],F)}):D==null?D={}:typeof D=="object"&&("from"in D||"to"in D)&&(Se=bY(Ar(D.from),Ar(D.to)),D={},D.ms=Se.milliseconds,D.M=Se.months),te=new d0(D),f0(b)&&o(b,"_locale")&&(te._locale=b._locale),f0(b)&&o(b,"_isValid")&&(te._isValid=b._isValid),te}ia.fn=d0.prototype,ia.invalid=aY;function yc(b,E){var D=b&&parseFloat(b.replace(",","."));return(isNaN(D)?0:D)*E}function tO(b,E){var D={};return D.months=E.month()-b.month()+(E.year()-b.year())*12,b.clone().add(D.months,"M").isAfter(E)&&--D.months,D.milliseconds=+E-+b.clone().add(D.months,"M"),D}function bY(b,E){var D;return b.isValid()&&E.isValid()?(E=o_(E,b),b.isBefore(E)?D=tO(b,E):(D=tO(E,b),D.milliseconds=-D.milliseconds,D.months=-D.months),D):{milliseconds:0,months:0}}function rO(b,E){return function(D,R){var F,te;return R!==null&&!isNaN(+R)&&(I(E,"moment()."+E+"(period, number) is deprecated. Please use moment()."+E+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),te=D,D=R,R=te),F=ia(D,R),iO(this,F,b),this}}function iO(b,E,D,R){var F=E._milliseconds,te=s_(E._days),Se=s_(E._months);b.isValid()&&(R=R??!0,Se&&Qi(b,et(b,"Month")+Se*D),te&&ot(b,"Date",et(b,"Date")+te*D),F&&b._d.setTime(b._d.valueOf()+F*D),R&&i.updateOffset(b,te||Se))}var _Y=rO(1,"add"),SY=rO(-1,"subtract");function nO(b){return typeof b=="string"||b instanceof String}function MY(b){return M(b)||c(b)||nO(b)||h(b)||AY(b)||EY(b)||b===null||b===void 0}function EY(b){var E=a(b)&&!l(b),D=!1,R=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],F,te,Se=R.length;for(F=0;F<Se;F+=1)te=R[F],D=D||o(b,te);return E&&D}function AY(b){var E=s(b),D=!1;return E&&(D=b.filter(function(R){return!h(R)&&nO(b)}).length===0),E&&D}function TY(b){var E=a(b)&&!l(b),D=!1,R=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],F,te;for(F=0;F<R.length;F+=1)te=R[F],D=D||o(b,te);return E&&D}function CY(b,E){var D=b.diff(E,"days",!0);return D<-6?"sameElse":D<-1?"lastWeek":D<0?"lastDay":D<1?"sameDay":D<2?"nextDay":D<7?"nextWeek":"sameElse"}function DY(b,E){arguments.length===1&&(arguments[0]?MY(arguments[0])?(b=arguments[0],E=void 0):TY(arguments[0])&&(E=arguments[0],b=void 0):(b=void 0,E=void 0));var D=b||Ar(),R=o_(D,this).startOf("day"),F=i.calendarFormat(this,R)||"sameElse",te=E&&(k(E[F])?E[F].call(this,D):E[F]);return this.format(te||this.localeData().calendar(F,this,Ar(D)))}function PY(){return new A(this)}function OY(b,E){var D=M(b)?b:Ar(b);return this.isValid()&&D.isValid()?(E=Y(E)||"millisecond",E==="millisecond"?this.valueOf()>D.valueOf():D.valueOf()<this.clone().startOf(E).valueOf()):!1}function LY(b,E){var D=M(b)?b:Ar(b);return this.isValid()&&D.isValid()?(E=Y(E)||"millisecond",E==="millisecond"?this.valueOf()<D.valueOf():this.clone().endOf(E).valueOf()<D.valueOf()):!1}function IY(b,E,D,R){var F=M(b)?b:Ar(b),te=M(E)?E:Ar(E);return this.isValid()&&F.isValid()&&te.isValid()?(R=R||"()",(R[0]==="("?this.isAfter(F,D):!this.isBefore(F,D))&&(R[1]===")"?this.isBefore(te,D):!this.isAfter(te,D))):!1}function RY(b,E){var D=M(b)?b:Ar(b),R;return this.isValid()&&D.isValid()?(E=Y(E)||"millisecond",E==="millisecond"?this.valueOf()===D.valueOf():(R=D.valueOf(),this.clone().startOf(E).valueOf()<=R&&R<=this.clone().endOf(E).valueOf())):!1}function kY(b,E){return this.isSame(b,E)||this.isAfter(b,E)}function zY(b,E){return this.isSame(b,E)||this.isBefore(b,E)}function NY(b,E,D){var R,F,te;if(!this.isValid())return NaN;if(R=o_(b,this),!R.isValid())return NaN;switch(F=(R.utcOffset()-this.utcOffset())*6e4,E=Y(E),E){case"year":te=p0(this,R)/12;break;case"month":te=p0(this,R);break;case"quarter":te=p0(this,R)/3;break;case"second":te=(this-R)/1e3;break;case"minute":te=(this-R)/6e4;break;case"hour":te=(this-R)/36e5;break;case"day":te=(this-R-F)/864e5;break;case"week":te=(this-R-F)/6048e5;break;default:te=this-R}return D?te:Ye(te)}function p0(b,E){if(b.date()<E.date())return-p0(E,b);var D=(E.year()-b.year())*12+(E.month()-b.month()),R=b.clone().add(D,"months"),F,te;return E-R<0?(F=b.clone().add(D-1,"months"),te=(E-R)/(R-F)):(F=b.clone().add(D+1,"months"),te=(E-R)/(F-R)),-(D+te)||0}i.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",i.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function BY(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function FY(b){if(!this.isValid())return null;var E=b!==!0,D=E?this.clone().utc():this;return D.year()<0||D.year()>9999?re(D,E?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):k(Date.prototype.toISOString)?E?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",re(D,"Z")):re(D,E?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function UY(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var b="moment",E="",D,R,F,te;return this.isLocal()||(b=this.utcOffset()===0?"moment.utc":"moment.parseZone",E="Z"),D="["+b+'("]',R=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",F="-MM-DD[T]HH:mm:ss.SSS",te=E+'[")]',this.format(D+R+F+te)}function jY(b){b||(b=this.isUtc()?i.defaultFormatUtc:i.defaultFormat);var E=re(this,b);return this.localeData().postformat(E)}function HY(b,E){return this.isValid()&&(M(b)&&b.isValid()||Ar(b).isValid())?ia({to:this,from:b}).locale(this.locale()).humanize(!E):this.localeData().invalidDate()}function VY(b){return this.from(Ar(),b)}function WY(b,E){return this.isValid()&&(M(b)&&b.isValid()||Ar(b).isValid())?ia({from:this,to:b}).locale(this.locale()).humanize(!E):this.localeData().invalidDate()}function GY(b){return this.to(Ar(),b)}function sO(b){var E;return b===void 0?this._locale._abbr:(E=Bo(b),E!=null&&(this._locale=E),this)}var aO=C("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(b){return b===void 0?this.localeData():this.locale(b)});function oO(){return this._locale}var m0=1e3,Wh=60*m0,g0=60*Wh,lO=(365*400+97)*24*g0;function Gh(b,E){return(b%E+E)%E}function uO(b,E,D){return b<100&&b>=0?new Date(b+400,E,D)-lO:new Date(b,E,D).valueOf()}function cO(b,E,D){return b<100&&b>=0?Date.UTC(b+400,E,D)-lO:Date.UTC(b,E,D)}function YY(b){var E,D;if(b=Y(b),b===void 0||b==="millisecond"||!this.isValid())return this;switch(D=this._isUTC?cO:uO,b){case"year":E=D(this.year(),0,1);break;case"quarter":E=D(this.year(),this.month()-this.month()%3,1);break;case"month":E=D(this.year(),this.month(),1);break;case"week":E=D(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":E=D(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":E=D(this.year(),this.month(),this.date());break;case"hour":E=this._d.valueOf(),E-=Gh(E+(this._isUTC?0:this.utcOffset()*Wh),g0);break;case"minute":E=this._d.valueOf(),E-=Gh(E,Wh);break;case"second":E=this._d.valueOf(),E-=Gh(E,m0);break}return this._d.setTime(E),i.updateOffset(this,!0),this}function qY(b){var E,D;if(b=Y(b),b===void 0||b==="millisecond"||!this.isValid())return this;switch(D=this._isUTC?cO:uO,b){case"year":E=D(this.year()+1,0,1)-1;break;case"quarter":E=D(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":E=D(this.year(),this.month()+1,1)-1;break;case"week":E=D(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":E=D(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":E=D(this.year(),this.month(),this.date()+1)-1;break;case"hour":E=this._d.valueOf(),E+=g0-Gh(E+(this._isUTC?0:this.utcOffset()*Wh),g0)-1;break;case"minute":E=this._d.valueOf(),E+=Wh-Gh(E,Wh)-1;break;case"second":E=this._d.valueOf(),E+=m0-Gh(E,m0)-1;break}return this._d.setTime(E),i.updateOffset(this,!0),this}function XY(){return this._d.valueOf()-(this._offset||0)*6e4}function $Y(){return Math.floor(this.valueOf()/1e3)}function QY(){return new Date(this.valueOf())}function KY(){var b=this;return[b.year(),b.month(),b.date(),b.hour(),b.minute(),b.second(),b.millisecond()]}function ZY(){var b=this;return{years:b.year(),months:b.month(),date:b.date(),hours:b.hours(),minutes:b.minutes(),seconds:b.seconds(),milliseconds:b.milliseconds()}}function JY(){return this.isValid()?this.toISOString():null}function e8(){return y(this)}function t8(){return f({},g(this))}function r8(){return g(this).overflow}function i8(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}G("N",0,0,"eraAbbr"),G("NN",0,0,"eraAbbr"),G("NNN",0,0,"eraAbbr"),G("NNNN",0,0,"eraName"),G("NNNNN",0,0,"eraNarrow"),G("y",["y",1],"yo","eraYear"),G("y",["yy",2],0,"eraYear"),G("y",["yyy",3],0,"eraYear"),G("y",["yyyy",4],0,"eraYear"),qe("N",u_),qe("NN",u_),qe("NNN",u_),qe("NNNN",p8),qe("NNNNN",m8),ee(["N","NN","NNN","NNNN","NNNNN"],function(b,E,D,R){var F=D._locale.erasParse(b,R,D._strict);F?g(D).era=F:g(D).invalidEra=b}),qe("y",Dt),qe("yy",Dt),qe("yyy",Dt),qe("yyyy",Dt),qe("yo",g8),ee(["y","yy","yyy","yyyy"],lt),ee(["yo"],function(b,E,D,R){var F;D._locale._eraYearOrdinalRegex&&(F=b.match(D._locale._eraYearOrdinalRegex)),D._locale.eraYearOrdinalParse?E[lt]=D._locale.eraYearOrdinalParse(b,F):E[lt]=parseInt(b,10)});function n8(b,E){var D,R,F,te=this._eras||Bo("en")._eras;for(D=0,R=te.length;D<R;++D){switch(typeof te[D].since){case"string":F=i(te[D].since).startOf("day"),te[D].since=F.valueOf();break}switch(typeof te[D].until){case"undefined":te[D].until=1/0;break;case"string":F=i(te[D].until).startOf("day").valueOf(),te[D].until=F.valueOf();break}}return te}function s8(b,E,D){var R,F,te=this.eras(),Se,dt,Ut;for(b=b.toUpperCase(),R=0,F=te.length;R<F;++R)if(Se=te[R].name.toUpperCase(),dt=te[R].abbr.toUpperCase(),Ut=te[R].narrow.toUpperCase(),D)switch(E){case"N":case"NN":case"NNN":if(dt===b)return te[R];break;case"NNNN":if(Se===b)return te[R];break;case"NNNNN":if(Ut===b)return te[R];break}else if([Se,dt,Ut].indexOf(b)>=0)return te[R]}function a8(b,E){var D=b.since<=b.until?1:-1;return E===void 0?i(b.since).year():i(b.since).year()+(E-b.offset)*D}function o8(){var b,E,D,R=this.localeData().eras();for(b=0,E=R.length;b<E;++b)if(D=this.clone().startOf("day").valueOf(),R[b].since<=D&&D<=R[b].until||R[b].until<=D&&D<=R[b].since)return R[b].name;return""}function l8(){var b,E,D,R=this.localeData().eras();for(b=0,E=R.length;b<E;++b)if(D=this.clone().startOf("day").valueOf(),R[b].since<=D&&D<=R[b].until||R[b].until<=D&&D<=R[b].since)return R[b].narrow;return""}function u8(){var b,E,D,R=this.localeData().eras();for(b=0,E=R.length;b<E;++b)if(D=this.clone().startOf("day").valueOf(),R[b].since<=D&&D<=R[b].until||R[b].until<=D&&D<=R[b].since)return R[b].abbr;return""}function c8(){var b,E,D,R,F=this.localeData().eras();for(b=0,E=F.length;b<E;++b)if(D=F[b].since<=F[b].until?1:-1,R=this.clone().startOf("day").valueOf(),F[b].since<=R&&R<=F[b].until||F[b].until<=R&&R<=F[b].since)return(this.year()-i(F[b].since).year())*D+F[b].offset;return this.year()}function h8(b){return o(this,"_erasNameRegex")||c_.call(this),b?this._erasNameRegex:this._erasRegex}function d8(b){return o(this,"_erasAbbrRegex")||c_.call(this),b?this._erasAbbrRegex:this._erasRegex}function f8(b){return o(this,"_erasNarrowRegex")||c_.call(this),b?this._erasNarrowRegex:this._erasRegex}function u_(b,E){return E.erasAbbrRegex(b)}function p8(b,E){return E.erasNameRegex(b)}function m8(b,E){return E.erasNarrowRegex(b)}function g8(b,E){return E._eraYearOrdinalRegex||Dt}function c_(){var b=[],E=[],D=[],R=[],F,te,Se=this.eras();for(F=0,te=Se.length;F<te;++F)E.push(le(Se[F].name)),b.push(le(Se[F].abbr)),D.push(le(Se[F].narrow)),R.push(le(Se[F].name)),R.push(le(Se[F].abbr)),R.push(le(Se[F].narrow));this._erasRegex=new RegExp("^("+R.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+E.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+b.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+D.join("|")+")","i")}G(0,["gg",2],0,function(){return this.weekYear()%100}),G(0,["GG",2],0,function(){return this.isoWeekYear()%100});function v0(b,E){G(0,[b,b.length],0,E)}v0("gggg","weekYear"),v0("ggggg","weekYear"),v0("GGGG","isoWeekYear"),v0("GGGGG","isoWeekYear"),He("weekYear","gg"),He("isoWeekYear","GG"),Ee("weekYear",1),Ee("isoWeekYear",1),qe("G",nr),qe("g",nr),qe("GG",ie,ve),qe("gg",ie,ve),qe("GGGG",ct,rt),qe("gggg",ct,rt),qe("GGGGG",yt,Z),qe("ggggg",yt,Z),we(["gggg","ggggg","GGGG","GGGGG"],function(b,E,D,R){E[R.substr(0,2)]=De(b)}),we(["gg","GG"],function(b,E,D,R){E[R]=i.parseTwoDigitYear(b)});function v8(b){return hO.call(this,b,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function y8(b){return hO.call(this,b,this.isoWeek(),this.isoWeekday(),1,4)}function x8(){return No(this.year(),1,4)}function w8(){return No(this.isoWeekYear(),1,4)}function b8(){var b=this.localeData()._week;return No(this.year(),b.dow,b.doy)}function _8(){var b=this.localeData()._week;return No(this.weekYear(),b.dow,b.doy)}function hO(b,E,D,R,F){var te;return b==null?Fp(this,R,F).year:(te=No(b,R,F),E>te&&(E=te),S8.call(this,b,E,D,R,F))}function S8(b,E,D,R,F){var te=HP(b,E,D,R,F),Se=Bp(te.year,0,te.dayOfYear);return this.year(Se.getUTCFullYear()),this.month(Se.getUTCMonth()),this.date(Se.getUTCDate()),this}G("Q",0,"Qo","quarter"),He("quarter","Q"),Ee("quarter",7),qe("Q",oe),ee("Q",function(b,E){E[it]=(De(b)-1)*3});function M8(b){return b==null?Math.ceil((this.month()+1)/3):this.month((b-1)*3+this.month()%3)}G("D",["DD",2],"Do","date"),He("date","D"),Ee("date",9),qe("D",ie),qe("DD",ie,ve),qe("Do",function(b,E){return b?E._dayOfMonthOrdinalParse||E._ordinalParse:E._dayOfMonthOrdinalParseLenient}),ee(["D","DD"],vt),ee("Do",function(b,E){E[vt]=De(b.match(ie)[0])});var dO=xe("Date",!0);G("DDD",["DDDD",3],"DDDo","dayOfYear"),He("dayOfYear","DDD"),Ee("dayOfYear",4),qe("DDD",Ve),qe("DDDD",ze),ee(["DDD","DDDD"],function(b,E,D){D._dayOfYear=De(b)});function E8(b){var E=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return b==null?E:this.add(b-E,"d")}G("m",["mm",2],0,"minute"),He("minute","m"),Ee("minute",14),qe("m",ie),qe("mm",ie,ve),ee(["m","mm"],Tt);var A8=xe("Minutes",!1);G("s",["ss",2],0,"second"),He("second","s"),Ee("second",15),qe("s",ie),qe("ss",ie,ve),ee(["s","ss"],It);var T8=xe("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)}),G(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),G(0,["SSS",3],0,"millisecond"),G(0,["SSSS",4],0,function(){return this.millisecond()*10}),G(0,["SSSSS",5],0,function(){return this.millisecond()*100}),G(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),G(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),G(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),G(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),He("millisecond","ms"),Ee("millisecond",16),qe("S",Ve,oe),qe("SS",Ve,ve),qe("SSS",Ve,ze);var Zl,fO;for(Zl="SSSS";Zl.length<=9;Zl+="S")qe(Zl,Dt);function C8(b,E){E[Ir]=De(("0."+b)*1e3)}for(Zl="S";Zl.length<=9;Zl+="S")ee(Zl,C8);fO=xe("Milliseconds",!1),G("z",0,0,"zoneAbbr"),G("zz",0,0,"zoneName");function D8(){return this._isUTC?"UTC":""}function P8(){return this._isUTC?"Coordinated Universal Time":""}var Be=A.prototype;Be.add=_Y,Be.calendar=DY,Be.clone=PY,Be.diff=NY,Be.endOf=qY,Be.format=jY,Be.from=HY,Be.fromNow=VY,Be.to=WY,Be.toNow=GY,Be.get=ut,Be.invalidAt=r8,Be.isAfter=OY,Be.isBefore=LY,Be.isBetween=IY,Be.isSame=RY,Be.isSameOrAfter=kY,Be.isSameOrBefore=zY,Be.isValid=e8,Be.lang=aO,Be.locale=sO,Be.localeData=oO,Be.max=eY,Be.min=JG,Be.parsingFlags=t8,Be.set=ne,Be.startOf=YY,Be.subtract=SY,Be.toArray=KY,Be.toObject=ZY,Be.toDate=QY,Be.toISOString=FY,Be.inspect=UY,typeof Symbol<"u"&&Symbol.for!=null&&(Be[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),Be.toJSON=JY,Be.toString=BY,Be.unix=$Y,Be.valueOf=XY,Be.creationData=i8,Be.eraName=o8,Be.eraNarrow=l8,Be.eraAbbr=u8,Be.eraYear=c8,Be.year=jP,Be.isLeapYear=Z6,Be.weekYear=v8,Be.isoWeekYear=y8,Be.quarter=Be.quarters=M8,Be.month=Hh,Be.daysInMonth=Qb,Be.week=Be.weeks=nG,Be.isoWeek=Be.isoWeeks=sG,Be.weeksInYear=b8,Be.weeksInWeekYear=_8,Be.isoWeeksInYear=x8,Be.isoWeeksInISOWeekYear=w8,Be.date=dO,Be.day=Be.days=yG,Be.weekday=xG,Be.isoWeekday=wG,Be.dayOfYear=E8,Be.hour=Be.hours=TG,Be.minute=Be.minutes=A8,Be.second=Be.seconds=T8,Be.millisecond=Be.milliseconds=fO,Be.utcOffset=uY,Be.utc=hY,Be.local=dY,Be.parseZone=fY,Be.hasAlignedHourOffset=pY,Be.isDST=mY,Be.isLocal=vY,Be.isUtcOffset=yY,Be.isUtc=eO,Be.isUTC=eO,Be.zoneAbbr=D8,Be.zoneName=P8,Be.dates=C("dates accessor is deprecated. Use date instead.",dO),Be.months=C("months accessor is deprecated. Use month instead",Hh),Be.years=C("years accessor is deprecated. Use year instead",jP),Be.zone=C("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",cY),Be.isDSTShifted=C("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",gY);function O8(b){return Ar(b*1e3)}function L8(){return Ar.apply(null,arguments).parseZone()}function pO(b){return b}var er=K.prototype;er.calendar=W,er.longDateFormat=me,er.invalidDate=Ae,er.ordinal=Qe,er.preparse=pO,er.postformat=pO,er.relativeTime=Re,er.pastFuture=Ie,er.set=z,er.eras=n8,er.erasParse=s8,er.erasConvertYear=a8,er.erasAbbrRegex=d8,er.erasNameRegex=h8,er.erasNarrowRegex=f8,er.months=kp,er.monthsShort=mi,er.monthsParse=zp,er.monthsRegex=K6,er.monthsShortRegex=l0,er.week=eG,er.firstDayOfYear=iG,er.firstDayOfWeek=rG,er.weekdays=fG,er.weekdaysMin=mG,er.weekdaysShort=pG,er.weekdaysParse=vG,er.weekdaysRegex=bG,er.weekdaysShortRegex=_G,er.weekdaysMinRegex=SG,er.isPM=EG,er.meridiem=CG;function y0(b,E,D,R){var F=Bo(),te=p().set(R,E);return F[D](te,b)}function mO(b,E,D){if(h(b)&&(E=b,b=void 0),b=b||"",E!=null)return y0(b,E,D,"month");var R,F=[];for(R=0;R<12;R++)F[R]=y0(b,R,D,"month");return F}function h_(b,E,D,R){typeof b=="boolean"?(h(E)&&(D=E,E=void 0),E=E||""):(E=b,D=E,b=!1,h(E)&&(D=E,E=void 0),E=E||"");var F=Bo(),te=b?F._week.dow:0,Se,dt=[];if(D!=null)return y0(E,(D+te)%7,R,"day");for(Se=0;Se<7;Se++)dt[Se]=y0(E,(Se+te)%7,R,"day");return dt}function I8(b,E){return mO(b,E,"months")}function R8(b,E){return mO(b,E,"monthsShort")}function k8(b,E,D){return h_(b,E,D,"weekdays")}function z8(b,E,D){return h_(b,E,D,"weekdaysShort")}function N8(b,E,D){return h_(b,E,D,"weekdaysMin")}Kl("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(b){var E=b%10,D=De(b%100/10)===1?"th":E===1?"st":E===2?"nd":E===3?"rd":"th";return b+D}}),i.lang=C("moment.lang is deprecated. Use moment.locale instead.",Kl),i.langData=C("moment.langData is deprecated. Use moment.localeData instead.",Bo);var Fo=Math.abs;function B8(){var b=this._data;return this._milliseconds=Fo(this._milliseconds),this._days=Fo(this._days),this._months=Fo(this._months),b.milliseconds=Fo(b.milliseconds),b.seconds=Fo(b.seconds),b.minutes=Fo(b.minutes),b.hours=Fo(b.hours),b.months=Fo(b.months),b.years=Fo(b.years),this}function gO(b,E,D,R){var F=ia(E,D);return b._milliseconds+=R*F._milliseconds,b._days+=R*F._days,b._months+=R*F._months,b._bubble()}function F8(b,E){return gO(this,b,E,1)}function U8(b,E){return gO(this,b,E,-1)}function vO(b){return b<0?Math.floor(b):Math.ceil(b)}function j8(){var b=this._milliseconds,E=this._days,D=this._months,R=this._data,F,te,Se,dt,Ut;return b>=0&&E>=0&&D>=0||b<=0&&E<=0&&D<=0||(b+=vO(d_(D)+E)*864e5,E=0,D=0),R.milliseconds=b%1e3,F=Ye(b/1e3),R.seconds=F%60,te=Ye(F/60),R.minutes=te%60,Se=Ye(te/60),R.hours=Se%24,E+=Ye(Se/24),Ut=Ye(yO(E)),D+=Ut,E-=vO(d_(Ut)),dt=Ye(D/12),D%=12,R.days=E,R.months=D,R.years=dt,this}function yO(b){return b*4800/146097}function d_(b){return b*146097/4800}function H8(b){if(!this.isValid())return NaN;var E,D,R=this._milliseconds;if(b=Y(b),b==="month"||b==="quarter"||b==="year")switch(E=this._days+R/864e5,D=this._months+yO(E),b){case"month":return D;case"quarter":return D/3;case"year":return D/12}else switch(E=this._days+Math.round(d_(this._months)),b){case"week":return E/7+R/6048e5;case"day":return E+R/864e5;case"hour":return E*24+R/36e5;case"minute":return E*1440+R/6e4;case"second":return E*86400+R/1e3;case"millisecond":return Math.floor(E*864e5)+R;default:throw new Error("Unknown unit "+b)}}function V8(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+De(this._months/12)*31536e6:NaN}function Uo(b){return function(){return this.as(b)}}var W8=Uo("ms"),G8=Uo("s"),Y8=Uo("m"),q8=Uo("h"),X8=Uo("d"),$8=Uo("w"),Q8=Uo("M"),K8=Uo("Q"),Z8=Uo("y");function J8(){return ia(this)}function e9(b){return b=Y(b),this.isValid()?this[b+"s"]():NaN}function xc(b){return function(){return this.isValid()?this._data[b]:NaN}}var t9=xc("milliseconds"),r9=xc("seconds"),i9=xc("minutes"),n9=xc("hours"),s9=xc("days"),a9=xc("months"),o9=xc("years");function l9(){return Ye(this.days()/7)}var jo=Math.round,Yh={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function u9(b,E,D,R,F){return F.relativeTime(E||1,!!D,b,R)}function c9(b,E,D,R){var F=ia(b).abs(),te=jo(F.as("s")),Se=jo(F.as("m")),dt=jo(F.as("h")),Ut=jo(F.as("d")),pr=jo(F.as("M")),pn=jo(F.as("w")),Ho=jo(F.as("y")),Jl=te<=D.ss&&["s",te]||te<D.s&&["ss",te]||Se<=1&&["m"]||Se<D.m&&["mm",Se]||dt<=1&&["h"]||dt<D.h&&["hh",dt]||Ut<=1&&["d"]||Ut<D.d&&["dd",Ut];return D.w!=null&&(Jl=Jl||pn<=1&&["w"]||pn<D.w&&["ww",pn]),Jl=Jl||pr<=1&&["M"]||pr<D.M&&["MM",pr]||Ho<=1&&["y"]||["yy",Ho],Jl[2]=E,Jl[3]=+b>0,Jl[4]=R,u9.apply(null,Jl)}function h9(b){return b===void 0?jo:typeof b=="function"?(jo=b,!0):!1}function d9(b,E){return Yh[b]===void 0?!1:E===void 0?Yh[b]:(Yh[b]=E,b==="s"&&(Yh.ss=E-1),!0)}function f9(b,E){if(!this.isValid())return this.localeData().invalidDate();var D=!1,R=Yh,F,te;return typeof b=="object"&&(E=b,b=!1),typeof b=="boolean"&&(D=b),typeof E=="object"&&(R=Object.assign({},Yh,E),E.s!=null&&E.ss==null&&(R.ss=E.s-1)),F=this.localeData(),te=c9(this,!D,R,F),D&&(te=F.pastFuture(+this,te)),F.postformat(te)}var f_=Math.abs;function qh(b){return(b>0)-(b<0)||+b}function x0(){if(!this.isValid())return this.localeData().invalidDate();var b=f_(this._milliseconds)/1e3,E=f_(this._days),D=f_(this._months),R,F,te,Se,dt=this.asSeconds(),Ut,pr,pn,Ho;return dt?(R=Ye(b/60),F=Ye(R/60),b%=60,R%=60,te=Ye(D/12),D%=12,Se=b?b.toFixed(3).replace(/\.?0+$/,""):"",Ut=dt<0?"-":"",pr=qh(this._months)!==qh(dt)?"-":"",pn=qh(this._days)!==qh(dt)?"-":"",Ho=qh(this._milliseconds)!==qh(dt)?"-":"",Ut+"P"+(te?pr+te+"Y":"")+(D?pr+D+"M":"")+(E?pn+E+"D":"")+(F||R||b?"T":"")+(F?Ho+F+"H":"")+(R?Ho+R+"M":"")+(b?Ho+Se+"S":"")):"P0D"}var Kt=d0.prototype;Kt.isValid=sY,Kt.abs=B8,Kt.add=F8,Kt.subtract=U8,Kt.as=H8,Kt.asMilliseconds=W8,Kt.asSeconds=G8,Kt.asMinutes=Y8,Kt.asHours=q8,Kt.asDays=X8,Kt.asWeeks=$8,Kt.asMonths=Q8,Kt.asQuarters=K8,Kt.asYears=Z8,Kt.valueOf=V8,Kt._bubble=j8,Kt.clone=J8,Kt.get=e9,Kt.milliseconds=t9,Kt.seconds=r9,Kt.minutes=i9,Kt.hours=n9,Kt.days=s9,Kt.weeks=l9,Kt.months=a9,Kt.years=o9,Kt.humanize=f9,Kt.toISOString=x0,Kt.toString=x0,Kt.toJSON=x0,Kt.locale=sO,Kt.localeData=oO,Kt.toIsoString=C("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",x0),Kt.lang=aO,G("X",0,0,"unix"),G("x",0,0,"valueOf"),qe("x",nr),qe("X",oi),ee("X",function(b,E,D){D._d=new Date(parseFloat(b)*1e3)}),ee("x",function(b,E,D){D._d=new Date(De(b))});//! moment.js
return i.version="2.29.4",n(Ar),i.fn=Be,i.min=tY,i.max=rY,i.now=iY,i.utc=p,i.unix=O8,i.months=I8,i.isDate=c,i.locale=Kl,i.invalid=x,i.duration=ia,i.isMoment=M,i.weekdays=k8,i.parseZone=L8,i.localeData=Bo,i.isDuration=f0,i.monthsShort=R8,i.weekdaysMin=N8,i.defineLocale=e_,i.updateLocale=LG,i.locales=IG,i.weekdaysShort=z8,i.normalizeUnits=Y,i.relativeTimeRounding=h9,i.relativeTimeThreshold=d9,i.calendarFormat=CY,i.prototype=Be,i.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},i})}(QM)),QM.exports}(function(e,t){(function(r,i){i(typeof $6=="function"?rIe():r.moment)})(Hl,function(r){//! moment.js locale configuration
var i=/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i,n=/(janv\.?|févr\.?|mars|avr\.?|mai|juin|juil\.?|août|sept\.?|oct\.?|nov\.?|déc\.?)/i,s=/(janv\.?|févr\.?|mars|avr\.?|mai|juin|juil\.?|août|sept\.?|oct\.?|nov\.?|déc\.?|janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i,a=[/^janv/i,/^févr/i,/^mars/i,/^avr/i,/^mai/i,/^juin/i,/^juil/i,/^août/i,/^sept/i,/^oct/i,/^nov/i,/^déc/i],o=r.defineLocale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsRegex:s,monthsShortRegex:s,monthsStrictRegex:i,monthsShortStrictRegex:n,monthsParse:a,longMonthsParse:a,shortMonthsParse:a,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd’hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",w:"une semaine",ww:"%d semaines",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(l,u){switch(u){case"D":return l+(l===1?"er":"");default:case"M":case"Q":case"DDD":case"d":return l+(l===1?"er":"e");case"w":case"W":return l+(l===1?"re":"e")}},week:{dow:1,doy:4}});return o})})();var Q6={exports:{}};(function(e){var t;(function(){t=e.exports})(),t.foldLength=75,t.newLineChar=`\r
`,t.helpers={updateTimezones:function(r){var i,n,s,a,o,l;if(!r||r.name!=="vcalendar")return r;for(i=r.getAllSubcomponents(),n=[],s={},o=0;o<i.length;o++)i[o].name==="vtimezone"?(l=i[o].getFirstProperty("tzid").getFirstValue(),s[l]=i[o]):n=n.concat(i[o].getAllProperties());for(a={},o=0;o<n.length;o++)(l=n[o].getParameter("tzid"))&&(a[l]=!0);for(o in s)s.hasOwnProperty(o)&&!a[o]&&r.removeSubcomponent(s[o]);for(o in a)a.hasOwnProperty(o)&&!s[o]&&t.TimezoneService.has(o)&&r.addSubcomponent(t.TimezoneService.get(o).component);return r},isStrictlyNaN:function(r){return typeof r=="number"&&isNaN(r)},strictParseInt:function(r){var i=parseInt(r,10);if(t.helpers.isStrictlyNaN(i))throw new Error('Could not extract integer from "'+r+'"');return i},formatClassType:function(i,n){if(!(typeof i>"u"))return i instanceof n?i:new n(i)},unescapedIndexOf:function(r,i,n){for(;(n=r.indexOf(i,n))!==-1;)if(n>0&&r[n-1]==="\\")n+=1;else return n;return-1},binsearchInsert:function(r,i,n){if(!r.length)return 0;for(var s=0,a=r.length-1,o,l;s<=a;)if(o=s+Math.floor((a-s)/2),l=n(i,r[o]),l<0)a=o-1;else if(l>0)s=o+1;else break;return l<0?o:l>0?o+1:o},dumpn:function(){t.debug&&(typeof console<"u"&&"log"in console?t.helpers.dumpn=function(i){console.log(i)}:t.helpers.dumpn=function(i){dump(i+`
`)},t.helpers.dumpn(arguments[0]))},clone:function(r,i){if(!r||typeof r!="object")return r;if(r instanceof Date)return new Date(r.getTime());if("clone"in r)return r.clone();if(Array.isArray(r)){for(var n=[],s=0;s<r.length;s++)n.push(i?t.helpers.clone(r[s],!0):r[s]);return n}else{var a={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i?a[o]=t.helpers.clone(r[o],!0):a[o]=r[o]);return a}},foldline:function(i){for(var n="",s=i||"",a=0,o=0;s.length;){var l=s.codePointAt(a);l<128?++o:l<2048?o+=2:l<65536?o+=3:o+=4,o<t.foldLength+1?a+=l>65535?2:1:(n+=t.newLineChar+" "+s.substring(0,a),s=s.substring(a),a=o=0)}return n.substr(t.newLineChar.length+1)},pad2:function(i){typeof i!="string"&&(typeof i=="number"&&(i=parseInt(i)),i=String(i));var n=i.length;switch(n){case 0:return"00";case 1:return"0"+i;default:return i}},trunc:function(i){return i<0?Math.ceil(i):Math.floor(i)},inherits:function(r,i,n){function s(){}s.prototype=r.prototype,i.prototype=new s,n&&t.helpers.extend(n,i.prototype)},extend:function(r,i){for(var n in r){var s=Object.getOwnPropertyDescriptor(r,n);s&&!Object.getOwnPropertyDescriptor(i,n)&&Object.defineProperty(i,n,s)}return i}},t.design=function(){var r=/\\\\|\\;|\\,|\\[Nn]/g,i=/\\|;|,|\n/g,n=/\\\\|\\,|\\[Nn]/g,s=/\\|,|\n/g;function a(O,W){var N={matches:/.*/,fromICAL:function(B,j){return y(B,O,j)},toICAL:function(B,j){var Q=W;return j&&(Q=new RegExp(Q.source+"|"+j)),B.replace(Q,function(H){switch(H){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return H}})}};return N}var o={defaultType:"text"},l={defaultType:"text",multiValue:","},u={defaultType:"text",structuredValue:";"},h={defaultType:"integer"},c={defaultType:"date-time",allowedTypes:["date-time","date"]},d={defaultType:"date-time"},f={defaultType:"uri"},p={defaultType:"utc-offset"},m={defaultType:"recur"},g={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function v(O){switch(O){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return O}}function y(O,W,N){return O.indexOf("\\")===-1?O:(N&&(W=new RegExp(W.source+"|\\\\"+N)),O.replace(W,v))}var x={categories:l,url:f,version:o,uid:o},w={boolean:{values:["TRUE","FALSE"],fromICAL:function(O){switch(O){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(O){return O?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(O){var W=parseFloat(O);return t.helpers.isStrictlyNaN(W)?0:W},toICAL:function(O){return String(O)}},integer:{fromICAL:function(O){var W=parseInt(O);return t.helpers.isStrictlyNaN(W)?0:W},toICAL:function(O){return String(O)}},"utc-offset":{toICAL:function(O){return O.length<7?O.substr(0,3)+O.substr(4,2):O.substr(0,3)+O.substr(4,2)+O.substr(7,2)},fromICAL:function(O){return O.length<6?O.substr(0,3)+":"+O.substr(3,2):O.substr(0,3)+":"+O.substr(3,2)+":"+O.substr(5,2)},decorate:function(O){return t.UtcOffset.fromString(O)},undecorate:function(O){return O.toString()}}},S={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},_=t.helpers.extend(w,{text:a(r,i),uri:{},binary:{decorate:function(O){return t.Binary.fromString(O)},undecorate:function(O){return O.toString()}},"cal-address":{},date:{decorate:function(O,W){return q.strict?t.Time.fromDateString(O,W):t.Time.fromString(O,W)},undecorate:function(O){return O.toString()},fromICAL:function(O){return!q.strict&&O.length>=15?_["date-time"].fromICAL(O):O.substr(0,4)+"-"+O.substr(4,2)+"-"+O.substr(6,2)},toICAL:function(O){var W=O.length;return W==10?O.substr(0,4)+O.substr(5,2)+O.substr(8,2):W>=19?_["date-time"].toICAL(O):O}},"date-time":{fromICAL:function(O){if(!q.strict&&O.length==8)return _.date.fromICAL(O);var W=O.substr(0,4)+"-"+O.substr(4,2)+"-"+O.substr(6,2)+"T"+O.substr(9,2)+":"+O.substr(11,2)+":"+O.substr(13,2);return O[15]&&O[15]==="Z"&&(W+="Z"),W},toICAL:function(O){var W=O.length;if(W==10&&!q.strict)return _.date.toICAL(O);if(W>=19){var N=O.substr(0,4)+O.substr(5,2)+O.substr(8,5)+O.substr(14,2)+O.substr(17,2);return O[19]&&O[19]==="Z"&&(N+="Z"),N}else return O},decorate:function(O,W){return q.strict?t.Time.fromDateTimeString(O,W):t.Time.fromString(O,W)},undecorate:function(O){return O.toString()}},duration:{decorate:function(O){return t.Duration.fromString(O)},undecorate:function(O){return O.toString()}},period:{fromICAL:function(O){var W=O.split("/");return W[0]=_["date-time"].fromICAL(W[0]),t.Duration.isValueString(W[1])||(W[1]=_["date-time"].fromICAL(W[1])),W},toICAL:function(O){return!q.strict&&O[0].length==10?O[0]=_.date.toICAL(O[0]):O[0]=_["date-time"].toICAL(O[0]),t.Duration.isValueString(O[1])||(!q.strict&&O[1].length==10?O[1]=_.date.toICAL(O[1]):O[1]=_["date-time"].toICAL(O[1])),O.join("/")},decorate:function(O,W){return t.Period.fromJSON(O,W,!q.strict)},undecorate:function(O){return O.toJSON()}},recur:{fromICAL:function(O){return t.Recur._stringToData(O,!0)},toICAL:function(O){var W="";for(var N in O)if(Object.prototype.hasOwnProperty.call(O,N)){var B=O[N];N=="until"?B.length>10?B=_["date-time"].toICAL(B):B=_.date.toICAL(B):N=="wkst"?typeof B=="number"&&(B=t.Recur.numericDayToIcalDay(B)):Array.isArray(B)&&(B=B.join(",")),W+=N.toUpperCase()+"="+B+";"}return W.substr(0,W.length-1)},decorate:function(W){return t.Recur.fromData(W)},undecorate:function(O){return O.toJSON()}},time:{fromICAL:function(O){if(O.length<6)return O;var W=O.substr(0,2)+":"+O.substr(2,2)+":"+O.substr(4,2);return O[6]==="Z"&&(W+="Z"),W},toICAL:function(O){if(O.length<8)return O;var W=O.substr(0,2)+O.substr(3,2)+O.substr(6,2);return O[8]==="Z"&&(W+="Z"),W}}}),A=t.helpers.extend(x,{action:o,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:o,class:o,comment:o,completed:d,contact:o,created:d,description:o,dtend:c,dtstamp:d,dtstart:c,due:c,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:m,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":d,location:o,method:o,organizer:{defaultType:"cal-address"},"percent-complete":h,priority:h,prodid:o,"related-to":o,repeat:h,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(O){return O.indexOf("/")!==-1?"period":O.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":c,resources:l,"request-status":u,rrule:m,sequence:h,status:o,summary:o,transp:o,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:p,tzoffsetto:p,tzurl:f,tzid:o,tzname:o}),M=t.helpers.extend(w,{text:a(n,s),uri:a(n,s),date:{decorate:function(O){return t.VCardTime.fromDateAndOrTimeString(O,"date")},undecorate:function(O){return O.toString()},fromICAL:function(O){return O.length==8?_.date.fromICAL(O):O[0]=="-"&&O.length==6?O.substr(0,4)+"-"+O.substr(4):O},toICAL:function(O){return O.length==10?_.date.toICAL(O):O[0]=="-"&&O.length==7?O.substr(0,4)+O.substr(5):O}},time:{decorate:function(O){return t.VCardTime.fromDateAndOrTimeString("T"+O,"time")},undecorate:function(O){return O.toString()},fromICAL:function(O){var W=M.time._splitZone(O,!0),N=W[0],B=W[1];return B.length==6?B=B.substr(0,2)+":"+B.substr(2,2)+":"+B.substr(4,2):B.length==4&&B[0]!="-"?B=B.substr(0,2)+":"+B.substr(2,2):B.length==5&&(B=B.substr(0,3)+":"+B.substr(3,2)),N.length==5&&(N[0]=="-"||N[0]=="+")&&(N=N.substr(0,3)+":"+N.substr(3)),B+N},toICAL:function(O){var W=M.time._splitZone(O),N=W[0],B=W[1];return B.length==8?B=B.substr(0,2)+B.substr(3,2)+B.substr(6,2):B.length==5&&B[0]!="-"?B=B.substr(0,2)+B.substr(3,2):B.length==6&&(B=B.substr(0,3)+B.substr(4,2)),N.length==6&&(N[0]=="-"||N[0]=="+")&&(N=N.substr(0,3)+N.substr(4)),B+N},_splitZone:function(O,W){var N=O.length-1,B=O.length-(W?5:6),j=O[B],Q,H;return O[N]=="Z"?(Q=O[N],H=O.substr(0,N)):O.length>6&&(j=="-"||j=="+")?(Q=O.substr(B),H=O.substr(0,B)):(Q="",H=O),[Q,H]}},"date-time":{decorate:function(O){return t.VCardTime.fromDateAndOrTimeString(O,"date-time")},undecorate:function(O){return O.toString()},fromICAL:function(O){return M["date-and-or-time"].fromICAL(O)},toICAL:function(O){return M["date-and-or-time"].toICAL(O)}},"date-and-or-time":{decorate:function(O){return t.VCardTime.fromDateAndOrTimeString(O,"date-and-or-time")},undecorate:function(O){return O.toString()},fromICAL:function(O){var W=O.split("T");return(W[0]?M.date.fromICAL(W[0]):"")+(W[1]?"T"+M.time.fromICAL(W[1]):"")},toICAL:function(O){var W=O.split("T");return M.date.toICAL(W[0])+(W[1]?"T"+M.time.toICAL(W[1]):"")}},timestamp:_["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/}}),T={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},C=t.helpers.extend(x,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:g,bday:g,caladruri:f,caluri:f,clientpidmap:u,email:o,fburl:f,fn:o,gender:u,geo:f,impp:f,key:f,kind:o,lang:{defaultType:"language-tag"},logo:f,member:f,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:l,note:o,org:{defaultType:"text",structuredValue:";"},photo:f,related:f,rev:{defaultType:"timestamp"},role:o,sound:f,source:f,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:o,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:o}),L=t.helpers.extend(w,{binary:_.binary,date:M.date,"date-time":M["date-time"],"phone-number":{},uri:_.uri,text:_.text,time:_.time,vcard:_.text,"utc-offset":{toICAL:function(O){return O.substr(0,7)},fromICAL:function(O){return O.substr(0,7)},decorate:function(O){return t.UtcOffset.fromString(O)},undecorate:function(O){return O.toString()}}}),I={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},k=t.helpers.extend(x,{fn:o,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:l,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(O){return O.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:o,tel:{defaultType:"phone-number"},email:o,mailer:o,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:o,role:o,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:u,note:l,prodid:o,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(O){return O.indexOf("T")===-1?"date":"date-time"}},"sort-string":o,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:o,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),z={value:_,param:S,property:A},V={value:M,param:T,property:C},K={value:L,param:I,property:k},q={strict:!0,defaultSet:z,defaultType:"unknown",components:{vcard:V,vcard3:K,vevent:z,vtodo:z,vjournal:z,valarm:z,vtimezone:z,daylight:z,standard:z},icalendar:z,vcard:V,vcard3:K,getDesignSet:function(O){var W=O&&O in q.components;return W?q.components[O]:q.defaultSet}};return q}(),t.stringify=function(){var r=`\r
`,i="unknown",n=t.design,s=t.helpers;function a(l){typeof l[0]=="string"&&(l=[l]);for(var u=0,h=l.length,c="";u<h;u++)c+=a.component(l[u])+r;return c}a.component=function(l,u){var h=l[0].toUpperCase(),c="BEGIN:"+h+r,d=l[1],f=0,p=d.length,m=l[0];for(m==="vcard"&&l[1].length>0&&!(l[1][0][0]==="version"&&l[1][0][3]==="4.0")&&(m="vcard3"),u=u||n.getDesignSet(m);f<p;f++)c+=a.property(d[f],u)+r;for(var g=l[2]||[],v=0,y=g.length;v<y;v++)c+=a.component(g[v],u)+r;return c+="END:"+h,c},a.property=function(l,u,h){var c=l[0].toUpperCase(),d=l[0],f=l[1],p=c,m;for(m in f){var g=f[m];if(f.hasOwnProperty(m)){var x=m in u.param&&u.param[m].multiValue;x&&Array.isArray(g)?(u.param[m].multiValueSeparateDQuote&&(x='"'+x+'"'),g=g.map(a._rfc6868Unescape),g=a.multiValue(g,x,"unknown",null,u)):g=a._rfc6868Unescape(g),p+=";"+m.toUpperCase(),p+="="+a.propertyValue(g)}}if(l.length===3)return p+":";var v=l[2];u||(u=n.defaultSet);var y,x=!1,w=!1,S=!1;return d in u.property?(y=u.property[d],"multiValue"in y&&(x=y.multiValue),"structuredValue"in y&&Array.isArray(l[3])&&(w=y.structuredValue),"defaultType"in y?v===y.defaultType&&(S=!0):v===i&&(S=!0)):v===i&&(S=!0),S||(p+=";VALUE="+v.toUpperCase()),p+=":",x&&w?p+=a.multiValue(l[3],w,v,x,u,w):x?p+=a.multiValue(l.slice(3),x,v,null,u,!1):w?p+=a.multiValue(l[3],w,v,null,u,w):p+=a.value(l[3],v,u,!1),h?p:t.helpers.foldline(p)},a.propertyValue=function(l){return s.unescapedIndexOf(l,",")===-1&&s.unescapedIndexOf(l,":")===-1&&s.unescapedIndexOf(l,";")===-1?l:'"'+l+'"'},a.multiValue=function(l,u,h,c,d,f){for(var p="",m=l.length,g=0;g<m;g++)c&&Array.isArray(l[g])?p+=a.multiValue(l[g],c,h,null,d,f):p+=a.value(l[g],h,d,f),g!==m-1&&(p+=u);return p},a.value=function(l,u,h,c){return u in h.value&&"toICAL"in h.value[u]?h.value[u].toICAL(l,c):l},a._rfc6868Unescape=function(l){return l.replace(/[\n^"]/g,function(u){return o[u]})};var o={'"':"^'","\n":"^n","^":"^^"};return a}(),t.parse=function(){var r=/[^ \t]/,i=":",n=";",s="=",a="unknown",o="text",l=t.design,u=t.helpers;function h(f){this.message=f,this.name="ParserError";try{throw new Error}catch(m){if(m.stack){var p=m.stack.split(`
`);p.shift(),this.stack=p.join(`
`)}}}h.prototype=Error.prototype;function c(f){var p={},m=p.component=[];if(p.stack=[m],c._eachLine(f,function(g,v){c._handleContentLine(v,p)}),p.stack.length>1)throw new h("invalid ical body. component began but did not end");return p=null,m.length==1?m[0]:m}c.property=function(f,p){var m={component:[[],[]],designSet:p||l.defaultSet};return c._handleContentLine(f,m),m.component[1][0]},c.component=function(f){return c(f)},c.ParserError=h,c._handleContentLine=function(f,p){var m=f.indexOf(i),g=f.indexOf(n),v,y,x,w,S={};g!==-1&&m!==-1&&g>m&&(g=-1);var _;if(g!==-1){if(x=f.substring(0,g).toLowerCase(),_=c._parseParameters(f.substring(g),0,p.designSet),_[2]==-1)throw new h("Invalid parameters in '"+f+"'");if(S=_[0],v=_[1].length+_[2]+g,(y=f.substring(v).indexOf(i))!==-1)w=f.substring(v+y+1);else throw new h("Missing parameter value in '"+f+"'")}else if(m!==-1){if(x=f.substring(0,m).toLowerCase(),w=f.substring(m+1),x==="begin"){var A=[w.toLowerCase(),[],[]];p.stack.length===1?p.component.push(A):p.component[2].push(A),p.stack.push(p.component),p.component=A,p.designSet||(p.designSet=l.getDesignSet(p.component[0]));return}else if(x==="end"){p.component=p.stack.pop();return}}else throw new h('invalid line (no token ";" or ":") "'+f+'"');var M,T=!1,C=!1,L;x in p.designSet.property&&(L=p.designSet.property[x],"multiValue"in L&&(T=L.multiValue),"structuredValue"in L&&(C=L.structuredValue),w&&"detectType"in L&&(M=L.detectType(w))),M||("value"in S?M=S.value.toLowerCase():L?M=L.defaultType:M=a),delete S.value;var I;T&&C?(w=c._parseMultiValue(w,C,M,[],T,p.designSet,C),I=[x,S,M,w]):T?(I=[x,S,M],c._parseMultiValue(w,T,M,I,null,p.designSet,!1)):C?(w=c._parseMultiValue(w,C,M,[],null,p.designSet,C),I=[x,S,M,w]):(w=c._parseValue(w,M,p.designSet,!1),I=[x,S,M,w]),p.component[0]==="vcard"&&p.component[1].length===0&&!(x==="version"&&w==="4.0")&&(p.designSet=l.getDesignSet("vcard3")),p.component[1].push(I)},c._parseValue=function(f,p,m,g){return p in m.value&&"fromICAL"in m.value[p]?m.value[p].fromICAL(f,g):f},c._parseParameters=function(f,p,m){for(var g=p,v=0,y=s,x={},w,S,_,A=-1,M,T,C;v!==!1&&(v=u.unescapedIndexOf(f,y,v+1))!==-1;){if(w=f.substr(g+1,v-g-1),w.length==0)throw new h("Empty parameter name in '"+f+"'");S=w.toLowerCase(),C=!1,T=!1,S in m.param&&m.param[S].valueType?M=m.param[S].valueType:M=o,S in m.param&&(T=m.param[S].multiValue,m.param[S].multiValueSeparateDQuote&&(C=c._rfc6868Escape('"'+T+'"')));var L=f[v+1];if(L==='"'){if(A=v+2,v=u.unescapedIndexOf(f,'"',A),T&&v!=-1)for(var I=!0;I;)f[v+1]==T&&f[v+2]=='"'?v=u.unescapedIndexOf(f,'"',v+3):I=!1;if(v===-1)throw new h('invalid line (no matching double quote) "'+f+'"');_=f.substr(A,v-A),g=u.unescapedIndexOf(f,n,v),g===-1&&(v=!1)}else{A=v+1;var k=u.unescapedIndexOf(f,n,A),z=u.unescapedIndexOf(f,i,A);z!==-1&&k>z?(k=z,v=!1):k===-1?(z===-1?k=f.length:k=z,v=!1):(g=k,v=k),_=f.substr(A,k-A)}if(_=c._rfc6868Escape(_),T){var V=C||T;_=c._parseMultiValue(_,V,M,[],null,m)}else _=c._parseValue(_,M,m);T&&S in x?Array.isArray(x[S])?x[S].push(_):x[S]=[x[S],_]:x[S]=_}return[x,_,A]},c._rfc6868Escape=function(f){return f.replace(/\^['n^]/g,function(p){return d[p]})};var d={"^'":'"',"^n":`
`,"^^":"^"};return c._parseMultiValue=function(f,p,m,g,v,y,x){var w=0,S=0,_;if(p.length===0)return f;for(;(w=u.unescapedIndexOf(f,p,S))!==-1;)_=f.substr(S,w-S),v?_=c._parseMultiValue(_,v,m,[],null,y,x):_=c._parseValue(_,m,y,x),g.push(_),S=w+p.length;return _=f.substr(S),v?_=c._parseMultiValue(_,v,m,[],null,y,x):_=c._parseValue(_,m,y,x),g.push(_),g.length==1?g[0]:g},c._eachLine=function(f,p){var m=f.length,g=f.search(r),v=g,y,x,w;do v=f.indexOf(`
`,g)+1,v>1&&f[v-2]==="\r"?w=2:w=1,v===0&&(v=m,w=0),x=f[g],x===" "||x==="	"?y+=f.substr(g+1,v-g-(w+1)):(y&&p(null,y),y=f.substr(g,v-g-w)),g=v;while(v!==m);y=y.trim(),y.length&&p(null,y)},c}(),t.Component=function(){var r=1,i=2,n=0;function s(a,o){typeof a=="string"&&(a=[a,[],[]]),this.jCal=a,this.parent=o||null}return s.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[n]},get _designSet(){var a=this.parent&&this.parent._designSet;return a||t.design.getDesignSet(this.name)},_hydrateComponent:function(a){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[a])return this._components[a];var o=new s(this.jCal[i][a],this);return this._hydratedComponentCount++,this._components[a]=o},_hydrateProperty:function(a){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[a])return this._properties[a];var o=new t.Property(this.jCal[r][a],this);return this._hydratedPropertyCount++,this._properties[a]=o},getFirstSubcomponent:function(a){if(a){for(var o=0,l=this.jCal[i],u=l.length;o<u;o++)if(l[o][n]===a){var h=this._hydrateComponent(o);return h}}else if(this.jCal[i].length)return this._hydrateComponent(0);return null},getAllSubcomponents:function(a){var o=this.jCal[i].length,l=0;if(a){for(var u=this.jCal[i],h=[];l<o;l++)a===u[l][n]&&h.push(this._hydrateComponent(l));return h}else{if(!this._components||this._hydratedComponentCount!==o)for(;l<o;l++)this._hydrateComponent(l);return this._components||[]}},hasProperty:function(a){for(var o=this.jCal[r],l=o.length,u=0;u<l;u++)if(o[u][n]===a)return!0;return!1},getFirstProperty:function(a){if(a){for(var o=0,l=this.jCal[r],u=l.length;o<u;o++)if(l[o][n]===a){var h=this._hydrateProperty(o);return h}}else if(this.jCal[r].length)return this._hydrateProperty(0);return null},getFirstPropertyValue:function(a){var o=this.getFirstProperty(a);return o?o.getFirstValue():null},getAllProperties:function(a){var o=this.jCal[r].length,l=0;if(a){for(var u=this.jCal[r],h=[];l<o;l++)a===u[l][n]&&h.push(this._hydrateProperty(l));return h}else{if(!this._properties||this._hydratedPropertyCount!==o)for(;l<o;l++)this._hydrateProperty(l);return this._properties||[]}},_removeObjectByIndex:function(a,o,l){if(o=o||[],o[l]){var u=o[l];"parent"in u&&(u.parent=null)}o.splice(l,1),this.jCal[a].splice(l,1)},_removeObject:function(a,o,l){var u=0,h=this.jCal[a],c=h.length,d=this[o];if(typeof l=="string"){for(;u<c;u++)if(h[u][n]===l)return this._removeObjectByIndex(a,d,u),!0}else if(d){for(;u<c;u++)if(d[u]&&d[u]===l)return this._removeObjectByIndex(a,d,u),!0}return!1},_removeAllObjects:function(a,o,l){for(var u=this[o],h=this.jCal[a],c=h.length-1;c>=0;c--)(!l||h[c][n]===l)&&this._removeObjectByIndex(a,u,c)},addSubcomponent:function(a){this._components||(this._components=[],this._hydratedComponentCount=0),a.parent&&a.parent.removeSubcomponent(a);var o=this.jCal[i].push(a.jCal);return this._components[o-1]=a,this._hydratedComponentCount++,a.parent=this,a},removeSubcomponent:function(a){var o=this._removeObject(i,"_components",a);return o&&this._hydratedComponentCount--,o},removeAllSubcomponents:function(a){var o=this._removeAllObjects(i,"_components",a);return this._hydratedComponentCount=0,o},addProperty:function(a){if(!(a instanceof t.Property))throw new TypeError("must instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),a.parent&&a.parent.removeProperty(a);var o=this.jCal[r].push(a.jCal);return this._properties[o-1]=a,this._hydratedPropertyCount++,a.parent=this,a},addPropertyWithValue:function(a,o){var l=new t.Property(a);return l.setValue(o),this.addProperty(l),l},updatePropertyWithValue:function(a,o){var l=this.getFirstProperty(a);return l?l.setValue(o):l=this.addPropertyWithValue(a,o),l},removeProperty:function(a){var o=this._removeObject(r,"_properties",a);return o&&this._hydratedPropertyCount--,o},removeAllProperties:function(a){var o=this._removeAllObjects(r,"_properties",a);return this._hydratedPropertyCount=0,o},toJSON:function(){return this.jCal},toString:function(){return t.stringify.component(this.jCal,this._designSet)}},s.fromString=function(a){return new s(t.parse.component(a))},s}(),t.Property=function(){var r=0,i=1,n=2,s=3,a=t.design;function o(l,u){this._parent=u||null,typeof l=="string"?(this.jCal=[l,{},a.defaultType],this.jCal[n]=this.getDefaultType()):this.jCal=l,this._updateType()}return o.prototype={get type(){return this.jCal[n]},get name(){return this.jCal[r]},get parent(){return this._parent},set parent(l){var u=!this._parent||l&&l._designSet!=this._parent._designSet;return this._parent=l,this.type==a.defaultType&&u&&(this.jCal[n]=this.getDefaultType(),this._updateType()),l},get _designSet(){return this.parent?this.parent._designSet:a.defaultSet},_updateType:function(){var l=this._designSet;this.type in l.value&&(l.value[this.type],"decorate"in l.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in l.property&&(this.isMultiValue="multiValue"in l.property[this.name],this.isStructuredValue="structuredValue"in l.property[this.name]))},_hydrateValue:function(l){return this._values&&this._values[l]?this._values[l]:this.jCal.length<=s+l?null:this.isDecorated?(this._values||(this._values=[]),this._values[l]=this._decorate(this.jCal[s+l])):this.jCal[s+l]},_decorate:function(l){return this._designSet.value[this.type].decorate(l,this)},_undecorate:function(l){return this._designSet.value[this.type].undecorate(l,this)},_setDecoratedValue:function(l,u){this._values||(this._values=[]),typeof l=="object"&&"icaltype"in l?(this.jCal[s+u]=this._undecorate(l),this._values[u]=l):(this.jCal[s+u]=l,this._values[u]=this._decorate(l))},getParameter:function(l){if(l in this.jCal[i])return this.jCal[i][l]},getFirstParameter:function(l){var u=this.getParameter(l);return Array.isArray(u)?u[0]:u},setParameter:function(l,u){var h=l.toLowerCase();typeof u=="string"&&h in this._designSet.param&&"multiValue"in this._designSet.param[h]&&(u=[u]),this.jCal[i][l]=u},removeParameter:function(l){delete this.jCal[i][l]},getDefaultType:function(){var l=this.jCal[r],u=this._designSet;if(l in u.property){var h=u.property[l];if("defaultType"in h)return h.defaultType}return a.defaultType},resetType:function(l){this.removeAllValues(),this.jCal[n]=l,this._updateType()},getFirstValue:function(){return this._hydrateValue(0)},getValues:function(){var l=this.jCal.length-s;if(l<1)return[];for(var u=0,h=[];u<l;u++)h[u]=this._hydrateValue(u);return h},removeAllValues:function(){this._values&&(this._values.length=0),this.jCal.length=3},setValues:function(l){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);var u=l.length,h=0;if(this.removeAllValues(),u>0&&typeof l[0]=="object"&&"icaltype"in l[0]&&this.resetType(l[0].icaltype),this.isDecorated)for(;h<u;h++)this._setDecoratedValue(l[h],h);else for(;h<u;h++)this.jCal[s+h]=l[h]},setValue:function(l){this.removeAllValues(),typeof l=="object"&&"icaltype"in l&&this.resetType(l.icaltype),this.isDecorated?this._setDecoratedValue(l,0):this.jCal[s]=l},toJSON:function(){return this.jCal},toICALString:function(){return t.stringify.property(this.jCal,this._designSet,!0)}},o.fromString=function(l,u){return new o(t.parse.property(l,u))},o}(),t.UtcOffset=function(){function r(i){this.fromData(i)}return r.prototype={hours:0,minutes:0,factor:1,icaltype:"utc-offset",clone:function(){return t.UtcOffset.fromSeconds(this.toSeconds())},fromData:function(i){if(i)for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);this._normalize()},fromSeconds:function(i){var n=Math.abs(i);return this.factor=i<0?-1:1,this.hours=t.helpers.trunc(n/3600),n-=this.hours*3600,this.minutes=t.helpers.trunc(n/60),this},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function(n){var s=this.toSeconds(),a=n.toSeconds();return(s>a)-(a>s)},_normalize:function(){for(var i=this.toSeconds(),n=this.factor;i<-43200;)i+=97200;for(;i>50400;)i-=97200;this.fromSeconds(i),i==0&&(this.factor=n)},toICALString:function(){return t.design.icalendar.value["utc-offset"].toICAL(this.toString())},toString:function(){return(this.factor==1?"+":"-")+t.helpers.pad2(this.hours)+":"+t.helpers.pad2(this.minutes)}},r.fromString=function(i){var n={};return n.factor=i[0]==="+"?1:-1,n.hours=t.helpers.strictParseInt(i.substr(1,2)),n.minutes=t.helpers.strictParseInt(i.substr(4,2)),new t.UtcOffset(n)},r.fromSeconds=function(i){var n=new r;return n.fromSeconds(i),n},r}(),t.Binary=function(){function r(i){this.value=i}return r.prototype={icaltype:"binary",decodeValue:function(){return this._b64_decode(this.value)},setEncodedValue:function(n){this.value=this._b64_encode(n)},_b64_encode:function(n){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a,o,l,u,h,c,d,f,p=0,m=0,g="",v=[];if(!n)return n;do a=n.charCodeAt(p++),o=n.charCodeAt(p++),l=n.charCodeAt(p++),f=a<<16|o<<8|l,u=f>>18&63,h=f>>12&63,c=f>>6&63,d=f&63,v[m++]=s.charAt(u)+s.charAt(h)+s.charAt(c)+s.charAt(d);while(p<n.length);g=v.join("");var y=n.length%3;return(y?g.slice(0,y-3):g)+"===".slice(y||3)},_b64_decode:function(n){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a,o,l,u,h,c,d,f,p=0,m=0,g="",v=[];if(!n)return n;n+="";do u=s.indexOf(n.charAt(p++)),h=s.indexOf(n.charAt(p++)),c=s.indexOf(n.charAt(p++)),d=s.indexOf(n.charAt(p++)),f=u<<18|h<<12|c<<6|d,a=f>>16&255,o=f>>8&255,l=f&255,c==64?v[m++]=String.fromCharCode(a):d==64?v[m++]=String.fromCharCode(a,o):v[m++]=String.fromCharCode(a,o,l);while(p<n.length);return g=v.join(""),g},toString:function(){return this.value}},r.fromString=function(i){return new r(i)},r}(),function(){t.Period=function(i){if(this.wrappedJSObject=this,i&&"start"in i){if(i.start&&!(i.start instanceof t.Time))throw new TypeError(".start must be an instance of ICAL.Time");this.start=i.start}if(i&&i.end&&i.duration)throw new Error("cannot accept both end and duration");if(i&&"end"in i){if(i.end&&!(i.end instanceof t.Time))throw new TypeError(".end must be an instance of ICAL.Time");this.end=i.end}if(i&&"duration"in i){if(i.duration&&!(i.duration instanceof t.Duration))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=i.duration}},t.Period.prototype={start:null,end:null,duration:null,icalclass:"icalperiod",icaltype:"period",clone:function(){return t.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function(){return this.duration?this.duration:this.end.subtractDate(this.start)},getEnd:function(){if(this.end)return this.end;var r=this.start.clone();return r.addDuration(this.duration),r},toString:function(){return this.start+"/"+(this.end||this.duration)},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},t.Period.fromString=function(i,n){var s=i.split("/");if(s.length!==2)throw new Error('Invalid string value: "'+i+'" must contain a "/" char.');var a={start:t.Time.fromDateTimeString(s[0],n)},o=s[1];return t.Duration.isValueString(o)?a.duration=t.Duration.fromString(o):a.end=t.Time.fromDateTimeString(o,n),new t.Period(a)},t.Period.fromData=function(i){return new t.Period(i)},t.Period.fromJSON=function(r,i,n){function s(a,o){return n?t.Time.fromString(a,o):t.Time.fromDateTimeString(a,o)}return t.Duration.isValueString(r[1])?t.Period.fromData({start:s(r[0],i),duration:t.Duration.fromString(r[1])}):t.Period.fromData({start:s(r[0],i),end:s(r[1],i)})}}(),function(){var r=/([PDWHMTS]{1,1})/;t.Duration=function(s){this.wrappedJSObject=this,this.fromData(s)},t.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:"icalduration",icaltype:"duration",clone:function(){return t.Duration.fromData(this)},toSeconds:function(){var s=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-s:s},fromSeconds:function(s){var a=Math.abs(s);return this.isNegative=s<0,this.days=t.helpers.trunc(a/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,a-=(this.days+7*this.weeks)*86400,this.hours=t.helpers.trunc(a/3600),a-=this.hours*3600,this.minutes=t.helpers.trunc(a/60),a-=this.minutes*60,this.seconds=a,this},fromData:function(s){var a=["weeks","days","hours","minutes","seconds","isNegative"];for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];s&&l in s?this[l]=s[l]:this[l]=0}},reset:function(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0},compare:function(s){var a=this.toSeconds(),o=s.toSeconds();return(a>o)-(a<o)},normalize:function(){this.fromSeconds(this.toSeconds())},toString:function(){if(this.toSeconds()==0)return"PT0S";var s="";return this.isNegative&&(s+="-"),s+="P",this.weeks&&(s+=this.weeks+"W"),this.days&&(s+=this.days+"D"),(this.hours||this.minutes||this.seconds)&&(s+="T",this.hours&&(s+=this.hours+"H"),this.minutes&&(s+=this.minutes+"M"),this.seconds&&(s+=this.seconds+"S")),s},toICALString:function(){return this.toString()}},t.Duration.fromSeconds=function(s){return new t.Duration().fromSeconds(s)};function i(n,s,a){var o;switch(n){case"P":s&&s==="-"?a.isNegative=!0:a.isNegative=!1;break;case"D":o="days";break;case"W":o="weeks";break;case"H":o="hours";break;case"M":o="minutes";break;case"S":o="seconds";break;default:return 0}if(o){if(!s&&s!==0)throw new Error('invalid duration value: Missing number before "'+n+'"');var l=parseInt(s,10);if(t.helpers.isStrictlyNaN(l))throw new Error('invalid duration value: Invalid number "'+s+'" before "'+n+'"');a[o]=l}return 1}t.Duration.isValueString=function(n){return n[0]==="P"||n[1]==="P"},t.Duration.fromString=function(s){for(var a=0,o=Object.create(null),l=0;(a=s.search(r))!==-1;){var u=s[a],h=s.substr(0,a);s=s.substr(a+1),l+=i(u,h,o)}if(l<2)throw new Error('invalid duration value: Not enough duration components in "'+s+'"');return new t.Duration(o)},t.Duration.fromData=function(s){return new t.Duration(s)}}(),function(){var r=["tzid","location","tznames","latitude","longitude"];t.Timezone=function(n){this.wrappedJSObject=this,this.fromData(n)},t.Timezone.prototype={tzid:"",location:"",tznames:"",latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:"icaltimezone",fromData:function(n){if(this.expandedUntilYear=0,this.changes=[],n instanceof t.Component)this.component=n;else{if(n&&"component"in n)if(typeof n.component=="string"){var s=t.parse(n.component);this.component=new t.Component(s)}else n.component instanceof t.Component?this.component=n.component:this.component=null;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a];n&&o in n&&(this[o]=n[o])}}return this.component instanceof t.Component&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this},utcOffset:function(n){if(this==t.Timezone.utcTimezone||this==t.Timezone.localTimezone||(this._ensureCoverage(n.year),!this.changes.length))return 0;for(var s={year:n.year,month:n.month,day:n.day,hour:n.hour,minute:n.minute,second:n.second},a=this._findNearbyChange(s),o=-1,l=1;;){var u=t.helpers.clone(this.changes[a],!0);u.utcOffset<u.prevUtcOffset?t.Timezone.adjust_change(u,0,0,0,u.utcOffset):t.Timezone.adjust_change(u,0,0,0,u.prevUtcOffset);var h=t.Timezone._compare_change_fn(s,u);if(h>=0?o=a:l=-1,l==-1&&o!=-1)break;if(a+=l,a<0)return 0;if(a>=this.changes.length)break}var c=this.changes[o],d=c.utcOffset-c.prevUtcOffset;if(d<0&&o>0){var f=t.helpers.clone(c,!0);if(t.Timezone.adjust_change(f,0,0,0,f.prevUtcOffset),t.Timezone._compare_change_fn(s,f)<0){var p=this.changes[o-1],m=!1;c.is_daylight!=m&&p.is_daylight==m&&(c=p)}}return c.utcOffset},_findNearbyChange:function(n){var s=t.helpers.binsearchInsert(this.changes,n,t.Timezone._compare_change_fn);return s>=this.changes.length?this.changes.length-1:s},_ensureCoverage:function(i){if(t.Timezone._minimumExpansionYear==-1){var n=t.Time.now();t.Timezone._minimumExpansionYear=n.year}var s=i;if(s<t.Timezone._minimumExpansionYear&&(s=t.Timezone._minimumExpansionYear),s+=t.Timezone.EXTRA_COVERAGE,s>t.Timezone.MAX_YEAR&&(s=t.Timezone.MAX_YEAR),!this.changes.length||this.expandedUntilYear<i){for(var a=this.component.getAllSubcomponents(),o=a.length,l=0;l<o;l++)this._expandComponent(a[l],s,this.changes);this.changes.sort(t.Timezone._compare_change_fn),this.expandedUntilYear=s}},_expandComponent:function(i,n,s){if(!i.hasProperty("dtstart")||!i.hasProperty("tzoffsetto")||!i.hasProperty("tzoffsetfrom"))return null;var a=i.getFirstProperty("dtstart").getFirstValue(),o;function l(v){return v.factor*(v.hours*3600+v.minutes*60)}function u(){var v={};return v.is_daylight=i.name=="daylight",v.utcOffset=l(i.getFirstProperty("tzoffsetto").getFirstValue()),v.prevUtcOffset=l(i.getFirstProperty("tzoffsetfrom").getFirstValue()),v}if(!i.hasProperty("rrule")&&!i.hasProperty("rdate"))o=u(),o.year=a.year,o.month=a.month,o.day=a.day,o.hour=a.hour,o.minute=a.minute,o.second=a.second,t.Timezone.adjust_change(o,0,0,0,-o.prevUtcOffset),s.push(o);else{var h=i.getAllProperties("rdate");for(var c in h)if(h.hasOwnProperty(c)){var d=h[c],f=d.getFirstValue();o=u(),o.year=f.year,o.month=f.month,o.day=f.day,f.isDate?(o.hour=a.hour,o.minute=a.minute,o.second=a.second,a.zone!=t.Timezone.utcTimezone&&t.Timezone.adjust_change(o,0,0,0,-o.prevUtcOffset)):(o.hour=f.hour,o.minute=f.minute,o.second=f.second,f.zone!=t.Timezone.utcTimezone&&t.Timezone.adjust_change(o,0,0,0,-o.prevUtcOffset)),s.push(o)}var p=i.getFirstProperty("rrule");if(p){p=p.getFirstValue(),o=u(),p.until&&p.until.zone==t.Timezone.utcTimezone&&(p.until.adjust(0,0,0,o.prevUtcOffset),p.until.zone=t.Timezone.localTimezone);for(var m=p.iterator(a),g;(g=m.next())&&(o=u(),!(g.year>n||!g));)o.year=g.year,o.month=g.month,o.day=g.day,o.hour=g.hour,o.minute=g.minute,o.second=g.second,o.isDate=g.isDate,t.Timezone.adjust_change(o,0,0,0,-o.prevUtcOffset),s.push(o)}}return s},toString:function(){return this.tznames?this.tznames:this.tzid}},t.Timezone._compare_change_fn=function(n,s){return n.year<s.year?-1:n.year>s.year?1:n.month<s.month?-1:n.month>s.month?1:n.day<s.day?-1:n.day>s.day?1:n.hour<s.hour?-1:n.hour>s.hour?1:n.minute<s.minute?-1:n.minute>s.minute?1:n.second<s.second?-1:n.second>s.second?1:0},t.Timezone.convert_time=function(n,s,a){if(n.isDate||s.tzid==a.tzid||s==t.Timezone.localTimezone||a==t.Timezone.localTimezone)return n.zone=a,n;var o=s.utcOffset(n);return n.adjust(0,0,0,-o),o=a.utcOffset(n),n.adjust(0,0,0,o),null},t.Timezone.fromData=function(n){var s=new t.Timezone;return s.fromData(n)},t.Timezone.utcTimezone=t.Timezone.fromData({tzid:"UTC"}),t.Timezone.localTimezone=t.Timezone.fromData({tzid:"floating"}),t.Timezone.adjust_change=function(n,s,a,o,l){return t.Time.prototype.adjust.call(n,s,a,o,l,n)},t.Timezone._minimumExpansionYear=-1,t.Timezone.MAX_YEAR=2035,t.Timezone.EXTRA_COVERAGE=5}(),t.TimezoneService=function(){var r,i={get count(){return Object.keys(r).length},reset:function(){r=Object.create(null);var n=t.Timezone.utcTimezone;r.Z=n,r.UTC=n,r.GMT=n},has:function(n){return!!r[n]},get:function(n){return r[n]},register:function(n,s){if(n instanceof t.Component&&n.name==="vtimezone"&&(s=new t.Timezone(n),n=s.tzid),s instanceof t.Timezone)r[n]=s;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(n){return delete r[n]}};return i.reset(),i}(),function(){t.Time=function(i,n){this.wrappedJSObject=this;var s=this._time=Object.create(null);s.year=0,s.month=1,s.day=1,s.hour=0,s.minute=0,s.second=0,s.isDate=!1,this.fromData(i,n)},t.Time._dowCache={},t.Time._wnCache={},t.Time.prototype={icalclass:"icaltime",_cachedUnixTime:null,get icaltype(){return this.isDate?"date":"date-time"},zone:null,_pendingNormalization:!1,clone:function(){return new t.Time(this._time,this.zone)},reset:function(){this.fromData(t.Time.epochTime),this.zone=t.Timezone.utcTimezone},resetTo:function(i,n,s,a,o,l,u){this.fromData({year:i,month:n,day:s,hour:a,minute:o,second:l,zone:u})},fromJSDate:function(i,n){return i?n?(this.zone=t.Timezone.utcTimezone,this.year=i.getUTCFullYear(),this.month=i.getUTCMonth()+1,this.day=i.getUTCDate(),this.hour=i.getUTCHours(),this.minute=i.getUTCMinutes(),this.second=i.getUTCSeconds()):(this.zone=t.Timezone.localTimezone,this.year=i.getFullYear(),this.month=i.getMonth()+1,this.day=i.getDate(),this.hour=i.getHours(),this.minute=i.getMinutes(),this.second=i.getSeconds()):this.reset(),this._cachedUnixTime=null,this},fromData:function(i,n){if(i){for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(s==="icaltype")continue;this[s]=i[s]}}if(n&&(this.zone=n),i&&!("isDate"in i)?this.isDate=!("hour"in i):i&&"isDate"in i&&(this.isDate=i.isDate),i&&"timezone"in i){var a=t.TimezoneService.get(i.timezone);this.zone=a||t.Timezone.localTimezone}return i&&"zone"in i&&(this.zone=i.zone),this.zone||(this.zone=t.Timezone.localTimezone),this._cachedUnixTime=null,this},dayOfWeek:function(i){var n=i||t.Time.SUNDAY,s=(this.year<<12)+(this.month<<8)+(this.day<<3)+n;if(s in t.Time._dowCache)return t.Time._dowCache[s];var a=this.day,o=this.month+(this.month<3?12:0),l=this.year-(this.month<3?1:0),u=a+l+t.helpers.trunc((o+1)*26/10)+t.helpers.trunc(l/4);return u+=t.helpers.trunc(l/100)*6+t.helpers.trunc(l/400),u=(u+7-n)%7+1,t.Time._dowCache[s]=u,u},dayOfYear:function(){var i=t.Time.isLeapYear(this.year)?1:0,n=t.Time.daysInYearPassedMonth;return n[i][this.month-1]+this.day},startOfWeek:function(i){var n=i||t.Time.SUNDAY,s=this.clone();return s.day-=(this.dayOfWeek()+7-n)%7,s.isDate=!0,s.hour=0,s.minute=0,s.second=0,s},endOfWeek:function(i){var n=i||t.Time.SUNDAY,s=this.clone();return s.day+=(7-this.dayOfWeek()+n-t.Time.SUNDAY)%7,s.isDate=!0,s.hour=0,s.minute=0,s.second=0,s},startOfMonth:function(){var i=this.clone();return i.day=1,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},endOfMonth:function(){var i=this.clone();return i.day=t.Time.daysInMonth(i.month,i.year),i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},startOfYear:function(){var i=this.clone();return i.day=1,i.month=1,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},endOfYear:function(){var i=this.clone();return i.day=31,i.month=12,i.isDate=!0,i.hour=0,i.minute=0,i.second=0,i},startDoyWeek:function(i){var n=i||t.Time.SUNDAY,s=this.dayOfWeek()-n;return s<0&&(s+=7),this.dayOfYear()-s},getDominicalLetter:function(){return t.Time.getDominicalLetter(this.year)},nthWeekDay:function(i,n){var s=t.Time.daysInMonth(this.month,this.year),a,o=n,l=0,u=this.clone();if(o>=0){u.day=1,o!=0&&o--,l=u.day;var h=u.dayOfWeek(),c=i-h;c<0&&(c+=7),l+=c,l-=i,a=i}else{u.day=s;var d=u.dayOfWeek();o++,a=d-i,a<0&&(a+=7),a=s-a}return a+=o*7,l+a},isNthWeekDay:function(r,i){var n=this.dayOfWeek();if(i===0&&n===r)return!0;var s=this.nthWeekDay(r,i);return s===this.day},weekNumber:function(i){var n=(this.year<<12)+(this.month<<8)+(this.day<<3)+i;if(n in t.Time._wnCache)return t.Time._wnCache[n];var s,a=this.clone();a.isDate=!0;var o=this.year;a.month==12&&a.day>25?(s=t.Time.weekOneStarts(o+1,i),a.compare(s)<0?s=t.Time.weekOneStarts(o,i):o++):(s=t.Time.weekOneStarts(o,i),a.compare(s)<0&&(s=t.Time.weekOneStarts(--o,i)));var l=a.subtractDate(s).toSeconds()/86400,u=t.helpers.trunc(l/7)+1;return t.Time._wnCache[n]=u,u},addDuration:function(i){var n=i.isNegative?-1:1,s=this.second,a=this.minute,o=this.hour,l=this.day;s+=n*i.seconds,a+=n*i.minutes,o+=n*i.hours,l+=n*i.days,l+=n*7*i.weeks,this.second=s,this.minute=a,this.hour=o,this.day=l,this._cachedUnixTime=null},subtractDate:function(i){var n=this.toUnixTime()+this.utcOffset(),s=i.toUnixTime()+i.utcOffset();return t.Duration.fromSeconds(n-s)},subtractDateTz:function(i){var n=this.toUnixTime(),s=i.toUnixTime();return t.Duration.fromSeconds(n-s)},compare:function(i){var n=this.toUnixTime(),s=i.toUnixTime();return n>s?1:s>n?-1:0},compareDateOnlyTz:function(i,n){function s(u){return t.Time._cmp_attr(a,o,u)}var a=this.convertToZone(n),o=i.convertToZone(n),l=0;return(l=s("year"))!=0||(l=s("month"))!=0||(l=s("day"))!=0,l},convertToZone:function(i){var n=this.clone(),s=this.zone.tzid==i.tzid;return!this.isDate&&!s&&t.Timezone.convert_time(n,this.zone,i),n.zone=i,n},utcOffset:function(){return this.zone==t.Timezone.localTimezone||this.zone==t.Timezone.utcTimezone?0:this.zone.utcOffset(this)},toICALString:function(){var r=this.toString();return r.length>10?t.design.icalendar.value["date-time"].toICAL(r):t.design.icalendar.value.date.toICAL(r)},toString:function(){var i=this.year+"-"+t.helpers.pad2(this.month)+"-"+t.helpers.pad2(this.day);return this.isDate||(i+="T"+t.helpers.pad2(this.hour)+":"+t.helpers.pad2(this.minute)+":"+t.helpers.pad2(this.second),this.zone===t.Timezone.utcTimezone&&(i+="Z")),i},toJSDate:function(){return this.zone==t.Timezone.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)},_normalize:function(){return this._time.isDate,this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this},adjust:function(i,n,s,a,o){var l,u,h=0,c=0,d,f,p,m,g,v=o||this._time;if(v.isDate||(d=v.second+a,v.second=d%60,l=t.helpers.trunc(d/60),v.second<0&&(v.second+=60,l--),f=v.minute+s+l,v.minute=f%60,u=t.helpers.trunc(f/60),v.minute<0&&(v.minute+=60,u--),p=v.hour+n+u,v.hour=p%24,h=t.helpers.trunc(p/24),v.hour<0&&(v.hour+=24,h--)),v.month>12?c=t.helpers.trunc((v.month-1)/12):v.month<1&&(c=t.helpers.trunc(v.month/12)-1),v.year+=c,v.month-=12*c,m=v.day+i+h,m>0)for(;g=t.Time.daysInMonth(v.month,v.year),!(m<=g);)v.month++,v.month>12&&(v.year++,v.month=1),m-=g;else for(;m<=0;)v.month==1?(v.year--,v.month=12):v.month--,m+=t.Time.daysInMonth(v.month,v.year);return v.day=m,this._cachedUnixTime=null,this},fromUnixTime:function(i){this.zone=t.Timezone.utcTimezone;var n=t.Time.epochTime.clone();n.adjust(0,0,0,i),this.year=n.year,this.month=n.month,this.day=n.day,this.hour=n.hour,this.minute=n.minute,this.second=Math.floor(n.second),this._cachedUnixTime=null},toUnixTime:function(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;var i=this.utcOffset(),n=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-i);return this._cachedUnixTime=n/1e3,this._cachedUnixTime},toJSON:function(){for(var r=["year","month","day","hour","minute","second","isDate"],i=Object.create(null),n=0,s=r.length,a;n<s;n++)a=r[n],i[a]=this[a];return this.zone&&(i.timezone=this.zone.tzid),i}},function(){function i(n){Object.defineProperty(t.Time.prototype,n,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[n]},set:function(a){return n==="isDate"&&a&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[n]=a,a}})}"defineProperty"in Object&&(i("year"),i("month"),i("day"),i("hour"),i("minute"),i("second"),i("isDate"))}(),t.Time.daysInMonth=function(i,n){var s=[0,31,28,31,30,31,30,31,31,30,31,30,31],a=30;return i<1||i>12||(a=s[i],i==2&&(a+=t.Time.isLeapYear(n))),a},t.Time.isLeapYear=function(i){return i<=1752?i%4==0:i%4==0&&i%100!=0||i%400==0},t.Time.fromDayOfYear=function(i,n){var s=n,a=i,o=new t.Time;o.auto_normalize=!1;var l=t.Time.isLeapYear(s)?1:0;if(a<1)return s--,l=t.Time.isLeapYear(s)?1:0,a+=t.Time.daysInYearPassedMonth[l][12],t.Time.fromDayOfYear(a,s);if(a>t.Time.daysInYearPassedMonth[l][12])return l=t.Time.isLeapYear(s)?1:0,a-=t.Time.daysInYearPassedMonth[l][12],s++,t.Time.fromDayOfYear(a,s);o.year=s,o.isDate=!0;for(var u=11;u>=0;u--)if(a>t.Time.daysInYearPassedMonth[l][u]){o.month=u+1,o.day=a-t.Time.daysInYearPassedMonth[l][u];break}return o.auto_normalize=!0,o},t.Time.fromStringv2=function(i){return new t.Time({year:parseInt(i.substr(0,4),10),month:parseInt(i.substr(5,2),10),day:parseInt(i.substr(8,2),10),isDate:!0})},t.Time.fromDateString=function(r){return new t.Time({year:t.helpers.strictParseInt(r.substr(0,4)),month:t.helpers.strictParseInt(r.substr(5,2)),day:t.helpers.strictParseInt(r.substr(8,2)),isDate:!0})},t.Time.fromDateTimeString=function(r,i){if(r.length<19)throw new Error('invalid date-time value: "'+r+'"');var n;r[19]&&r[19]==="Z"?n="Z":i&&(n=i.getParameter("tzid"));var s=new t.Time({year:t.helpers.strictParseInt(r.substr(0,4)),month:t.helpers.strictParseInt(r.substr(5,2)),day:t.helpers.strictParseInt(r.substr(8,2)),hour:t.helpers.strictParseInt(r.substr(11,2)),minute:t.helpers.strictParseInt(r.substr(14,2)),second:t.helpers.strictParseInt(r.substr(17,2)),timezone:n});return s},t.Time.fromString=function(i,n){return i.length>10?t.Time.fromDateTimeString(i,n):t.Time.fromDateString(i)},t.Time.fromJSDate=function(i,n){var s=new t.Time;return s.fromJSDate(i,n)},t.Time.fromData=function(i,n){var s=new t.Time;return s.fromData(i,n)},t.Time.now=function(){return t.Time.fromJSDate(new Date,!1)},t.Time.weekOneStarts=function(i,n){var s=t.Time.fromData({year:i,month:1,day:1,isDate:!0}),a=s.dayOfWeek(),o=n||t.Time.DEFAULT_WEEK_START;return a>t.Time.THURSDAY&&(s.day+=7),o>t.Time.THURSDAY&&(s.day-=7),s.day-=a-o,s},t.Time.getDominicalLetter=function(r){var i="GFEDCBA",n=(r+(r/4|0)+(r/400|0)-(r/100|0)-1)%7,s=t.Time.isLeapYear(r);return s?i[(n+6)%7]+i[n]:i[n]},t.Time.epochTime=t.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"}),t.Time._cmp_attr=function(i,n,s){return i[s]>n[s]?1:i[s]<n[s]?-1:0},t.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]],t.Time.SUNDAY=1,t.Time.MONDAY=2,t.Time.TUESDAY=3,t.Time.WEDNESDAY=4,t.Time.THURSDAY=5,t.Time.FRIDAY=6,t.Time.SATURDAY=7,t.Time.DEFAULT_WEEK_START=t.Time.MONDAY}(),function(){t.VCardTime=function(r,i,n){this.wrappedJSObject=this;var s=this._time=Object.create(null);s.year=null,s.month=null,s.day=null,s.hour=null,s.minute=null,s.second=null,this.icaltype=n||"date-and-or-time",this.fromData(r,i)},t.helpers.inherits(t.Time,t.VCardTime,{icalclass:"vcardtime",icaltype:"date-and-or-time",zone:null,clone:function(){return new t.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function(){return this},utcOffset:function(){return this.zone instanceof t.UtcOffset?this.zone.toSeconds():t.Time.prototype.utcOffset.apply(this,arguments)},toICALString:function(){return t.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function(){var i=t.helpers.pad2,n=this.year,s=this.month,a=this.day,o=this.hour,l=this.minute,u=this.second,h=n!==null,c=s!==null,d=a!==null,f=o!==null,p=l!==null,m=u!==null,g=(h?i(n)+(c||d?"-":""):c||d?"--":"")+(c?i(s):"")+(d?"-"+i(a):""),v=(f?i(o):"-")+(f&&p?":":"")+(p?i(l):"")+(!f&&!p?"-":"")+(p&&m?":":"")+(m?i(u):""),y;if(this.zone===t.Timezone.utcTimezone)y="Z";else if(this.zone instanceof t.UtcOffset)y=this.zone.toString();else if(this.zone===t.Timezone.localTimezone)y="";else if(this.zone instanceof t.Timezone){var x=t.UtcOffset.fromSeconds(this.zone.utcOffset(this));y=x.toString()}else y="";switch(this.icaltype){case"time":return v+y;case"date-and-or-time":case"date-time":return g+(v=="--"?"":"T"+v+y);case"date":return g}return null}}),t.VCardTime.fromDateAndOrTimeString=function(r,i){function n(g,v,y){return g?t.helpers.strictParseInt(g.substr(v,y)):null}var s=r.split("T"),a=s[0],o=s[1],l=o?t.design.vcard.value.time._splitZone(o):[],u=l[0],h=l[1];t.helpers.strictParseInt;var c=a?a.length:0,d=h?h.length:0,f=a&&a[0]=="-"&&a[1]=="-",p=h&&h[0]=="-",m={year:f?null:n(a,0,4),month:f&&(c==4||c==7)?n(a,2,2):c==7||c==10?n(a,5,2):null,day:c==5?n(a,3,2):c==7&&f?n(a,5,2):c==10?n(a,8,2):null,hour:p?null:n(h,0,2),minute:p&&d==3?n(h,1,2):d>4?p?n(h,1,2):n(h,3,2):null,second:d==4?n(h,2,2):d==6?n(h,4,2):d==8?n(h,6,2):null};return u=="Z"?u=t.Timezone.utcTimezone:u&&u[3]==":"?u=t.UtcOffset.fromString(u):u=null,new t.VCardTime(m,u,i)}}(),function(){var r={SU:t.Time.SUNDAY,MO:t.Time.MONDAY,TU:t.Time.TUESDAY,WE:t.Time.WEDNESDAY,TH:t.Time.THURSDAY,FR:t.Time.FRIDAY,SA:t.Time.SATURDAY},i={};for(var n in r)r.hasOwnProperty(n)&&(i[r[n]]=n);t.Recur=function(d){this.wrappedJSObject=this,this.parts={},d&&typeof d=="object"&&this.fromData(d)},t.Recur.prototype={parts:null,interval:1,wkst:t.Time.MONDAY,until:null,count:null,freq:null,icalclass:"icalrecur",icaltype:"recur",iterator:function(c){return new t.RecurIterator({rule:this,dtstart:c})},clone:function(){return new t.Recur(this.toJSON())},isFinite:function(){return!!(this.count||this.until)},isByCount:function(){return!!(this.count&&!this.until)},addComponent:function(d,f){var p=d.toUpperCase();p in this.parts?this.parts[p].push(f):this.parts[p]=[f]},setComponent:function(d,f){this.parts[d.toUpperCase()]=f.slice()},getComponent:function(d){var f=d.toUpperCase();return f in this.parts?this.parts[f].slice():[]},getNextOccurrence:function(d,f){var p=this.iterator(d),m;do m=p.next();while(m&&m.compare(f)<=0);return m&&f.zone&&(m.zone=f.zone),m},fromData:function(c){for(var d in c){var f=d.toUpperCase();f in h?Array.isArray(c[d])?this.parts[f]=c[d]:this.parts[f]=[c[d]]:this[d]=c[d]}this.interval&&typeof this.interval!="number"&&u.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=t.Recur.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof t.Time)&&(this.until=t.Time.fromString(this.until))},toJSON:function(){var c=Object.create(null);c.freq=this.freq,this.count&&(c.count=this.count),this.interval>1&&(c.interval=this.interval);for(var d in this.parts)if(this.parts.hasOwnProperty(d)){var f=this.parts[d];Array.isArray(f)&&f.length==1?c[d.toLowerCase()]=f[0]:c[d.toLowerCase()]=t.helpers.clone(this.parts[d])}return this.until&&(c.until=this.until.toString()),"wkst"in this&&this.wkst!==t.Time.DEFAULT_WEEK_START&&(c.wkst=t.Recur.numericDayToIcalDay(this.wkst)),c},toString:function(){var d="FREQ="+this.freq;this.count&&(d+=";COUNT="+this.count),this.interval>1&&(d+=";INTERVAL="+this.interval);for(var f in this.parts)this.parts.hasOwnProperty(f)&&(d+=";"+f+"="+this.parts[f]);return this.until&&(d+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==t.Time.DEFAULT_WEEK_START&&(d+=";WKST="+t.Recur.numericDayToIcalDay(this.wkst)),d}};function s(c,d,f,p){var m=p;if(p[0]==="+"&&(m=p.substr(1)),m=t.helpers.strictParseInt(m),d!==void 0&&p<d)throw new Error(c+': invalid value "'+p+'" must be > '+d);if(f!==void 0&&p>f)throw new Error(c+': invalid value "'+p+'" must be < '+d);return m}t.Recur.icalDayToNumericDay=function(d,f){var p=f||t.Time.SUNDAY;return(r[d]-p+7)%7+1},t.Recur.numericDayToIcalDay=function(d,f){var p=f||t.Time.SUNDAY,m=d+p-t.Time.SUNDAY;return m>7&&(m-=7),i[m]};var a=/^(SU|MO|TU|WE|TH|FR|SA)$/,o=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,l=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],u={FREQ:function(c,d,f){if(l.indexOf(c)!==-1)d.freq=c;else throw new Error('invalid frequency "'+c+'" expected: "'+l.join(", ")+'"')},COUNT:function(c,d,f){d.count=t.helpers.strictParseInt(c)},INTERVAL:function(c,d,f){d.interval=t.helpers.strictParseInt(c),d.interval<1&&(d.interval=1)},UNTIL:function(c,d,f){c.length>10?d.until=t.design.icalendar.value["date-time"].fromICAL(c):d.until=t.design.icalendar.value.date.fromICAL(c),f||(d.until=t.Time.fromString(d.until))},WKST:function(c,d,f){if(a.test(c))d.wkst=t.Recur.icalDayToNumericDay(c);else throw new Error('invalid WKST value "'+c+'"')}},h={BYSECOND:s.bind(this,"BYSECOND",0,60),BYMINUTE:s.bind(this,"BYMINUTE",0,59),BYHOUR:s.bind(this,"BYHOUR",0,23),BYDAY:function(c){if(o.test(c))return c;throw new Error('invalid BYDAY value "'+c+'"')},BYMONTHDAY:s.bind(this,"BYMONTHDAY",-31,31),BYYEARDAY:s.bind(this,"BYYEARDAY",-366,366),BYWEEKNO:s.bind(this,"BYWEEKNO",-53,53),BYMONTH:s.bind(this,"BYMONTH",1,12),BYSETPOS:s.bind(this,"BYSETPOS",-366,366)};t.Recur.fromString=function(c){var d=t.Recur._stringToData(c,!1);return new t.Recur(d)},t.Recur.fromData=function(c){return new t.Recur(c)},t.Recur._stringToData=function(c,d){for(var f=Object.create(null),p=c.split(";"),m=p.length,g=0;g<m;g++){var v=p[g].split("="),y=v[0].toUpperCase(),x=v[0].toLowerCase(),w=d?x:y,S=v[1];if(y in h){for(var _=S.split(","),A=0,M=_.length;A<M;A++)_[A]=h[y](_[A]);f[w]=_.length==1?_[0]:_}else y in u?u[y](S,f,d):f[x]=S}return f}}(),t.RecurIterator=function(){function r(i){this.fromData(i)}return r.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function(i){if(this.rule=t.helpers.formatClassType(i.rule,t.Recur),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=t.helpers.formatClassType(i.dtstart,t.Time),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");i.by_data?this.by_data=i.by_data:this.by_data=t.helpers.clone(this.rule.parts,!0),i.occurrence_number&&(this.occurrence_number=i.occurrence_number),this.days=i.days||[],i.last&&(this.last=t.helpers.formatClassType(i.last,t.Time)),this.by_indices=i.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=i.initialized||!1,this.initialized||this.init()},init:function(){this.initialized=!0,this.last=this.dtstart.clone();var n=this.by_data;if("BYDAY"in n&&this.sort_byday_rules(n.BYDAY),"BYYEARDAY"in n&&("BYMONTH"in n||"BYWEEKNO"in n||"BYMONTHDAY"in n||"BYDAY"in n))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in n&&"BYMONTHDAY"in n)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in n||"BYWEEKNO"in n))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in n||"BYMONTHDAY"in n))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in n)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in n){var s=this.ruleDayOfWeek(n.BYDAY[0],this.rule.wkst),a=s[0],o=s[1],l=o-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<o&&l>=0||l<0)&&(this.last.day+=l)}else{var u=t.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());n.BYDAY=[u]}if(this.rule.freq=="YEARLY"){for(;this.expand_year_days(this.last.year),!(this.days.length>0);)this.increment_year(this.rule.interval);this._nextByYearDay()}if(this.rule.freq=="MONTHLY"&&this.has_by_data("BYDAY")){var h=null,c=this.last.clone(),d=t.Time.daysInMonth(this.last.month,this.last.year);for(var f in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(f)){this.last=c.clone();var s=this.ruleDayOfWeek(this.by_data.BYDAY[f]),a=s[0],o=s[1],p=this.last.nthWeekDay(o,a);if(a>=6||a<=-6)throw new Error("Malformed values in BYDAY part");if(p>d||p<=0){if(h&&h.month==c.month)continue;for(;p>d||p<=0;)this.increment_month(),d=t.Time.daysInMonth(this.last.month,this.last.year),p=this.last.nthWeekDay(o,a)}this.last.day=p,(!h||this.last.compare(h)<0)&&(h=this.last.clone())}if(this.last=h.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>d||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")&&this.last.day<0){var d=t.Time.daysInMonth(this.last.month,this.last.year);this.last.day=d+this.last.day+1}},next:function(){var n=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)return this.completed=!0,null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;var s;do switch(s=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":s=this.next_month();break;case"YEARLY":this.next_year();break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!s);if(this.last.compare(n)==0)throw new Error("Same occurrence found twice, protecting you from death by recursion");return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)},next_second:function(){return this.next_generic("BYSECOND","SECONDLY","second","minute")},increment_second:function(n){return this.increment_generic(n,"second",60,"minute")},next_minute:function(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")},increment_minute:function(n){return this.increment_generic(n,"minute",60,"hour")},next_hour:function(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")},increment_hour:function(n){this.increment_generic(n,"hour",24,"monthday")},next_day:function(){"BYDAY"in this.by_data;var n=this.rule.freq=="DAILY";return this.next_hour()==0||(n?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0},next_week:function(){var n=0;if(this.next_weekday_by_week()==0)return n;if(this.has_by_data("BYWEEKNO")){++this.by_indices.BYWEEKNO,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,n=1),this.last.month=1,this.last.day=1;var s=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*s,n&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return n},normalizeByMonthDayRules:function(i,n,s){for(var a=t.Time.daysInMonth(n,i),o=[],l=0,u=s.length,h;l<u;l++)if(h=s[l],!(Math.abs(h)>a)){if(h<0)h=a+(h+1);else if(h===0)continue;o.indexOf(h)===-1&&o.push(h)}return o.sort(function(c,d){return c-d})},_byDayAndMonthDay:function(i){var n,s=this.by_data.BYDAY,a,o=0,l,u=s.length,h=0,c,d=this,f=this.last.day;function p(){for(c=t.Time.daysInMonth(d.last.month,d.last.year),n=d.normalizeByMonthDayRules(d.last.year,d.last.month,d.by_data.BYMONTHDAY),l=n.length;n[o]<=f&&!(i&&n[o]==f)&&o<l-1;)o++}function m(){f=0,d.increment_month(),o=0,p()}p(),i&&(f-=1);for(var g=48;!h&&g;){if(g--,a=f+1,a>c){m();continue}var v=n[o++];if(v>=a)f=v;else{m();continue}for(var y=0;y<u;y++){var x=this.ruleDayOfWeek(s[y]),w=x[0],S=x[1];if(this.last.day=f,this.last.isNthWeekDay(S,w)){h=1;break}}if(!h&&o===l){m();continue}}if(g<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return h},next_month:function(){this.rule.freq=="MONTHLY";var n=1;if(this.next_hour()==0)return n;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))n=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){var s=t.Time.daysInMonth(this.last.month,this.last.year),a=0,o=0;if(this.has_by_data("BYSETPOS")){for(var l=this.last.day,u=1;u<=s;u++)this.last.day=u,this.is_day_in_byday(this.last)&&(o++,u<=l&&a++);this.last.day=l}n=0;for(var u=this.last.day+1;u<=s;u++)if(this.last.day=u,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++a)||this.check_set_position(a-o-1))){n=1;break}u>s&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(n=1):n=0)}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());var s=t.Time.daysInMonth(this.last.month,this.last.year),u=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];u<0&&(u=s+u+1),u>s?(this.last.day=1,n=this.is_day_in_byday(this.last)):this.last.day=u}else{this.increment_month();var s=t.Time.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>s?n=0:this.last.day=this.by_data.BYMONTHDAY[0]}return n},next_weekday_by_week:function(){var n=0;if(this.next_hour()==0)return n;if(!this.has_by_data("BYDAY"))return 1;for(;;){var s=new t.Time;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,n=1);var a=this.by_data.BYDAY[this.by_indices.BYDAY],o=this.ruleDayOfWeek(a),l=o[1];l-=this.rule.wkst,l<0&&(l+=7),s.year=this.last.year,s.month=this.last.month,s.day=this.last.day;var u=s.startDoyWeek(this.rule.wkst);if(!(l+u<1&&!n)){var h=t.Time.fromDayOfYear(u+l,this.last.year);return this.last.year=h.year,this.last.month=h.month,this.last.day=h.day,n}}},next_year:function(){if(this.next_hour()==0)return 0;if(++this.days_index==this.days.length){this.days_index=0;do this.increment_year(this.rule.interval),this.expand_year_days(this.last.year);while(this.days.length==0)}return this._nextByYearDay(),1},_nextByYearDay:function(){var n=this.days[this.days_index],s=this.last.year;n<1&&(n+=1,s+=1);var a=t.Time.fromDayOfYear(n,s);this.last.day=a.day,this.last.month=a.month},ruleDayOfWeek:function(n,s){var a=n.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(a){var o=parseInt(a[1]||0,10);return n=t.Recur.icalDayToNumericDay(a[2],s),[o,n]}else return[0,0]},next_generic:function(n,s,a,o,l){var u=n in this.by_data,h=this.rule.freq==s,c=0;if(l&&this[l]()==0)return c;if(u){this.by_indices[n]++,this.by_indices[n];var d=this.by_data[n];this.by_indices[n]==d.length&&(this.by_indices[n]=0,c=1),this.last[a]=d[this.by_indices[n]]}else h&&this["increment_"+a](this.rule.interval);return u&&c&&h&&this["increment_"+o](1),c},increment_monthday:function(n){for(var s=0;s<n;s++){var a=t.Time.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>a&&(this.last.day-=a,this.increment_month())}},increment_month:function(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;var n=t.helpers.trunc(this.last.month/12);this.last.month%=12,this.last.month++,n!=0&&this.increment_year(n)}},increment_year:function(n){this.last.year+=n},increment_generic:function(n,s,a,o){this.last[s]+=n;var l=t.helpers.trunc(this.last[s]/a);this.last[s]%=a,l!=0&&this["increment_"+o](l)},has_by_data:function(n){return n in this.rule.parts},expand_year_days:function(n){var s=new t.Time;this.days=[];var a={},o=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(var l in o)if(o.hasOwnProperty(l)){var u=o[l];u in this.rule.parts&&(a[u]=this.rule.parts[u])}if("BYMONTH"in a&&"BYWEEKNO"in a){var h=1,c={};s.year=n,s.isDate=!0;for(var d=0;d<this.by_data.BYMONTH.length;d++){var f=this.by_data.BYMONTH[d];s.month=f,s.day=1;var p=s.weekNumber(this.rule.wkst);s.day=t.Time.daysInMonth(f,n);var m=s.weekNumber(this.rule.wkst);for(d=p;d<m;d++)c[d]=1}for(var g=0;g<this.by_data.BYWEEKNO.length&&h;g++){var v=this.by_data.BYWEEKNO[g];v<52?h&=c[g]:h=0}h?delete a.BYMONTH:delete a.BYWEEKNO}var y=Object.keys(a).length;if(y==0){var x=this.dtstart.clone();x.year=this.last.year,this.days.push(x.dayOfYear())}else if(y==1&&"BYMONTH"in a){for(var w in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(w)){var S=this.dtstart.clone();S.year=n,S.month=this.by_data.BYMONTH[w],S.isDate=!0,this.days.push(S.dayOfYear())}}else if(y==1&&"BYMONTHDAY"in a){for(var _ in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(_)){var A=this.dtstart.clone(),M=this.by_data.BYMONTHDAY[_];if(M<0){var T=t.Time.daysInMonth(A.month,n);M=M+T+1}A.day=M,A.year=n,A.isDate=!0,this.days.push(A.dayOfYear())}}else if(y==2&&"BYMONTHDAY"in a&&"BYMONTH"in a){for(var w in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(w)){var C=this.by_data.BYMONTH[w],T=t.Time.daysInMonth(C,n);for(var _ in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(_)){var M=this.by_data.BYMONTHDAY[_];M<0&&(M=M+T+1),s.day=M,s.month=C,s.year=n,s.isDate=!0,this.days.push(s.dayOfYear())}}}else if(!(y==1&&"BYWEEKNO"in a)){if(!(y==2&&"BYWEEKNO"in a&&"BYMONTHDAY"in a))if(y==1&&"BYDAY"in a)this.days=this.days.concat(this.expand_by_day(n));else if(y==2&&"BYDAY"in a&&"BYMONTH"in a){for(var w in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(w)){var f=this.by_data.BYMONTH[w],T=t.Time.daysInMonth(f,n);s.year=n,s.month=this.by_data.BYMONTH[w],s.day=1,s.isDate=!0;var L=s.dayOfWeek(),I=s.dayOfYear()-1;s.day=T;var k=s.dayOfWeek();if(this.has_by_data("BYSETPOS")){for(var z=[],V=1;V<=T;V++)s.day=V,this.is_day_in_byday(s)&&z.push(V);for(var K=0;K<z.length;K++)(this.check_set_position(K+1)||this.check_set_position(K-z.length))&&this.days.push(I+z[K])}else for(var q in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(q)){var O=this.by_data.BYDAY[q],W=this.ruleDayOfWeek(O),N=W[0],B=W[1],j,Q=(B+7-L)%7+1,H=T-(k+7-B)%7;if(N==0)for(var V=Q;V<=T;V+=7)this.days.push(I+V);else N>0?(j=Q+(N-1)*7,j<=T&&this.days.push(I+j)):(j=H+(N+1)*7,j>0&&this.days.push(I+j))}}this.days.sort(function(re,ae){return re-ae})}else if(y==2&&"BYDAY"in a&&"BYMONTHDAY"in a){var G=this.expand_by_day(n);for(var $ in G)if(G.hasOwnProperty($)){var V=G[$],se=t.Time.fromDayOfYear(V,n);this.by_data.BYMONTHDAY.indexOf(se.day)>=0&&this.days.push(V)}}else if(y==3&&"BYDAY"in a&&"BYMONTHDAY"in a&&"BYMONTH"in a){var G=this.expand_by_day(n);for(var $ in G)if(G.hasOwnProperty($)){var V=G[$],se=t.Time.fromDayOfYear(V,n);this.by_data.BYMONTH.indexOf(se.month)>=0&&this.by_data.BYMONTHDAY.indexOf(se.day)>=0&&this.days.push(V)}}else if(y==2&&"BYDAY"in a&&"BYWEEKNO"in a){var G=this.expand_by_day(n);for(var $ in G)if(G.hasOwnProperty($)){var V=G[$],se=t.Time.fromDayOfYear(V,n),v=se.weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(v)&&this.days.push(V)}}else y==3&&"BYDAY"in a&&"BYWEEKNO"in a&&"BYMONTHDAY"in a||(y==1&&"BYYEARDAY"in a?this.days=this.days.concat(this.by_data.BYYEARDAY):this.days=[])}return 0},expand_by_day:function(n){var s=[],a=this.last.clone();a.year=n,a.month=1,a.day=1,a.isDate=!0;var o=a.dayOfWeek();a.month=12,a.day=31,a.isDate=!0;var l=a.dayOfWeek(),u=a.dayOfYear();for(var h in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(h)){var c=this.by_data.BYDAY[h],d=this.ruleDayOfWeek(c),f=d[0],p=d[1];if(f==0)for(var m=(p+7-o)%7+1,g=m;g<=u;g+=7)s.push(g);else if(f>0){var v;p>=o?v=p-o+1:v=p-o+8,s.push(v+(f-1)*7)}else{var y;f=-f,p<=l?y=u-l+p:y=u-l+p-7,s.push(y-(f-1)*7)}}return s},is_day_in_byday:function(n){for(var s in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(s)){var a=this.by_data.BYDAY[s],o=this.ruleDayOfWeek(a),l=o[0],u=o[1],h=n.dayOfWeek();if(l==0&&u==h||n.nthWeekDay(u,l)==n.day)return 1}return 0},check_set_position:function(n){if(this.has_by_data("BYSETPOS")){var s=this.by_data.BYSETPOS.indexOf(n);return s!==-1}return!1},sort_byday_rules:function(n){for(var s=0;s<n.length;s++)for(var a=0;a<s;a++){var o=this.ruleDayOfWeek(n[a],this.rule.wkst)[1],l=this.ruleDayOfWeek(n[s],this.rule.wkst)[1];if(o>l){var u=n[s];n[s]=n[a],n[a]=u}}},check_contract_restriction:function(n,s){var a=r._indexMap[n],o=r._expandMap[this.rule.freq][a],l=!1;if(n in this.by_data&&o==r.CONTRACT){var u=this.by_data[n];for(var h in u)if(u.hasOwnProperty(h)&&u[h]==s){l=!0;break}}else l=!0;return l},check_contracting_rules:function(){var n=this.last.dayOfWeek(),s=this.last.weekNumber(this.rule.wkst),a=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",t.Recur.numericDayToIcalDay(n))&&this.check_contract_restriction("BYWEEKNO",s)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",a)},setup_defaults:function(n,s,a){var o=r._indexMap[n],l=r._expandMap[this.rule.freq][o];return l!=r.CONTRACT&&(n in this.by_data||(this.by_data[n]=[a]),this.rule.freq!=s)?this.by_data[n][0]:a},toJSON:function(){var i=Object.create(null);return i.initialized=this.initialized,i.rule=this.rule.toJSON(),i.dtstart=this.dtstart.toJSON(),i.by_data=this.by_data,i.days=this.days,i.last=this.last.toJSON(),i.by_indices=this.by_indices,i.occurrence_number=this.occurrence_number,i}},r._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8},r._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]},r.UNKNOWN=0,r.CONTRACT=1,r.EXPAND=2,r.ILLEGAL=3,r}(),t.RecurExpansion=function(){function r(a){return t.helpers.formatClassType(a,t.Time)}function i(a,o){return a.compare(o)}function n(a){return a.hasProperty("rdate")||a.hasProperty("rrule")||a.hasProperty("recurrence-id")}function s(a){this.ruleDates=[],this.exDates=[],this.fromData(a)}return s.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(a){var o=t.helpers.formatClassType(a.dtstart,t.Time);if(o)this.dtstart=o;else throw new Error(".dtstart (ICAL.Time) must be given");if(a.component)this._init(a.component);else{if(this.last=r(a.last)||o.clone(),!a.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=a.ruleIterators.map(function(l){return t.helpers.formatClassType(l,t.RecurIterator)}),this.ruleDateInc=a.ruleDateInc,this.exDateInc=a.exDateInc,a.ruleDates&&(this.ruleDates=a.ruleDates.map(r),this.ruleDate=this.ruleDates[this.ruleDateInc]),a.exDates&&(this.exDates=a.exDates.map(r),this.exDate=this.exDates[this.exDateInc]),typeof a.complete<"u"&&(this.complete=a.complete)}},next:function(){for(var a,o,l,u=500,h=0;;){if(h++>u)throw new Error("max tries have occured, rule may be impossible to forfill.");if(o=this.ruleDate,a=this._nextRecurrenceIter(this.last),!o&&!a){this.complete=!0;break}if((!o||a&&o.compare(a.last)>0)&&(o=a.last.clone(),a.next()),this.ruleDate===o&&this._nextRuleDay(),this.last=o,this.exDate&&(l=this.exDate.compare(this.last),l<0&&this._nextExDay(),l===0)){this._nextExDay();continue}return this.last}},toJSON:function(){function a(l){return l.toJSON()}var o=Object.create(null);return o.ruleIterators=this.ruleIterators.map(a),this.ruleDates&&(o.ruleDates=this.ruleDates.map(a)),this.exDates&&(o.exDates=this.exDates.map(a)),o.ruleDateInc=this.ruleDateInc,o.exDateInc=this.exDateInc,o.last=this.last.toJSON(),o.dtstart=this.dtstart.toJSON(),o.complete=this.complete,o},_extractDates:function(a,o){function l(p){f=t.helpers.binsearchInsert(u,p,i),u.splice(f,0,p)}for(var u=[],h=a.getAllProperties(o),c=h.length,d=0,f;d<c;d++)h[d].getValues().forEach(l);return u},_init:function(a){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!n(a)){this.ruleDate=this.last.clone(),this.complete=!0;return}if(a.hasProperty("rdate")&&(this.ruleDates=this._extractDates(a,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=t.helpers.binsearchInsert(this.ruleDates,this.last,i),this.ruleDate=this.ruleDates[this.ruleDateInc]),a.hasProperty("rrule"))for(var o=a.getAllProperties("rrule"),l=0,u=o.length,h,c;l<u;l++)h=o[l].getFirstValue(),c=h.iterator(this.dtstart),this.ruleIterators.push(c),c.next();a.hasProperty("exdate")&&(this.exDates=this._extractDates(a,"exdate"),this.exDateInc=t.helpers.binsearchInsert(this.exDates,this.last,i),this.exDate=this.exDates[this.exDateInc])},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function(){var a=this.ruleIterators;if(a.length===0)return null;for(var o=a.length,l,u,h=0,c;h<o;h++){if(l=a[h],u=l.last,l.completed){o--,h!==0&&h--,a.splice(h,1);continue}(!c||c.last.compare(u)>0)&&(c=l)}return c}},s}(),t.Event=function(){function r(n,s){n instanceof t.Component||(s=n,n=null),n?this.component=n:this.component=new t.Component("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],s&&s.strictExceptions&&(this.strictExceptions=s.strictExceptions),s&&s.exceptions?s.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(a){a.hasProperty("recurrence-id")&&this.relateException(a)},this)}r.prototype={THISANDFUTURE:"THISANDFUTURE",exceptions:null,strictExceptions:!1,relateException:function(n){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(n instanceof t.Component&&(n=new t.Event(n)),this.strictExceptions&&n.uid!==this.uid)throw new Error("attempted to relate unrelated exception");var s=n.recurrenceId.toString();if(this.exceptions[s]=n,n.modifiesFuture()){var a=[n.recurrenceId.toUnixTime(),s],o=t.helpers.binsearchInsert(this.rangeExceptions,a,i);this.rangeExceptions.splice(o,0,a)}},modifiesFuture:function(){if(!this.component.hasProperty("recurrence-id"))return!1;var n=this.component.getFirstProperty("recurrence-id").getParameter("range");return n===this.THISANDFUTURE},findRangeException:function(n){if(!this.rangeExceptions.length)return null;var s=n.toUnixTime(),a=t.helpers.binsearchInsert(this.rangeExceptions,[s],i);if(a-=1,a<0)return null;var o=this.rangeExceptions[a];return s<o[0]?null:o[1]},getOccurrenceDetails:function(n){var s=n.toString(),a=n.convertToZone(t.Timezone.utcTimezone).toString(),o,l={recurrenceId:n};if(s in this.exceptions)o=l.item=this.exceptions[s],l.startDate=o.startDate,l.endDate=o.endDate,l.item=o;else if(a in this.exceptions)o=this.exceptions[a],l.startDate=o.startDate,l.endDate=o.endDate,l.item=o;else{var u=this.findRangeException(n),h;if(u){var c=this.exceptions[u];l.item=c;var d=this._rangeExceptionCache[u];if(!d){var f=c.recurrenceId.clone(),p=c.startDate.clone();f.zone=p.zone,d=p.subtractDate(f),this._rangeExceptionCache[u]=d}var m=n.clone();m.zone=c.startDate.zone,m.addDuration(d),h=m.clone(),h.addDuration(c.duration),l.startDate=m,l.endDate=h}else h=n.clone(),h.addDuration(this.duration),l.endDate=h,l.startDate=n,l.item=this}return l},iterator:function(n){return new t.RecurExpansion({component:this.component,dtstart:n||this.startDate})},isRecurring:function(){var n=this.component;return n.hasProperty("rrule")||n.hasProperty("rdate")},isRecurrenceException:function(){return this.component.hasProperty("recurrence-id")},getRecurrenceTypes:function(){for(var n=this.component.getAllProperties("rrule"),s=0,a=n.length,o=Object.create(null);s<a;s++){var l=n[s].getFirstValue();o[l.freq]=!0}return o},get uid(){return this._firstProp("uid")},set uid(n){this._setProp("uid",n)},get startDate(){return this._firstProp("dtstart")},set startDate(n){this._setTime("dtstart",n)},get endDate(){var n=this._firstProp("dtend");if(!n){var s=this._firstProp("duration");n=this.startDate.clone(),s?n.addDuration(s):n.isDate&&(n.day+=1)}return n},set endDate(n){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",n)},get duration(){var n=this._firstProp("duration");return n||this.endDate.subtractDateTz(this.startDate)},set duration(n){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",n)},get location(){return this._firstProp("location")},set location(n){return this._setProp("location",n)},get attendees(){return this.component.getAllProperties("attendee")},get summary(){return this._firstProp("summary")},set summary(n){this._setProp("summary",n)},get description(){return this._firstProp("description")},set description(n){this._setProp("description",n)},get color(){return this._firstProp("color")},set color(n){this._setProp("color",n)},get organizer(){return this._firstProp("organizer")},set organizer(n){this._setProp("organizer",n)},get sequence(){return this._firstProp("sequence")},set sequence(n){this._setProp("sequence",n)},get recurrenceId(){return this._firstProp("recurrence-id")},set recurrenceId(n){this._setTime("recurrence-id",n)},_setTime:function(n,s){var a=this.component.getFirstProperty(n);a||(a=new t.Property(n),this.component.addProperty(a)),s.zone===t.Timezone.localTimezone||s.zone===t.Timezone.utcTimezone?a.removeParameter("tzid"):a.setParameter("tzid",s.zone.tzid),a.setValue(s)},_setProp:function(n,s){this.component.updatePropertyWithValue(n,s)},_firstProp:function(n){return this.component.getFirstPropertyValue(n)},toString:function(){return this.component.toString()}};function i(n,s){return n[0]>s[0]?1:s[0]>n[0]?-1:0}return r}(),t.ComponentParser=function(){function r(i){typeof i>"u"&&(i={});var n;for(n in i)i.hasOwnProperty(n)&&(this[n]=i[n])}return r.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function(){},onerror:function(i){},ontimezone:function(i){},onevent:function(i){},process:function(i){typeof i=="string"&&(i=t.parse(i)),i instanceof t.Component||(i=new t.Component(i));for(var n=i.getAllSubcomponents(),s=0,a=n.length,o;s<a;s++)switch(o=n[s],o.name){case"vtimezone":if(this.parseTimezone){var l=o.getFirstPropertyValue("tzid");l&&this.ontimezone(new t.Timezone({tzid:l,component:o}))}break;case"vevent":this.parseEvent&&this.onevent(new t.Event(o));break;default:continue}this.oncomplete()}},r}()})(Q6);var iIe=Q6.exports;const nIe=sp(iIe);Ke.updateLocale("en",{longDateFormat:{LTS:"HH:mm:ss",LT:"HH:mm",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM D, YYYY HH:mm"}});const sIe=tPe(Ke),aIe=()=>{yb();const{tasks:e,urlIcal:t}=N2(),[r,i]=pe.useState([]),[n,s]=pe.useState(!1),a=async o=>{try{const u=await(await fetch("http://localhost:3001/ical",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({url:o})}).then(d=>{if(!d.ok)throw new Error("Erreur lors de la connexion");return d})).text(),c=nIe.parse(u)[2].map(d=>{const f=d[1],p=f[1][3],m=f[2][3];return{title:f[3][3],start:new Date(p),end:new Date(m)}});i(d=>[...d,...c])}catch(l){console.error("Erreur lors de l'import du fichier iCalendar",l)}};return pe.useEffect(()=>{if(e.length===0)return;const l=e.map(u=>{let c=u.task_date_add.split("T");c[0].split("-");let p=u.task_due_date.split("T")[0].split("-"),m=p[1],g=0;switch(m){case"01":g=0;break;case"02":g=1;break;case"03":g=2;break;case"04":g=3;break;case"05":g=4;break;case"06":g=5;break;case"07":g=6;break;case"08":g=7;break;case"09":g=8;break;case"10":g=9;break;case"11":g=10;break;case"12":g=11;break;default:g=0;break}let v=p[2],y=p[0],x=c[1].split(":")[0],w=c[1].split(":")[1],S=parseInt(x);return S=S+1,{title:u.task_name,year:y,month:g,day:v,startHour:x,startMinute:w,endHour:S,endMinute:w}}).map(u=>({title:u.title,start:new Date(u.year,u.month,u.day,u.startHour,u.startMinute),end:new Date(u.year,u.month,u.day,u.endHour,u.endMinute)}));i(l),!n&&t!==void 0&&t!==null&&t!==""&&(console.log("Import du fichier iCalendar"),a(t),s(!0))},[e,t,n]),St("div",{className:"view__dashboard",children:[ge(xb,{}),St("div",{className:"view__dashboard__content",children:[ge(wb,{}),ge("div",{style:{height:"110%",width:"100%",paddingBottom:"20px"},children:ge($2e,{localizer:sIe,events:r,views:["day","week"],defaultView:"week",step:60,showMultiDayTimes:!0,formats:{eventTimeRangeFormat:function({start:o,end:l},u,h){return(h==null?void 0:h.format(o,"HH:mm",u))+" - "+(h==null?void 0:h.format(l,"HH:mm",u))},agendaTimeRangeFormat:function({start:o,end:l},u,h){return(h==null?void 0:h.format(o,"HH:mm",u))+" - "+(h==null?void 0:h.format(l,"HH:mm",u))},dayRangeHeaderFormat:function({start:o,end:l},u,h){return(h==null?void 0:h.format(o,"MMMM DD, YYYY",u))+" - "+(h==null?void 0:h.format(l,"MMMM DD, YYYY",u))}}})})]})]})};const oIe=()=>(yb(),St("div",{className:"view__dashboard",children:[ge(xb,{}),ge("div",{className:"view__dashboard__content",children:ge(wb,{})})]}));const lIe=()=>(yb(),St("div",{className:"view__dashboard",children:[ge(xb,{}),St("div",{className:"view__dashboard__content",children:[ge(wb,{}),St("form",{action:"",onSubmit:t=>{t.preventDefault();const r=t.target.url.value;localStorage.setItem("urlIcal",r)},children:[ge("input",{type:"text",name:"url",id:"url"}),ge("button",{type:"submit",children:"Enregistrer"})]})]})]}));const uIe=KX(XE([ge(rl,{path:"/",element:ge(G3,{})}),ge(rl,{path:"/login",element:ge(Owe,{})}),ge(rl,{path:"/register",element:ge(Lwe,{})}),ge(rl,{path:"/home",element:ge(Xwe,{})}),ge(rl,{path:"/calendar",element:ge(aIe,{})}),ge(rl,{path:"/premium",element:ge(oIe,{})}),ge(rl,{path:"/settings",element:ge(lIe,{})}),ge(rl,{path:"*",element:ge(G3,{})})]));KM.createRoot(document.getElementById("root")).render(ge(fe.StrictMode,{children:ge(s$,{children:St(jwe,{children:[ge(u$,{}),ge(r4,{}),ge(VX,{router:uIe})]})})}));postMessage({payload:"removeLoading"},"*");
